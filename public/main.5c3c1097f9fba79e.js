(self.webpackChunkScssAngular=self.webpackChunkScssAngular||[]).push([[179],{2340:(zn,zt,Te)=>{"use strict";Te.d(zt,{N:()=>H});const H={production:!0,mapboxToken:"pk.eyJ1IjoidGhlcGhvZW5peDI2NjEiLCJhIjoiY2w4MGtuaGg2MDc3aDN3bWtoZWlodHd4eiJ9.k4EGjyiZRiNg9BBLEjggNg",urlAuth:"https://meeti-angular-project.herokuapp.com/api/auth"}},2865:(zn,zt,Te)=>{"use strict";var H=Te(1481),Ie=Te(8256),nt=Te(4154);const c=[{path:"meeti",loadChildren:()=>Te.e(922).then(Te.bind(Te,3922)).then(tt=>tt.MeetiModule)},{path:"**",pathMatch:"full",redirectTo:"meeti"}];let Fe=(()=>{class tt{}return tt.\u0275fac=function(un){return new(un||tt)},tt.\u0275mod=Ie.oAB({type:tt}),tt.\u0275inj=Ie.cJS({imports:[nt.Bz.forRoot(c),nt.Bz]}),tt})();var Jt=Te(9898),kt=Te(2340);let Ye=(()=>{class tt{constructor(){this.title="ScssAngular"}ngOnInit(){Jt.accessToken=kt.N.mapboxToken}}return tt.\u0275fac=function(un){return new(un||tt)},tt.\u0275cmp=Ie.Xpm({type:tt,selectors:[["app-root"]],decls:1,vars:0,template:function(un,Tt){1&un&&Ie._UZ(0,"router-outlet")},dependencies:[nt.lC],encapsulation:2}),tt})();var gt=Te(529);let yt=(()=>{class tt{}return tt.\u0275fac=function(un){return new(un||tt)},tt.\u0275mod=Ie.oAB({type:tt,bootstrap:[Ye]}),tt.\u0275inj=Ie.cJS({imports:[H.b2,Fe,gt.JF]}),tt})();kt.N.production&&(0,Ie.G48)(),H.q6().bootstrapModule(yt).catch(tt=>console.error(tt))},9898:function(zn){zn.exports=function(){"use strict";var zt,Te,H;function Ie(c,Fe){if(zt)if(Te){var Jt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+zt+")(sharedChunk); ("+Te+")(sharedChunk); self.onerror = null;",kt={};zt(kt),H=Fe(kt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(H.workerUrl=window.URL.createObjectURL(new Blob([Jt],{type:"text/javascript"})))}else Te=Fe;else zt=Fe}return Ie(0,function(c){var Fe=typeof self<"u"?self:{},Jt=kt;function kt(n,e,t,s){this.cx=3*n,this.bx=3*(t-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=t,this.p2y=s}kt.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},kt.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},kt.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},kt.prototype.solveCurveX=function(n,e){var t,s,u,f,m;for(void 0===e&&(e=1e-6),u=n,m=0;m<8;m++){if(f=this.sampleCurveX(u)-n,Math.abs(f)<e)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=f/y}if((u=n)<(t=0))return t;if(u>(s=1))return s;for(;t<s;){if(f=this.sampleCurveX(u),Math.abs(f-n)<e)return u;n>f?t=u:s=u,u=.5*(s-t)+t}return u},kt.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var Ye=gt;function gt(n,e){this.x=n,this.y=e}gt.prototype={clone:function(){return new gt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,t=n.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),t=Math.sin(n),s=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=s,this},_rotateAround:function(n,e){var t=Math.cos(n),s=Math.sin(n),u=e.y+s*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},gt.convert=function(n){return n instanceof gt?n:Array.isArray(n)?new gt(n[0],n[1]):n};const yt=Math.PI/180,tt=180/Math.PI;function st(n){return n*yt}function un(n){return n*tt}const Tt=[[0,0],[1,0],[1,1],[0,1]];function xn(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,t=e*n;return 4*(n<.5?t:3*(n-e)+t-.75)}function hn(n,e,t,s){const u=new Jt(n,e,t,s);return function(f){return u.solve(f)}}const Cn=hn(.25,.1,.25,1);function $t(n,e,t){return Math.min(t,Math.max(e,n))}function nr(n,e,t){return(t=$t((t-n)/(e-n),0,1))*t*(3-2*t)}function rn(n,e,t){const s=t-e,u=((n-e)%s+s)%s+e;return u===e?t:u}function Qt(n,e,t){if(!n.length)return t(null,[]);let s=n.length;const u=new Array(n.length);let f=null;n.forEach((m,y)=>{e(m,(b,w)=>{b&&(f=b),u[y]=w,0==--s&&t(f,u)})})}function Ht(n){const e=[];for(const t in n)e.push(n[t]);return e}function xt(n,...e){for(const t of e)for(const s in t)n[s]=t[s];return n}let sr=1;function At(){return sr++}function Ct(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function en(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Ze(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Ge(n,e){n.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function ot(n,e){return-1!==n.indexOf(e,n.length-e.length)}function We(n,e,t){const s={};for(const u in n)s[u]=e.call(t||this,n[u],u,n);return s}function Gt(n,e,t){const s={};for(const u in n)e.call(t||this,n[u],u,n)&&(s[u]=n[u]);return s}function dt(n){return Array.isArray(n)?n.map(dt):"object"==typeof n&&n?We(n,dt):n}const wn={};function dn(n){wn[n]||(typeof console<"u"&&console.warn(n),wn[n]=!0)}function Sr(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function En(n){let e=0;for(let t,s,u=0,f=n.length,m=f-1;u<f;m=u++)t=n[u],s=n[m],e+=(s.x-t.x)*(t.y+s.y);return e}function qn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function oi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,s,u,f)=>{const m=u||f;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let pr=null;function xi(n){if(null==pr){const e=n.navigator?n.navigator.userAgent:null;pr=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return pr}function Jr(n){try{const e=Fe[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function yr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const hr=Fe.performance;function Vn(n){const e=n?n.url.toString():void 0;return hr.getEntriesByName(e)}let Jn,$i,Mr,Li;const si={now:()=>void 0!==Mr?Mr:Fe.performance.now(),setNow(n){Mr=n},restoreNow(){Mr=void 0},frame(n){const e=Fe.requestAnimationFrame(n);return{cancel:()=>Fe.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:t,height:s}=n;Li||(Li=Fe.document.createElement("canvas"));const u=Li.getContext("2d");if(!u)throw new Error("failed to create canvas 2d context");return(t>Li.width||s>Li.height)&&(Li.width=t,Li.height=s),u.clearRect(-e,-e,t+2*e,s+2*e),u.drawImage(n,0,0,t,s),u.getImageData(-e,-e,t+2*e,s+2*e)},resolveURL:n=>(Jn||(Jn=Fe.document.createElement("a")),Jn.href=n,Jn.href),get devicePixelRatio(){return Fe.devicePixelRatio},get prefersReducedMotion(){return!!Fe.matchMedia&&(null==$i&&($i=Fe.matchMedia("(prefers-reduced-motion: reduce)")),$i.matches)}};let Gi;const Bn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Gi){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Gi=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{Gi=n}}return Gi},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},mn={supported:!1,testSupport:function(n){!Oi&&fo&&(io?Xo(n):pi=n)}};let pi,fo,Oi=!1,io=!1;function Xo(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,fo),n.isContextLost())return;mn.supported=!0}catch{}n.deleteTexture(e),Oi=!0}Fe.document&&(fo=Fe.document.createElement("img"),fo.onload=function(){pi&&Xo(pi),pi=null,io=!0},fo.onerror=function(){Oi=!0,pi=null},fo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qr="01",ft="NO_ACCESS_TOKEN";function _e(n){return 0===n.indexOf("mapbox:")}function xe(n){return Bn.API_URL_REGEX.test(n)}const ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(n){const e=n.match(ct);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function cn(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function Sn(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Fe.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ar{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Sn(Bn.ACCESS_TOKEN);let s="";return s=t&&t.u?Fe.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):Bn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=Jr("localStorage"),t=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Fe.localStorage.getItem(t);u&&(this.eventData=JSON.parse(u));const f=Fe.localStorage.getItem(s);f&&(this.anonId=f)}catch{dn("Unable to read from LocalStorage")}}saveEventData(){const e=Jr("localStorage"),t=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Fe.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Fe.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{dn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,s,u){if(!Bn.EVENTS_URL)return;const f=it(Bn.EVENTS_URL);f.params.push(`access_token=${u||Bn.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.10.0",skuId:Qr,userId:this.anonId},y=t?xt(m,t):m,b={url:cn(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=pt(b,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(u)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const yn=new class extends ar{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Bn.EVENTS_URL&&Bn.ACCESS_TOKEN&&Array.isArray(n)&&n.some(t=>_e(t)||xe(t))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Sn(Bn.ACCESS_TOKEN),t=e?e.u:Bn.ACCESS_TOKEN;let s=t!==this.eventData.tokenU;Ze(this.anonId)||(this.anonId=Ct(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||f.getDate()!==m.getDate()}else s=!0;s?this.postEvent(u,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=t)},n):this.processRequests()}},Ur=yn.postTurnstileEvent.bind(yn),mr=new class extends ar{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,t,s){this.skuToken=e,this.errorCb=s,Bn.EVENTS_URL&&(t||Bn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},t):this.errorCb(new Error(ft)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ze(this.anonId)||(this.anonId=Ct()),this.postEvent(t,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},ai=mr.postMapLoadEvent.bind(mr),gn=new class extends ar{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,t,s){if(!Bn.API_URL||!Bn.SESSION_PATH)return;const u=it(Bn.API_URL+Bn.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||Bn.ACCESS_TOKEN||""}`);const f={url:cn(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ee(f,m=>{this.pendingRequest=null,t(m),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,t,s){this.skuToken=e,this.errorCb=s,Bn.SESSION_PATH&&Bn.API_URL&&(t||Bn.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},t):this.errorCb(new Error(ft)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:t}=this.queue.shift();e&&this.success[e]||this.getSession(t,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},zr=gn.getSessionAPI.bind(gn),dr=new Set;let Wr,kn=500,Ar=50,bn={};function Fi(n){const e=q(n);let t,s;e&&e.forEach(f=>{const m=f.split("=");"language"===m[0]?t=m[1]:"worldview"===m[0]&&(s=m[1])});let u="mapbox-tiles";return t&&(u+=`-${t}`),s&&(u+=`-${s}`),u}function ue(){try{return Fe.caches}catch{}}function G(n){const e=ue();e&&!bn[n]&&(bn[n]=e.open(n))}function q(n){const e=n.indexOf("?");return e>0?n.slice(e+1).split("&"):[]}function he(n){const e=n.indexOf("?");if(e<0)return n;const t=q(n).filter(s=>{const u=s.split("=");return"language"===u[0]||"worldview"===u[0]});return t.length?`${n.slice(0,e)}?${t.join("&")}`:n.slice(0,e)}let ge=1/0;const Pe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Pe);class Ue extends Error{constructor(e,t,s){401===t&&xe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ne=qn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Fe.location.protocol?Fe.parent:Fe).location.href,Re=function(n,e){if(!(/^file:/.test(t=n.url)||/^file:/.test(Ne())&&!/^\w+:/.test(t))){if(Fe.fetch&&Fe.Request&&Fe.AbortController&&Fe.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new Fe.AbortController,m=new Fe.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Ne(),signal:f.signal});let y=!1,b=!1;const w=(M=m.url).indexOf("sku=")>0&&xe(M);var M;"json"===s.type&&m.headers.set("Accept","application/json");const R=(j,V,X)=>{if(b)return;if(j&&"SecurityError"!==j.message&&dn(j),V&&X)return L(V);const ee=Date.now();Fe.fetch(m).then(de=>{if(de.ok){const we=w?de.clone():null;return L(de,we,ee)}return u(new Ue(de.statusText,de.status,s.url))}).catch(de=>{20!==de.code&&u(new Error(de.message))})},L=(j,V,X)=>{("arrayBuffer"===s.type?j.arrayBuffer():"json"===s.type?j.json():j.text()).then(ee=>{b||(V&&X&&function(de,we,fe){const ye=Fi(de.url);if(G(ye),!bn[ye])return;const Le={status:we.status,statusText:we.statusText,headers:new Fe.Headers};we.headers.forEach((Xe,lt)=>Le.headers.set(lt,Xe));const De=oi(we.headers.get("Cache-Control")||"");if(De["no-store"])return;De["max-age"]&&Le.headers.set("Expires",new Date(fe+1e3*De["max-age"]).toUTCString());const Je=Le.headers.get("Expires");Je&&(new Date(Je).getTime()-fe<42e4||function(Xe,lt){if(void 0===Wr)try{new Response(new ReadableStream),Wr=!0}catch{Wr=!1}Wr?lt(Xe.body):Xe.blob().then(lt)}(we,Xe=>{const lt=new Fe.Response(Xe,Le);G(ye),bn[ye]&&bn[ye].then(Lt=>Lt.put(he(de.url),lt)).catch(Lt=>dn(Lt.message))}))}(m,V,X),y=!0,u(null,ee,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(ee=>{b||u(new Error(ee.message))})};return w?function(j,V){const X=Fi(j.url);if(G(X),!bn[X])return V(null);const ee=he(j.url);bn[X].then(de=>{de.match(ee).then(we=>{const fe=function(ye){if(!ye)return!1;const Le=new Date(ye.headers.get("Expires")||0),De=oi(ye.headers.get("Cache-Control")||"");return Le>Date.now()&&!De["no-cache"]}(we);de.delete(ee),fe&&de.put(ee,we.clone()),V(null,we,fe)}).catch(V)}).catch(V)}(m,R):R(null,null),{cancel:()=>{b=!0,y||f.abort()}}}(n,e);if(qn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var t;return function(s,u){const f=new Fe.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const m in s.headers)f.setRequestHeader(m,s.headers[m]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let m=f.response;if("json"===s.type)try{m=JSON.parse(f.response)}catch(y){return u(y)}u(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Ue(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(n,e)},$e=function(n,e){return Re(xt(n,{type:"arrayBuffer"}),e)},pt=function(n,e){return Re(xt(n,{method:"POST"}),e)},Ee=function(n,e){return Re(xt(n,{method:"GET"}),e)};function le(n){const e=Fe.document.createElement("a");return e.href=n,e.protocol===Fe.document.location.protocol&&e.host===Fe.document.location.host}const oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Oe,je;Oe=[],je=0;const It=function(n,e){if(mn.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),je>=Bn.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Oe.push(f),f}je++;let t=!1;const s=()=>{if(!t)for(t=!0,je--;Oe.length&&je<Bn.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Oe.shift(),{requestParameters:m,callback:y,cancelled:b}=f;b||(f.cancel=It(m,y).cancel)}},u=$e(n,(f,m,y,b)=>{s(),f?e(f):m&&(Fe.createImageBitmap?function(w,M){const R=new Fe.Blob([new Uint8Array(w)],{type:"image/png"});Fe.createImageBitmap(R).then(L=>{M(null,L)}).catch(L=>{M(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,M)=>e(w,M,y,b)):function(w,M){const R=new Fe.Image,L=Fe.URL;R.onload=()=>{M(null,R),L.revokeObjectURL(R.src),R.onload=null,Fe.requestAnimationFrame(()=>{R.src=oe})},R.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Fe.Blob([new Uint8Array(w)],{type:"image/png"});R.src=w.byteLength?L.createObjectURL(j):oe}(m,(w,M)=>e(w,M,y,b)))});return{cancel:()=>{u.cancel(),s()}}};function Ut(n,e,t){t[n]&&-1!==t[n].indexOf(e)||(t[n]=t[n]||[],t[n].push(e))}function _n(n,e,t){if(t&&t[n]){const s=t[n].indexOf(e);-1!==s&&t[n].splice(s,1)}}class wt{constructor(e,t={}){xt(this,t),this.type=e}}class tn extends wt{constructor(e,t={}){super("error",xt({error:e},t))}}class Zt{on(e,t){return this._listeners=this._listeners||{},Ut(e,t,this._listeners),this}off(e,t){return _n(e,t,this._listeners),_n(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Ut(e,t,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,t){"string"==typeof e&&(e=new wt(e,t||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)_n(s,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(xt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof tn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function mi(n,...e){for(const t of e)for(const s in t)n[s]=t[s];return n}function $n(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ti(n){if(Array.isArray(n))return n.map(Ti);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const t in n)e[t]=Ti(n[t]);return e}return $n(n)}class Br extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var qr=Br;class po{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[s,u]of t)this.bindings[s]=u}concat(e){return new po(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Qn=po;const os={kind:"null"},jt={kind:"number"},Fn={kind:"string"},Tn={kind:"boolean"},Er={kind:"color"},li={kind:"object"},Dn={kind:"value"},zi={kind:"collator"},mo={kind:"formatted"},To={kind:"resolvedImage"};function er(n,e){return{kind:"array",itemType:n,N:e}}function jr(n){if("array"===n.kind){const e=jr(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const Fa=[os,jt,Fn,Tn,Er,mo,li,er(Dn),To];function Do(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Do(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const t of Fa)if(!Do(t,e))return null}return`Expected ${jr(n)} but found ${jr(e)} instead.`}function Fo(n,e){return e.some(t=>t.kind===n.kind)}function Bi(n,e){return e.some(t=>"null"===t?null===n:"array"===t?Array.isArray(n):"object"===t?n&&!Array.isArray(n)&&"object"==typeof n:t===typeof n)}function Ls(n){var e={exports:{}};return n(e,e.exports),e.exports}var Hi=Ls(function(n,e){var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function u(y){return s("%"===y[y.length-1]?parseFloat(y)/100*255:parseInt(y))}function f(y){return(b="%"===y[y.length-1]?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function m(y,b,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?y+(b-y)*w*6:2*w<1?b:3*w<2?y+(b-y)*(2/3-w)*6:y}try{e.parseCSSColor=function(y){var b,w=y.replace(/ /g,"").toLowerCase();if(w in t)return t[w].slice();if("#"===w[0])return 4===w.length?(b=parseInt(w.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===w.length&&(b=parseInt(w.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var M=w.indexOf("("),R=w.indexOf(")");if(-1!==M&&R+1===w.length){var L=w.substr(0,M),j=w.substr(M+1,R-(M+1)).split(","),V=1;switch(L){case"rgba":if(4!==j.length)return null;V=f(j.pop());case"rgb":return 3!==j.length?null:[u(j[0]),u(j[1]),u(j[2]),V];case"hsla":if(4!==j.length)return null;V=f(j.pop());case"hsl":if(3!==j.length)return null;var X=(parseFloat(j[0])%360+360)%360/360,ee=f(j[1]),de=f(j[2]),we=de<=.5?de*(ee+1):de+ee-de*ee,fe=2*de-we;return[s(255*m(fe,we,X+1/3)),s(255*m(fe,we,X)),s(255*m(fe,we,X-1/3)),V];default:return null}}return null}}catch{}});class Tr{constructor(e,t,s,u=1){this.r=e,this.g=t,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Tr)return e;if("string"!=typeof e)return;const t=Hi.parseCSSColor(e);return t?new Tr(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(s)},${u})`}toArray(){const{r:e,g:t,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*t/u,255*s/u,u]}toArray01(){const{r:e,g:t,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,t/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:s,a:u}=this;return[e,t,s,u]}}Tr.black=new Tr(0,0,0,1),Tr.white=new Tr(1,1,1,1),Tr.transparent=new Tr(0,0,0,0),Tr.red=new Tr(1,0,0,1),Tr.blue=new Tr(0,0,1,1);var vr=Tr;class Di{constructor(e,t,s){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xr{constructor(e,t,s,u,f){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=s,this.fontStack=u,this.textColor=f}}class Ci{constructor(e){this.sections=e}static fromString(e){return new Ci([new Xr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ci?e:Ci.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const s={};t.fontStack&&(s["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(s["font-scale"]=t.scale),t.textColor&&(s["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(s)}return e}}class gr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new gr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Yo(n,e,t,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,t,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,t,s]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gi(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof vr||n instanceof Di||n instanceof Ci||n instanceof gr)return!0;if(Array.isArray(n)){for(const e of n)if(!gi(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!gi(n[e]))return!1;return!0}return!1}function ei(n){if(null===n)return os;if("string"==typeof n)return Fn;if("boolean"==typeof n)return Tn;if("number"==typeof n)return jt;if(n instanceof vr)return Er;if(n instanceof Di)return zi;if(n instanceof Ci)return mo;if(n instanceof gr)return To;if(Array.isArray(n)){const e=n.length;let t;for(const s of n){const u=ei(s);if(t){if(t===u)continue;t=Dn;break}t=u}return er(t||Dn,e)}return li}function za(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof vr||n instanceof Ci||n instanceof gr?n.toString():JSON.stringify(n)}class xl{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!gi(e[1]))return t.error("invalid value");const s=e[1];let u=ei(s);const f=t.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new xl(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof vr?["rgba"].concat(this.value.toArray()):this.value instanceof Ci?this.value.serialize():this.value}}var ia=xl,Ii=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const Ba={string:Fn,number:jt,boolean:Tn,object:li};class tc{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let y,b;if(e.length>2){const w=e[1];if("string"!=typeof w||!(w in Ba)||"object"===w)return t.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ba[w],u++}else y=Dn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}s=er(y,b)}else s=Ba[f];const m=[];for(;u<e.length;u++){const y=t.parse(e[u],u,Dn);if(!y)return null;m.push(y)}return new tc(s,m)}evaluate(e){for(let t=0;t<this.args.length;t++){const s=this.args[t].evaluate(e);if(!Do(this.type,ei(s)))return s;if(t===this.args.length-1)throw new Ii(`Expected value to be of type ${jr(this.type)}, but found ${jr(ei(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){t.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&t.push(u)}}return t.concat(this.args.map(s=>s.serialize()))}}var Co=tc;class Na{constructor(e){this.type=mo,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return t.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(f&&"object"==typeof y&&!Array.isArray(y)){f=!1;let b=null;if(y["font-scale"]&&(b=t.parse(y["font-scale"],1,jt),!b))return null;let w=null;if(y["text-font"]&&(w=t.parse(y["text-font"],1,er(Fn)),!w))return null;let M=null;if(y["text-color"]&&(M=t.parse(y["text-color"],1,Er),!M))return null;const R=u[u.length-1];R.scale=b,R.font=w,R.textColor=M}else{const b=t.parse(e[m],1,Dn);if(!b)return null;const w=b.type.kind;if("string"!==w&&"value"!==w&&"null"!==w&&"resolvedImage"!==w)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Na(u)}evaluate(e){return new Ci(this.sections.map(t=>{const s=t.content.evaluate(e);return ei(s)===To?new Xr("",s,null,null,null):new Xr(za(s),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const s={};t.scale&&(s["font-scale"]=t.scale.serialize()),t.font&&(s["text-font"]=t.font.serialize()),t.textColor&&(s["text-color"]=t.textColor.serialize()),e.push(s)}return e}}class bl{constructor(e){this.type=To,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const s=t.parse(e[1],1,Fn);return s?new bl(s):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),s=gr.fromString(t);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(t)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const gu={"to-boolean":Tn,"to-color":Er,"to-number":jt,"to-string":Fn};class wl{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return t.error("Expected one argument.");const u=gu[s],f=[];for(let m=1;m<e.length;m++){const y=t.parse(e[m],m,Dn);if(!y)return null;f.push(y)}return new wl(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,s;for(const u of this.args){if(t=u.evaluate(e),s=null,t instanceof vr)return t;if("string"==typeof t){const f=e.parseColor(t);if(f)return f}else if(Array.isArray(t)&&(s=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Yo(t[0],t[1],t[2],t[3]),!s))return new vr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ii(s||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const s of this.args){if(t=s.evaluate(e),null===t)return 0;const u=Number(t);if(!isNaN(u))return u}throw new Ii(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Ci.fromString(za(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?gr.fromString(za(this.args[0].evaluate(e))):za(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Na([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new bl(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var oa=wl;const kc=["Unknown","Point","LineString","Polygon"];var El=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?kc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:t,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(t*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=vr.parse(n)),e}};class Ko{constructor(e,t,s,u){this.name=e,this.type=t,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const s=e[0],u=Ko.definitions[s];if(!u)return t.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let b=null;for(const[w,M]of y){b=new Uo(t.registry,t.path,null,t.scope);const R=[];let L=!1;for(let j=1;j<e.length;j++){const V=e[j],X=Array.isArray(w)?w[j-1]:w.type,ee=b.parse(V,1+R.length,X);if(!ee){L=!0;break}R.push(ee)}if(!L)if(Array.isArray(w)&&w.length!==R.length)b.error(`Expected ${w.length} arguments, but found ${R.length} instead.`);else{for(let j=0;j<R.length;j++){const V=Array.isArray(w)?w[j]:w.type,X=R[j];b.concat(j+1).checkSubtype(V,X.type)}if(0===b.errors.length)return new Ko(s,f,M,R)}}if(1===y.length)t.errors.push(...b.errors);else{const w=(y.length?y:m).map(([R])=>{return L=R,Array.isArray(L)?`(${L.map(jr).join(", ")})`:`(${jr(L.type)}...)`;var L}).join(" | "),M=[];for(let R=1;R<e.length;R++){const L=t.parse(e[R],1+M.length);if(!L)return null;M.push(jr(L.type))}t.error(`Expected arguments of type ${w}, but found (${M.join(", ")}) instead.`)}return null}static register(e,t){Ko.definitions=t;for(const s in t)e[s]=Ko}}var _i=Ko;class ss{constructor(e,t,s){this.type=zi,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return t.error("Collator options argument must be an object.");const u=t.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Tn);if(!u)return null;const f=t.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Tn);if(!f)return null;let m=null;return s.locale&&(m=t.parse(s.locale,1,Fn),!m)?null:new ss(u,f,m)}evaluate(e){return new Di(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const zo=8192;function as(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function sa(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Os(n,e){const t=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(t*u*zo),Math.round(s*u*zo)]}function _u(n,e,t){const s=n[0]-e[0],u=n[1]-e[1],f=n[0]-t[0],m=n[1]-t[1];return s*m-f*u==0&&s*f<=0&&u*m<=0}function Bo(n,e){let t=!1;for(let m=0,y=e.length;m<y;m++){const b=e[m];for(let w=0,M=b.length;w<M-1;w++){if(_u(n,b[w],b[w+1]))return!1;(u=b[w])[1]>(s=n)[1]!=(f=b[w+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(t=!t)}}var s,u,f;return t}function ls(n,e){for(let t=0;t<e.length;t++)if(Bo(n,e[t]))return!0;return!1}function aa(n,e,t,s){const u=s[0]-t[0],f=s[1]-t[1],m=(n[0]-t[0])*f-u*(n[1]-t[1]),y=(e[0]-t[0])*f-u*(e[1]-t[1]);return m>0&&y<0||m<0&&y>0}function Ua(n,e,t){for(const w of t)for(let M=0;M<w.length-1;++M)if((y=[(m=w[M+1])[0]-(f=w[M])[0],m[1]-f[1]])[0]*(b=[(u=e)[0]-(s=n)[0],u[1]-s[1]])[1]-y[1]*b[0]!=0&&aa(s,u,f,m)&&aa(f,m,s,u))return!0;var s,u,f,m,y,b;return!1}function Tl(n,e){for(let t=0;t<n.length;++t)if(!Bo(n[t],e))return!1;for(let t=0;t<n.length-1;++t)if(Ua(n[t],n[t+1],e))return!1;return!0}function nc(n,e){for(let t=0;t<e.length;t++)if(Tl(n,e[t]))return!0;return!1}function Ki(n,e,t){const s=[];for(let u=0;u<n.length;u++){const f=[];for(let m=0;m<n[u].length;m++){const y=Os(n[u][m],t);as(e,y),f.push(y)}s.push(f)}return s}function Dl(n,e,t){const s=[];for(let u=0;u<n.length;u++){const f=Ki(n[u],e,t);s.push(f)}return s}function Fs(n,e,t,s){if(n[0]<t[0]||n[0]>t[2]){const u=.5*s;let f=n[0]-t[0]>u?-s:t[0]-n[0]>u?s:0;0===f&&(f=n[0]-t[2]>u?-s:t[2]-n[0]>u?s:0),n[0]+=f}as(e,n)}function ja(n,e,t,s){const u=Math.pow(2,s.z)*zo,f=[s.x*zo,s.y*zo],m=[];if(!n)return m;for(const y of n)for(const b of y){const w=[b.x+f[0],b.y+f[1]];Fs(w,e,t,u),m.push(w)}return m}function Cl(n,e,t,s){const u=Math.pow(2,s.z)*zo,f=[s.x*zo,s.y*zo],m=[];if(!n)return m;for(const b of n){const w=[];for(const M of b){const R=[M.x+f[0],M.y+f[1]];as(e,R),w.push(R)}m.push(w)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const w of b)Fs(w,e,t,u)}var y;return m}class yi{constructor(e,t){this.type=Tn,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(gi(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new yi(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new yi(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new yi(s,s)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(t,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(!m)return!1;if("Polygon"===s.type){const y=Ki(s.coordinates,f,m),b=ja(t.geometry(),u,f,m);if(!sa(u,f))return!1;for(const w of b)if(!Bo(w,y))return!1}if("MultiPolygon"===s.type){const y=Dl(s.coordinates,f,m),b=ja(t.geometry(),u,f,m);if(!sa(u,f))return!1;for(const w of b)if(!ls(w,y))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(t,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(!m)return!1;if("Polygon"===s.type){const y=Ki(s.coordinates,f,m),b=Cl(t.geometry(),u,f,m);if(!sa(u,f))return!1;for(const w of b)if(!Tl(w,y))return!1}if("MultiPolygon"===s.type){const y=Dl(s.coordinates,f,m),b=Cl(t.geometry(),u,f,m);if(!sa(u,f))return!1;for(const w of b)if(!nc(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var cs=yi;function us(n){if(n instanceof _i&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof cs)return!1;let e=!0;return n.eachChild(t=>{e&&!us(t)&&(e=!1)}),e}function No(n){if(n instanceof _i&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(t=>{e&&!No(t)&&(e=!1)}),e}function zs(n,e){if(n instanceof _i&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(s=>{t&&!zs(s,e)&&(t=!1)}),t}class rc{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const s=e[1];return t.scope.has(s)?new rc(s,t.scope.get(s)):t.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Hn=rc;class Bs{constructor(e,t=[],s,u=new Qn,f=[]){this.registry=e,this.path=t,this.key=t.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,t,s,u,f={}){return t?this.concat(t,s,u)._parse(e,f):this._parse(e,f)}_parse(e,t){function s(u,f,m){return"assert"===m?new Co(f,[u]):"coerce"===m?new oa(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,b=m.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else m=s(m,y,t.typeAnnotation||"coerce");else m=s(m,y,t.typeAnnotation||"assert")}if(!(m instanceof ia)&&"resolvedImage"!==m.type.kind&&lr(m)){const y=new El;try{m=new ia(m.type,m.evaluate(y))}catch(b){return this.error(b.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new Bs(this.registry,u,t||null,f,this.errors)}error(e,...t){const s=`${this.key}${t.map(u=>`[${u}]`).join("")}`;this.errors.push(new qr(s,e))}checkSubtype(e,t){const s=Do(e,t);return s&&this.error(s),s}}var Uo=Bs;function lr(n){if(n instanceof Hn)return lr(n.boundExpression);if(n instanceof _i&&"error"===n.name||n instanceof ss||n instanceof cs)return!1;const e=n instanceof oa||n instanceof Co;let t=!0;return n.eachChild(s=>{t=e?t&&lr(s):t&&s instanceof ia}),!!t&&us(n)&&zs(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Zi(n,e){const t=n.length-1;let s,u,f=0,m=t,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),s=n[y],u=n[y+1],s<=e){if(y===t||e<u)return y;f=y+1}else{if(!(s>e))throw new Ii("Input is not a number.");m=y-1}return 0}class la{constructor(e,t,s){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const s=t.parse(e[1],1,jt);if(!s)return null;const u=[];let f=null;t.expectedType&&"value"!==t.expectedType.kind&&(f=t.expectedType);for(let m=1;m<e.length;m+=2){const y=1===m?-1/0:e[m],b=e[m+1],w=m,M=m+1;if("number"!=typeof y)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=y)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const R=t.parse(b,M,f);if(!R)return null;f=f||R.type,u.push([y,R])}return new la(f,s,u)}evaluate(e){const t=this.labels,s=this.outputs;if(1===t.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=t[0])return s[0].evaluate(e);const f=t.length;return u>=t[f-1]?s[f-1].evaluate(e):s[Zi(t,u)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Ns=la;function Xn(n,e,t){return n*(1-t)+e*t}function Ni(n,e,t){return n.map((s,u)=>Xn(s,e[u],t))}var Va=Object.freeze({__proto__:null,number:Xn,color:function(n,e,t){return new vr(Xn(n.r,e.r,t),Xn(n.g,e.g,t),Xn(n.b,e.b,t),Xn(n.a,e.a,t))},array:Ni});const jo=4/29,go=6/29,ws=3*go*go,Pn=Math.PI/180,Ji=180/Math.PI;function $a(n){return n>.008856451679035631?Math.pow(n,1/3):n/ws+jo}function Us(n){return n>go?n*n*n:ws*(n-jo)}function Il(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Sl(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ga(n){const e=Sl(n.r),t=Sl(n.g),s=Sl(n.b),u=$a((.4124564*e+.3575761*t+.1804375*s)/.95047),f=$a((.2126729*e+.7151522*t+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-$a((.0193339*e+.119192*t+.9503041*s)/1.08883)),alpha:n.a}}function ha(n){let e=(n.l+16)/116,t=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*Us(e),t=.95047*Us(t),s=1.08883*Us(s),new vr(Il(3.2404542*t-1.5371385*e-.4985314*s),Il(-.969266*t+1.8760108*e+.041556*s),Il(.0556434*t-.2040259*e+1.0572252*s),n.alpha)}function ic(n,e,t){const s=e-n;return n+t*(s>180||s<-180?s-360*Math.round(s/360):s)}const St={forward:Ga,reverse:ha,interpolate:function(n,e,t){return{l:Xn(n.l,e.l,t),a:Xn(n.a,e.a,t),b:Xn(n.b,e.b,t),alpha:Xn(n.alpha,e.alpha,t)}}},Gn={forward:function(n){const{l:e,a:t,b:s}=Ga(n),u=Math.atan2(s,t)*Ji;return{h:u<0?u+360:u,c:Math.sqrt(t*t+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Pn,t=n.c;return ha({l:n.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:n.alpha})},interpolate:function(n,e,t){return{h:ic(n.h,e.h,t),c:Xn(n.c,e.c,t),l:Xn(n.l,e.l,t),alpha:Xn(n.alpha,e.alpha,t)}}};var Es=Object.freeze({__proto__:null,lab:St,hcl:Gn});class da{constructor(e,t,s,u,f){this.type=e,this.operator=t,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,t,s,u){let f=0;if("exponential"===e.name)f=ti(t,e.base,s,u);else if("linear"===e.name)f=ti(t,1,s,u);else if("cubic-bezier"===e.name){const m=e.controlPoints;f=new Jt(m[0],m[1],m[2],m[3]).solve(ti(t,1,s,u))}return f}static parse(e,t){let[s,u,f,...m]=e;if(!Array.isArray(u)||0===u.length)return t.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const w=u[1];if("number"!=typeof w)return t.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if("cubic-bezier"!==u[0])return t.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const w=u.slice(1);if(4!==w.length||w.some(M=>"number"!=typeof M||M<0||M>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(f=t.parse(f,2,jt),!f)return null;const y=[];let b=null;"interpolate-hcl"===s||"interpolate-lab"===s?b=Er:t.expectedType&&"value"!==t.expectedType.kind&&(b=t.expectedType);for(let w=0;w<m.length;w+=2){const M=m[w],R=m[w+1],L=w+3,j=w+4;if("number"!=typeof M)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(y.length&&y[y.length-1][0]>=M)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const V=t.parse(R,j,b);if(!V)return null;b=b||V.type,y.push([M,V])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new da(b,s,u,f,y):t.error(`Type ${jr(b)} is not interpolatable.`)}evaluate(e){const t=this.labels,s=this.outputs;if(1===t.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=t[0])return s[0].evaluate(e);const f=t.length;if(u>=t[f-1])return s[f-1].evaluate(e);const m=Zi(t,u),y=da.interpolationFactor(this.interpolation,u,t[m],t[m+1]),b=s[m].evaluate(e),w=s[m+1].evaluate(e);return"interpolate"===this.operator?Va[this.type.kind.toLowerCase()](b,w,y):"interpolate-hcl"===this.operator?Gn.reverse(Gn.interpolate(Gn.forward(b),Gn.forward(w),y)):St.reverse(St.interpolate(St.forward(b),St.forward(w),y))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)t.push(this.labels[s],this.outputs[s].serialize());return t}}function ti(n,e,t,s){const u=s-t,f=n-t;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var Si=da;class Wi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let s=null;const u=t.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const y of e.slice(1)){const b=t.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,f.push(b)}const m=u&&f.some(y=>Do(u,y.type));return new Wi(m?Dn:s,f)}evaluate(e){let t,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof gr&&!s.available&&(t||(t=s),s=null,u===this.args.length))return t;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var _o=Wi;class js{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if("string"!=typeof m)return t.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=t.parse(e[f+1],f+1);if(!y)return null;s.push([m,y])}const u=t.parse(e[e.length-1],e.length-1,t.expectedType,s);return u?new js(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,s]of this.bindings)e.push(t,s.serialize());return e.push(this.result.serialize()),e}}var Ml=js;class Lc{constructor(e,t,s){this.type=e,this.index=t,this.input=s}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,jt),u=t.parse(e[2],2,er(t.expectedType||Dn));return s&&u?new Lc(u.type.itemType,s,u):null}evaluate(e){const t=this.index.evaluate(e),s=this.input.evaluate(e);if(t<0)throw new Ii(`Array index out of bounds: ${t} < 0.`);if(t>=s.length)throw new Ii(`Array index out of bounds: ${t} > ${s.length-1}.`);if(t!==Math.floor(t))throw new Ii(`Array index must be an integer, but found ${t} instead.`);return s[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Oc=Lc;class Fc{constructor(e,t){this.type=Tn,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,Dn),u=t.parse(e[2],2,Dn);return s&&u?Fo(s.type,[Tn,Fn,jt,os,Dn])?new Fc(s,u):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${jr(s.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Bi(t,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${jr(ei(t))} instead.`);if(!Bi(s,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${jr(ei(s))} instead.`);return s.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var oc=Fc;class Mi{constructor(e,t,s){this.type=jt,this.needle=e,this.haystack=t,this.fromIndex=s}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,Dn),u=t.parse(e[2],2,Dn);if(!s||!u)return null;if(!Fo(s.type,[Tn,Fn,jt,os,Dn]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${jr(s.type)} instead`);if(4===e.length){const f=t.parse(e[3],3,jt);return f?new Mi(s,u,f):null}return new Mi(s,u)}evaluate(e){const t=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Bi(t,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${jr(ei(t))} instead.`);if(!Bi(s,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${jr(ei(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(t,u)}return s.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Vo=Mi;class hs{constructor(e,t,s,u,f,m){this.inputType=e,this.type=t,this.input=s,this.cases=u,this.outputs=f,this.otherwise=m}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let s,u;t.expectedType&&"value"!==t.expectedType.kind&&(u=t.expectedType);const f={},m=[];for(let w=2;w<e.length-1;w+=2){let M=e[w];const R=e[w+1];Array.isArray(M)||(M=[M]);const L=t.concat(w);if(0===M.length)return L.error("Expected at least one branch label.");for(const V of M){if("number"!=typeof V&&"string"!=typeof V)return L.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,ei(V)))return null}else s=ei(V);if(void 0!==f[String(V)])return L.error("Branch labels must be unique.");f[String(V)]=m.length}const j=t.parse(R,w,u);if(!j)return null;u=u||j.type,m.push(j)}const y=t.parse(e[1],1,Dn);if(!y)return null;const b=t.parse(e[e.length-1],e.length-1,u);return b?"value"!==y.type.kind&&t.concat(1).checkSubtype(s,y.type)?null:new hs(s,u,y,f,m,b):null}evaluate(e){const t=this.input.evaluate(e);return(ei(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),s=[],u={};for(const m of t){const y=u[this.cases[m]];void 0===y?(u[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[y][1].push(m)}const f=m=>"number"===this.inputType.kind?Number(m):m;for(const[m,y]of s)e.push(1===y.length?f(y[0]):y.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var Io=hs;class yo{constructor(e,t,s){this.type=e,this.branches=t,this.otherwise=s}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let s;t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const y=t.parse(e[m],m,Tn);if(!y)return null;const b=t.parse(e[m+1],m+1,s);if(!b)return null;u.push([y,b]),s=s||b.type}const f=t.parse(e[e.length-1],e.length-1,s);return f?new yo(s,u,f):null}evaluate(e){for(const[t,s]of this.branches)if(t.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,s]of this.branches)e(t),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var zc=yo;class Ha{constructor(e,t,s,u){this.type=e,this.input=t,this.beginIndex=s,this.endIndex=u}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=t.parse(e[1],1,Dn),u=t.parse(e[2],2,jt);if(!s||!u)return null;if(!Fo(s.type,[er(Dn),Fn,Dn]))return t.error(`Expected first argument to be of type array or string, but found ${jr(s.type)} instead`);if(4===e.length){const f=t.parse(e[3],3,jt);return f?new Ha(s.type,s,u,f):null}return new Ha(s.type,s,u)}evaluate(e){const t=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Bi(t,["string","array"]))throw new Ii(`Expected first argument to be of type array or string, but found ${jr(ei(t))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return t.slice(s,u)}return t.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Bc=Ha;function sc(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Za(n,e,t,s){return 0===s.compare(e,t)}function Ts(n,e,t){const s="=="!==n&&"!="!==n;return class bx{constructor(f,m,y){this.type=Tn,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument="value"===f.type.kind||"value"===m.type.kind}static parse(f,m){if(3!==f.length&&4!==f.length)return m.error("Expected two or three arguments.");const y=f[0];let b=m.parse(f[1],1,Dn);if(!b)return null;if(!sc(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${jr(b.type)}'.`);let w=m.parse(f[2],2,Dn);if(!w)return null;if(!sc(y,w.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${jr(w.type)}'.`);if(b.type.kind!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return m.error(`Cannot compare types '${jr(b.type)}' and '${jr(w.type)}'.`);s&&("value"===b.type.kind&&"value"!==w.type.kind?b=new Co(w.type,[b]):"value"!==b.type.kind&&"value"===w.type.kind&&(w=new Co(b.type,[w])));let M=null;if(4===f.length){if("string"!==b.type.kind&&"string"!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(f[3],3,zi),!M)return null}return new bx(b,w,M)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const b=ei(m),w=ei(y);if(b.kind!==w.kind||"string"!==b.kind&&"number"!==b.kind)throw new Ii(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=ei(m),w=ei(y);if("string"!==b.kind||"string"!==w.kind)return e(f,m,y)}return this.collator?t(f,m,y,this.collator.evaluate(f)):e(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const F=Ts("==",function(n,e,t){return e===t},Za),W=Ts("!=",function(n,e,t){return e!==t},function(n,e,t,s){return!Za(0,e,t,s)}),B=Ts("<",function(n,e,t){return e<t},function(n,e,t,s){return s.compare(e,t)<0}),Q=Ts(">",function(n,e,t){return e>t},function(n,e,t,s){return s.compare(e,t)>0}),Me=Ts("<=",function(n,e,t){return e<=t},function(n,e,t,s){return s.compare(e,t)<=0}),rt=Ts(">=",function(n,e,t){return e>=t},function(n,e,t,s){return s.compare(e,t)>=0});class Dt{constructor(e,t,s,u,f,m){this.type=Fn,this.number=e,this.locale=t,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const s=t.parse(e[1],1,jt);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return t.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=t.parse(u.locale,1,Fn),!f))return null;let m=null;if(u.currency&&(m=t.parse(u.currency,1,Fn),!m))return null;let y=null;if(u.unit&&(y=t.parse(u.unit,1,Fn),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=t.parse(u["min-fraction-digits"],1,jt),!b))return null;let w=null;return u["max-fraction-digits"]&&(w=t.parse(u["max-fraction-digits"],1,jt),!w)?null:new Dt(s,f,m,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class sn{constructor(e){this.type=jt,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=t.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?t.error(`Expected argument of type string or array, but found ${jr(s.type)} instead.`):new sn(s):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t||Array.isArray(t))return t.length;throw new Ii(`Expected value to be of type string or array, but found ${jr(ei(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const xr={"==":F,"!=":W,">":Q,"<":B,">=":rt,"<=":Me,array:Co,at:Oc,boolean:Co,case:zc,coalesce:_o,collator:ss,format:Na,image:bl,in:oc,"index-of":Vo,interpolate:Si,"interpolate-hcl":Si,"interpolate-lab":Si,length:sn,let:Ml,literal:ia,match:Io,number:Co,"number-format":Dt,object:Co,slice:Bc,step:Ns,string:Co,"to-boolean":oa,"to-color":oa,"to-number":oa,"to-string":oa,var:Hn,within:cs};function fr(n,[e,t,s,u]){e=e.evaluate(n),t=t.evaluate(n),s=s.evaluate(n);const f=u?u.evaluate(n):1,m=Yo(e,t,s,f);if(m)throw new Ii(m);return new vr(e/255*f,t/255*f,s/255*f,f)}function Dr(n,e){return n in e}function rr(n,e){const t=e[n];return void 0===t?null:t}function Nn(n){return{type:n}}_i.register(xr,{error:[{kind:"error"},[Fn],(n,[e])=>{throw new Ii(e.evaluate(n))}],typeof:[Fn,[Dn],(n,[e])=>jr(ei(e.evaluate(n)))],"to-rgba":[er(jt,4),[Er],(n,[e])=>e.evaluate(n).toArray()],rgb:[Er,[jt,jt,jt],fr],rgba:[Er,[jt,jt,jt,jt],fr],has:{type:Tn,overloads:[[[Fn],(n,[e])=>Dr(e.evaluate(n),n.properties())],[[Fn,li],(n,[e,t])=>Dr(e.evaluate(n),t.evaluate(n))]]},get:{type:Dn,overloads:[[[Fn],(n,[e])=>rr(e.evaluate(n),n.properties())],[[Fn,li],(n,[e,t])=>rr(e.evaluate(n),t.evaluate(n))]]},"feature-state":[Dn,[Fn],(n,[e])=>rr(e.evaluate(n),n.featureState||{})],properties:[li,[],n=>n.properties()],"geometry-type":[Fn,[],n=>n.geometryType()],id:[Dn,[],n=>n.id()],zoom:[jt,[],n=>n.globals.zoom],pitch:[jt,[],n=>n.globals.pitch||0],"distance-from-center":[jt,[],n=>n.distanceFromCenter()],"heatmap-density":[jt,[],n=>n.globals.heatmapDensity||0],"line-progress":[jt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[jt,[],n=>n.globals.skyRadialProgress||0],accumulated:[Dn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[jt,Nn(jt),(n,e)=>{let t=0;for(const s of e)t+=s.evaluate(n);return t}],"*":[jt,Nn(jt),(n,e)=>{let t=1;for(const s of e)t*=s.evaluate(n);return t}],"-":{type:jt,overloads:[[[jt,jt],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[jt],(n,[e])=>-e.evaluate(n)]]},"/":[jt,[jt,jt],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[jt,[jt,jt],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[jt,[],()=>Math.LN2],pi:[jt,[],()=>Math.PI],e:[jt,[],()=>Math.E],"^":[jt,[jt,jt],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[jt,[jt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[jt,[jt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[jt,[jt],(n,[e])=>Math.log(e.evaluate(n))],log2:[jt,[jt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[jt,[jt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[jt,[jt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[jt,[jt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[jt,[jt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[jt,[jt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[jt,[jt],(n,[e])=>Math.atan(e.evaluate(n))],min:[jt,Nn(jt),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[jt,Nn(jt),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[jt,[jt],(n,[e])=>Math.abs(e.evaluate(n))],round:[jt,[jt],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[jt,[jt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[jt,[jt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Tn,[Fn,Dn],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[Tn,[Dn],(n,[e])=>n.id()===e.value],"filter-type-==":[Tn,[Fn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Tn,[Fn,Dn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Tn,[Dn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t<s}],"filter->":[Tn,[Fn,Dn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s>u}],"filter-id->":[Tn,[Dn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t>s}],"filter-<=":[Tn,[Fn,Dn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Tn,[Dn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t<=s}],"filter->=":[Tn,[Fn,Dn],(n,[e,t])=>{const s=n.properties()[e.value],u=t.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Tn,[Dn],(n,[e])=>{const t=n.id(),s=e.value;return typeof t==typeof s&&t>=s}],"filter-has":[Tn,[Dn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Tn,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Tn,[er(Fn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Tn,[er(Dn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Tn,[Fn,er(Dn)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Tn,[Fn,er(Dn)],(n,[e,t])=>function(s,u,f,m){for(;f<=m;){const y=f+m>>1;if(u[y]===s)return!0;u[y]>s?m=y-1:f=y+1}return!1}(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[Nn(Tn),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[Nn(Tn),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[Tn,[Tn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Tn,[Fn],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return!t||t(e.evaluate(n))}],upcase:[Fn,[Fn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Fn,[Fn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Fn,Nn(Dn),(n,e)=>e.map(t=>za(t.evaluate(n))).join("")],"resolved-locale":[Fn,[zi],(n,[e])=>e.evaluate(n).resolvedLocale()]});var ir=xr;function Yn(n){return{result:"success",value:n}}function qi(n){return{result:"error",value:n}}function bi(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function Jo(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Qi(n){return!!n.expression&&n.expression.interpolated}function or(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function Ds(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function Vs(n){return n}function $s(n,e){const t="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],u=s||!(s||void 0!==n.property),f=n.type||(Qi(e)?"exponential":"interval");if(t&&((n=mi({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],vr.parse(w[1])])),n.default=vr.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Es[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,y,b;if("exponential"===f)m=Uc;else if("interval"===f)m=$o;else if("categorical"===f){m=Nc,y=Object.create(null);for(const w of n.stops)y[w[0]]=w[1];b=typeof n.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);m=So}if(s){const w={},M=[];for(let j=0;j<n.stops.length;j++){const V=n.stops[j],X=V[0].zoom;void 0===w[X]&&(w[X]={zoom:X,type:n.type,property:n.property,default:n.default,stops:[]},M.push(X)),w[X].stops.push([V[0].value,V[1]])}const R=[];for(const j of M)R.push([w[j].zoom,$s(w[j],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Si.interpolationFactor.bind(void 0,L),zoomStops:R.map(j=>j[0]),evaluate:({zoom:j},V)=>Uc({stops:R,base:n.base},e,j).evaluate(j,V)}}if(u){const w="exponential"===f?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Si.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>m(n,e,M,y,b)}}return{kind:"source",evaluate(w,M){const R=M&&M.properties?M.properties[n.property]:void 0;return void 0===R?Gs(n.default,e.default):m(n,e,R,y,b)}}}function Gs(n,e,t){return void 0!==n?n:void 0!==e?e:void 0!==t?t:void 0}function Nc(n,e,t,s,u){return Gs(typeof t===u?s[t]:void 0,n.default,e.default)}function $o(n,e,t){if("number"!==or(t))return Gs(n.default,e.default);const s=n.stops.length;if(1===s||t<=n.stops[0][0])return n.stops[0][1];if(t>=n.stops[s-1][0])return n.stops[s-1][1];const u=Zi(n.stops.map(f=>f[0]),t);return n.stops[u][1]}function Uc(n,e,t){const s=void 0!==n.base?n.base:1;if("number"!==or(t))return Gs(n.default,e.default);const u=n.stops.length;if(1===u||t<=n.stops[0][0])return n.stops[0][1];if(t>=n.stops[u-1][0])return n.stops[u-1][1];const f=Zi(n.stops.map(M=>M[0]),t),m=function(M,R,L,j){const V=j-L,X=M-L;return 0===V?0:1===R?X/V:(Math.pow(R,X)-1)/(Math.pow(R,V)-1)}(t,s,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],b=n.stops[f+1][1];let w=Va[e.type]||Vs;if(n.colorSpace&&"rgb"!==n.colorSpace){const M=Es[n.colorSpace];w=(R,L)=>M.reverse(M.interpolate(M.forward(R),M.forward(L),m))}return"function"==typeof y.evaluate?{evaluate(...M){const R=y.evaluate.apply(void 0,M),L=b.evaluate.apply(void 0,M);if(void 0!==R&&void 0!==L)return w(R,L,m)}}:w(y,b,m)}function So(n,e,t){return"color"===e.type?t=vr.parse(t):"formatted"===e.type?t=Ci.fromString(t.toString()):"resolvedImage"===e.type?t=gr.fromString(t.toString()):or(t)===e.type||"enum"===e.type&&e.values[t]||(t=void 0),Gs(t,n.default,e.default)}class fa{constructor(e,t){var s;this.expression=e,this._warningHistory={},this._evaluator=new El,this._defaultValue=t?"color"===(s=t).type&&(Ds(s.default)||Array.isArray(s.default))?new vr(0,0,0,0):"color"===s.type?vr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,s,u,f,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,s,u,f,m,y,b){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Ii(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function ac(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in ir}function Wa(n,e){const t=new Uo(ir,[],e?function(u){const f={color:Er,string:Fn,number:jt,enum:Fn,boolean:Tn,formatted:mo,resolvedImage:To};return"array"===u.type?er(f[u.value]||Dn,u.length):f[u.type]}(e):void 0),s=t.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Yn(new fa(s,e)):qi(t.errors)}class pa{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!No(t.expression)}evaluateWithoutErrorHandling(e,t,s,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,s,u,f,m)}evaluate(e,t,s,u,f,m){return this._styleExpression.evaluate(e,t,s,u,f,m)}}class ma{constructor(e,t,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=t,this.isStateDependent="camera"!==e&&!No(t.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,t,s,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,s,u,f,m)}evaluate(e,t,s,u,f,m){return this._styleExpression.evaluate(e,t,s,u,f,m)}interpolationFactor(e,t,s){return this.interpolationType?Si.interpolationFactor(this.interpolationType,e,t,s):0}}function lc(n,e){if("error"===(n=Wa(n,e)).result)return n;const t=n.value.expression,s=us(t);if(!s&&!bi(e))return qi([new qr("","data expressions not supported")]);const u=zs(t,["zoom","pitch","distance-from-center"]);if(!u&&!Jo(e))return qi([new qr("","zoom expressions not supported")]);const f=Xa(t);return f||u?f instanceof qr?qi([f]):f instanceof Si&&!Qi(e)?qi([new qr("",'"interpolate" expressions cannot be used with this property')]):Yn(f?new ma(s?"camera":"composite",n.value,f.labels,f instanceof Si?f.interpolation:void 0):new pa(s?"constant":"source",n.value)):qi([new qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class qa{constructor(e,t){this._parameters=e,this._specification=t,mi(this,$s(this._parameters,this._specification))}static deserialize(e){return new qa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xa(n){let e=null;if(n instanceof Ml)e=Xa(n.result);else if(n instanceof _o){for(const t of n.args)if(e=Xa(t),e)break}else(n instanceof Ns||n instanceof Si)&&n.input instanceof _i&&"zoom"===n.input.name&&(e=n);return e instanceof qr||n.eachChild(t=>{const s=Xa(t);s instanceof qr?e=s:!e&&s?e=new qr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new qr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Xt{constructor(e,t,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=t&&t.__line__&&(this.line=t.__line__)}}function Xi(n){const e=n.key,t=n.value,s=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,m=n.styleSpec;let y=[];const b=or(t);if("object"!==b)return[new Xt(e,t,`object expected, ${b} found`)];for(const w in t){const M=w.split(".")[0],R=s[M]||s["*"];let L;u[M]?L=u[M]:s[M]?L=ci:u["*"]?L=u["*"]:s["*"]&&(L=ci),L?y=y.concat(L({key:(e&&`${e}.`)+w,value:t[w],valueSpec:R,style:f,styleSpec:m,object:t,objectKey:w},t)):y.push(new Xt(e,t[w],`unknown property "${w}"`))}for(const w in s)u[w]||s[w].required&&void 0===s[w].default&&void 0===t[w]&&y.push(new Xt(e,t,`missing required property "${w}"`));return y}function Al(n){const e=n.value,t=n.valueSpec,s=n.style,u=n.styleSpec,f=n.key,m=n.arrayElementValidator||ci;if("array"!==or(e))return[new Xt(f,e,`array expected, ${or(e)} found`)];if(t.length&&e.length!==t.length)return[new Xt(f,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new Xt(f,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let y={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};u.$version<7&&(y.function=t.function),"object"===or(t.value)&&(y=t.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(m({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:s,styleSpec:u,key:`${f}[${w}]`}));return b}function Pl(n){const e=n.key,t=n.value,s=n.valueSpec;let u=or(t);if("number"===u&&t!=t&&(u="NaN"),"number"!==u)return[new Xt(e,t,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===or(s.minimum)&&(f=s.minimum[n.arrayIndex]),t<f)return[new Xt(e,t,`${t} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===or(s.maximum)&&(f=s.maximum[n.arrayIndex]),t>f)return[new Xt(e,t,`${t} is greater than the maximum value ${f}`)]}return[]}function Hs(n){const e=n.valueSpec,t=$n(n.value.type);let s,u,f,m={};const y="categorical"!==t&&void 0===n.value.property,b=!y,w="array"===or(n.value.stops)&&"array"===or(n.value.stops[0])&&"object"===or(n.value.stops[0][0]),M=Xi({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(j){if("identity"===t)return[new Xt(j.key,j.value,'identity function may not have a "stops" property')];let V=[];const X=j.value;return V=V.concat(Al({key:j.key,value:X,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:R})),"array"===or(X)&&0===X.length&&V.push(new Xt(j.key,X,"array must have at least one stop")),V},default:function(j){return ci({key:j.key,value:j.value,valueSpec:e,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===t&&y&&M.push(new Xt(n.key,n.value,'missing required property "property"')),"identity"===t||n.value.stops||M.push(new Xt(n.key,n.value,'missing required property "stops"')),"exponential"===t&&n.valueSpec.expression&&!Qi(n.valueSpec)&&M.push(new Xt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!bi(n.valueSpec)?M.push(new Xt(n.key,n.value,"property functions not supported")):y&&!Jo(n.valueSpec)&&M.push(new Xt(n.key,n.value,"zoom functions not supported"))),"categorical"!==t&&!w||void 0!==n.value.property||M.push(new Xt(n.key,n.value,'"property" property is required')),M;function R(j){let V=[];const X=j.value,ee=j.key;if("array"!==or(X))return[new Xt(ee,X,`array expected, ${or(X)} found`)];if(2!==X.length)return[new Xt(ee,X,`array length 2 expected, length ${X.length} found`)];if(w){if("object"!==or(X[0]))return[new Xt(ee,X,`object expected, ${or(X[0])} found`)];if(void 0===X[0].zoom)return[new Xt(ee,X,"object stop key must have zoom")];if(void 0===X[0].value)return[new Xt(ee,X,"object stop key must have value")];const de=$n(X[0].zoom);if("number"!=typeof de)return[new Xt(ee,X[0].zoom,"stop zoom values must be numbers")];if(f&&f>de)return[new Xt(ee,X[0].zoom,"stop zoom values must appear in ascending order")];de!==f&&(f=de,u=void 0,m={}),V=V.concat(Xi({key:`${ee}[0]`,value:X[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Pl,value:L}}))}else V=V.concat(L({key:`${ee}[0]`,value:X[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},X));return ac(Ti(X[1]))?V.concat([new Xt(`${ee}[1]`,X[1],"expressions are not allowed in function stops.")]):V.concat(ci({key:`${ee}[1]`,value:X[1],valueSpec:e,style:j.style,styleSpec:j.styleSpec}))}function L(j,V){const X=or(j.value),ee=$n(j.value),de=null!==j.value?j.value:V;if(s){if(X!==s)return[new Xt(j.key,de,`${X} stop domain type must match previous stop domain type ${s}`)]}else s=X;if("number"!==X&&"string"!==X&&"boolean"!==X&&"number"!=typeof ee&&"string"!=typeof ee&&"boolean"!=typeof ee)return[new Xt(j.key,de,"stop domain value must be a number, string, or boolean")];if("number"!==X&&"categorical"!==t){let we=`number expected, ${X} found`;return bi(e)&&void 0===t&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xt(j.key,de,we)]}return"categorical"!==t||"number"!==X||"number"==typeof ee&&isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==t&&"number"===X&&"number"==typeof ee&&"number"==typeof u&&void 0!==u&&ee<u?[new Xt(j.key,de,"stop domain values must appear in ascending order")]:(u=ee,"categorical"===t&&ee in m?[new Xt(j.key,de,"stop domain values must be unique")]:(m[ee]=!0,[])):[new Xt(j.key,de,`integer expected, found ${String(ee)}`)]}}function Go(n){const e=("property"===n.expressionContext?lc:Wa)(Ti(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new Xt(`${n.key}${s.key}`,n.value,s.message));const t=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!t.outputDefined())return[new Xt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!No(t))return[new Xt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return cc(t,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!zs(t,["zoom","feature-state"]))return[new Xt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!us(t))return[new Xt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cc(n,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)t.delete(u);if(0===t.size)return[];const s=[];return n instanceof _i&&t.has(n.name)?[new Xt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{s.push(...cc(u,e))}),s)}function ds(n){const e=n.key,t=n.value,s=n.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf($n(t))&&u.push(new Xt(e,t,`expected one of [${s.values.join(", ")}], ${JSON.stringify(t)} found`)):-1===Object.keys(s.values).indexOf($n(t))&&u.push(new Xt(e,t,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(t)} found`)),u}function Rl(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Rl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function fs(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Rl(n)||(n=Mo(n));const t=n;let s=!0;try{s=function(w){if(!Cs(w))return w;let M=Ti(w);return Zs(M),M=kl(M),M}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(t,null,2)}\n        `)}const u=Ke[`filter_${e}`],f=Wa(s,u);let m=null;if("error"===f.result)throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,M,R)=>f.value.evaluate(w,M,{},R);let y=null,b=null;if(s!==t){const w=Wa(t,u);if("error"===w.result)throw new Error(w.value.map(M=>`${M.key}: ${M.message}`).join(", "));y=(M,R,L,j,V)=>w.value.evaluate(M,R,{},L,void 0,void 0,j,V),b=!us(w.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:yu(s),needFeature:!!b}}function kl(n){if(!Array.isArray(n))return n;const e=function(t){if(jc.has(t[0]))for(let s=1;s<t.length;s++)if(Cs(t[s]))return!0;return t}(n);return!0===e?e:e.map(t=>kl(t))}function Zs(n){let e=!1;const t=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||Cs(n[s]),t.push(n[s+1]);t.push(n[n.length-1])}else if("match"===n[0]){e=e||Cs(n[1]);for(let s=2;s<n.length-1;s+=2)t.push(n[s+1]);t.push(n[n.length-1])}else if("step"===n[0]){e=e||Cs(n[1]);for(let s=1;s<n.length-1;s+=2)t.push(n[s+1])}e&&(n.length=0,n.push("any",...t));for(let s=1;s<n.length;s++)Zs(n[s])}function Cs(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let t=1;t<n.length;t++)if(Cs(n[t]))return!0;return!1}const jc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ih(n,e){return n<e?-1:n>e?1:0}function yu(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(yu(n[e]))return!0;return!1}function Mo(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?Vc(n[1],n[2],"=="):"!="===e?Ai(Vc(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Vc(n[1],n[2],e):"any"===e?(t=n.slice(1),["any"].concat(t.map(Mo))):"all"===e?["all"].concat(n.slice(1).map(Mo)):"none"===e?["all"].concat(n.slice(1).map(Mo).map(Ai)):"in"===e?Is(n[1],n.slice(2)):"!in"===e?Ai(Is(n[1],n.slice(2))):"has"===e?ps(n[1]):"!has"===e?Ai(ps(n[1])):"within"!==e||n;var t}function Vc(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function Is(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(ih)]]:["filter-in-small",n,["literal",e]]}}function ps(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ai(n){return["!",n]}function Qo(n){return Rl(Ti(n.value))?Go(mi({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):ga(n)}function ga(n){const e=n.value,t=n.key;if("array"!==or(e))return[new Xt(t,e,`array expected, ${or(e)} found`)];const s=n.styleSpec;let u,f=[];if(e.length<1)return[new Xt(t,e,"filter array must have at least 1 element")];switch(f=f.concat(ds({key:`${t}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),$n(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===$n(e[1])&&f.push(new Xt(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new Xt(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=or(e[1]),"string"!==u&&f.push(new Xt(`${t}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=or(e[m]),"$type"===$n(e[1])?f=f.concat(ds({key:`${t}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new Xt(`${t}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(ga({key:`${t}[${m}]`,value:e[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=or(e[1]),2!==e.length?f.push(new Xt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new Xt(`${t}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=or(e[1]),2!==e.length?f.push(new Xt(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new Xt(`${t}[1]`,e[1],`object expected, ${u} found`))}return f}function vu(n,e){const t=n.key,s=n.style,u=n.styleSpec,f=n.value,m=n.objectKey,y=u[`${e}_${n.layerType}`];if(!y)return[];const b=m.match(/^(.*)-transition$/);if("paint"===e&&b&&y[b[1]]&&y[b[1]].transition)return ci({key:t,value:f,valueSpec:u.transition,style:s,styleSpec:u});const w=n.valueSpec||y[m];if(!w)return[new Xt(t,f,`unknown property "${m}"`)];let M;if("string"===or(f)&&bi(w)&&!w.tokens&&(M=/^{([^}]+)}$/.exec(f)))return[new Xt(t,f,`"${m}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const R=[];return"symbol"===n.layerType&&("text-field"===m&&s&&!s.glyphs&&R.push(new Xt(t,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===m&&Ds(Ti(f))&&"identity"===$n(f.type)&&R.push(new Xt(t,f,'"text-font" does not support identity functions'))),R.concat(ci({key:n.key,value:f,valueSpec:w,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function $c(n){return vu(n,"paint")}function Ya(n){return vu(n,"layout")}function Ll(n){let e=[];const t=n.value,s=n.key,u=n.style,f=n.styleSpec;t.type||t.ref||e.push(new Xt(s,t,'either "type" or "ref" is required'));let m=$n(t.type);const y=$n(t.ref);if(t.id){const b=$n(t.id);for(let w=0;w<n.arrayIndex;w++){const M=u.layers[w];$n(M.id)===b&&e.push(new Xt(s,t.id,`duplicate layer id "${t.id}", previously used at line ${M.id.__line__}`))}}if("ref"in t){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in t&&e.push(new Xt(s,t[w],`"${w}" is prohibited for ref layers`))}),u.layers.forEach(w=>{$n(w.id)===y&&(b=w)}),b?b.ref?e.push(new Xt(s,t.ref,"ref cannot reference another ref layer")):m=$n(b.type):"string"==typeof y&&e.push(new Xt(s,t.ref,`ref layer "${y}" not found`))}else if("background"!==m&&"sky"!==m)if(t.source){const b=u.sources&&u.sources[t.source],w=b&&$n(b.type);b?"vector"===w&&"raster"===m?e.push(new Xt(s,t.source,`layer "${t.id}" requires a raster source`)):"raster"===w&&"raster"!==m?e.push(new Xt(s,t.source,`layer "${t.id}" requires a vector source`)):"vector"!==w||t["source-layer"]?"raster-dem"===w&&"hillshade"!==m?e.push(new Xt(s,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==m||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||"geojson"===w&&b.lineMetrics||e.push(new Xt(s,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Xt(s,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new Xt(s,t.source,`source "${t.source}" not found`))}else e.push(new Xt(s,t,'missing required property "source"'));return e=e.concat(Xi({key:s,value:t,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ci({key:`${s}.type`,value:t.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:t,objectKey:"type"}),filter:b=>Qo(mi({layerType:m},b)),layout:b=>Xi({layer:t,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Ya(mi({layerType:m},w))}}),paint:b=>Xi({layer:t,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>$c(mi({layerType:m},w))}})}})),e}function _a(n){const e=n.value,t=n.key,s=or(e);return"string"!==s?[new Xt(t,e,`string expected, ${s} found`)]:[]}const uc={promoteId:function({key:n,value:e}){if("string"===or(e))return _a({key:n,value:e});{const t=[];for(const s in e)t.push(..._a({key:`${n}.${s}`,value:e[s]}));return t}}};function Ol(n){const e=n.value,t=n.key,s=n.styleSpec,u=n.style;if(!e.type)return[new Xt(t,e,'"type" is required')];const f=$n(e.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=Xi({key:t,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:uc}),m;case"geojson":if(m=Xi({key:t,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:uc}),e.cluster)for(const y in e.clusterProperties){const[b,w]=e.clusterProperties[y],M="string"==typeof b?[b,["accumulated"],["get",y]]:b;m.push(...Go({key:`${t}.${y}.map`,value:w,expressionContext:"cluster-map"})),m.push(...Go({key:`${t}.${y}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return m;case"video":return Xi({key:t,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Xi({key:t,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Xt(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ds({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:s})}}function Ka(n){const e=n.value,t=n.styleSpec,s=t.light,u=n.style;let f=[];const m=or(e);if(void 0===e)return f;if("object"!==m)return f=f.concat([new Xt("light",e,`object expected, ${m} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&s[b[1]]&&s[b[1]].transition?ci({key:y,value:e[y],valueSpec:t.transition,style:u,styleSpec:t}):s[y]?ci({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:t}):[new Xt(y,e[y],`unknown property "${y}"`)])}return f}function Fl(n){const e=n.value,t=n.key,s=n.style,u=n.styleSpec,f=u.terrain;let m=[];const y=or(e);if(void 0===e)return m;if("object"!==y)return m=m.concat([new Xt("terrain",e,`object expected, ${y} found`)]),m;for(const b in e){const w=b.match(/^(.*)-transition$/);m=m.concat(w&&f[w[1]]&&f[w[1]].transition?ci({key:b,value:e[b],valueSpec:u.transition,style:s,styleSpec:u}):f[b]?ci({key:b,value:e[b],valueSpec:f[b],style:s,styleSpec:u}):[new Xt(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=s.sources&&s.sources[e.source],w=b&&$n(b.type);b?"raster-dem"!==w&&m.push(new Xt(t,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):m.push(new Xt(t,e.source,`source "${e.source}" not found`))}else m.push(new Xt(t,e,'terrain is missing required property "source"'));return m}function Pi(n){const e=n.value,t=n.style,s=n.styleSpec,u=s.fog;let f=[];const m=or(e);if(void 0===e)return f;if("object"!==m)return f=f.concat([new Xt("fog",e,`object expected, ${m} found`)]),f;for(const y in e){const b=y.match(/^(.*)-transition$/);f=f.concat(b&&u[b[1]]&&u[b[1]].transition?ci({key:y,value:e[y],valueSpec:s.transition,style:t,styleSpec:s}):u[y]?ci({key:y,value:e[y],valueSpec:u[y],style:t,styleSpec:s}):[new Xt(y,e[y],`unknown property "${y}"`)])}return f}const hc={"*":()=>[],array:Al,boolean:function(n){const e=n.value,t=n.key,s=or(e);return"boolean"!==s?[new Xt(t,e,`boolean expected, ${s} found`)]:[]},number:Pl,color:function(n){const e=n.key,t=n.value,s=or(t);return"string"!==s?[new Xt(e,t,`color expected, ${s} found`)]:null===Hi.parseCSSColor(t)?[new Xt(e,t,`color expected, "${t}" found`)]:[]},enum:ds,filter:Qo,function:Hs,layer:Ll,object:Xi,source:Ol,light:Ka,terrain:Fl,fog:Pi,string:_a,formatted:function(n){return 0===_a(n).length?[]:Go(n)},resolvedImage:function(n){return 0===_a(n).length?[]:Go(n)},projection:function(n){const e=n.value,t=n.styleSpec,s=t.projection,u=n.style;let f=[];const m=or(e);if("object"===m)for(const y in e)f=f.concat(ci({key:y,value:e[y],valueSpec:s[y],style:u,styleSpec:t}));else"string"!==m&&(f=f.concat([new Xt("projection",e,`object or string expected, ${m} found`)]));return f}};function ci(n){const e=n.value,t=n.valueSpec,s=n.styleSpec;return t.expression&&Ds($n(e))?Hs(n):t.expression&&ac(Ti(e))?Go(n):t.type&&hc[t.type]?hc[t.type](n):Xi(mi({},n,{valueSpec:t.type?s[t.type]:t}))}function Gc(n){const e=n.value,t=n.key,s=_a(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new Xt(t,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new Xt(t,e,'"glyphs" url must include a "{range}" token'))),s}function ya(n,e=Ke){return es(ci({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Gc,"*":()=>[]}}))}const Ja=n=>es($c(n)),xu=n=>es(Ya(n));function es(n){return n.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function dc(n,e){let t=!1;if(e&&e.length)for(const s of e)n.fire(new tn(new Error(s.message))),t=!0;return t}var ms=Yi;function Yi(n,e,t){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(t=u[2]);for(var f=0;f<this.d*this.d;f++){var m=u[3+f],y=u[3+f+1];s.push(m===y?null:u.subarray(m,y))}var b=u[3+s.length+1];this.keys=u.subarray(u[3+s.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=t,this.scale=e/n,this.uid=0;var M=t/e*n;this.min=-M,this.max=n+M}Yi.prototype.insert=function(n,e,t,s,u){this._forEachCell(e,t,s,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(s),this.bboxes.push(u)},Yi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Yi.prototype._insertCell=function(n,e,t,s,u,f){this.cells[u].push(f)},Yi.prototype.query=function(n,e,t,s,u){var f=this.min,m=this.max;if(n<=f&&e<=f&&m<=t&&m<=s&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,t,s,this._queryCell,y,{},u),y},Yi.prototype._queryCell=function(n,e,t,s,u,f,m,y){var b=this.cells[u];if(null!==b)for(var w=this.keys,M=this.bboxes,R=0;R<b.length;R++){var L=b[R];if(void 0===m[L]){var j=4*L;(y?y(M[j+0],M[j+1],M[j+2],M[j+3]):n<=M[j+2]&&e<=M[j+3]&&t>=M[j+0]&&s>=M[j+1])?(m[L]=!0,f.push(w[L])):m[L]=!1}}},Yi.prototype._forEachCell=function(n,e,t,s,u,f,m,y){for(var b=this._convertToCellCoord(n),w=this._convertToCellCoord(e),M=this._convertToCellCoord(t),R=this._convertToCellCoord(s),L=b;L<=M;L++)for(var j=w;j<=R;j++){var V=this.d*j+L;if((!y||y(this._convertFromCellCoord(L),this._convertFromCellCoord(j),this._convertFromCellCoord(L+1),this._convertFromCellCoord(j+1)))&&u.call(this,n,e,t,s,V,f,m,y))return}},Yi.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Yi.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Yi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,t=0,s=0;s<this.cells.length;s++)t+=this.cells[s].length;var u=new Int32Array(e+t+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,m=0;m<n.length;m++){var y=n[m];u[3+m]=f,u.set(y,f),f+=y.length}return u[3+n.length]=f,u.set(this.keys,f),u[3+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};const ts={};function Yt(n,e,t={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),ts[e]={klass:n,omit:t.omit||[]}}Yt(Object,"Object"),ms.serialize=function(n,e){const t=n.toArrayBuffer();return e&&e.push(t),{buffer:t}},ms.deserialize=function(n){return new ms(n.buffer)},Object.defineProperty(ms,"name",{value:"Grid"}),Yt(ms,"Grid"),Yt(vr,"Color"),Yt(Error,"Error"),Yt(Ue,"AJAXError"),Yt(gr,"ResolvedImage"),Yt(qa,"StylePropertyFunction"),Yt(fa,"StyleExpression",{omit:["_evaluator"]}),Yt(ma,"ZoomDependentExpression"),Yt(pa,"ZoomConstantExpression"),Yt(_i,"CompoundExpression",{omit:["_evaluate"]});for(const n in ir)ts[ir[n]._classRegistryKey]||Yt(ir[n],`Expression${n}`);function va(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function Qa(n){return Fe.ImageBitmap&&n instanceof Fe.ImageBitmap}function el(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(va(n)||Qa(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const t=n;return e&&e.push(t.buffer),t}if(n instanceof Fe.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const t=[];for(const s of n)t.push(el(s,e));return t}if("object"==typeof n){const t=n.constructor,s=t._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=t.serialize?t.serialize(n,e):{};if(!t.serialize){for(const f in n)n.hasOwnProperty(f)&&(ts[s].omit.indexOf(f)>=0||(u[f]=el(n[f],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof n)}function gs(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||va(n)||Qa(n)||ArrayBuffer.isView(n)||n instanceof Fe.ImageData)return n;if(Array.isArray(n))return n.map(gs);if("object"==typeof n){const e=n.$name||"Object",{klass:t}=ts[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(n);const s=Object.create(t.prototype);for(const u of Object.keys(n))"$name"!==u&&(s[u]=gs(n[u]));return s}throw new Error("can't deserialize object of type "+typeof n)}class Rr{constructor(){this.first=!0}update(e,t){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const Wh=n=>n>=1536&&n<=1791,bu=n=>n>=1872&&n<=1919,wu=n=>n>=2208&&n<=2303,Hc=n=>n>=11904&&n<=12031,oh=n=>n>=12032&&n<=12255,fc=n=>n>=12272&&n<=12287,Zc=n=>n>=12288&&n<=12351,Ws=n=>n>=12352&&n<=12447,tl=n=>n>=12448&&n<=12543,qh=n=>n>=12544&&n<=12591,ni=n=>n>=12704&&n<=12735,Wc=n=>n>=12736&&n<=12783,qs=n=>n>=12784&&n<=12799,Eu=n=>n>=12800&&n<=13055,qc=n=>n>=13056&&n<=13311,oo=n=>n>=13312&&n<=19903,Ao=n=>n>=19968&&n<=40959,zl=n=>n>=40960&&n<=42127,Bl=n=>n>=42128&&n<=42191,nl=n=>n>=44032&&n<=55215,Xc=n=>n>=63744&&n<=64255,rl=n=>n>=64336&&n<=65023,Tu=n=>n>=65040&&n<=65055,sh=n=>n>=65072&&n<=65103,I=n=>n>=65104&&n<=65135,S=n=>n>=65136&&n<=65279,T=n=>n>=65280&&n<=65519;function k(n){for(const e of n)if(me(e.charCodeAt(0)))return!0;return!1}function U(n){for(const e of n)if(!Y(e.charCodeAt(0)))return!1;return!0}function Y(n){return!(Wh(n)||bu(n)||wu(n)||rl(n)||S(n))}function me(n){return!(746!==n&&747!==n&&(n<4352||!(ni(n)||qh(n)||sh(n)&&!(n>=65097&&n<=65103)||Xc(n)||qc(n)||Hc(n)||Wc(n)||!(!Zc(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||oo(n)||Ao(n)||Eu(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||nl(n)||Ws(n)||fc(n)||(e=>e>=12688&&e<=12703)(n)||oh(n)||qs(n)||tl(n)&&12540!==n||!(!T(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!I(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||Tu(n)||(e=>e>=19904&&e<=19967)(n)||zl(n)||Bl(n))));var e}function be(n){return!(me(n)||(e=n,(t=e)>=128&&t<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(t=>t>=8192&&t<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&9251!==e||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Zc(e)||tl(e)||(t=>t>=57344&&t<=63743)(e)||sh(e)||I(e)||T(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,t}function h(n){return n>=1424&&n<=2303||rl(n)||S(n)}function r(n,e){return!(!e&&h(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(t=n,t>=6016&&t<=6143));var t}function l(n){for(const e of n)if(h(e.charCodeAt(0)))return!0;return!1}const p="deferred",_="loading",v="loaded";let E=null,C="unavailable",A=null;const z=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(C="error"),E&&E(n)};function N(){Z.fire(new wt("pluginStateChange",{pluginStatus:C,pluginURL:A}))}const Z=new Zt,K=function(){return C},se=function(){if(C!==p||!A)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");C=_,N(),A&&$e({url:A},n=>{n?z(n):(C=v,N())})},re={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>C===v||null!=re.applyArabicShaping,isLoading:()=>C===_,setState(n){C=n.pluginStatus,A=n.pluginURL},isParsed:()=>null!=re.applyArabicShaping&&null!=re.processBidirectionalText&&null!=re.processStyledBidirectionalText,getPluginURL:()=>A};class ne{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rr,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,s){for(const u of t)if(!r(u.charCodeAt(0),s))return!1;return!0}(e,re.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*t}}}class ie{constructor(e,t){this.property=e,this.value=t,this.expression=function(s,u){if(Ds(s))return new qa(s,u);if(ac(s)){const f=lc(s,u);if("error"===f.result)throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=vr.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,s){return this.property.possiblyEvaluate(this,e,t,s)}}class te{constructor(e){this.property=e,this.value=new ie(e,void 0)}transitioned(e,t){return new ce(this.property,this.value,t,xt({},e.transition,this.transition),e.now)}untransitioned(){return new ce(this.property,this.value,null,{},0)}}class ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return dt(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new te(this._values[e].property)),this._values[e].value=new ie(this._values[e].property,null===t?void 0:dt(t))}getTransition(e){return dt(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new te(this._values[e].property)),this._values[e].transition=dt(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const s=this.getValue(t);void 0!==s&&(e[t]=s);const u=this.getTransition(t);void 0!==u&&(e[`${t}-transition`]=u)}return e}transitioned(e,t){const s=new ke(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,t._values[u]);return s}untransitioned(){const e=new ke(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class ce{constructor(e,t,s,u,f){const m=u.delay||0,y=u.duration||0;f=f||0,this.property=e,this.value=t,this.begin=f+m,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,t,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,t,s),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(e,t,s);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,s),f,xn(y))}}return f}}class ke{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,s){const u=new Ae(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,t,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return dt(this._values[e].value)}setValue(e,t){this._values[e]=new ie(this._values[e].property,null===t?void 0:dt(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const s=this.getValue(t);void 0!==s&&(e[t]=s)}return e}possiblyEvaluate(e,t,s){const u=new Ae(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,t,s);return u}}class ve{constructor(e,t,s){this.property=e,this.value=t,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,s,u){return this.property.evaluate(this.value,this.parameters,e,t,s,u)}}class Ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ce{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,s){const u=Va[this.specification.type];return u?u(e,t,s):e}}class Be{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,s,u){return new ve(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},s,u)}:e.expression,t)}interpolate(e,t,s){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new ve(this,{kind:"constant",value:void 0},e.parameters);const u=Va[this.specification.type];return u?new ve(this,{kind:"constant",value:u(e.value.value,t.value.value,s)},e.parameters):e}evaluate(e,t,s,u,f,m){return"constant"===e.kind?e.value:e.evaluate(t,s,u,f,m)}}class He extends Be{possiblyEvaluate(e,t,s,u){if(void 0===e.value)return new ve(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const f=e.expression.evaluate(t,null,{},s,u),m="resolvedImage"===e.property.specification.type&&"string"!=typeof f?f.name:f,y=this._calculate(m,m,m,t);return new ve(this,{kind:"constant",value:y},t)}if("camera"===e.expression.kind){const f=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new ve(this,{kind:"constant",value:f},t)}return new ve(this,e.expression,t)}evaluate(e,t,s,u,f,m){if("source"===e.kind){const y=e.evaluate(t,s,u,f,m);return this._calculate(y,y,y,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},s,u),e.evaluate({zoom:Math.floor(t.zoom)},s,u),e.evaluate({zoom:Math.floor(t.zoom)+1},s,u),t):e.value}_calculate(e,t,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:t,other:s}:{from:s,to:t,other:e}}interpolate(e){return e}}class Mt{constructor(e){this.specification=e}possiblyEvaluate(e,t,s,u){if(void 0!==e.value){if("constant"===e.expression.kind){const f=e.expression.evaluate(t,null,{},s,u);return this._calculate(f,f,f,t)}return this._calculate(e.expression.evaluate(new ne(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ne(Math.floor(t.zoom),t)),e.expression.evaluate(new ne(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:s,to:t}}interpolate(e){return e}}class Ve{constructor(e){this.specification=e}possiblyEvaluate(e,t,s,u){return!!e.expression.evaluate(t,null,{},s,u)}interpolate(){return!1}}class at{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new ne(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new ie(u,void 0),m=this.defaultTransitionablePropertyValues[s]=new te(u);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(t)}}}function _t(n,e){return 256*(n=$t(Math.floor(n),0,255))+$t(Math.floor(e),0,255)}Yt(Be,"DataDrivenProperty"),Yt(Ce,"DataConstantProperty"),Yt(He,"CrossFadedDataDrivenProperty"),Yt(Mt,"CrossFadedProperty"),Yt(Ve,"ColorRampProperty");const Bt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qe{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function mt(n,e=1){let t=0,s=0;return{members:n.map(u=>{const f=Bt[u.type].BYTES_PER_ELEMENT,m=t=Wt(t,Math.max(e,f)),y=u.components||1;return s=Math.max(s,f),t+=f*y,{name:u.name,type:u.type,components:y,offset:m}}),size:Wt(t,Math.max(s,e)),alignment:e}}function Wt(n,e){return Math.ceil(n/e)*e}class Vt extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const s=this.length;return this.resize(s+1),this.emplace(s,e,t)}emplace(e,t,s){const u=2*e;return this.int16[u+0]=t,this.int16[u+1]=s,e}}Vt.prototype.bytesPerElement=4,Yt(Vt,"StructArrayLayout2i4");class nn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,s)}emplace(e,t,s,u){const f=3*e;return this.int16[f+0]=t,this.int16[f+1]=s,this.int16[f+2]=u,e}}nn.prototype.bytesPerElement=6,Yt(nn,"StructArrayLayout3i6");class fn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const m=4*e;return this.int16[m+0]=t,this.int16[m+1]=s,this.int16[m+2]=u,this.int16[m+3]=f,e}}fn.prototype.bytesPerElement=8,Yt(fn,"StructArrayLayout4i8");class In extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,s,u,f,m,y)}emplace(e,t,s,u,f,m,y,b){const w=6*e,M=12*e,R=3*e;return this.int16[w+0]=t,this.int16[w+1]=s,this.uint8[M+4]=u,this.uint8[M+5]=f,this.uint8[M+6]=m,this.uint8[M+7]=y,this.float32[R+2]=b,e}}In.prototype.bytesPerElement=12,Yt(In,"StructArrayLayout2i4ub1f12");class cr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const m=4*e;return this.float32[m+0]=t,this.float32[m+1]=s,this.float32[m+2]=u,this.float32[m+3]=f,e}}cr.prototype.bytesPerElement=16,Yt(cr,"StructArrayLayout4f16");class ln extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y,b,w,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,t,s,u,f,m,y,b,w,M)}emplace(e,t,s,u,f,m,y,b,w,M,R){const L=10*e;return this.uint16[L+0]=t,this.uint16[L+1]=s,this.uint16[L+2]=u,this.uint16[L+3]=f,this.uint16[L+4]=m,this.uint16[L+5]=y,this.uint16[L+6]=b,this.uint16[L+7]=w,this.uint16[L+8]=M,this.uint16[L+9]=R,e}}ln.prototype.bytesPerElement=20,Yt(ln,"StructArrayLayout10ui20");class Ln extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y,b){const w=this.length;return this.resize(w+1),this.emplace(w,e,t,s,u,f,m,y,b)}emplace(e,t,s,u,f,m,y,b,w){const M=8*e;return this.uint16[M+0]=t,this.uint16[M+1]=s,this.uint16[M+2]=u,this.uint16[M+3]=f,this.uint16[M+4]=m,this.uint16[M+5]=y,this.uint16[M+6]=b,this.uint16[M+7]=w,e}}Ln.prototype.bytesPerElement=16,Yt(Ln,"StructArrayLayout8ui16");class br extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,s,u,f,m)}emplace(e,t,s,u,f,m,y){const b=6*e;return this.int16[b+0]=t,this.int16[b+1]=s,this.int16[b+2]=u,this.int16[b+3]=f,this.int16[b+4]=m,this.int16[b+5]=y,e}}br.prototype.bytesPerElement=12,Yt(br,"StructArrayLayout6i12");class Yr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y,b,w,M,R,L){const j=this.length;return this.resize(j+1),this.emplace(j,e,t,s,u,f,m,y,b,w,M,R,L)}emplace(e,t,s,u,f,m,y,b,w,M,R,L,j){const V=12*e;return this.int16[V+0]=t,this.int16[V+1]=s,this.int16[V+2]=u,this.int16[V+3]=f,this.uint16[V+4]=m,this.uint16[V+5]=y,this.uint16[V+6]=b,this.uint16[V+7]=w,this.int16[V+8]=M,this.int16[V+9]=R,this.int16[V+10]=L,this.int16[V+11]=j,e}}Yr.prototype.bytesPerElement=24,Yt(Yr,"StructArrayLayout4i4ui4i24");class hi extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,s,u,f,m)}emplace(e,t,s,u,f,m,y){const b=10*e,w=5*e;return this.int16[b+0]=t,this.int16[b+1]=s,this.int16[b+2]=u,this.float32[w+2]=f,this.float32[w+3]=m,this.float32[w+4]=y,e}}hi.prototype.bytesPerElement=20,Yt(hi,"StructArrayLayout3i3f20");class Lr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Lr.prototype.bytesPerElement=4,Yt(Lr,"StructArrayLayout1ul4");class Ui extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y,b,w,M,R,L,j){const V=this.length;return this.resize(V+1),this.emplace(V,e,t,s,u,f,m,y,b,w,M,R,L,j)}emplace(e,t,s,u,f,m,y,b,w,M,R,L,j,V){const X=20*e,ee=10*e;return this.int16[X+0]=t,this.int16[X+1]=s,this.int16[X+2]=u,this.int16[X+3]=f,this.int16[X+4]=m,this.float32[ee+3]=y,this.float32[ee+4]=b,this.float32[ee+5]=w,this.float32[ee+6]=M,this.int16[X+14]=R,this.uint32[ee+8]=L,this.uint16[X+18]=j,this.uint16[X+19]=V,e}}Ui.prototype.bytesPerElement=40,Yt(Ui,"StructArrayLayout5i4f1i1ul2ui40");class _s extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,s,u,f,m,y)}emplace(e,t,s,u,f,m,y,b){const w=8*e;return this.int16[w+0]=t,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+4]=f,this.int16[w+5]=m,this.int16[w+6]=y,this.int16[w+7]=b,e}}_s.prototype.bytesPerElement=16,Yt(_s,"StructArrayLayout3i2i2i16");class xa extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,s,u,f)}emplace(e,t,s,u,f,m){const y=4*e,b=8*e;return this.float32[y+0]=t,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[b+6]=f,this.int16[b+7]=m,e}}xa.prototype.bytesPerElement=16,Yt(xa,"StructArrayLayout2f1f2i16");class Gr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const m=12*e,y=3*e;return this.uint8[m+0]=t,this.uint8[m+1]=s,this.float32[y+1]=u,this.float32[y+2]=f,e}}Gr.prototype.bytesPerElement=12,Yt(Gr,"StructArrayLayout2ub2f12");class ui extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,s)}emplace(e,t,s,u){const f=3*e;return this.float32[f+0]=t,this.float32[f+1]=s,this.float32[f+2]=u,e}}ui.prototype.bytesPerElement=12,Yt(ui,"StructArrayLayout3f12");class Zn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,s)}emplace(e,t,s,u){const f=3*e;return this.uint16[f+0]=t,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}Zn.prototype.bytesPerElement=6,Yt(Zn,"StructArrayLayout3ui6");class ji extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee,de,we,fe,ye,Le){const De=this.length;return this.resize(De+1),this.emplace(De,e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee,de,we,fe,ye,Le)}emplace(e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee,de,we,fe,ye,Le,De){const Je=30*e,Xe=15*e,lt=60*e;return this.int16[Je+0]=t,this.int16[Je+1]=s,this.int16[Je+2]=u,this.float32[Xe+2]=f,this.float32[Xe+3]=m,this.uint16[Je+8]=y,this.uint16[Je+9]=b,this.uint32[Xe+5]=w,this.uint32[Xe+6]=M,this.uint32[Xe+7]=R,this.uint16[Je+16]=L,this.uint16[Je+17]=j,this.uint16[Je+18]=V,this.float32[Xe+10]=X,this.float32[Xe+11]=ee,this.uint8[lt+48]=de,this.uint8[lt+49]=we,this.uint8[lt+50]=fe,this.uint32[Xe+13]=ye,this.int16[Je+28]=Le,this.uint8[lt+58]=De,e}}ji.prototype.bytesPerElement=60,Yt(ji,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class eo extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee,de,we,fe,ye,Le,De,Je,Xe,lt,Lt,et,ut,bt,ht){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee,de,we,fe,ye,Le,De,Je,Xe,lt,Lt,et,ut,bt,ht)}emplace(e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee,de,we,fe,ye,Le,De,Je,Xe,lt,Lt,et,ut,bt,ht,Rt){const vt=38*e,qt=19*e;return this.int16[vt+0]=t,this.int16[vt+1]=s,this.int16[vt+2]=u,this.float32[qt+2]=f,this.float32[qt+3]=m,this.int16[vt+8]=y,this.int16[vt+9]=b,this.int16[vt+10]=w,this.int16[vt+11]=M,this.int16[vt+12]=R,this.int16[vt+13]=L,this.uint16[vt+14]=j,this.uint16[vt+15]=V,this.uint16[vt+16]=X,this.uint16[vt+17]=ee,this.uint16[vt+18]=de,this.uint16[vt+19]=we,this.uint16[vt+20]=fe,this.uint16[vt+21]=ye,this.uint16[vt+22]=Le,this.uint16[vt+23]=De,this.uint16[vt+24]=Je,this.uint16[vt+25]=Xe,this.uint16[vt+26]=lt,this.uint16[vt+27]=Lt,this.uint16[vt+28]=et,this.uint32[qt+15]=ut,this.float32[qt+16]=bt,this.float32[qt+17]=ht,this.float32[qt+18]=Rt,e}}eo.prototype.bytesPerElement=76,Yt(eo,"StructArrayLayout3i2f6i15ui1ul3f76");class Vr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Vr.prototype.bytesPerElement=4,Yt(Vr,"StructArrayLayout1f4");class so extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,s,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,s,u,f)}emplace(e,t,s,u,f,m){const y=5*e;return this.float32[y+0]=t,this.float32[y+1]=s,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=m,e}}so.prototype.bytesPerElement=20,Yt(so,"StructArrayLayout5f20");class Xs extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,s,u)}emplace(e,t,s,u,f){const m=6*e;return this.uint32[3*e+0]=t,this.uint16[m+2]=s,this.uint16[m+3]=u,this.uint16[m+4]=f,e}}Xs.prototype.bytesPerElement=12,Yt(Xs,"StructArrayLayout1ul3ui12");class ao extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const s=this.length;return this.resize(s+1),this.emplace(s,e,t)}emplace(e,t,s){const u=2*e;return this.uint16[u+0]=t,this.uint16[u+1]=s,e}}ao.prototype.bytesPerElement=4,Yt(ao,"StructArrayLayout2ui4");class ys extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ys.prototype.bytesPerElement=2,Yt(ys,"StructArrayLayout1ui2");class Nl extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const s=this.length;return this.resize(s+1),this.emplace(s,e,t)}emplace(e,t,s){const u=2*e;return this.float32[u+0]=t,this.float32[u+1]=s,e}}Nl.prototype.bytesPerElement=8,Yt(Nl,"StructArrayLayout2f8");class Ul extends Qe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ul.prototype.size=12;class Ho extends br{get(e){return new Ul(this,e)}}Yt(Ho,"FillExtrusionExtArray");class Ys extends Qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ys.prototype.size=40;class Ks extends Ui{get(e){return new Ys(this,e)}}Yt(Ks,"CollisionBoxArray");class pc extends Qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}pc.prototype.size=60;class Qd extends ji{get(e){return new pc(this,e)}}Yt(Qd,"PlacedSymbolArray");class ef extends Qe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ef.prototype.size=76;class tf extends eo{get(e){return new ef(this,e)}}Yt(tf,"SymbolInstanceArray");class Pp extends Vr{getoffsetX(e){return this.float32[1*e+0]}}Yt(Pp,"GlyphOffsetArray");class Rp extends nn{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Yt(Rp,"SymbolLineVertexArray");class kp extends Qe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kp.prototype.size=12;class Lp extends Xs{get(e){return new kp(this,e)}}Yt(Lp,"FeatureIndexArray");class Op extends Qe{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Op.prototype.size=4;class jl extends ao{get(e){return new Op(this,e)}}Yt(jl,"FillExtrusionCentroidArray");class Du extends Qe{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Du.prototype.size=12;class Fp extends br{get(e){return new Du(this,e)}}Yt(Fp,"CircleGlobeExtArray");const ky=mt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ly=mt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ag=Ls(function(n){n.exports=function(e,t){var s,u,f,m,y,b,w,M;for(u=e.length-(s=3&e.length),f=t,y=3432918353,b=461845907,M=0;M<u;)w=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,f=27492+(65535&(m=5*(65535&(f=(f^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&e.charCodeAt(M+2))<<16;case 2:w^=(255&e.charCodeAt(M+1))<<8;case 1:f^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(M)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*b+(((w>>>16)*b&65535)<<16)&4294967295}return f^=e.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Oy=Ls(function(n){n.exports=function(e,t){for(var s,u=e.length,f=t^u,m=0;u>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(s>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),u-=4,++m;switch(u){case 3:f^=(255&e.charCodeAt(m+2))<<16;case 2:f^=(255&e.charCodeAt(m+1))<<8;case 1:f=1540483477*(65535&(f^=255&e.charCodeAt(m)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),Xh=Ag,zp=Oy;Xh.murmur3=Ag,Xh.murmur2=zp;class Yh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,s,u){this.ids.push(Bp(e)),this.positions.push(t,s,u)}getPositions(e){const t=Bp(e);let s=0,u=this.ids.length-1;for(;s<u;){const m=s+u>>1;this.ids[m]>=t?u=m:s=m+1}const f=[];for(;this.ids[s]===t;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,t){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return nf(s,u,0,s.length-1),t&&t.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const t=new Yh;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Bp(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Xh(String(n))}function nf(n,e,t,s){for(;t<s;){const u=n[t+s>>1];let f=t-1,m=s+1;for(;;){do{f++}while(n[f]<u);do{m--}while(n[m]>u);if(f>=m)break;Kh(n,f,m),Kh(e,3*f,3*m),Kh(e,3*f+1,3*m+1),Kh(e,3*f+2,3*m+2)}m-t<s-m?(nf(n,e,t,m),t=m+1):(nf(n,e,m+1,s),s=m)}}function Kh(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}Yt(Yh,"FeaturePositionMap");class Js{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class ah extends Js{constructor(e){super(e),this.current=0}set(e,t,s){this.fetchUniformLocation(e,t)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ba extends Js{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,s){this.fetchUniformLocation(e,t)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Cu extends Js{constructor(e){super(e),this.current=vr.transparent}set(e,t,s){this.fetchUniformLocation(e,t)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Np=new Float32Array(16),Up=new Float32Array(9),jp=new Float32Array(4);function Vp(n){return[_t(255*n.r,255*n.g),_t(255*n.b,255*n.a)]}class Jh{constructor(e,t,s){this.value=e,this.uniformNames=t.map(u=>`u_${u}`),this.type=s}setUniform(e,t,s,u,f){t.set(e,f,u.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Cu(e):new ah(e)}}class lh{constructor(e,t){this.uniformNames=t.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,s,u,f){const m="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;m&&t.set(e,f,m)}getBinding(e,t){return"u_pattern_from"===t||"u_pattern_to"===t||"u_dash_from"===t||"u_dash_to"===t?new ba(e):new ah(e)}}class wa{constructor(e,t,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=t.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,t,s,u,f,m){const y=this.paintVertexArray.length,b=this.expression.evaluate(new ne(0),t,{},f,u,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,t,s,u,f){const m=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,t,m)}_setPaintValue(e,t,s){if("color"===this.type){const u=Vp(s);for(let f=e;f<t;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ss{constructor(e,t,s,u,f,m){this.expression=e,this.uniformNames=t.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=t.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,t,s,u,f,m){const y=this.expression.evaluate(new ne(this.zoom),t,{},f,u,m),b=this.expression.evaluate(new ne(this.zoom+1),t,{},f,u,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,b)}updatePaintArray(e,t,s,u,f){const m=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,t,m,y)}_setPaintValue(e,t,s,u){if("color"===this.type){const f=Vp(s),m=Vp(u);for(let y=e;y<t;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=e;f<t;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,s,u,f){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=$t(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);t.set(e,f,y)}getBinding(e,t){return new ah(e)}}class il{constructor(e,t,s,u,f,m,y){this.expression=e,this.type=s,this.useIntegerZoom=u,this.zoom=f,this.layerId=y,this.paintVertexAttributes=("array"===s?Ly:ky).members;for(let b=0;b<t.length;++b);this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,t,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,t.patterns&&t.patterns[this.layerId],s)}updatePaintArray(e,t,s,u,f,m){this._setPaintValues(e,t,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,t,s,u){if(!u||!s)return;const{min:f,mid:m,max:y}=s,b=u[f],w=u[m],M=u[y];if(b&&w&&M)for(let R=e;R<t;R++)this._setPaintValue(this.zoomInPaintVertexArray,R,w,b),this._setPaintValue(this.zoomOutPaintVertexArray,R,w,M)}_setPaintValue(e,t,s,u){e.emplace(t,s.tl[0],s.tl[1],s.br[0],s.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],s.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yc{constructor(e,t,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const m=e.paint.get(f);if(!(m instanceof ve&&bi(m.property.specification)))continue;const y=Pg(f,e.type),b=m.value,w=m.property.specification.type,M=m.property.useIntegerZoom,R=m.property.specification["property-type"],L="cross-faded"===R||"cross-faded-data-driven"===R,j="line-dasharray"===String(f)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||j)if("source"===b.kind||j||L){const V=Gp(f,w,"source");this.binders[f]=L?new il(b,y,w,M,t,V,e.id):new wa(b,y,w,V),u.push(`/a_${f}`)}else{const V=Gp(f,w,"composite");this.binders[f]=new Ss(b,y,w,M,t,V),u.push(`/z_${f}`)}else this.binders[f]=L?new lh(b.value,y):new Jh(b.value,y,w),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof wa||t instanceof Ss?t.maxValue:0}populatePaintArrays(e,t,s,u,f,m){for(const y in this.binders){const b=this.binders[y];(b instanceof wa||b instanceof Ss||b instanceof il)&&b.populatePaintArray(e,t,s,u,f,m)}}setConstantPatternPositions(e,t){for(const s in this.binders){const u=this.binders[s];u instanceof lh&&u.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,s,u,f,m){let y=!1;for(const b in e){const w=t.getPositions(b);for(const M of w){const R=s.feature(M.index);for(const L in this.binders){const j=this.binders[L];if((j instanceof wa||j instanceof Ss||j instanceof il)&&!0===j.expression.isStateDependent){const V=u.paint.get(L);j.expression=V.value,j.updatePaintArray(M.start,M.end,R,e[b],f,m),y=!0}}}}return y}defines(){const e=[];for(const t in this.binders){const s=this.binders[t];(s instanceof Jh||s instanceof lh)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const s=this.binders[t];if(s instanceof wa||s instanceof Ss||s instanceof il)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const s=this.binders[t];if(s instanceof Jh||s instanceof lh||s instanceof Ss)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Jh||u instanceof lh||u instanceof Ss)for(const f of u.uniformNames)t.push({name:f,property:s,binding:u.getBinding(e,f)})}return t}setUniforms(e,t,s,u,f){for(const{name:m,property:y,binding:b}of s)this.binders[y].setUniform(e,b,f,u.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const s=this.binders[t];if(e&&s instanceof il){const u=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof wa||s instanceof Ss)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const t in this.binders){const s=this.binders[t];(s instanceof wa||s instanceof Ss||s instanceof il)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof wa||t instanceof Ss||t instanceof il)&&t.destroy()}}}class Iu{constructor(e,t,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Yc(u,t,s);this.needsUpload=!1,this._featureMap=new Yh,this._bufferOffset=0}populatePaintArrays(e,t,s,u,f,m,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,t,u,f,m,y);void 0!==t.id&&this._featureMap.add(t.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,s,u,f){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,t,m,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const $p={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Pg(n,e){return $p[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Rg={"line-pattern":{source:ln,composite:ln},"fill-pattern":{source:ln,composite:ln},"fill-extrusion-pattern":{source:ln,composite:ln},"line-dasharray":{source:Ln,composite:Ln}},kg={color:{source:Nl,composite:cr},number:{source:Vr,composite:Nl}};function Gp(n,e,t){const s=Rg[n];return s&&s[t]||kg[e][t]}Yt(Jh,"ConstantBinder"),Yt(lh,"CrossFadedConstantBinder"),Yt(wa,"SourceExpressionBinder"),Yt(il,"CrossFadedCompositeBinder"),Yt(Ss,"CompositeExpressionBinder"),Yt(Yc,"ProgramConfiguration",{omit:["_buffers"]}),Yt(Iu,"ProgramConfigurationSet");const ch="-transition";class vs extends Zt{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Se(t.layout)),t.paint)){this._transitionablePaint=new ae(t.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ae(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,s={}){null!=t&&this._validate(xu,`layers.${this.id}.layout.${e}`,e,t,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return ot(e,ch)?this._transitionablePaint.getTransition(e.slice(0,-ch.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,s={}){if(null!=t&&this._validate(Ja,`layers.${this.id}.paint.${e}`,e,t,s))return!1;if(ot(e,ch))return this._transitionablePaint.setTransition(e.slice(0,-ch.length),t||void 0),!1;{const u=this._transitionablePaint._values[e],f="cross-faded-data-driven"===u.property.specification["property-type"],m=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Gt(e,(t,s)=>!(void 0===t||"layout"===s&&!Object.keys(t).length||"paint"===s&&!Object.keys(t).length))}_validate(e,t,s,u,f={}){return(!f||!1!==f.validate)&&dc(this,e.call(ya,{key:t,layerType:this.type,objectKey:s,value:u,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ve&&bi(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=fs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Lg=mt([{name:"a_pos",components:2,type:"Int16"}],4),rf=mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vi{constructor(e=[]){this.segments=e}prepareSegment(e,t,s,u){let f=this.segments[this.segments.length-1];return e>Vi.MAX_VERTEX_ARRAY_LENGTH&&dn(`Max vertices per segment is ${Vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Vi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:t.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,s,u){return new Vi([{vertexOffset:e,primitiveOffset:t,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}Vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt(Vi,"SegmentVector");var an=8192;class mc{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Cr?new Cr(e.lng,e.lat):Cr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Cr?new Cr(e.lng,e.lat):Cr.convert(e),this}extend(e){const t=this._sw,s=this._ne;let u,f;if(e instanceof Cr)u=e,f=e;else{if(!(e instanceof mc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(mc.convert(e)):this.extend(Cr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return t||s?(t.lng=Math.min(u.lng,t.lng),t.lat=Math.min(u.lat,t.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Cr(u.lng,u.lat),this._ne=new Cr(f.lng,f.lat)),this}getCenter(){return new Cr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Cr(this.getWest(),this.getNorth())}getSouthEast(){return new Cr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:s}=Cr.convert(e);let u=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof mc?e:new mc(e)}}const sf=6371008.8;class Cr{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Cr(rn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,s=this.lat*t,u=e.lat*t,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*t);return sf*Math.acos(Math.min(f,1))}toBounds(e=0){const t=360*e/40075017,s=t/Math.cos(Math.PI/180*this.lat);return new mc(new Cr(this.lng-s,this.lat-t),new Cr(this.lng+s,this.lat+t))}static convert(e){if(e instanceof Cr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Cr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Cr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const af=2*Math.PI*sf;function lf(n){return af*Math.cos(n*Math.PI/180)}function ol(n){return(180+n)/360}function Vl(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Qs(n,e){return n/lf(e)}function ea(n){return 360*n-180}function Po(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Og(n,e){return n*lf(Po(e))}const xs=85.051129;function Qh(n){return 1/Math.cos(n*Math.PI/180)}class Kc{constructor(e,t,s=0){this.x=+e,this.y=+t,this.z=+s}static fromLngLat(e,t=0){const s=Cr.convert(e);return new Kc(ol(s.lng),Vl(s.lat),Qs(t,s.lat))}toLngLat(){return new Cr(ea(this.x),Po(this.y))}toAltitude(){return Og(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/af*Qh(Po(this.y))}}function ed(n,e,t,s,u,f,m,y,b){const w=(e+s)/2,M=(t+u)/2,R=new Ye(w,M);y(R),function(L,j,V,X,ee,de){const we=V-ee,fe=X-de;return Math.abs((X-j)*we-(V-L)*fe)/Math.hypot(we,fe)}(R.x,R.y,f.x,f.y,m.x,m.y)>=b?(ed(n,e,t,w,M,f,R,y,b),ed(n,w,M,s,u,R,m,y,b)):n.push(m)}function cf(n,e,t){let s=n[0],u=s.x,f=s.y;e(s);const m=[s];for(let y=1;y<n.length;y++){const b=n[y],{x:w,y:M}=b;e(b),ed(m,u,f,w,M,s,b,e,t),u=w,f=M,s=b}return m}function uf(n,e,t,s,u){if(u(e,t)){const f=e.add(t).mult(.5);s(f),uf(n,e,f,s,u),uf(n,f,t,s,u)}else n.push(t)}function Hp(n,e,t){let s=n[0];e(s);const u=[s];for(let f=1;f<n.length;f++){const m=n[f];e(m),uf(u,s,m,e,t),s=m}return u}const td=Math.pow(2,14)-1,nd=-td-1;function Fy(n,e){const t=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=$t(t,nd,td),n.y=$t(s,nd,td),(t<n.x||t>n.x+1||s<n.y||s>n.y+1)&&dn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function $l(n,e,t){const s=n.loadGeometry(),u=n.extent,f=an/u;if(e&&t&&t.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:w,projection:M}=t,R=L=>{const j=ea((e.x+L.x/u)/m),V=Po((e.y+L.y/u)/m),X=M.project(j,V);L.x=(X.x*y-b)*u,L.y=(X.y*y-w)*u};for(let L=0;L<s.length;L++)if(1!==n.type)s[L]=cf(s[L],R,1);else{const j=[];for(const V of s[L])V.x<0||V.x>=u||V.y<0||V.y>=u||(R(V),j.push(V));s[L]=j}}for(const m of s)for(const y of m)Fy(y,f);return s}function Gl(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?$l(n):[]}}function uh(n,e,t,s,u){n.emplaceBack(2*e+(s+1)/2,2*t+(u+1)/2)}function hh(n,e,t){n.emplaceBack(e.x,e.y,e.z,16384*t[0],16384*t[1],16384*t[2])}class Hl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Vt,this.indexArray=new Zn,this.segments=new Vi,this.programConfigurations=new Iu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,s,u){const f=this.layers[0],m=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:M,index:R,sourceLayerIndex:L}of e){const j=this.layers[0]._featureFilter.needGeometry,V=Gl(w,j);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),V,s))continue;const X=y?y.evaluate(V,{},s):void 0,ee={id:M,properties:w.properties,type:w.type,sourceLayerIndex:L,index:R,geometry:j?V.geometry:$l(w,s,u),patterns:{},sortKey:X};m.push(ee)}y&&m.sort((w,M)=>w.sortKey-M.sortKey);let b=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Fp,b=u.projection);for(const w of m){const{geometry:M,index:R,sourceLayerIndex:L}=w,j=e[R].feature;this.addFeature(w,M,R,t.availableImages,s,b),t.featureIndex.insert(j,M,R,L,this.index)}}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,rf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,s,u,f,m){for(const y of t)for(const b of y){const w=b.x,M=b.y;if(w<0||w>=an||M<0||M>=an)continue;if(m){const j=m.projectTilePoint(w,M,f),V=m.upVector(f,w,M),X=this.globeExtVertexArray;hh(X,j,V),hh(X,j,V),hh(X,j,V),hh(X,j,V)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=R.vertexLength;uh(this.layoutVertexArray,w,M,-1,-1),uh(this.layoutVertexArray,w,M,1,-1),uh(this.layoutVertexArray,w,M,1,1),uh(this.layoutVertexArray,w,M,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function Zp(n,e){for(let t=0;t<n.length;t++)if(Jc(e,n[t]))return!0;for(let t=0;t<e.length;t++)if(Jc(n,e[t]))return!0;return!!fh(n,e)}function hf(n,e,t){return!!Jc(n,e)||!!Zl(e,n,t)}function dh(n,e){if(1===n.length)return id(e,n[0]);for(let t=0;t<e.length;t++){const s=e[t];for(let u=0;u<s.length;u++)if(Jc(n,s[u]))return!0}for(let t=0;t<n.length;t++)if(id(e,n[t]))return!0;for(let t=0;t<e.length;t++)if(fh(n,e[t]))return!0;return!1}function Fg(n,e,t){if(n.length>1){if(fh(n,e))return!0;for(let s=0;s<e.length;s++)if(Zl(e[s],n,t))return!0}for(let s=0;s<n.length;s++)if(Zl(n[s],e,t))return!0;return!1}function fh(n,e){if(0===n.length||0===e.length)return!1;for(let t=0;t<n.length-1;t++){const s=n[t],u=n[t+1];for(let f=0;f<e.length-1;f++)if(rd(s,u,e[f],e[f+1]))return!0}return!1}function rd(n,e,t,s){return Sr(n,t,s)!==Sr(e,t,s)&&Sr(n,e,t)!==Sr(n,e,s)}function Zl(n,e,t){const s=t*t;if(1===e.length)return n.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(df(n,e[u-1],e[u])<s)return!0;return!1}function df(n,e,t){const s=e.distSqr(t);if(0===s)return n.distSqr(e);const u=((n.x-e.x)*(t.x-e.x)+(n.y-e.y)*(t.y-e.y))/s;return n.distSqr(u<0?e:u>1?t:t.sub(e)._mult(u)._add(e))}function id(n,e){let t,s,u,f=!1;for(let m=0;m<n.length;m++){t=n[m];for(let y=0,b=t.length-1;y<t.length;b=y++)s=t[y],u=t[b],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Jc(n,e){let t=!1;for(let s=0,u=n.length-1;s<n.length;u=s++){const f=n[s],m=n[u];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(t=!t)}return t}function Wp(n,e,t,s,u){for(const m of n)if(e<=m.x&&t<=m.y&&s>=m.x&&u>=m.y)return!0;const f=[new Ye(e,t),new Ye(e,u),new Ye(s,u),new Ye(s,t)];if(n.length>2)for(const m of f)if(Jc(n,m))return!0;for(let m=0;m<n.length-1;m++)if(qp(n[m],n[m+1],f))return!0;return!1}function qp(n,e,t){const s=t[0],u=t[2];if(n.x<s.x&&e.x<s.x||n.x>u.x&&e.x>u.x||n.y<s.y&&e.y<s.y||n.y>u.y&&e.y>u.y)return!1;const f=Sr(n,e,t[0]);return f!==Sr(n,e,t[1])||f!==Sr(n,e,t[2])||f!==Sr(n,e,t[3])}function Ea(n,e,t){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:t.programConfigurations.get(e.id).getMaxValue(n)}function od(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Xp(n,e,t,s,u){if(!e[0]&&!e[1])return n;const f=Ye.convert(e)._mult(u);"viewport"===t&&f._rotate(-s);const m=[];for(let y=0;y<n.length;y++)m.push(n[y].sub(f));return m}function Yp(n,e,t,s){const u=Ye.convert(n)._mult(s);return"viewport"===e&&u._rotate(-t),u}Yt(Hl,"CircleBucket",{omit:["layers"]});const zg=new at({"circle-sort-key":new Be(Ke.layout_circle["circle-sort-key"])});var ff={paint:new at({"circle-radius":new Be(Ke.paint_circle["circle-radius"]),"circle-color":new Be(Ke.paint_circle["circle-color"]),"circle-blur":new Be(Ke.paint_circle["circle-blur"]),"circle-opacity":new Be(Ke.paint_circle["circle-opacity"]),"circle-translate":new Ce(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Ce(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ce(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ce(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Be(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Be(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Be(Ke.paint_circle["circle-stroke-opacity"])}),layout:zg},sd=1e-6,ns=typeof Float32Array<"u"?Float32Array:Array;function Kp(){var n=new ns(9);return ns!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Ta(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Jp(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],m=e[4],y=e[5],b=e[6],w=e[7],M=e[8],R=e[9],L=e[10],j=e[11],V=e[12],X=e[13],ee=e[14],de=e[15],we=t*y-s*m,fe=t*b-u*m,ye=t*w-f*m,Le=s*b-u*y,De=s*w-f*y,Je=u*w-f*b,Xe=M*X-R*V,lt=M*ee-L*V,Lt=M*de-j*V,et=R*ee-L*X,ut=R*de-j*X,bt=L*de-j*ee,ht=we*bt-fe*ut+ye*et+Le*Lt-De*lt+Je*Xe;return ht?(n[0]=(y*bt-b*ut+w*et)*(ht=1/ht),n[1]=(u*ut-s*bt-f*et)*ht,n[2]=(X*Je-ee*De+de*Le)*ht,n[3]=(L*De-R*Je-j*Le)*ht,n[4]=(b*Lt-m*bt-w*lt)*ht,n[5]=(t*bt-u*Lt+f*lt)*ht,n[6]=(ee*ye-V*Je-de*fe)*ht,n[7]=(M*Je-L*ye+j*fe)*ht,n[8]=(m*ut-y*Lt+w*Xe)*ht,n[9]=(s*Lt-t*ut-f*Xe)*ht,n[10]=(V*De-X*ye+de*we)*ht,n[11]=(R*ye-M*De-j*we)*ht,n[12]=(y*lt-m*et-b*Xe)*ht,n[13]=(t*et-s*lt+u*Xe)*ht,n[14]=(X*fe-V*Le-ee*we)*ht,n[15]=(M*Le-R*fe+L*we)*ht,n):null}function Su(n,e,t){var s=e[0],u=e[1],f=e[2],m=e[3],y=e[4],b=e[5],w=e[6],M=e[7],R=e[8],L=e[9],j=e[10],V=e[11],X=e[12],ee=e[13],de=e[14],we=e[15],fe=t[0],ye=t[1],Le=t[2],De=t[3];return n[0]=fe*s+ye*y+Le*R+De*X,n[1]=fe*u+ye*b+Le*L+De*ee,n[2]=fe*f+ye*w+Le*j+De*de,n[3]=fe*m+ye*M+Le*V+De*we,n[4]=(fe=t[4])*s+(ye=t[5])*y+(Le=t[6])*R+(De=t[7])*X,n[5]=fe*u+ye*b+Le*L+De*ee,n[6]=fe*f+ye*w+Le*j+De*de,n[7]=fe*m+ye*M+Le*V+De*we,n[8]=(fe=t[8])*s+(ye=t[9])*y+(Le=t[10])*R+(De=t[11])*X,n[9]=fe*u+ye*b+Le*L+De*ee,n[10]=fe*f+ye*w+Le*j+De*de,n[11]=fe*m+ye*M+Le*V+De*we,n[12]=(fe=t[12])*s+(ye=t[13])*y+(Le=t[14])*R+(De=t[15])*X,n[13]=fe*u+ye*b+Le*L+De*ee,n[14]=fe*f+ye*w+Le*j+De*de,n[15]=fe*m+ye*M+Le*V+De*we,n}function Wl(n,e,t){var s,u,f,m,y,b,w,M,R,L,j,V,X=t[0],ee=t[1],de=t[2];return e===n?(n[12]=e[0]*X+e[4]*ee+e[8]*de+e[12],n[13]=e[1]*X+e[5]*ee+e[9]*de+e[13],n[14]=e[2]*X+e[6]*ee+e[10]*de+e[14],n[15]=e[3]*X+e[7]*ee+e[11]*de+e[15]):(u=e[1],f=e[2],m=e[3],y=e[4],b=e[5],w=e[6],M=e[7],R=e[8],L=e[9],j=e[10],V=e[11],n[0]=s=e[0],n[1]=u,n[2]=f,n[3]=m,n[4]=y,n[5]=b,n[6]=w,n[7]=M,n[8]=R,n[9]=L,n[10]=j,n[11]=V,n[12]=s*X+y*ee+R*de+e[12],n[13]=u*X+b*ee+L*de+e[13],n[14]=f*X+w*ee+j*de+e[14],n[15]=m*X+M*ee+V*de+e[15]),n}function Qc(n,e,t){var s=t[0],u=t[1],f=t[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function gc(n,e,t){var s=Math.sin(t),u=Math.cos(t),f=e[4],m=e[5],y=e[6],b=e[7],w=e[8],M=e[9],R=e[10],L=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+w*s,n[5]=m*u+M*s,n[6]=y*u+R*s,n[7]=b*u+L*s,n[8]=w*u-f*s,n[9]=M*u-m*s,n[10]=R*u-y*s,n[11]=L*u-b*s,n}function _c(n,e,t){var s=Math.sin(t),u=Math.cos(t),f=e[0],m=e[1],y=e[2],b=e[3],w=e[8],M=e[9],R=e[10],L=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-w*s,n[1]=m*u-M*s,n[2]=y*u-R*s,n[3]=b*u-L*s,n[8]=f*s+w*u,n[9]=m*s+M*u,n[10]=y*s+R*u,n[11]=b*s+L*u,n}function Qp(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Bg(n,e,t){var s,u,f,m=t[0],y=t[1],b=t[2],w=Math.hypot(m,y,b);return w<sd?null:(m*=w=1/w,y*=w,b*=w,s=Math.sin(e),u=Math.cos(e),n[0]=m*m*(f=1-u)+u,n[1]=y*m*f+b*s,n[2]=b*m*f-y*s,n[3]=0,n[4]=m*y*f-b*s,n[5]=y*y*f+u,n[6]=b*y*f+m*s,n[7]=0,n[8]=m*b*f+y*s,n[9]=y*b*f-m*s,n[10]=b*b*f+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var em=Su;function pf(){var n=new ns(3);return ns!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function tm(n){var e=new ns(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function ph(n){return Math.hypot(n[0],n[1],n[2])}function eu(n,e,t){var s=new ns(3);return s[0]=n,s[1]=e,s[2]=t,s}function yc(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function mh(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function nm(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function mf(n,e,t){return n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n}function gh(n,e,t){return n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n}function sl(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function gf(n,e,t,s){return n[0]=e[0]+t[0]*s,n[1]=e[1]+t[1]*s,n[2]=e[2]+t[2]*s,n}function vo(n,e){var t=e[0],s=e[1],u=e[2],f=t*t+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function Da(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function rm(n,e,t){var s=e[0],u=e[1],f=e[2],m=t[0],y=t[1],b=t[2];return n[0]=u*b-f*y,n[1]=f*m-s*b,n[2]=s*y-u*m,n}function to(n,e,t){var s=e[0],u=e[1],f=e[2],m=t[3]*s+t[7]*u+t[11]*f+t[15];return n[0]=(t[0]*s+t[4]*u+t[8]*f+t[12])/(m=m||1),n[1]=(t[1]*s+t[5]*u+t[9]*f+t[13])/m,n[2]=(t[2]*s+t[6]*u+t[10]*f+t[14])/m,n}function Ng(n,e,t){var s=t[0],u=t[1],f=t[2],m=e[0],y=e[1],b=e[2],w=u*b-f*y,M=f*m-s*b,R=s*y-u*m,L=u*R-f*M,j=f*w-s*R,V=s*M-u*w,X=2*t[3];return M*=X,R*=X,j*=2,V*=2,n[0]=m+(w*=X)+(L*=2),n[1]=y+M+j,n[2]=b+R+V,n}var ad,Ca=mh,im=nm,_f=ph;function yf(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function vc(n,e,t){var s=e[0],u=e[1],f=e[2],m=e[3];return n[0]=t[0]*s+t[4]*u+t[8]*f+t[12]*m,n[1]=t[1]*s+t[5]*u+t[9]*f+t[13]*m,n[2]=t[2]*s+t[6]*u+t[10]*f+t[14]*m,n[3]=t[3]*s+t[7]*u+t[11]*f+t[15]*m,n}function vf(){var n=new ns(4);return ns!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ld(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function om(n,e,t){t*=.5;var s=e[0],u=e[1],f=e[2],m=e[3],y=Math.sin(t),b=Math.cos(t);return n[0]=s*b+m*y,n[1]=u*b+f*y,n[2]=f*b-u*y,n[3]=m*b-s*y,n}function cd(n,e,t){t*=.5;var s=e[0],u=e[1],f=e[2],m=e[3],y=Math.sin(t),b=Math.cos(t);return n[0]=s*b-f*y,n[1]=u*b+m*y,n[2]=f*b+s*y,n[3]=m*b-u*y,n}pf(),ad=new ns(4),ns!=Float32Array&&(ad[0]=0,ad[1]=0,ad[2]=0,ad[3]=0),pf(),eu(1,0,0),eu(0,1,0),vf(),vf(),Kp();class tu{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,s){const u=Da(t,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,t,s){if(X=(j=this.pos)[0],ee=j[1],de=j[2],we=(V=e)[0],fe=V[1],ye=V[2],Math.abs(X-we)<=sd*Math.max(1,Math.abs(X),Math.abs(we))&&Math.abs(ee-fe)<=sd*Math.max(1,Math.abs(ee),Math.abs(fe))&&Math.abs(de-ye)<=sd*Math.max(1,Math.abs(de),Math.abs(ye))||0===t)return s[0]=s[1]=s[2]=0,!1;var j,V,X,ee,de,we,fe,ye;const[u,f,m]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],M=u*u+f*f+m*m,R=2*(y*u+b*f+w*m),L=R*R-4*M*(y*y+b*b+w*w-t*t);if(L<0){const j=Math.max(-R/2,0),V=y+u*j,X=b+f*j,ee=w+m*j,de=Math.hypot(V,X,ee);return s[0]=V*t/de,s[1]=X*t/de,s[2]=ee*t/de,!1}{const j=(-R-Math.sqrt(L))/(2*M);if(j<0){const V=Math.hypot(y,b,w);return s[0]=y*t/V,s[1]=b*t/V,s[2]=w*t/V,!1}return s[0]=y+u*j,s[1]=b+f*j,s[2]=w+m*j,!0}}}class xf{constructor(e,t,s,u,f){this.TL=e,this.TR=t,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,t,s){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],y=[-1,-1,1],b=to(u,u,e),w=to(f,f,e),M=to(m,m,e),R=to(y,y,e);return new xf(b,w,M,R,t/s)}}class bf{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,s,u){const f=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=vc([],b,e),M=1/w[3]/t*f;return(R=w)[0]=(L=w)[0]*(j=[M,M,u?1/w[3]:M,M])[0],R[1]=L[1]*j[1],R[2]=L[2]*j[2],R[3]=L[3]*j[3],R;var R,L,j}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=vo([],rm([],Ca([],m[b[0]],m[b[1]]),Ca([],m[b[2]],m[b[1]]))),M=-Da(w,m[b[1]]);return w.concat(M)});return new bf(m,y)}}class rs{static fromPoints(e){const t=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],s=[Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE];for(const u of e)t[0]=Math.min(t[0],u[0]),t[1]=Math.min(t[1],u[1]),t[2]=Math.min(t[2],u[2]),s[0]=Math.max(s[0],u[0]),s[1]=Math.max(s[1],u[1]),s[2]=Math.max(s[2],u[2]);return new rs(t,s)}constructor(e,t){this.min=e,this.max=t,this.center=sl([],yc([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],s=tm(this.min),u=tm(this.max);for(let f=0;f<t.length;f++)s[f]=t[f]?this.min[f]:this.center[f],u[f]=t[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new rs(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let m=0;for(let y=0;y<t.length;y++)m+=Da(f,t[y])+f[3]>=0;if(0===m)return 0;m!==t.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][u]-this.min[u];f=Math.min(f,b),m=Math.max(m,b)}if(m<0||f>this.max[u]-this.min[u])return 0}return 1}}function wf(n,e,t,s,u,f,m,y,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,M=t.projection.upVectorScale(w,t.center.lat,t.worldSize).metersToTile;for(const R of e)for(const L of R){const j=L.add(y),V=u&&t.elevation?t.elevation.exaggeration()*u.getElevationAt(j.x,j.y,!0):0,X=t.projection.projectTilePoint(j.x,j.y,w);if(V>0){const fe=t.projection.upVector(w,j.x,j.y);X.x+=fe[0]*M*V,X.y+=fe[1]*M*V,X.z+=fe[2]*M*V}const ee=f?j:Ug(X.x,X.y,X.z,s),de=f?n.tilespaceRays.map(fe=>Vg(fe,V)):n.queryGeometry.screenGeometry,we=vc([],[X.x,X.y,X.z,1],s);if(!m&&f?b*=we[3]/t.cameraToCenterDistance:m&&!f&&(b*=t.cameraToCenterDistance/we[3]),f){const fe=Po((L.y/an+w.y)/(1<<w.z));b/=t.projection.pixelsPerMeter(fe,1)/Qs(1,fe)}if(hf(de,ee,b))return!0}return!1}function Ug(n,e,t,s){const u=vc([],[n,e,t,1],s);return new Ye(u[0]/u[3],u[1]/u[3])}const sm=eu(0,0,0),jg=eu(0,0,1);function Vg(n,e){const t=pf();return sm[2]=e,n.intersectsPlane(sm,jg,t),new Ye(t[0],t[1])}class ud extends Hl{}function am(n,{width:e,height:t},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*t*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*t*s);return n.width=e,n.height=t,n.data=u,n}function lm(n,e,t){const{width:s,height:u}=e;s===n.width&&u===n.height||(Ef(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,u)},t),n.width=s,n.height=u,n.data=e.data)}function Ef(n,e,t,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>n.width||u.height>n.height||t.x>n.width-u.width||t.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,y=e.data;for(let b=0;b<u.height;b++){const w=((t.y+b)*n.width+t.x)*f,M=((s.y+b)*e.width+s.x)*f;for(let R=0;R<u.width*f;R++)y[M+R]=m[w+R]}return e}Yt(ud,"HeatmapBucket",{omit:["layers"]});class al{constructor(e,t){am(this,e,1,t)}resize(e){lm(this,new al(e),1)}clone(){return new al({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,s,u,f){Ef(e,t,s,u,f,1)}}class bs{constructor(e,t){am(this,e,4,t)}resize(e){lm(this,new bs(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,s,u,f){Ef(e,t,s,u,f,4)}}Yt(al,"AlphaImage"),Yt(bs,"RGBAImage");var $g={paint:new at({"heatmap-radius":new Be(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Be(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ce(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ve(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ce(Ke.paint_heatmap["heatmap-opacity"])})};function Ro(n){const e={},t=n.resolution||256,s=n.clips?n.clips.length:1,u=n.image||new bs({width:t,height:s}),f=(m,y,b)=>{e[n.evaluationKey]=b;const w=n.expression.evaluate(e);u.data[m+y+0]=Math.floor(255*w.r/w.a),u.data[m+y+1]=Math.floor(255*w.g/w.a),u.data[m+y+2]=Math.floor(255*w.b/w.a),u.data[m+y+3]=Math.floor(255*w.a)};if(n.clips)for(let m=0,y=0;m<s;++m,y+=4*t)for(let b=0,w=0;b<t;b++,w+=4){const M=b/(t-1),{start:R,end:L}=n.clips[m];f(y,w,R*(1-M)+L*M)}else for(let m=0,y=0;m<t;m++,y+=4)f(0,y,m/(t-1));return u}var Tf={paint:new at({"hillshade-illumination-direction":new Ce(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ce(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ce(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ce(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ce(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ce(Ke.paint_hillshade["hillshade-accent-color"])})};const cm=mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Df}=cm;var lo=Mu,_h=Mu;function Mu(n,e,t){t=t||2;var s,u,f,m,y,b,w,M=e&&e.length,R=M?e[0]*t:n.length,L=um(n,0,R,t,!0),j=[];if(!L||L.next===L.prev)return j;if(M&&(L=function(X,ee,de,we){var fe,ye,Le,De=[];for(fe=0,ye=ee.length;fe<ye;fe++)(Le=um(X,ee[fe]*we,fe<ye-1?ee[fe+1]*we:X.length,we,!1))===Le.next&&(Le.steiner=!0),De.push(Xg(Le));for(De.sort(Zg),fe=0;fe<De.length;fe++)de=Wg(De[fe],de);return de}(n,e,L,t)),n.length>80*t){s=f=n[0],u=m=n[1];for(var V=t;V<R;V+=t)(y=n[V])<s&&(s=y),(b=n[V+1])<u&&(u=b),y>f&&(f=y),b>m&&(m=b);w=0!==(w=Math.max(f-s,m-u))?32767/w:0}return Au(L,j,t,s,u,w,0),j}function um(n,e,t,s,u){var f,m;if(u===pd(n,e,t,s)>0)for(f=e;f<t;f+=s)m=fd(f,n[f],n[f+1],m);else for(f=t-s;f>=e;f-=s)m=fd(f,n[f],n[f+1],m);return m&&hd(m,m.next)&&(ru(m),m=m.next),m}function nu(n,e){if(!n)return n;e||(e=n);var t,s=n;do{if(t=!1,s.steiner||!hd(s,s.next)&&0!==Ri(s.prev,s,s.next))s=s.next;else{if(ru(s),(s=e=s.prev)===s.next)break;t=!0}}while(t||s!==e);return e}function Au(n,e,t,s,u,f,m){if(n){!m&&f&&function(M,R,L,j){var V=M;do{0===V.z&&(V.z=Cf(V.x,V.y,R,L,j)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==M);V.prevZ.nextZ=null,V.prevZ=null,function(X){var ee,de,we,fe,ye,Le,De,Je,Xe=1;do{for(de=X,X=null,ye=null,Le=0;de;){for(Le++,we=de,De=0,ee=0;ee<Xe&&(De++,we=we.nextZ);ee++);for(Je=Xe;De>0||Je>0&&we;)0!==De&&(0===Je||!we||de.z<=we.z)?(fe=de,de=de.nextZ,De--):(fe=we,we=we.nextZ,Je--),ye?ye.nextZ=fe:X=fe,fe.prevZ=ye,ye=fe;de=we}ye.nextZ=null,Xe*=2}while(Le>1)}(V)}(n,s,u,f);for(var y,b,w=n;n.prev!==n.next;)if(y=n.prev,b=n.next,f?hm(n,s,u,f):Gg(n))e.push(y.i/t|0),e.push(n.i/t|0),e.push(b.i/t|0),ru(n),n=b.next,w=b.next;else if((n=b)===w){m?1===m?Au(n=Hg(nu(n),e,t),e,t,s,u,f,2):2===m&&dm(n,e,t,s,u,f):Au(nu(n),e,t,s,u,f,1);break}}}function Gg(n){var e=n.prev,t=n,s=n.next;if(Ri(e,t,s)>=0)return!1;for(var u=e.x,f=t.x,m=s.x,y=e.y,b=t.y,w=s.y,M=u<f?u<m?u:m:f<m?f:m,R=y<b?y<w?y:w:b<w?b:w,L=u>f?u>m?u:m:f>m?f:m,j=y>b?y>w?y:w:b>w?b:w,V=s.next;V!==e;){if(V.x>=M&&V.x<=L&&V.y>=R&&V.y<=j&&Ia(u,y,f,b,m,w,V.x,V.y)&&Ri(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function hm(n,e,t,s){var u=n.prev,f=n,m=n.next;if(Ri(u,f,m)>=0)return!1;for(var y=u.x,b=f.x,w=m.x,M=u.y,R=f.y,L=m.y,j=y<b?y<w?y:w:b<w?b:w,V=M<R?M<L?M:L:R<L?R:L,X=y>b?y>w?y:w:b>w?b:w,ee=M>R?M>L?M:L:R>L?R:L,de=Cf(j,V,e,t,s),we=Cf(X,ee,e,t,s),fe=n.prevZ,ye=n.nextZ;fe&&fe.z>=de&&ye&&ye.z<=we;){if(fe.x>=j&&fe.x<=X&&fe.y>=V&&fe.y<=ee&&fe!==u&&fe!==m&&Ia(y,M,b,R,w,L,fe.x,fe.y)&&Ri(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,ye.x>=j&&ye.x<=X&&ye.y>=V&&ye.y<=ee&&ye!==u&&ye!==m&&Ia(y,M,b,R,w,L,ye.x,ye.y)&&Ri(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;fe&&fe.z>=de;){if(fe.x>=j&&fe.x<=X&&fe.y>=V&&fe.y<=ee&&fe!==u&&fe!==m&&Ia(y,M,b,R,w,L,fe.x,fe.y)&&Ri(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;ye&&ye.z<=we;){if(ye.x>=j&&ye.x<=X&&ye.y>=V&&ye.y<=ee&&ye!==u&&ye!==m&&Ia(y,M,b,R,w,L,ye.x,ye.y)&&Ri(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function Hg(n,e,t){var s=n;do{var u=s.prev,f=s.next.next;!hd(u,f)&&Yg(u,s,s.next,f)&&dd(u,f)&&dd(f,u)&&(e.push(u.i/t|0),e.push(s.i/t|0),e.push(f.i/t|0),ru(s),ru(s.next),s=n=f),s=s.next}while(s!==n);return nu(s)}function dm(n,e,t,s,u,f){var m=n;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&ql(m,y)){var b=Sa(m,y);return m=nu(m,m.next),b=nu(b,b.next),Au(m,e,t,s,u,f,0),void Au(b,e,t,s,u,f,0)}y=y.next}m=m.next}while(m!==n)}function Zg(n,e){return n.x-e.x}function Wg(n,e){var t=function(u,f){var m,y=f,b=u.x,w=u.y,M=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var R=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(R<=b&&R>M&&(M=R,m=y.x<y.next.x?y:y.next,R===b))return m}y=y.next}while(y!==f);if(!m)return null;var L,j=m,V=m.x,X=m.y,ee=1/0;y=m;do{b>=y.x&&y.x>=V&&b!==y.x&&Ia(w<X?b:M,w,V,X,w<X?M:b,w,y.x,y.y)&&(L=Math.abs(w-y.y)/(b-y.x),dd(y,u)&&(L<ee||L===ee&&(y.x>m.x||y.x===m.x&&qg(m,y)))&&(m=y,ee=L)),y=y.next}while(y!==j);return m}(n,e);if(!t)return e;var s=Sa(t,n);return nu(s,s.next),nu(t,t.next)}function qg(n,e){return Ri(n.prev,n,e.prev)<0&&Ri(e.next,n,n.next)<0}function Cf(n,e,t,s,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xg(n){var e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function Ia(n,e,t,s,u,f,m,y){return(u-m)*(e-y)>=(n-m)*(f-y)&&(n-m)*(s-y)>=(t-m)*(e-y)&&(t-m)*(f-y)>=(u-m)*(s-y)}function ql(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(t,s){var u=t;do{if(u.i!==t.i&&u.next.i!==t.i&&u.i!==s.i&&u.next.i!==s.i&&Yg(u,u.next,t,s))return!0;u=u.next}while(u!==t);return!1}(n,e)&&(dd(n,e)&&dd(e,n)&&function(t,s){var u=t,f=!1,m=(t.x+s.x)/2,y=(t.y+s.y)/2;do{u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==t);return f}(n,e)&&(Ri(n.prev,n,e.prev)||Ri(n,e.prev,e))||hd(n,e)&&Ri(n.prev,n,n.next)>0&&Ri(e.prev,e,e.next)>0)}function Ri(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function hd(n,e){return n.x===e.x&&n.y===e.y}function Yg(n,e,t,s){var u=yh(Ri(n,e,t)),f=yh(Ri(n,e,s)),m=yh(Ri(t,s,n)),y=yh(Ri(t,s,e));return u!==f&&m!==y||!(0!==u||!If(n,t,e))||!(0!==f||!If(n,s,e))||!(0!==m||!If(t,n,s))||!(0!==y||!If(t,e,s))}function If(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function yh(n){return n>0?1:n<0?-1:0}function dd(n,e){return Ri(n.prev,n,n.next)<0?Ri(n,e,n.next)>=0&&Ri(n,n.prev,e)>=0:Ri(n,e,n.prev)<0||Ri(n,n.next,e)<0}function Sa(n,e){var t=new Sf(n.i,n.x,n.y),s=new Sf(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,t.next=u,u.prev=t,s.next=t,t.prev=s,f.next=s,s.prev=f,s}function fd(n,e,t,s){var u=new Sf(n,e,t);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function ru(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Sf(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pd(n,e,t,s){for(var u=0,f=e,m=t-s;f<t;f+=s)u+=(n[m]-n[f])*(n[f+1]+n[m+1]),m=f;return u}function Kg(n,e,t,s,u){Pu(n,e,t||0,s||n.length-1,u||Jg)}function Pu(n,e,t,s,u){for(;s>t;){if(s-t>600){var f=s-t+1,m=e-t+1,y=Math.log(f),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(f-b)/f)*(m-f/2<0?-1:1);Pu(n,e,Math.max(t,Math.floor(e-m*b/f+w)),Math.min(s,Math.floor(e+(f-m)*b/f+w)),u)}var M=n[e],R=t,L=s;for(vh(n,t,e),u(n[s],M)>0&&vh(n,t,s);R<L;){for(vh(n,R,L),R++,L--;u(n[R],M)<0;)R++;for(;u(n[L],M)>0;)L--}0===u(n[t],M)?vh(n,t,L):vh(n,++L,s),L<=e&&(t=L+1),e<=L&&(s=L-1)}}function vh(n,e,t){var s=n[e];n[e]=n[t],n[t]=s}function Jg(n,e){return n<e?-1:n>e?1:0}function xh(n,e){const t=n.length;if(t<=1)return[n];const s=[];let u,f;for(let m=0;m<t;m++){const y=En(n[m]);0!==y&&(n[m].area=Math.abs(y),void 0===f&&(f=y<0),f===y<0?(u&&s.push(u),u=[n[m]]):u.push(n[m]))}if(u&&s.push(u),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(Kg(s[m],e,1,s[m].length-1,Mf),s[m]=s[m].slice(0,e));return s}function Mf(n,e){return e.area-n.area}function md(n,e,t){const s=t.patternDependencies;let u=!1;for(const f of e){const m=f.paint.get(`${n}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,s[y.to]=!0,s[y.from]=!0)}return u}function fm(n,e,t,s,u){const f=u.patternDependencies;for(const m of e){const y=m.paint.get(`${n}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:s-1},t,{},u.availableImages),w=y.evaluate({zoom:s},t,{},u.availableImages),M=y.evaluate({zoom:s+1},t,{},u.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,M=M&&M.name?M.name:M,f[b]=!0,f[w]=!0,f[M]=!0,t.patterns[m.id]={min:b,mid:w,max:M}}}return t}Mu.deviation=function(n,e,t,s){var u=e&&e.length,f=Math.abs(pd(n,0,u?e[0]*t:n.length,t));if(u)for(var m=0,y=e.length;m<y;m++)f-=Math.abs(pd(n,e[m]*t,m<y-1?e[m+1]*t:n.length,t));var b=0;for(m=0;m<s.length;m+=3){var w=s[m]*t,M=s[m+1]*t,R=s[m+2]*t;b+=Math.abs((n[w]-n[R])*(n[M+1]-n[w+1])-(n[w]-n[M])*(n[R+1]-n[w+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)},Mu.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},s=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var m=0;m<e;m++)t.vertices.push(n[u][f][m]);u>0&&t.holes.push(s+=n[u-1].length)}return t},lo.default=_h;class Xl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vt,this.indexArray=new Zn,this.indexArray2=new ao,this.programConfigurations=new Iu(e.layers,e.zoom),this.segments=new Vi,this.segments2=new Vi,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,s,u){this.hasPattern=md("fill",this.layers,t);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:M}of e){const R=this.layers[0]._featureFilter.needGeometry,L=Gl(y,R);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),L,s))continue;const j=f?f.evaluate(L,{},s,t.availableImages):void 0,V={id:b,properties:y.properties,type:y.type,sourceLayerIndex:M,index:w,geometry:R?L.geometry:$l(y,s,u),patterns:{},sortKey:j};m.push(V)}f&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:w,sourceLayerIndex:M}=y;if(this.hasPattern){const R=fm("fill",this.layers,y,this.zoom,t);this.patternFeatures.push(R)}else this.addFeature(y,b,w,s,{},t.availableImages);t.featureIndex.insert(e[w].feature,b,w,M,this.index)}}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}addFeatures(e,t,s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,t,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,s,u,f,m=[]){for(const y of xh(t,500)){let b=0;for(const V of y)b+=V.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),M=w.vertexLength,R=[],L=[];for(const V of y){if(0===V.length)continue;V!==y[0]&&L.push(R.length/2);const X=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),ee=X.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(ee+V.length-1,ee),R.push(V[0].x),R.push(V[0].y);for(let de=1;de<V.length;de++)this.layoutVertexArray.emplaceBack(V[de].x,V[de].y),this.indexArray2.emplaceBack(ee+de-1,ee+de),R.push(V[de].x),R.push(V[de].y);X.vertexLength+=V.length,X.primitiveLength+=V.length}const j=lo(R,L);for(let V=0;V<j.length;V+=3)this.indexArray.emplaceBack(M+j[V],M+j[V+1],M+j[V+2]);w.vertexLength+=b,w.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,u)}}Yt(Xl,"FillBucket",{omit:["layers","patternFeatures"]});const Af=new at({"fill-sort-key":new Be(Ke.layout_fill["fill-sort-key"])});var pm={paint:new at({"fill-antialias":new Ce(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Be(Ke.paint_fill["fill-opacity"]),"fill-color":new Be(Ke.paint_fill["fill-color"]),"fill-outline-color":new Be(Ke.paint_fill["fill-outline-color"]),"fill-translate":new Ce(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Ce(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new He(Ke.paint_fill["fill-pattern"])}),layout:Af};const Qg=mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Pf=mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),e_=mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:t_}=Qg;var mm=Ru;function Ru(n,e,t,s,u){this.properties={},this.extent=t,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=u,n.readFields(n_,this,e)}function n_(n,e,t){1==n?e.id=t.readVarint():2==n?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var m=u._keys[s.readVarint()],y=u._values[s.readVarint()];u.properties[m]=y}}(t,e):3==n?e.type=t.readVarint():4==n&&(e._geometry=t.pos)}function r_(n){for(var e,t,s=0,u=0,f=n.length,m=f-1;u<f;m=u++)s+=((t=n[m]).x-(e=n[u]).x)*(e.y+t.y);return s}Ru.types=["Unknown","Point","LineString","Polygon"],Ru.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,t=n.readVarint()+n.pos,s=1,u=0,f=0,m=0,y=[];n.pos<t;){if(u<=0){var b=n.readVarint();s=7&b,u=b>>3}if(u--,1===s||2===s)f+=n.readSVarint(),m+=n.readSVarint(),1===s&&(e&&y.push(e),e=[]),e.push(new Ye(f,m));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Ru.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,t=1,s=0,u=0,f=0,m=1/0,y=-1/0,b=1/0,w=-1/0;n.pos<e;){if(s<=0){var M=n.readVarint();t=7&M,s=M>>3}if(s--,1===t||2===t)(u+=n.readSVarint())<m&&(m=u),u>y&&(y=u),(f+=n.readSVarint())<b&&(b=f),f>w&&(w=f);else if(7!==t)throw new Error("unknown command "+t)}return[m,b,y,w]},Ru.prototype.toGeoJSON=function(n,e,t){var s,u,f=this.extent*Math.pow(2,t),m=this.extent*n,y=this.extent*e,b=this.loadGeometry(),w=Ru.types[this.type];function M(j){for(var V=0;V<j.length;V++){var X=j[V];j[V]=[360*(X.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(s=0;s<b.length;s++)R[s]=b[s][0];M(b=R);break;case 2:for(s=0;s<b.length;s++)M(b[s]);break;case 3:for(b=function(j){var V=j.length;if(V<=1)return[j];for(var X,ee,de=[],we=0;we<V;we++){var fe=r_(j[we]);0!==fe&&(void 0===ee&&(ee=fe<0),ee===fe<0?(X&&de.push(X),X=[j[we]]):X.push(j[we]))}return X&&de.push(X),de}(b),s=0;s<b.length;s++)for(u=0;u<b[s].length;u++)M(b[s][u])}1===b.length?b=b[0]:w="Multi"+w;var L={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Rf=gd;function gd(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(gm,this,e),this.length=this._features.length}function gm(n,e,t){15===n?e.version=t.readVarint():1===n?e.name=t.readString():5===n?e.extent=t.readVarint():2===n?e._features.push(t.pos):3===n?e._keys.push(t.readString()):4===n&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var m=s.readVarint()>>3;u=1===m?s.readString():2===m?s.readFloat():3===m?s.readDouble():4===m?s.readVarint64():5===m?s.readVarint():6===m?s.readSVarint():7===m?s.readBoolean():null}return u}(t))}function kf(n,e,t){if(3===n){var s=new Rf(t,t.readVarint()+t.pos);s.length&&(e[s.name]=s)}}gd.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new mm(this._pbf,e,this.extent,this._keys,this._values)};var iu={VectorTile:function(n,e){this.layers=n.readFields(kf,{},e)},VectorTileFeature:mm,VectorTileLayer:Rf};function _d(n,e,t,s){const u=[],f=0===s?(m,y,b,w,M,R)=>{m.push(new Ye(R,b+(R-y)/(w-y)*(M-b)))}:(m,y,b,w,M,R)=>{m.push(new Ye(y+(R-b)/(M-b)*(w-y),R))};for(const m of n){const y=[];for(const b of m){if(b.length<=2)continue;const w=[];for(let L=0;L<b.length-1;L++){const j=b[L].x,V=b[L].y,X=b[L+1].x,ee=b[L+1].y,de=0===s?j:V,we=0===s?X:ee;de<e?we>e&&f(w,j,V,X,ee,e):de>t?we<t&&f(w,j,V,X,ee,t):w.push(b[L]),we<e&&de>=e&&f(w,j,V,X,ee,e),we>t&&de<=t&&f(w,j,V,X,ee,t)}let M=b[b.length-1];const R=0===s?M.x:M.y;R>=e&&R<=t&&w.push(M),w.length&&(M=w[w.length-1],w[0].x===M.x&&w[0].y===M.y||w.push(w[0]),y.push(w))}y.length&&u.push(y)}return u}const _m=iu.VectorTileFeature.types,ym=Math.pow(2,13);function Ma(n,e,t,s,u,f,m,y){n.emplaceBack((e<<1)+m,(t<<1)+f,(Math.floor(s*ym)<<1)+u,Math.round(y))}function ku(n,e,t){n.emplaceBack(e.x,e.y,e.z,16384*t[0],16384*t[1],16384*t[2])}class Lf{constructor(){this.acc=new Ye(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ye(e.x,e.y),this.max=new Ye(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===an)&&e.x===t.x)!=((0===e.y||e.y===an)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,Xn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>an!=e.x>an&&this.addBorderIntersection(1,Xn(t.y,e.y,(an-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Xn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>an!=e.y>an&&this.addBorderIntersection(3,Xn(t.x,e.x,(an-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];t<s[0]&&(s[0]=t),t>s[1]&&(s[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,t.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,t.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((t,s)=>t+s.edges,0);return 0!==e?this.acc.div(e)._round():new Ye(0,0)}span(){return new Ye(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class bh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new fn,this.centroidVertexArray=new jl,this.indexArray=new Zn,this.programConfigurations=new Iu(e.layers,e.zoom),this.segments=new Vi,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,s,u){this.features=[],this.hasPattern=md("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/an/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:y,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,M=Gl(f,w);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),M,s))continue;const R={id:m,sourceLayerIndex:b,index:y,geometry:w?M.geometry:$l(f,s,u),properties:f.properties,type:f.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(fm("fill-extrusion",this.layers,R,this.zoom,t)):this.addFeature(R,R.geometry,y,s,{},t.availableImages,u),t.featureIndex.insert(f,R.geometry,y,b,this.index,L)}this.sortBorders()}addFeatures(e,t,s,u,f){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,t,s,u,f)}this.sortBorders()}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,t_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,e_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Pf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,s,u,f,m,y){const b=[new Ye(0,0),new Ye(an,an)],w=y.projection,M="globe"===w.name,R=this.enableTerrain&&!M?new Lf:null,L="Polygon"===_m[e.type];M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ho);const j=xh(t,500);for(let de=j.length-1;de>=0;de--){const we=j[de];(0===we.length||(V=we[0]).every(fe=>fe.x<=0)||V.every(fe=>fe.x>=an)||V.every(fe=>fe.y<=0)||V.every(fe=>fe.y>=an))&&j.splice(de,1)}var V;let X;if(M)X=Bf(j,b,u);else{X=[];for(const de of j)X.push({polygon:de,bounds:b})}const ee=L?this.edgeRadius:0;for(const{polygon:de,bounds:we}of X){let fe=0,ye=0;for(const De of de)L&&!De[0].equals(De[De.length-1])&&De.push(De[0]),ye+=L?De.length-1:De.length;const Le=this.segments.prepareSegment((L?5:4)*ye,this.layoutVertexArray,this.indexArray);if(L){const De=[],Je=[];fe=Le.vertexLength;for(const lt of de){let Lt,et;lt.length&&lt!==de[0]&&Je.push(De.length/2),Lt=lt[1].sub(lt[0])._perp()._unit();for(let ut=1;ut<lt.length;ut++){const bt=lt[ut],ht=lt[ut===lt.length-1?1:ut+1];let{x:Rt,y:vt}=bt;if(ee){et=ht.sub(bt)._perp()._unit();const qt=Lt.add(et)._unit(),On=ee*Math.min(4,1/(Lt.x*qt.x+Lt.y*qt.y));Rt+=On*qt.x,vt+=On*qt.y,Lt=et}Ma(this.layoutVertexArray,Rt,vt,0,0,1,1,0),Le.vertexLength++,De.push(bt.x,bt.y),M&&ku(this.layoutVertexExtArray,w.projectTilePoint(Rt,vt,u),w.upVector(u,Rt,vt))}}const Xe=lo(De,Je);for(let lt=0;lt<Xe.length;lt+=3)this.indexArray.emplaceBack(fe+Xe[lt],fe+Xe[lt+2],fe+Xe[lt+1]),Le.primitiveLength++}for(const De of de){R&&De.length&&R.startRing(De[0]);let Je,Xe,lt,Lt=De.length>4&&Ff(De[De.length-2],De[0],De[1]),et=ee?yd(De[De.length-2],De[0],De[1],ee):0;Xe=De[1].sub(De[0])._perp()._unit();for(let ut=1,bt=0;ut<De.length;ut++){let ht=De[ut-1],Rt=De[ut];const vt=De[ut===De.length-1?1:ut+1];if(R&&L&&R.currentPolyCount.top++,Of(Rt,ht,we)){ee&&(Xe=vt.sub(Rt)._perp()._unit());continue}R&&R.append(Rt,ht);const qt=Rt.sub(ht)._perp(),On=qt.x/(Math.abs(qt.x)+Math.abs(qt.y)),Un=qt.y>0?1:0,vn=ht.dist(Rt);if(bt+vn>32768&&(bt=0),ee){lt=vt.sub(Rt)._perp()._unit();let Kt=vm(ht,Rt,vt,i_(Xe,lt),ee);isNaN(Kt)&&(Kt=0);const Nr=Rt.sub(ht)._unit();ht=ht.add(Nr.mult(et))._round(),Rt=Rt.add(Nr.mult(-Kt))._round(),et=Kt,Xe=lt}const Nt=Le.vertexLength,tr=De.length>4&&Ff(ht,Rt,vt);let Mn=zf(bt,Lt,!0);if(Ma(this.layoutVertexArray,ht.x,ht.y,On,Un,0,0,Mn),Ma(this.layoutVertexArray,ht.x,ht.y,On,Un,0,1,Mn),bt+=vn,Mn=zf(bt,tr,!1),Lt=tr,Ma(this.layoutVertexArray,Rt.x,Rt.y,On,Un,0,0,Mn),Ma(this.layoutVertexArray,Rt.x,Rt.y,On,Un,0,1,Mn),Le.vertexLength+=4,this.indexArray.emplaceBack(Nt+0,Nt+1,Nt+2),this.indexArray.emplaceBack(Nt+1,Nt+3,Nt+2),Le.primitiveLength+=2,ee){const Kt=fe+(1===ut?De.length-2:ut-2),Nr=1===ut?fe:Kt+1;if(this.indexArray.emplaceBack(Nt+1,Kt,Nt+3),this.indexArray.emplaceBack(Kt,Nr,Nt+3),Le.primitiveLength+=2,void 0===Je&&(Je=Nt),!Of(vt,De[ut],we)){const Or=ut===De.length-1?Je:Le.vertexLength;this.indexArray.emplaceBack(Nt+2,Nt+3,Or),this.indexArray.emplaceBack(Nt+3,Or+1,Or),this.indexArray.emplaceBack(Nt+3,Nr,Or+1),Le.primitiveLength+=3}}if(M){const Kt=this.layoutVertexExtArray,Nr=w.projectTilePoint(ht.x,ht.y,u),Or=w.projectTilePoint(Rt.x,Rt.y,u),Kr=w.upVector(u,ht.x,ht.y),Wn=w.upVector(u,Rt.x,Rt.y);ku(Kt,Nr,Kr),ku(Kt,Nr,Kr),ku(Kt,Or,Wn),ku(Kt,Or,Wn)}}L&&(fe+=De.length-1)}}if(R&&R.polyCount.length>0){if(R.borders){R.vertexArrayOffset=this.centroidVertexArray.length;const de=R.borders,we=this.featuresOnBorder.push(R)-1;for(let fe=0;fe<4;fe++)de[fe][0]!==Number.MAX_VALUE&&this.borders[fe].push(we)}this.encodeCentroid(R.borders?void 0:R.centroid(),R)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,s)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,t,s=!0){let u,f;if(e)if(0!==e.y){const y=t.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let m=s?this.centroidVertexArray.length:t.vertexArrayOffset;for(const y of t.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(m++,u,f);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,u,f)}}}function i_(n,e){const t=n.add(e)._unit();return n.x*t.x+n.y*t.y}function yd(n,e,t,s){const u=e.sub(n)._perp()._unit(),f=t.sub(e)._perp()._unit();return vm(n,e,t,i_(u,f),s)}function vm(n,e,t,s,u){const f=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(t)/3,u*f/s)}function Of(n,e,t){return n.x<t[0].x&&e.x<t[0].x||n.x>t[1].x&&e.x>t[1].x||n.y<t[0].y&&e.y<t[0].y||n.y>t[1].y&&e.y>t[1].y}function Ff(n,e,t){if(n.x<0||n.x>=an||e.x<0||e.x>=an||t.x<0||t.x>=an)return!1;const s=t.sub(e),u=s.perp(),f=n.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function zf(n,e,t){const s=e?2|n:-3&n;return t?1|s:-2&s}function vd(){const n=Math.PI/32,e=Math.tan(n),t=sf;return t*Math.sqrt(1+2*e*e)-t}function Bf(n,e,t){const s=1<<t.z,u=ea(t.x/s),f=ea((t.x+1)/s),m=Po(t.y/s),y=Po((t.y+1)/s);return function(b,w,M,R,L=0,j){const V=[];if(!b.length||!M||!R)return V;const X=(De,Je)=>{for(const Xe of De)V.push({polygon:Xe,bounds:Je})},ee=Math.ceil(Math.log2(M)),de=Math.ceil(Math.log2(R)),we=ee-de,fe=[];for(let De=0;De<Math.abs(we);De++)fe.push(we>0?0:1);for(let De=0;De<Math.min(ee,de);De++)fe.push(0),fe.push(1);let ye=b;if(ye=_d(ye,w[0].y-L,w[1].y+L,1),ye=_d(ye,w[0].x-L,w[1].x+L,0),!ye.length)return V;const Le=[];for(fe.length?Le.push({polygons:ye,bounds:w,depth:0}):X(ye,w);Le.length;){const De=Le.pop(),Je=De.depth,Xe=fe[Je],lt=De.bounds[0],Lt=De.bounds[1],et=0===Xe?lt.x:lt.y,ut=0===Xe?Lt.x:Lt.y,bt=j?j(Xe,et,ut):.5*(et+ut),ht=_d(De.polygons,et-L,bt+L,Xe),Rt=_d(De.polygons,bt-L,ut+L,Xe);if(ht.length){const vt=[lt,new Ye(0===Xe?bt:Lt.x,1===Xe?bt:Lt.y)];fe.length>Je+1?Le.push({polygons:ht,bounds:vt,depth:Je+1}):X(ht,vt)}if(Rt.length){const vt=[new Ye(0===Xe?bt:lt.x,1===Xe?bt:lt.y),Lt];fe.length>Je+1?Le.push({polygons:Rt,bounds:vt,depth:Je+1}):X(Rt,vt)}}return V}(n,e,Math.ceil((f-u)/11.25),Math.ceil((m-y)/11.25),1,(b,w,M)=>{if(0===b)return.5*(w+M);{const R=Po((t.y+w/an)/s);return(Vl(.5*(Po((t.y+M/an)/s)+R))*s-t.y)*an}})}Yt(bh,"FillExtrusionBucket",{omit:["layers","features"]}),Yt(Lf,"PartMetadata");const xd=new at({"fill-extrusion-edge-radius":new Ce(Ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var bd={paint:new at({"fill-extrusion-opacity":new Ce(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Be(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ce(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ce(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new He(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Be(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Be(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ce(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ce(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ce(Ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:xd};function Nf(n,e,t){var s=2*Math.PI*6378137/256/Math.pow(2,t);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Lu{constructor(e,t,s){this.z=e,this.x=t,this.y=s,this.key=Yl(0,e,e,t,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const s=(m=this.y,y=this.z,b=Nf(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),w=Nf(256*(f+1),256*(m+1),y),b[0]+","+b[1]+","+w[0]+","+w[1]),u=function(f,m,y){let b,w="";for(let M=f;M>0;M--)b=1<<M-1,w+=(m&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);var f,m,y,b,w;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Uf{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Yl(e,t.z,t.z,t.x,t.y)}}class xo{constructor(e,t,s,u,f){this.overscaledZ=e,this.wrap=t,this.canonical=new Lu(s,+u,+f),this.key=0===t&&e===s?this.canonical.key:Yl(t,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new xo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xo(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Yl(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Yl(this.wrap*+t,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new xo(t,this.wrap,t,s,u),new xo(t,this.wrap,t,s+1,u),new xo(t,this.wrap,t,s,u+1),new xo(t,this.wrap,t,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new xo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Uf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yl(n,e,t,s,u){const f=1<<Math.min(t,22);let m=f*(u%f)+s%f;return n&&t<22&&(m+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-t)))),16*(32*m+t)+(e-t)}function wh(n,e){return n.x*e.x+n.y*e.y}function jf(n,e){if(1===n.length){let t=0;const s=e[t++];let u;for(;!u||s.equals(u);)if(u=e[t++],!u)return 1/0;for(;t<e.length;t++){const f=e[t],m=n[0],y=u.sub(s),b=f.sub(s),w=m.sub(s),M=wh(y,y),R=wh(y,b),L=wh(b,b),j=wh(w,y),V=wh(w,b),X=M*L-R*R,ee=(L*j-R*V)/X,de=(M*V-R*j)/X,we=s.z*(1-ee-de)+u.z*ee+f.z*de;if(isFinite(we))return we}return 1/0}{let t=1/0;for(const s of e)t=Math.min(t,s.z);return t}}function wd(n){const e=new Ye(n[0],n[1]);return e.z=n[2],e}function xm(n,e,t,s,u,f,m,y){const b=m*u.getElevationAt(n,e,!0,!0),w=0!==f[0],M=w?0===f[1]?m*(f[0]/7-450):m*function(R,L,j){const V=Math.floor(L[0]/8),X=Math.floor(L[1]/8),ee=10*(L[0]-8*V),de=10*(L[1]-8*X),we=R.getElevationAt(V,X,!0,!0),fe=R.getMeterToDEM(j),ye=Math.floor(.5*(ee*fe-1)),Le=Math.floor(.5*(de*fe-1)),De=R.tileCoordToPixel(V,X),Je=2*ye+1,Xe=2*Le+1,lt=(On=Je,Un=Xe,[(Rt=R).getElevationAtPixel(vt=De.x-ye,qt=De.y-Le,!0),Rt.getElevationAtPixel(vt+Un,qt,!0),Rt.getElevationAtPixel(vt,qt+Un,!0),Rt.getElevationAtPixel(vt+On,qt+Un,!0)]),Lt=Math.abs(lt[0]-lt[1]),et=Math.abs(lt[2]-lt[3]),ut=Math.abs(lt[0]-lt[2])+Math.abs(lt[1]-lt[3]),bt=Math.min(.25,.5*fe*(Lt+et)/Je),ht=Math.min(.25,.5*fe*ut/Xe);var Rt,vt,qt,On,Un;return we+Math.max(bt*ee,ht*de)}(u,f,y):b;return{base:b+(0===t)?-1:t,top:w?Math.max(M+s,b+t+2):b+s}}Yt(Lu,"CanonicalTileID"),Yt(xo,"OverscaledTileID",{omit:["projMatrix"]});const bm=mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Vf}=bm,wm=mt([{name:"a_packed",components:4,type:"Float32"}]),{members:zy}=wm,Em=iu.VectorTileFeature.types,o_=Math.cos(Math.PI/180*37.5);class Eh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new In,this.layoutVertexArray2=new cr,this.indexArray=new Zn,this.programConfigurations=new Iu(e.layers,e.zoom),this.segments=new Vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,s,u){this.hasPattern=md("line",this.layers,t);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:M,id:R,index:L,sourceLayerIndex:j}of e){const V=this.layers[0]._featureFilter.needGeometry,X=Gl(M,V);if(!this.layers[0]._featureFilter.filter(new ne(this.zoom),X,s))continue;const ee=f?f.evaluate(X,{},s):void 0,de={id:R,properties:M.properties,type:M.type,sourceLayerIndex:j,index:L,geometry:V?X.geometry:$l(M,s,u),patterns:{},sortKey:ee};m.push(de)}f&&m.sort((M,R)=>M.sortKey-R.sortKey);const{lineAtlas:y,featureIndex:b}=t,w=this.addConstantDashes(y);for(const M of m){const{geometry:R,index:L,sourceLayerIndex:j}=M;if(w&&this.addFeatureDashes(M,y),this.hasPattern){const V=fm("line",this.layers,M,this.zoom,t);this.patternFeatures.push(V)}else this.addFeature(M,R,L,s,y.positions,t.availableImages);b.insert(e[L].feature,R,L,j,this.index)}}addConstantDashes(e){let t=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)t=!0;else{const m=f.value,y=u.value;if(!y)continue;e.addDash(y.from,m),e.addDash(y.to,m),y.other&&e.addDash(y.other,m)}}return t}addFeatureDashes(e,t){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===m.kind)continue;let y,b,w,M,R,L;if("constant"===f.kind){const ee=f.value;if(!ee)continue;y=ee.other||ee.to,b=ee.to,w=ee.from}else y=f.evaluate({zoom:s-1},e),b=f.evaluate({zoom:s},e),w=f.evaluate({zoom:s+1},e);"constant"===m.kind?M=R=L=m.value:(M=m.evaluate({zoom:s-1},e),R=m.evaluate({zoom:s},e),L=m.evaluate({zoom:s+1},e)),t.addDash(y,M),t.addDash(b,R),t.addDash(w,L);const j=t.getKey(y,M),V=t.getKey(b,R),X=t.getKey(w,L);e.patterns[u.id]={min:j,mid:V,max:X}}}update(e,t,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,s,u)}addFeatures(e,t,s,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,t,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zy)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,s,u,f,m){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),M=y.get("line-miter-limit"),R=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of t)this.addLine(L,e,b,w,M,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,m,u)}addLine(e,t,s,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<e.length-1;de++)this.totalDistance+=e[de].dist(e[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===Em[t.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;"bevel"===s&&(f=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,R=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let L,j,V,X,ee;this.e1=this.e2=-1,y&&(L=e[b-2],ee=e[w].sub(L)._unit()._perp());for(let de=w;de<b;de++){if(V=de===b-1?y?e[w+1]:void 0:e[de+1],V&&e[de].equals(V))continue;ee&&(X=ee),L&&(j=L),L=e[de],ee=V?V.sub(L)._unit()._perp():X,X=X||ee;let we=X.add(ee);0===we.x&&0===we.y||we._unit();const fe=X.x*ee.x+X.y*ee.y,ye=we.x*ee.x+we.y*ee.y,Le=0!==ye?1/ye:1/0,De=2*Math.sqrt(2-2*ye),Je=ye<o_&&j&&V,Xe=X.x*ee.y-X.y*ee.x>0;if(Je&&de>w){const et=L.dist(j);if(et>2*M){const ut=L.sub(L.sub(j)._mult(M/et)._round());this.updateDistance(j,ut),this.addCurrentVertex(ut,X,0,0,R),j=ut}}const lt=j&&V;let Lt=lt?s:y?"butt":u;if(lt&&"round"===Lt&&(Le<m?Lt="miter":Le<=2&&(Lt="fakeround")),"miter"===Lt&&Le>f&&(Lt="bevel"),"bevel"===Lt&&(Le>2&&(Lt="flipbevel"),Le<f&&(Lt="miter")),j&&this.updateDistance(j,L),"miter"===Lt)we._mult(Le),this.addCurrentVertex(L,we,0,0,R);else if("flipbevel"===Lt){if(Le>100)we=ee.mult(-1);else{const et=Le*X.add(ee).mag()/X.sub(ee).mag();we._perp()._mult(et*(Xe?-1:1))}this.addCurrentVertex(L,we,0,0,R),this.addCurrentVertex(L,we.mult(-1),0,0,R)}else if("bevel"===Lt||"fakeround"===Lt){const et=-Math.sqrt(Le*Le-1),ut=Xe?et:0,bt=Xe?0:et;if(j&&this.addCurrentVertex(L,X,ut,bt,R),"fakeround"===Lt){const ht=Math.round(180*De/Math.PI/20);for(let Rt=1;Rt<ht;Rt++){let vt=Rt/ht;if(.5!==vt){const On=vt-.5;vt+=vt*On*(vt-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*On*On+(.848013+fe*(.215638*fe-1.06021)))}const qt=ee.sub(X)._mult(vt)._add(X)._unit()._mult(Xe?-1:1);this.addHalfVertex(L,qt.x,qt.y,!1,Xe,0,R)}}V&&this.addCurrentVertex(L,ee,-ut,-bt,R)}else if("butt"===Lt)this.addCurrentVertex(L,we,0,0,R);else if("square"===Lt){const et=j?1:-1;j||this.addCurrentVertex(L,we,et,et,R),this.addCurrentVertex(L,we,0,0,R),j&&this.addCurrentVertex(L,we,et,et,R)}else"round"===Lt&&(j&&(this.addCurrentVertex(L,X,0,0,R),this.addCurrentVertex(L,X,1,1,R,!0)),V&&(this.addCurrentVertex(L,ee,-1,-1,R,!0),this.addCurrentVertex(L,ee,0,0,R)));if(Je&&de<b-1){const et=L.dist(V);if(et>2*M){const ut=L.add(V.sub(L)._mult(M/et)._round());this.updateDistance(L,ut),this.addCurrentVertex(ut,ee,0,0,R),L=ut}}}}addCurrentVertex(e,t,s,u,f,m=!1){const y=t.y*u-t.x,b=-t.y-t.x*u;this.addHalfVertex(e,t.x+t.y*s,t.y-t.x*s,m,!1,s,f),this.addHalfVertex(e,y,b,m,!0,-u,f)}addHalfVertex({x:e,y:t},s,u,f,m,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(t<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Yt(Eh,"LineBucket",{omit:["layers","patternFeatures"]});const s_=new at({"line-cap":new Be(Ke.layout_line["line-cap"]),"line-join":new Be(Ke.layout_line["line-join"]),"line-miter-limit":new Ce(Ke.layout_line["line-miter-limit"]),"line-round-limit":new Ce(Ke.layout_line["line-round-limit"]),"line-sort-key":new Be(Ke.layout_line["line-sort-key"])});var Tm={paint:new at({"line-opacity":new Be(Ke.paint_line["line-opacity"]),"line-color":new Be(Ke.paint_line["line-color"]),"line-translate":new Ce(Ke.paint_line["line-translate"]),"line-translate-anchor":new Ce(Ke.paint_line["line-translate-anchor"]),"line-width":new Be(Ke.paint_line["line-width"]),"line-gap-width":new Be(Ke.paint_line["line-gap-width"]),"line-offset":new Be(Ke.paint_line["line-offset"]),"line-blur":new Be(Ke.paint_line["line-blur"]),"line-dasharray":new He(Ke.paint_line["line-dasharray"]),"line-pattern":new He(Ke.paint_line["line-pattern"]),"line-gradient":new Ve(Ke.paint_line["line-gradient"]),"line-trim-offset":new Ce(Ke.paint_line["line-trim-offset"])}),layout:s_};const ta=new class extends Be{possiblyEvaluate(n,e){return e=new ne(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,t,s){return e=xt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,t,s)}}(Tm.paint.properties["line-width"].specification);function Dm(n,e){return e>0?e+2*n:n}ta.useIntegerZoom=!0;const Cm=mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),a_=mt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),l_=mt([{name:"a_projected_pos",components:4,type:"Float32"}],4);mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const c_=mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),u_=mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $f=mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),h_=mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);mt([{name:"triangle",components:3,type:"Uint16"}]),mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mt([{type:"Float32",name:"offsetX"}]),mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ll=128;function Kn(n,e){const{expression:t}=e;if("constant"===t.kind)return{kind:"constant",layoutSize:t.evaluate(new ne(n+1))};if("source"===t.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=t;let f=0;for(;f<s.length&&s[f]<=n;)f++;f=Math.max(0,f-1);let m=f;for(;m<s.length&&s[m]<n+1;)m++;m=Math.min(s.length-1,m);const y=s[f],b=s[m];return"composite"===t.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:t.evaluate(new ne(y)),maxSize:t.evaluate(new ne(b)),interpolationType:u}}}function Th(n,{uSize:e,uSizeT:t},{lowerSize:s,upperSize:u}){return"source"===n.kind?s/ll:"composite"===n.kind?Xn(s/ll,u/ll,t):e}function ou(n,e){let t=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:u,minZoom:f,maxZoom:m}=n,y=u?$t(Si.interpolationFactor(u,e,f,m),0,1):0;"camera"===n.kind?s=Xn(n.minSize,n.maxSize,y):t=y}return{uSizeT:t,uSize:s}}var Im=Object.freeze({__proto__:null,getSizeData:Kn,evaluateSizeForFeature:Th,evaluateSizeForZoom:ou,SIZE_PACK_FACTOR:ll});function d_(n,e,t){return n.sections.forEach(s=>{s.text=function(u,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return"uppercase"===y?u=u.toLocaleUpperCase():"lowercase"===y&&(u=u.toLocaleLowerCase()),re.applyArabicShaping&&(u=re.applyArabicShaping(u)),u}(s.text,e,t)}),n}const Dh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Sm(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function f_(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var Gf=function(n,e,t,s,u){var f,m,y=8*u-s-1,b=(1<<y)-1,w=b>>1,M=-7,R=t?u-1:0,L=t?-1:1,j=n[e+R];for(R+=L,f=j&(1<<-M)-1,j>>=-M,M+=y;M>0;f=256*f+n[e+R],R+=L,M-=8);for(m=f&(1<<-M)-1,f>>=-M,M+=s;M>0;m=256*m+n[e+R],R+=L,M-=8);if(0===f)f=1-w;else{if(f===b)return m?NaN:1/0*(j?-1:1);m+=Math.pow(2,s),f-=w}return(j?-1:1)*m*Math.pow(2,f-s)},Mm=function(n,e,t,s,u,f){var m,y,b,w=8*f-u-1,M=(1<<w)-1,R=M>>1,L=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,j=s?0:f-1,V=s?1:-1,X=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=M):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+R>=1?L/b:L*Math.pow(2,1-R))*b>=2&&(m++,b/=2),m+R>=M?(y=0,m=M):m+R>=1?(y=(e*b-1)*Math.pow(2,u),m+=R):(y=e*Math.pow(2,R-1)*Math.pow(2,u),m=0));u>=8;n[t+j]=255&y,j+=V,y/=256,u-=8);for(m=m<<u|y,w+=u;w>0;n[t+j]=255&m,j+=V,m/=256,w-=8);n[t+j-V]|=128*X},Ch=Hr;function Hr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Hr.Varint=0,Hr.Fixed64=1,Hr.Bytes=2,Hr.Fixed32=5;var Ed=4294967296,Hf=1/Ed,xc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Kl(n){return n.type===Hr.Bytes?n.readVarint()+n.pos:n.pos+1}function Td(n,e,t){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(s);for(var u=t.pos-1;u>=n;u--)t.buf[u+s]=t.buf[u]}function p_(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function By(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Ny(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function Uy(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function m_(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function Am(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function jy(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function g_(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function Ou(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function Dd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function su(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function Ih(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function __(n,e,t){e.glyphs=[],1===n&&t.readMessage(Pm,e)}function Pm(n,e,t){if(3===n){const{id:s,bitmap:u,width:f,height:m,left:y,top:b,advance:w}=t.readMessage(y_,{});e.glyphs.push({id:s,bitmap:new al({width:f+6,height:m+6},u),metrics:{width:f,height:m,left:y,top:b,advance:w}})}else 4===n?e.ascender=t.readSVarint():5===n&&(e.descender=t.readSVarint())}function y_(n,e,t){1===n?e.id=t.readVarint():2===n?e.bitmap=t.readBytes():3===n?e.width=t.readVarint():4===n?e.height=t.readVarint():5===n?e.left=t.readSVarint():6===n?e.top=t.readSVarint():7===n&&(e.advance=t.readVarint())}function Zf(n){let e=0,t=0;for(const m of n)e+=m.w*m.h,t=Math.max(t,m.w);n.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let u=0,f=0;for(const m of n)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===b.w&&m.h===b.h){const w=s.pop();y<s.length&&(s[y]=w)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(s.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Hr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,n(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Dd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Ih(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Dd(this.buf,this.pos)+Dd(this.buf,this.pos+4)*Ed;return this.pos+=8,n},readSFixed64:function(){var n=Dd(this.buf,this.pos)+Ih(this.buf,this.pos+4)*Ed;return this.pos+=8,n},readFloat:function(){var n=Gf(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Gf(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,t,s=this.buf;return e=127&(t=s[this.pos++]),t<128?e:(e|=(127&(t=s[this.pos++]))<<7,t<128?e:(e|=(127&(t=s[this.pos++]))<<14,t<128?e:(e|=(127&(t=s[this.pos++]))<<21,t<128?e:function(u,f,m){var y,b,w=m.buf;if(y=(112&(b=w[m.pos++]))>>4,b<128||(y|=(127&(b=w[m.pos++]))<<3,b<128)||(y|=(127&(b=w[m.pos++]))<<10,b<128)||(y|=(127&(b=w[m.pos++]))<<17,b<128)||(y|=(127&(b=w[m.pos++]))<<24,b<128)||(y|=(1&(b=w[m.pos++]))<<31,b<128))return function bc(n,e,t){return t?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&xc?xc.decode(this.buf.subarray(e,n)):function(t,s,u){for(var f="",m=s;m<u;){var y,b,w,M=t[m],R=null,L=M>239?4:M>223?3:M>191?2:1;if(m+L>u)break;1===L?M<128&&(R=M):2===L?128==(192&(y=t[m+1]))&&(R=(31&M)<<6|63&y)<=127&&(R=null):3===L?(b=t[m+2],128==(192&(y=t[m+1]))&&128==(192&b)&&((R=(15&M)<<12|(63&y)<<6|63&b)<=2047||R>=55296&&R<=57343)&&(R=null)):4===L&&(b=t[m+2],w=t[m+3],128==(192&(y=t[m+1]))&&128==(192&b)&&128==(192&w)&&((R=(15&M)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||R>=1114112)&&(R=null)),null===R?(R=65533,L=1):R>65535&&(R-=65536,f+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),f+=String.fromCharCode(R),m+=L}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==Hr.Bytes)return n.push(this.readVarint(e));var t=Kl(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==Hr.Bytes)return n.push(this.readSVarint());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Hr.Bytes)return n.push(this.readBoolean());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Hr.Bytes)return n.push(this.readFloat());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Hr.Bytes)return n.push(this.readDouble());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Hr.Bytes)return n.push(this.readFixed32());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Hr.Bytes)return n.push(this.readSFixed32());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Hr.Bytes)return n.push(this.readFixed64());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Hr.Bytes)return n.push(this.readSFixed64());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===Hr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Hr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Hr.Fixed32)this.pos+=4;else{if(e!==Hr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),su(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),su(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),su(this.buf,-1&n,this.pos),su(this.buf,Math.floor(n*Hf),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),su(this.buf,-1&n,this.pos),su(this.buf,Math.floor(n*Hf),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,t){var s,u,f,y;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),f=s,(y=t).buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,t)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var m,y,b=0;b<u.length;b++){if((m=u.charCodeAt(b))>55295&&m<57344){if(!y){m>56319||b+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):y=m;continue}if(m<56320){s[f++]=239,s[f++]=191,s[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(s[f++]=239,s[f++]=191,s[f++]=189,y=null);m<128?s[f++]=m:(m<2048?s[f++]=m>>6|192:(m<65536?s[f++]=m>>12|224:(s[f++]=m>>18|240,s[f++]=m>>12&63|128),s[f++]=m>>6&63|128),s[f++]=63&m|128)}return f}(this.buf,n,this.pos);var t=this.pos-e;t>=128&&Td(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),Mm(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Mm(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var s=this.pos-t;s>=128&&Td(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,t){this.writeTag(n,Hr.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,p_,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,By,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,m_,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Ny,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Uy,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Am,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,jy,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,g_,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Ou,e)},writeBytesField:function(n,e){this.writeTag(n,Hr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,Hr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,Hr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,Hr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,Hr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,Hr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,Hr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,Hr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,Hr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,Hr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class Wf{constructor(e,{pixelRatio:t,version:s,stretchX:u,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=u,this.stretchY=f,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Rm{constructor(e,t){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(t,u,f);const{w:m,h:y}=Zf(f),b=new bs({width:m||1,height:y||1});for(const w in e){const M=e[w],R=s[w].paddedRect;bs.copy(M.data,b,{x:0,y:0},{x:R.x+1,y:R.y+1},M.data)}for(const w in t){const M=t[w],R=u[w].paddedRect,L=R.x+1,j=R.y+1,V=M.data.width,X=M.data.height;bs.copy(M.data,b,{x:0,y:0},{x:L,y:j},M.data),bs.copy(M.data,b,{x:0,y:X-1},{x:L,y:j-1},{width:V,height:1}),bs.copy(M.data,b,{x:0,y:0},{x:L,y:j+X},{width:V,height:1}),bs.copy(M.data,b,{x:V-1,y:0},{x:L-1,y:j},{width:1,height:X}),bs.copy(M.data,b,{x:0,y:0},{x:L+V,y:j},{width:1,height:X})}this.image=b,this.iconPositions=s,this.patternPositions=u}addImages(e,t,s){for(const u in e){const f=e[u],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(m),t[u]=new Wf(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),t),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),t)}patchUpdatedImage(e,t,s){if(!e||!t||e.version===t.version)return;e.version=t.version;const[u,f]=e.tl;s.update(t.data,void 0,{x:u,y:f})}}Yt(Wf,"ImagePosition"),Yt(Rm,"ImageAtlas");const Ms={horizontal:1,vertical:2,horizontalOnly:3};class Fu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const s=new Fu;return s.scale=e||1,s.fontStack=t,s}static forImage(e){const t=new Fu;return t.imageName=e,t}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const s=new zu;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,t)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,s){let u="";for(let f=0;f<t.length;f++){const m=t.charCodeAt(f+1)||null,y=t.charCodeAt(f-1)||null;u+=!s&&(m&&be(m)&&!Dh[t[f+1]]||y&&be(y)&&!Dh[t[f-1]])||!Dh[t[f]]?t[f]:Dh[t[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Sh[this.text.charCodeAt(s)];s++)e++;let t=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Sh[this.text.charCodeAt(s)];s--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const s=new zu;return s.text=this.text.substring(e,t),s.sectionIndex=this.sectionIndex.slice(e,t),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Fu.forText(e.scale,e.fontStack||t));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void dn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Fu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):dn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cd(n,e,t,s,u,f,m,y,b,w,M,R,L,j,V,X){const ee=zu.fromFeature(n,u);let de;R===Ms.vertical&&ee.verticalizePunctuation(L);const{processBidirectionalText:we,processStyledBidirectionalText:fe}=re;if(we&&1===ee.sections.length){de=[];const De=we(ee.toString(),Sd(ee,w,f,e,s,j,V));for(const Je of De){const Xe=new zu;Xe.text=Je,Xe.sections=ee.sections;for(let lt=0;lt<Je.length;lt++)Xe.sectionIndex.push(0);de.push(Xe)}}else if(fe){de=[];const De=fe(ee.text,ee.sectionIndex,Sd(ee,w,f,e,s,j,V));for(const Je of De){const Xe=new zu;Xe.text=Je[0],Xe.sectionIndex=Je[1],Xe.sections=ee.sections,de.push(Xe)}}else de=function(De,Je){const Xe=[],lt=De.text;let Lt=0;for(const et of Je)Xe.push(De.substring(Lt,et)),Lt=et;return Lt<lt.length&&Xe.push(De.substring(Lt,lt.length)),Xe}(ee,Sd(ee,w,f,e,s,j,V));const ye=[],Le={positionedLines:ye,text:ee.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(De,Je,Xe,lt,Lt,et,ut,bt,ht,Rt,vt,qt){let On=0,Un=0,vn=0;const Nt="right"===bt?1:"left"===bt?0:.5;let tr=!1;for(const Wn of Lt){const _r=Wn.getSections();for(const $r of _r){if($r.imageName)continue;const Fr=Je[$r.fontStack];if(Fr&&(tr=void 0!==Fr.ascender&&void 0!==Fr.descender,!tr))break}if(!tr)break}let Mn=0;for(const Wn of Lt){Wn.trim();const _r=Wn.getMaxScale(),$r=24*(_r-1),Fr={positionedGlyphs:[],lineOffset:0};De.positionedLines[Mn]=Fr;const Pr=Fr.positionedGlyphs;let Zr=0;if(!Wn.length()){Un+=et,++Mn;continue}let ri=0,no=0;for(let ur=0;ur<Wn.length();ur++){const di=Wn.getSection(ur),Eo=Wn.getSectionIndex(ur),Ir=Wn.getCharCode(ur);let fi=di.scale,Wo=null,ii=null,vi=null,co=24,wr=0;const uo=!(ht===Ms.horizontal||!vt&&!me(Ir)||vt&&(Sh[Ir]||(Kt=Ir,Wh(Kt)||bu(Kt)||wu(Kt)||rl(Kt)||S(Kt))));if(di.imageName){const qo=lt[di.imageName];if(!qo)continue;vi=di.imageName,De.iconsInText=De.iconsInText||!0,ii=qo.paddedRect;const ho=qo.displaySize;fi=24*fi/qt,Wo={width:ho[0],height:ho[1],left:1,top:-3,advance:uo?ho[1]:ho[0],localGlyph:!1},wr=tr?-Wo.height*fi:24*_r-17-ho[1]*fi,co=Wo.advance;const _l=(uo?ho[0]:ho[1])*fi-24*_r;_l>0&&_l>Zr&&(Zr=_l)}else{const qo=Xe[di.fontStack];if(!qo)continue;qo[Ir]&&(ii=qo[Ir]);const ho=Je[di.fontStack];if(!ho)continue;const _l=ho.glyphs[Ir];if(!_l)continue;if(Wo=_l.metrics,co=8203!==Ir?24:0,tr){const Qu=void 0!==ho.ascender?Math.abs(ho.ascender):0,eh=void 0!==ho.descender?Math.abs(ho.descender):0,th=(Qu+eh)*fi;ri<th&&(ri=th,no=(Qu-eh)/2*fi),wr=-Qu*fi}else wr=24*(_r-fi)-17}uo?(De.verticalizable=!0,Pr.push({glyph:Ir,imageName:vi,x:On,y:Un+wr,vertical:uo,scale:fi,localGlyph:Wo.localGlyph,fontStack:di.fontStack,sectionIndex:Eo,metrics:Wo,rect:ii}),On+=co*fi+Rt):(Pr.push({glyph:Ir,imageName:vi,x:On,y:Un+wr,vertical:uo,scale:fi,localGlyph:Wo.localGlyph,fontStack:di.fontStack,sectionIndex:Eo,metrics:Wo,rect:ii}),On+=Wo.advance*fi+Rt)}0!==Pr.length&&(vn=Math.max(On-Rt,vn),tr?Mh(Pr,Nt,Zr,no,et*_r/2):Mh(Pr,Nt,Zr,0,et/2)),On=0;const Zo=et*_r+Zr;Fr.lineOffset=Math.max(Zr,$r),Un+=Zo,++Mn}var Kt;const Nr=Un,{horizontalAlign:Or,verticalAlign:Kr}=Md(ut);(function(Wn,_r,$r,Fr,Pr,Zr){const ri=(_r-$r)*Pr,no=-Zr*Fr;for(const Zo of Wn)for(const ur of Zo.positionedGlyphs)ur.x+=ri,ur.y+=no})(De.positionedLines,Nt,Or,Kr,vn,Nr),De.top+=-Kr*Nr,De.bottom=De.top+Nr,De.left+=-Or*vn,De.right=De.left+vn,De.hasBaseline=tr}(Le,e,t,s,de,m,y,b,R,w,L,X),!function(De){for(const Je of De)if(0!==Je.positionedGlyphs.length)return!1;return!0}(ye)&&Le}const Sh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function v_(n,e,t,s,u,f){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*24/f+u:0}{const m=t[e.fontStack],y=m&&m.glyphs[n];return y?y.metrics.advance*e.scale+u:0}}function Id(n,e,t,s){const u=Math.pow(n-e,2);return s?n<e?u/2:2*u:u+Math.abs(t)*t}function x_(n,e,t){let s=0;return 10===n&&(s-=1e4),t&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function b_(n,e,t,s,u,f){let m=null,y=Id(e,t,u,f);for(const b of s){const w=Id(e-b.x,t,u,f)+b.badness;w<=y&&(m=b,y=w)}return{index:n,x:e,priorBreak:m,badness:y}}function au(n){return n?au(n.priorBreak).concat(n.index):[]}function Sd(n,e,t,s,u,f,m){if("point"!==f)return[];if(!n)return[];const y=[],b=function(L,j,V,X,ee,de){let we=0;for(let fe=0;fe<L.length();fe++){const ye=L.getSection(fe);we+=v_(L.getCharCode(fe),ye,X,ee,j,de)}return we/Math.max(1,Math.ceil(we/V))}(n,e,t,s,u,m),w=n.text.indexOf("\u200b")>=0;let M=0;for(let L=0;L<n.length();L++){const j=n.getSection(L),V=n.getCharCode(L);if(Sh[V]||(M+=v_(V,j,s,u,e,m)),L<n.length()-1){const X=!((R=V)<11904||!(ni(R)||qh(R)||sh(R)||Xc(R)||qc(R)||Hc(R)||Wc(R)||Zc(R)||oo(R)||Ao(R)||Eu(R)||T(R)||Ws(R)||fc(R)||oh(R)||qs(R)||tl(R)||Tu(R)||Bl(R)||zl(R)));(qf[V]||X||j.imageName)&&y.push(b_(L+1,M,b,y,x_(V,n.getCharCode(L+1),X&&w),!1))}}var R;return au(b_(n.length(),M,b,y,0,!0))}function Md(n){let e=.5,t=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function Mh(n,e,t,s,u){if(!(e||t||s||u))return;const f=n.length-1,m=n[f],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=f;b++)n[b].x-=y,n[b].y+=t+s+u}function Aa(n,e,t){const{horizontalAlign:s,verticalAlign:u}=Md(t),f=e[0]-n.displaySize[0]*s,m=e[1]-n.displaySize[1]*u;return{image:n,top:m,bottom:m+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Xf(n,e,t,s,u,f){const m=n.image;let y;if(m.content){const ee=m.content,de=m.pixelRatio||1;y=[ee[0]/de,ee[1]/de,m.displaySize[0]-ee[2]/de,m.displaySize[1]-ee[3]/de]}const b=e.left*f,w=e.right*f;let M,R,L,j;"width"===t||"both"===t?(j=u[0]+b-s[3],R=u[0]+w+s[1]):(j=u[0]+(b+w-m.displaySize[0])/2,R=j+m.displaySize[0]);const V=e.top*f,X=e.bottom*f;return"height"===t||"both"===t?(M=u[1]+V-s[0],L=u[1]+X+s[2]):(M=u[1]+(V+X-m.displaySize[1])/2,L=M+m.displaySize[1]),{image:m,top:M,right:R,bottom:L,left:j,collisionPadding:y}}class Jl extends Ye{constructor(e,t,s,u,f){super(e,t),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new Jl(this.x,this.y,this.z,this.angle,this.segment)}}function Ad(n,e,t,s,u){if(void 0===e.segment)return!0;let f=e,m=e.segment+1,y=0;for(;y>-t/2;){if(m--,m<0)return!1;y-=n[m].dist(f),f=n[m]}y+=n[m].dist(n[m+1]),m++;const b=[];let w=0;for(;y<t/2;){const M=n[m],R=n[m+1];if(!R)return!1;let L=n[m-1].angleTo(M)-M.angleTo(R);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:L}),w+=L;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>u)return!1;m++,y+=M.dist(R)}return!0}function cl(n){let e=0;for(let t=0;t<n.length-1;t++)e+=n[t].dist(n[t+1]);return e}function Pd(n,e,t){return n?.6*e*t:0}function Yf(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Kf(n,e,t,s,u,f){const m=Pd(t,u,f),y=Yf(t,s)*f;let b=0;const w=cl(n)/2;for(let M=0;M<n.length-1;M++){const R=n[M],L=n[M+1],j=R.dist(L);if(b+j>w){const V=(w-b)/j,X=Xn(R.x,L.x,V),ee=Xn(R.y,L.y,V),de=new Jl(X,ee,0,L.angleTo(R),M);return!m||Ad(n,de,y,m,e)?de:void 0}b+=j}}function Vy(n,e,t,s,u,f,m,y,b){const w=Pd(s,f,m),M=Yf(s,u),R=M*m,L=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return e-R<e/4&&(e=R+e/4),Jf(n,L?e/2*y%e:(M/2+2*f)*m*y%e,e,w,t,R,L,!1,b)}function Jf(n,e,t,s,u,f,m,y,b){const w=f/2,M=cl(n);let R=0,L=e-t,j=[];for(let V=0;V<n.length-1;V++){const X=n[V],ee=n[V+1],de=X.dist(ee),we=ee.angleTo(X);for(;L+t<R+de;){L+=t;const fe=(L-R)/de,ye=Xn(X.x,ee.x,fe),Le=Xn(X.y,ee.y,fe);if(ye>=0&&ye<b&&Le>=0&&Le<b&&L-w>=0&&L+w<=M){const De=new Jl(ye,Le,0,we,V);De._round(),s&&!Ad(n,De,f,s,u)||j.push(De)}}R+=de}return y||j.length||m||(j=Jf(n,R/2,t,s,u,f,m,!0,b)),j}function w_(n,e,t,s,u){const f=[];for(let m=0;m<n.length;m++){const y=n[m];let b;for(let w=0;w<y.length-1;w++){let M=y[w],R=y[w+1];M.x<e&&R.x<e||(M.x<e?M=new Ye(e,M.y+(e-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x<e&&(R=new Ye(e,M.y+(e-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y<t&&R.y<t||(M.y<t?M=new Ye(M.x+(t-M.y)/(R.y-M.y)*(R.x-M.x),t)._round():R.y<t&&(R=new Ye(M.x+(t-M.y)/(R.y-M.y)*(R.x-M.x),t)._round()),M.x>=s&&R.x>=s||(M.x>=s?M=new Ye(s,M.y+(s-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x>=s&&(R=new Ye(s,M.y+(s-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y>=u&&R.y>=u||(M.y>=u?M=new Ye(M.x+(u-M.y)/(R.y-M.y)*(R.x-M.x),u)._round():R.y>=u&&(R=new Ye(M.x+(u-M.y)/(R.y-M.y)*(R.x-M.x),u)._round()),b&&M.equals(b[b.length-1])||(b=[M],f.push(b)),b.push(R)))))}}return f}Yt(Jl,"Anchor");const wc=1e20;function Ah(n,e,t,s,u,f,m,y,b){for(let w=e;w<e+s;w++)Rd(n,t*f+w,f,u,m,y,b);for(let w=t;w<t+u;w++)Rd(n,w*f+e,1,s,m,y,b)}function Rd(n,e,t,s,u,f,m){f[0]=0,m[0]=-wc,m[1]=wc,u[0]=n[e];for(let y=1,b=0,w=0;y<s;y++){u[y]=n[e+y*t];const M=y*y;do{const R=f[b];w=(u[y]-u[R]+M-R*R)/(y-R)/2}while(w<=m[b]&&--b>-1);b++,f[b]=y,m[b]=w,m[b+1]=wc}for(let y=0,b=0;y<s;y++){for(;m[b+1]<y;)b++;const w=f[b],M=y-w;n[e+y*t]=u[w]+M*M}}const Ph={none:0,ideographs:1,all:2};class Ec{constructor(e,t,s){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});Qt(s,({stack:u,id:f},m)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[f];if(void 0!==b)return void m(null,{stack:u,id:f,glyph:b});if(b=this._tinySDF(y,u,f),b)return y.glyphs[f]=b,void m(null,{stack:u,id:f,glyph:b});const w=Math.floor(f/256);if(256*w>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void m(null,{stack:u,id:f,glyph:b});let M=y.requests[w];M||(M=y.requests[w]=[],Ec.loadGlyphRange(u,w,this.url,this.requestManager,(R,L)=>{if(L){y.ascender=L.ascender,y.descender=L.descender;for(const j in L.glyphs)this._doesCharSupportLocalGlyph(+j)||(y.glyphs[+j]=L.glyphs[+j]);y.ranges[w]=!0}for(const j of M)j(R,L);delete y.requests[w]})),M.push((R,L)=>{R?m(R):L&&m(null,{stack:u,id:f,glyph:L.glyphs[f]||null})})},(u,f)=>{if(u)t(u);else if(f){const m={};for(const{stack:y,id:b,glyph:w}of f)void 0===m[y]&&(m[y]={}),void 0===m[y].glyphs&&(m[y].glyphs={}),m[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;t(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ph.none&&(this.localGlyphMode===Ph.all?!!this.localFontFamily:!!this.localFontFamily&&(Ao(e)||nl(e)||Ws(e)||tl(e)||Zc(e)))}_tinySDF(e,t,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let X="400";/bold/i.test(t)?X="900":/medium/i.test(t)?X="500":/light/i.test(t)&&(X="200"),f=e.tinySDF=new Ec.TinySDF({fontFamily:u,fontWeight:X,fontSize:48,buffer:6,radius:16}),f.fontWeight=X}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const m=String.fromCharCode(s),{data:y,width:b,height:w,glyphWidth:M,glyphHeight:R,glyphLeft:L,glyphTop:j,glyphAdvance:V}=f.draw(m);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new al({width:b,height:w},y),metrics:{width:M/2,height:R/2,left:L/2,top:j/2-27,advance:V/2,localGlyph:!0}}}}function E_(n,e,t,s){const u=[],f=n.image,m=f.pixelRatio,y=f.paddedRect.w-2,b=f.paddedRect.h-2,w=n.right-n.left,M=n.bottom-n.top,R=f.stretchX||[[0,y]],L=f.stretchY||[[0,b]],j=(et,ut)=>et+ut[1]-ut[0],V=R.reduce(j,0),X=L.reduce(j,0),ee=y-V,de=b-X;let we=0,fe=V,ye=0,Le=X,De=0,Je=ee,Xe=0,lt=de;if(f.content&&s){const et=f.content;we=kd(R,0,et[0]),ye=kd(L,0,et[1]),fe=kd(R,et[0],et[2]),Le=kd(L,et[1],et[3]),De=et[0]-we,Xe=et[1]-ye,Je=et[2]-et[0]-fe,lt=et[3]-et[1]-Le}const Lt=(et,ut,bt,ht)=>{const Rt=Ld(et.stretch-we,fe,w,n.left),vt=Od(et.fixed-De,Je,et.stretch,V),qt=Ld(ut.stretch-ye,Le,M,n.top),On=Od(ut.fixed-Xe,lt,ut.stretch,X),Un=Ld(bt.stretch-we,fe,w,n.left),vn=Od(bt.fixed-De,Je,bt.stretch,V),Nt=Ld(ht.stretch-ye,Le,M,n.top),tr=Od(ht.fixed-Xe,lt,ht.stretch,X),Mn=new Ye(Rt,qt),Kt=new Ye(Un,qt),Nr=new Ye(Un,Nt),Or=new Ye(Rt,Nt),Kr=new Ye(vt/m,On/m),Wn=new Ye(vn/m,tr/m),_r=e*Math.PI/180;if(_r){const Pr=Math.sin(_r),Zr=Math.cos(_r),ri=[Zr,-Pr,Pr,Zr];Mn._matMult(ri),Kt._matMult(ri),Or._matMult(ri),Nr._matMult(ri)}const $r=et.stretch+et.fixed,Fr=ut.stretch+ut.fixed;return{tl:Mn,tr:Kt,bl:Or,br:Nr,tex:{x:f.paddedRect.x+1+$r,y:f.paddedRect.y+1+Fr,w:bt.stretch+bt.fixed-$r,h:ht.stretch+ht.fixed-Fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kr,pixelOffsetBR:Wn,minFontScaleX:Je/m/w,minFontScaleY:lt/m/M,isSDF:t}};if(s&&(f.stretchX||f.stretchY)){const et=km(R,ee,V),ut=km(L,de,X);for(let bt=0;bt<et.length-1;bt++){const ht=et[bt],Rt=et[bt+1];for(let vt=0;vt<ut.length-1;vt++)u.push(Lt(ht,ut[vt],Rt,ut[vt+1]))}}else u.push(Lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return u}function kd(n,e,t){let s=0;for(const u of n)s+=Math.max(e,Math.min(t,u[1]))-Math.max(e,Math.min(t,u[0]));return s}function km(n,e,t){const s=[{fixed:-1,stretch:0}];for(const[u,f]of n){const m=s[s.length-1];s.push({fixed:u-m.stretch,stretch:m.stretch}),s.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return s.push({fixed:e+1,stretch:t}),s}function Ld(n,e,t,s){return n/e*t+s}function Od(n,e,t,s){return n-e*t/s}function Lm(n,e,t,s){const u=e+n.positionedLines[s].lineOffset;return 0===s?t+u/2:t+(u+(e+n.positionedLines[s-1].lineOffset))/2}Ec.loadGlyphRange=function(n,e,t,s,u){const f=256*e,m=f+255,y=s.transformRequest(s.normalizeGlyphsURL(t).replace("{fontstack}",n).replace("{range}",`${f}-${m}`),Pe.Glyphs);$e(y,(b,w)=>{if(b)u(b);else if(w){const M={},R=new Ch(w).readFields(__,{});for(const L of R.glyphs)M[L.id]=L;u(null,{glyphs:M,ascender:R.ascender,descender:R.descender})}})},Ec.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:t=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=t;const y=this.size=n+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${f} ${n}px ${u}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:t,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),m=Math.ceil(t),y=Math.min(this.size-this.buffer,Math.ceil(f-u)),b=Math.min(this.size-this.buffer,m+Math.ceil(s)),w=y+2*this.buffer,M=b+2*this.buffer,R=Math.max(w*M,0),L=new Uint8ClampedArray(R),j={data:L,width:w,height:M,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(0===y||0===b)return j;const{ctx:V,buffer:X,gridInner:ee,gridOuter:de}=this;V.clearRect(X,X,y,b),V.fillText(n,X,X+m);const we=V.getImageData(X,X,y,b);de.fill(wc,0,R),ee.fill(0,0,R);for(let fe=0;fe<b;fe++)for(let ye=0;ye<y;ye++){const Le=we.data[4*(fe*y+ye)+3]/255;if(0===Le)continue;const De=(fe+X)*w+ye+X;if(1===Le)de[De]=0,ee[De]=wc;else{const Je=.5-Le;de[De]=Je>0?Je*Je:0,ee[De]=Je<0?Je*Je:0}}Ah(de,0,0,w,M,w,this.f,this.v,this.z),Ah(ee,X,X,y,b,w,this.f,this.v,this.z);for(let fe=0;fe<R;fe++){const ye=Math.sqrt(de[fe])-Math.sqrt(ee[fe]);L[fe]=Math.round(255-255*(ye/this.radius+this.cutoff))}return j}};class $y{constructor(e=[],t=T_){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:s}=this,u=t[e];for(;e>0;){const f=e-1>>1,m=t[f];if(s(u,m)>=0)break;t[e]=m,e=f}t[e]=u}_down(e){const{data:t,compare:s}=this,u=this.length>>1,f=t[e];for(;e<u;){let m=1+(e<<1),y=t[m];const b=m+1;if(b<this.length&&s(t[b],y)<0&&(m=b,y=t[b]),s(y,f)>=0)break;t[e]=y,e=m}t[e]=f}}function T_(n,e){return n<e?-1:n>e?1:0}function Gy(n,e=1,t=!1){let s=1/0,u=1/0,f=-1/0,m=-1/0;const y=n[0];for(let j=0;j<y.length;j++){const V=y[j];(!j||V.x<s)&&(s=V.x),(!j||V.y<u)&&(u=V.y),(!j||V.x>f)&&(f=V.x),(!j||V.y>m)&&(m=V.y)}const b=Math.min(f-s,m-u);let w=b/2;const M=new $y([],Om);if(0===b)return new Ye(s,u);for(let j=s;j<f;j+=b)for(let V=u;V<m;V+=b)M.push(new lu(j+w,V+w,w,n));let R=function(j){let V=0,X=0,ee=0;const de=j[0];for(let we=0,fe=de.length,ye=fe-1;we<fe;ye=we++){const Le=de[we],De=de[ye],Je=Le.x*De.y-De.x*Le.y;X+=(Le.x+De.x)*Je,ee+=(Le.y+De.y)*Je,V+=3*Je}return new lu(X/V,ee/V,0,j)}(n),L=M.length;for(;M.length;){const j=M.pop();(j.d>R.d||!R.d)&&(R=j,t&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,L)),j.max-R.d<=e||(w=j.h/2,M.push(new lu(j.p.x-w,j.p.y-w,w,n)),M.push(new lu(j.p.x+w,j.p.y-w,w,n)),M.push(new lu(j.p.x-w,j.p.y+w,w,n)),M.push(new lu(j.p.x+w,j.p.y+w,w,n)),L+=4)}return t&&(console.log(`num probes: ${L}`),console.log(`best distance: ${R.d}`)),R.p}function Om(n,e){return e.max-n.max}function lu(n,e,t,s){this.p=new Ye(n,e),this.h=t,this.d=function(u,f){let m=!1,y=1/0;for(let b=0;b<f.length;b++){const w=f[b];for(let M=0,R=w.length,L=R-1;M<R;L=M++){const j=w[M],V=w[L];j.y>u.y!=V.y>u.y&&u.x<(V.x-j.x)*(u.y-j.y)/(V.y-j.y)+j.x&&(m=!m),y=Math.min(y,df(u,j,V))}}return(m?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const Qf=Number.POSITIVE_INFINITY,ep=Math.sqrt(2);function D_(n,e){return e[1]!==Qf?function(t,s,u){let f=0,m=0;switch(s=Math.abs(s),u=Math.abs(u),t){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(t){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,m]}(n,e[0],e[1]):function(t,s){let u=0,f=0;s<0&&(s=0);const m=s/ep;switch(t){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(t){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=s;break;case"right":u=-s}return[u,f]}(n,e[0])}function Hy(n,e,t,s,u,f,m,y,b,w){n.createArrays(),n.tilePixelRatio=an/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const M=n.layers[0].layout,R=n.layers[0]._unevaluatedLayout._values,L={};if("composite"===n.textSizeData.kind){const{minZoom:X,maxZoom:ee}=n.textSizeData;L.compositeTextSizes=[R["text-size"].possiblyEvaluate(new ne(X),y),R["text-size"].possiblyEvaluate(new ne(ee),y)]}if("composite"===n.iconSizeData.kind){const{minZoom:X,maxZoom:ee}=n.iconSizeData;L.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new ne(X),y),R["icon-size"].possiblyEvaluate(new ne(ee),y)]}L.layoutTextSize=R["text-size"].possiblyEvaluate(new ne(b+1),y),L.layoutIconSize=R["icon-size"].possiblyEvaluate(new ne(b+1),y),L.textMaxSize=R["text-size"].possiblyEvaluate(new ne(18),y);const j="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),V=M.get("text-size");for(const X of n.features){const ee=M.get("text-font").evaluate(X,{},y).join(","),de=V.evaluate(X,{},y),we=L.layoutTextSize.evaluate(X,{},y),fe=(L.layoutIconSize.evaluate(X,{},y),{horizontal:{},vertical:void 0}),ye=X.text;let Le,De=[0,0];if(ye){const lt=ye.toString(),Lt=24*M.get("text-letter-spacing").evaluate(X,{},y),et=24*M.get("text-line-height").evaluate(X,{},y),ut=U(lt)?Lt:0,bt=M.get("text-anchor").evaluate(X,{},y),ht=M.get("text-variable-anchor");if(!ht){const vn=M.get("text-radial-offset").evaluate(X,{},y);De=vn?D_(bt,[24*vn,Qf]):M.get("text-offset").evaluate(X,{},y).map(Nt=>24*Nt)}let Rt=j?"center":M.get("text-justify").evaluate(X,{},y);const vt=M.get("symbol-placement"),qt="point"===vt,On="point"===vt?24*M.get("text-max-width").evaluate(X,{},y):0,Un=vn=>{n.allowVerticalPlacement&&k(lt)&&(fe.vertical=Cd(ye,e,t,u,ee,On,et,bt,vn,ut,De,Ms.vertical,!0,vt,we,de))};if(!j&&ht){const vn="auto"===Rt?ht.map(tr=>Fm(tr)):[Rt];let Nt=!1;for(let tr=0;tr<vn.length;tr++){const Mn=vn[tr];if(!fe.horizontal[Mn])if(Nt)fe.horizontal[Mn]=fe.horizontal[0];else{const Kt=Cd(ye,e,t,u,ee,On,et,"center",Mn,ut,De,Ms.horizontal,!1,vt,we,de);Kt&&(fe.horizontal[Mn]=Kt,Nt=1===Kt.positionedLines.length)}}Un("left")}else{if("auto"===Rt&&(Rt=Fm(bt)),qt||M.get("text-writing-mode").indexOf("horizontal")>=0||!k(lt)){const vn=Cd(ye,e,t,u,ee,On,et,bt,Rt,ut,De,Ms.horizontal,!1,vt,we,de);vn&&(fe.horizontal[Rt]=vn)}Un("point"===vt?"left":Rt)}}let Je=!1;if(X.icon&&X.icon.name){const lt=s[X.icon.name];lt&&(Le=Aa(u[X.icon.name],M.get("icon-offset").evaluate(X,{},y),M.get("icon-anchor").evaluate(X,{},y)),Je=lt.sdf,void 0===n.sdfIcons?n.sdfIcons=lt.sdf:n.sdfIcons!==lt.sdf&&dn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(lt.pixelRatio!==n.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Xe=I_(fe.horizontal)||fe.vertical;n.iconsInText||(n.iconsInText=!!Xe&&Xe.iconsInText),(Xe||Le)&&Zy(n,X,fe,Le,s,L,we,0,De,Je,m,y,w)}f&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function Fm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Zy(n,e,t,s,u,f,m,y,b,w,M,R,L){let j=f.textMaxSize.evaluate(e,{},R);void 0===j&&(j=m);const V=n.layers[0].layout,X=V.get("icon-offset").evaluate(e,{},R),ee=I_(t.horizontal)||t.vertical,de="globe"===L.name,we=m/24,fe=n.tilePixelRatio*j/24,ye=(ut=n.overscaling,n.zoom>18&&ut>2&&(ut>>=1),Math.max(an/(512*ut),1)*V.get("symbol-spacing")),Le=V.get("text-padding")*n.tilePixelRatio,De=V.get("icon-padding")*n.tilePixelRatio,Je=st(V.get("text-max-angle")),Xe="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),lt="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),Lt=V.get("symbol-placement"),et=ye/2;var ut;const bt=V.get("icon-text-fit");let ht;s&&"none"!==bt&&(n.allowVerticalPlacement&&t.vertical&&(ht=Xf(s,t.vertical,bt,V.get("icon-text-fit-padding"),X,we)),ee&&(s=Xf(s,ee,bt,V.get("icon-text-fit-padding"),X,we)));const Rt=(vt,qt,On)=>{if(qt.x<0||qt.x>=an||qt.y<0||qt.y>=an)return;let Un=null;if(de){const{x:vn,y:Nt,z:tr}=L.projectTilePoint(qt.x,qt.y,On);Un={anchor:new Jl(vn,Nt,tr,0,void 0),up:L.upVector(On,qt.x,qt.y)}}!function(vn,Nt,tr,Mn,Kt,Nr,Or,Kr,Wn,_r,$r,Fr,Pr,Zr,ri,no,Zo,ur,di,Eo,Ir,fi,Wo,ii,vi){const co=vn.addToLineVertexArray(Nt,Mn);let wr,uo,qo,ho,_l,Qu,eh,th=0,fu=0,hg=0,dg=0,Hd=-1,xp=-1;const Oa={};let U_=Xh("");const Ac=tr?tr.anchor:Nt;let $h=0,ra=0;if(void 0===Wn._unevaluatedLayout.getValue("text-radial-offset")?[$h,ra]=Wn.layout.get("text-offset").evaluate(Ir,{},vi).map(wi=>24*wi):($h=24*Wn.layout.get("text-radial-offset").evaluate(Ir,{},vi),ra=Qf),vn.allowVerticalPlacement&&Kt.vertical){const wi=Kt.vertical;if(ri)Qu=zm(wi),Kr&&(eh=zm(Kr));else{const Ei=Wn.layout.get("text-rotate").evaluate(Ir,{},vi)+90;qo=tp(_r,Ac,Nt,$r,Fr,Pr,wi,Zr,Ei,no),Kr&&(ho=tp(_r,Ac,Nt,$r,Fr,Pr,Kr,ur,Ei))}}if(Nr){const wi=Wn.layout.get("icon-rotate").evaluate(Ir,{},vi),Ei="none"!==Wn.layout.get("icon-text-fit"),nh=E_(Nr,wi,Wo,Ei),Zd=Kr?E_(Kr,wi,Wo,Ei):void 0;uo=tp(_r,Ac,Nt,$r,Fr,Pr,Nr,ur,wi),th=4*nh.length;const fg=vn.iconSizeData;let pu=null;"source"===fg.kind?(pu=[ll*Wn.layout.get("icon-size").evaluate(Ir,{},vi)],pu[0]>cu&&dn(`${vn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===fg.kind&&(pu=[ll*fi.compositeIconSizes[0].evaluate(Ir,{},vi),ll*fi.compositeIconSizes[1].evaluate(Ir,{},vi)],(pu[0]>cu||pu[1]>cu)&&dn(`${vn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vn.addSymbols(vn.icon,nh,pu,Eo,di,Ir,!1,tr,Nt,co.lineStartIndex,co.lineLength,-1,ii,vi),Hd=vn.icon.placedSymbolArray.length-1,Zd&&(fu=4*Zd.length,vn.addSymbols(vn.icon,Zd,pu,Eo,di,Ir,Ms.vertical,tr,Nt,co.lineStartIndex,co.lineLength,-1,ii,vi),xp=vn.icon.placedSymbolArray.length-1)}for(const wi in Kt.horizontal){const Ei=Kt.horizontal[wi];wr||(U_=Xh(Ei.text),ri?_l=zm(Ei):wr=tp(_r,Ac,Nt,$r,Fr,Pr,Ei,Zr,Wn.layout.get("text-rotate").evaluate(Ir,{},vi),no));const nh=1===Ei.positionedLines.length;if(hg+=C_(vn,tr,Nt,Ei,Or,Wn,ri,Ir,no,co,Kt.vertical?Ms.horizontal:Ms.horizontalOnly,nh?Object.keys(Kt.horizontal):[wi],Oa,Hd,fi,ii,vi),nh)break}Kt.vertical&&(dg+=C_(vn,tr,Nt,Kt.vertical,Or,Wn,ri,Ir,no,co,Ms.vertical,["vertical"],Oa,xp,fi,ii,vi));let Pc=-1;const bp=(wi,Ei)=>wi?Math.max(wi,Ei):Ei;Pc=bp(_l,Pc),Pc=bp(Qu,Pc),Pc=bp(eh,Pc);const yl=Pc>-1?1:0;vn.glyphOffsetArray.length>=hl.MAX_GLYPHS&&dn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ir.sortKey&&vn.addToSortKeyRanges(vn.symbolInstances.length,Ir.sortKey),vn.symbolInstances.emplaceBack(Ac.x,Ac.y,Ac.z,Nt.x,Nt.y,Oa.right>=0?Oa.right:-1,Oa.center>=0?Oa.center:-1,Oa.left>=0?Oa.left:-1,Oa.vertical>=0?Oa.vertical:-1,Hd,xp,U_,void 0!==wr?wr:vn.collisionBoxArray.length,void 0!==wr?wr+1:vn.collisionBoxArray.length,void 0!==qo?qo:vn.collisionBoxArray.length,void 0!==qo?qo+1:vn.collisionBoxArray.length,void 0!==uo?uo:vn.collisionBoxArray.length,void 0!==uo?uo+1:vn.collisionBoxArray.length,ho||vn.collisionBoxArray.length,ho?ho+1:vn.collisionBoxArray.length,$r,hg,dg,th,fu,yl,0,$h,ra,Pc)}(n,qt,Un,vt,t,s,u,ht,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Le,Xe,b,0,De,lt,X,e,f,w,M,R)};if("line"===Lt)for(const vt of w_(e.geometry,0,0,an,an)){const qt=Vy(vt,ye,Je,t.vertical||ee,s,24,fe,n.overscaling,an);for(const On of qt){const Un=ee;Un&&Wy(n,Un.text,et,On)||Rt(vt,On,R)}}else if("line-center"===Lt){for(const vt of e.geometry)if(vt.length>1){const qt=Kf(vt,Je,t.vertical||ee,s,24,fe);qt&&Rt(vt,qt,R)}}else if("Polygon"===e.type)for(const vt of xh(e.geometry,0)){const qt=Gy(vt,16);Rt(vt[0],new Jl(qt.x,qt.y,0,0,void 0),R)}else if("LineString"===e.type)for(const vt of e.geometry)Rt(vt,new Jl(vt[0].x,vt[0].y,0,0,void 0),R);else if("Point"===e.type)for(const vt of e.geometry)for(const qt of vt)Rt([qt],new Jl(qt.x,qt.y,0,0,void 0),R)}const cu=32640;function C_(n,e,t,s,u,f,m,y,b,w,M,R,L,j,V,X,ee){const de=function(ye,Le,De,Je,Xe,lt,Lt,et){const ut=[];if(0===Le.positionedLines.length)return ut;const bt=Je.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,ht=function(Un){const vn=Un[0],Nt=Un[1],tr=vn*Nt;return tr>0?[vn,-Nt]:tr<0?[-vn,Nt]:0===vn?[Nt,vn]:[Nt,-vn]}(De);let Rt=Math.abs(Le.top-Le.bottom);for(const Un of Le.positionedLines)Rt-=Un.lineOffset;const vt=Le.positionedLines.length,qt=Rt/vt;let On=Le.top-De[1];for(let Un=0;Un<vt;++Un){const vn=Le.positionedLines[Un];On=Lm(Le,qt,On,Un);for(const Nt of vn.positionedGlyphs){if(!Nt.rect)continue;const tr=Nt.rect||{};let Mn=4,Kt=!0,Nr=1,Or=0;if(Nt.imageName){const ii=Lt[Nt.imageName];if(!ii)continue;if(ii.sdf){dn("SDF images are not supported in formatted text and will be ignored.");continue}Kt=!1,Nr=ii.pixelRatio,Mn=1/Nr}const Kr=(Xe||et)&&Nt.vertical,Wn=Nt.metrics.advance*Nt.scale/2,_r=Nt.metrics,$r=Nt.rect;if(null===$r)continue;et&&Le.verticalizable&&(Or=Nt.imageName?Wn-Nt.metrics.width*Nt.scale/2:0);const Fr=Xe?[Nt.x+Wn,Nt.y]:[0,0];let Pr=[0,0],Zr=[0,0],ri=!1;Xe||(Kr?(Zr=[Nt.x+Wn+ht[0],Nt.y+ht[1]-Or],ri=!0):Pr=[Nt.x+Wn+De[0],Nt.y+De[1]-Or]);const no=$r.w*Nt.scale/(Nr*(Nt.localGlyph?2:1)),Zo=$r.h*Nt.scale/(Nr*(Nt.localGlyph?2:1));let ur,di,Eo,Ir;if(Kr){const ii=Nt.y-On,vi=new Ye(-Wn,Wn-ii),co=-Math.PI/2,wr=new Ye(...Zr);ur=new Ye(-Wn+Pr[0],Pr[1]),ur._rotateAround(co,vi)._add(wr),ur.x+=-ii+Wn,ur.y-=(_r.left-Mn)*Nt.scale;const uo=Nt.imageName?_r.advance*Nt.scale:24*Nt.scale,qo=String.fromCharCode(Nt.glyph);Sm(qo)?ur.x+=(1-Mn)*Nt.scale:f_(qo)?ur.x+=uo-_r.height*Nt.scale+(-Mn-1)*Nt.scale:ur.x+=Nt.imageName||_r.width+2*Mn===$r.w&&_r.height+2*Mn===$r.h?(uo-Zo)/2:(uo-(_r.height+2*Mn)*Nt.scale)/2,di=new Ye(ur.x,ur.y-no),Eo=new Ye(ur.x+Zo,ur.y),Ir=new Ye(ur.x+Zo,ur.y-no)}else{const ii=(_r.left-Mn)*Nt.scale-Wn+Pr[0],vi=(-_r.top-Mn)*Nt.scale+Pr[1],co=ii+no,wr=vi+Zo;ur=new Ye(ii,vi),di=new Ye(co,vi),Eo=new Ye(ii,wr),Ir=new Ye(co,wr)}if(bt){let ii;ii=Xe?new Ye(0,0):ri?new Ye(ht[0],ht[1]):new Ye(De[0],De[1]),ur._rotateAround(bt,ii),di._rotateAround(bt,ii),Eo._rotateAround(bt,ii),Ir._rotateAround(bt,ii)}const fi=new Ye(0,0),Wo=new Ye(0,0);ut.push({tl:ur,tr:di,bl:Eo,br:Ir,tex:tr,writingMode:Le.writingMode,glyphOffset:Fr,sectionIndex:Nt.sectionIndex,isSDF:Kt,pixelOffsetTL:fi,pixelOffsetBR:Wo,minFontScaleX:0,minFontScaleY:0})}}return ut}(0,s,b,f,m,y,u,n.allowVerticalPlacement),we=n.textSizeData;let fe=null;"source"===we.kind?(fe=[ll*f.layout.get("text-size").evaluate(y,{},ee)],fe[0]>cu&&dn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===we.kind&&(fe=[ll*V.compositeTextSizes[0].evaluate(y,{},ee),ll*V.compositeTextSizes[1].evaluate(y,{},ee)],(fe[0]>cu||fe[1]>cu)&&dn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,de,fe,b,m,y,M,e,t,w.lineStartIndex,w.lineLength,j,X,ee);for(const ye of R)L[ye]=n.text.placedSymbolArray.length-1;return 4*de.length}function I_(n){for(const e in n)return n[e];return null}function tp(n,e,t,s,u,f,m,y,b,w){let M=m.top,R=m.bottom,L=m.left,j=m.right;const V=m.collisionPadding;if(V&&(L-=V[0],M-=V[1],j+=V[2],R+=V[3]),b){const X=new Ye(L,M),ee=new Ye(j,M),de=new Ye(L,R),we=new Ye(j,R),fe=st(b);let ye=new Ye(0,0);w&&(ye=new Ye(w[0],w[1])),X._rotateAround(fe,ye),ee._rotateAround(fe,ye),de._rotateAround(fe,ye),we._rotateAround(fe,ye),L=Math.min(X.x,ee.x,de.x,we.x),j=Math.max(X.x,ee.x,de.x,we.x),M=Math.min(X.y,ee.y,de.y,we.y),R=Math.max(X.y,ee.y,de.y,we.y)}return n.emplaceBack(e.x,e.y,e.z,t.x,t.y,L,M,j,R,y,s,u,f),n.length-1}function zm(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function Wy(n,e,t,s){const u=n.compareText;if(e in u){const f=u[e];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<t)return!0}else u[e]=[];return u[e].push(s),!1}const Tc=mt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Fd}=Tc,Bm=mt([{name:"a_pos_3",components:3,type:"Int16"}]);var Bu=mt([{name:"a_pos",type:"Int16",components:2}]);const Pa=an/Math.PI/2,zd=2*Qs(1,0)*Pa*Math.PI,Dc=[64,32,16],Ra=-Pa,wo=Pa,Nm=[new rs([Ra,Ra,Ra],[wo,wo,wo]),new rs([Ra,Ra,Ra],[0,0,wo]),new rs([0,Ra,Ra],[wo,0,wo]),new rs([Ra,0,Ra],[0,wo,wo]),new rs([0,0,Ra],[wo,wo,wo])];function Um(n,e,t,s=!0){const u=sl([],n._camera.position,n.worldSize),f=[e,t,1,1];vc(f,f,n.pixelMatrixInverse),yf(f,f,1/f[3]);const m=vo([],Ca([],f,u)),y=n.globeMatrix,b=[y[12],y[13],y[14]],w=Ca([],b,u),M=ph(w),R=vo([],w),L=n.worldSize/(2*Math.PI),j=Da(R,m),V=Math.asin(L/M);if(V<Math.acos(j)){if(!s)return null;const Lt=[],et=[];sl(Lt,m,M/j),vo(et,Ca(et,Lt,w)),vo(m,yc(m,w,sl(m,et,Math.tan(V)*M)))}const X=[];new tu(u,m).closestPointOnSphere(b,L,X);const ee=vo([],yr(y,0)),de=vo([],yr(y,1)),we=vo([],yr(y,2)),fe=Da(ee,X),ye=Da(de,X),Le=Da(we,X),De=un(Math.asin(-ye/L));let Je=un(Math.atan2(fe,Le));Je=n.center.lng+function(Lt,et){const ut=(et-Lt+180)%360-180;return ut<-180?ut+360:ut}(n.center.lng,Je);const Xe=ol(Je),lt=$t(Vl(De),0,1);return new Kc(Xe,lt)}class S_{constructor(e,t,s){this.a=Ca([],e,s),this.b=Ca([],t,s),this.center=s;const u=vo([],this.a),f=vo([],this.b);this.angle=Math.acos(Da(u,f))}}function Bd(n,e){if(0===n.angle)return null;let t;return t=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),t<0||t>1?null:function(s,u,f,m){const y=Math.sin(f);return s*(Math.sin((1-m)*f)/y)+u*(Math.sin(m*f)/y)}(n.a[e],n.b[e],n.angle,$t(t,0,1))+n.center[e]}function ul(n){if(n.z<=1)return Nm[n.z+2*n.y+n.x];const e=Cc(Uu(n));return rs.fromPoints(e)}function jm(n,e){const t=hu(e.zoom);if(0===t)return ul(n);const s=Uu(n),u=Cc(s),f=ol(s.getWest())*e.worldSize,m=ol(s.getEast())*e.worldSize,y=Vl(s.getNorth())*e.worldSize,b=Vl(s.getSouth())*e.worldSize,w=[f,y,0],M=[m,y,0],R=[f,b,0],L=[m,b,0],j=Jp([],e.globeMatrix);return to(w,w,j),to(M,M,j),to(R,R,j),to(L,L,j),u[0]=Ni(u[0],R,t),u[1]=Ni(u[1],L,t),u[2]=Ni(u[2],M,t),u[3]=Ni(u[3],w,t),rs.fromPoints(u)}function Rh(n,e,t,s,u){for(const f of t)to(f,f,s),sl(f,f,u),mf(n,n,f),gh(e,e,f)}function Uu({x:n,y:e,z:t}){const s=1/(1<<t),u=new Cr(ea(n*s),Po((e+1)*s)),f=new Cr(ea((n+1)*s),Po(e*s));return new mc(u,f)}function Cc(n){const e=st(n.getNorth()),t=st(n.getSouth()),s=Math.cos(e),u=Math.cos(t),f=Math.sin(e),m=Math.sin(t),y=n.getWest(),b=n.getEast();return[Ql(u,m,y),Ql(u,m,b),Ql(s,f,b),Ql(s,f,y)]}function Ql(n,e,t,s=Pa){return t=st(t),[n*Math.sin(t)*s,-e*s,n*Math.cos(t)*s]}function Ic(n,e,t){return Ql(Math.cos(st(n)),Math.sin(st(n)),e,t)}function kh(n,e,t,s){const u=1<<t.z,f=(n/an+t.x)/u;return Ic(Po((e/an+t.y)/u),ea(f),s)}function Lh({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const np=new Float64Array(16);function uu(n){const e=Lh(n),t=Qp(np,[e,e,e]);return Wl(t,t,((s=[])[0]=-(u=n.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function Oh(n){const e=(s=n.min,(t=np)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1,t);var t,s;const u=1/Lh(n);return Qc(e,e,[u,u,u])}function rp(n,e,t,s,u){const f=function(b){const w=an/(2*Math.PI);return b/(2*Math.PI)/w}(t),m=[n,e,-t/(2*Math.PI)],y=Ta(new Float64Array(16));return Wl(y,y,m),Qc(y,y,[f,f,f]),gc(y,y,st(-u)),_c(y,y,st(-s)),y}function hu(n){return nr(5,6,n)}function Vm(n,e){const t=Ic(e.lat,e.lng);return f=(s=mh([],function(j){const V=Ic(j._center.lat,j._center.lng);let X=rm([],eu(0,1,0),V);const ee=Bg([],-j.angle,V);X=to(X,X,ee),Bg(ee,-j._pitch,X);const de=vo([],V);return sl(de,de,j.cameraToCenterDistance/j.pixelsPerMeter*zd),to(de,de,ee),yc([],V,de)}(n),t))[0],m=s[1],y=s[2],b=(u=t)[0],w=u[1],M=u[2],L=(R=Math.sqrt(f*f+m*m+y*y)*Math.sqrt(b*b+w*w+M*M))&&Da(s,u)/R,Math.acos(Math.min(Math.max(L,-1),1));var s,u,f,m,y,b,w,M,R,L}const M_=st(85),A_=Math.cos(M_),$m=Math.sin(M_);function Gm(n,e){const t=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),f=Math.sin(t)*u/Math.sin(Math.max(Math.PI/2-n._pitch-t,.01)),m=Math.sin(n._pitch)*f+u;return Math.min(1.01*m,u*(1/n._horizonShift))}function Sc(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const t=Math.pow(2,-n.z),s=n.x*t,u=(n.x+1)*t,f=n.y*t,m=(n.y+1)*t,y=ea(s),b=ea(u),w=Po(f),M=Po(m),R=e.project(y,w),L=e.project(b,w),j=e.project(b,M),V=e.project(y,M);let X=Math.min(R.x,L.x,j.x,V.x),ee=Math.min(R.y,L.y,j.y,V.y),de=Math.max(R.x,L.x,j.x,V.x),we=Math.max(R.y,L.y,j.y,V.y);const fe=t/16;function ye(De,Je,Xe,lt,Lt,et){const ut=(Xe+Lt)/2,bt=(lt+et)/2,ht=e.project(ea(ut),Po(bt)),Rt=Math.max(0,X-ht.x,ee-ht.y,ht.x-de,ht.y-we);X=Math.min(X,ht.x),de=Math.max(de,ht.x),ee=Math.min(ee,ht.y),we=Math.max(we,ht.y),Rt>fe&&(ye(De,ht,Xe,lt,ut,bt),ye(ht,Je,ut,bt,Lt,et))}ye(R,L,s,f,u,f),ye(L,j,u,f,u,m),ye(j,V,u,m,s,m),ye(V,R,s,m,s,f),X-=fe,ee-=fe,de+=fe,we+=fe;const Le=1/Math.max(de-X,we-ee);return{scale:Le,x:X*Le,y:ee*Le,x2:de*Le,y2:we*Le,projection:e}}const Hm=Ta(new Float32Array(16));class Mc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Cr(0,0)}projectTilePoint(e,t,s){return{x:e,y:t,z:0}}locationPoint(e,t,s=!0){return e._coordinatePoint(e.locationCoordinate(t),s)}pixelsPerMeter(e,t){return Qs(1,e)*t}pixelSpaceConversion(e,t,s){return 1}farthestPixelDistance(e){return Gm(e,e.pixelsPerMeter)}pointCoordinate(e,t,s,u){const f=e.horizonLineFromTop(!1),m=new Ye(t,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,t,s){const u=new Ye(t,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const s=e.horizonLineFromTop();return t.y<s}createInversionMatrix(e,t){return Hm}createTileMatrix(e,t,s){let u,f,m;const y=s.canonical,b=Ta(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Sc(y,this);u=1,f=w.x+s.wrap*w.scale,m=w.y,Qc(b,b,[u/w.scale,u/w.scale,e.pixelsPerMeter/t])}else u=t/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*s.wrap)*u,m=y.y*u;return Wl(b,b,[f,m,0]),Qc(b,b,[u/an,u/an,1]),b}upVector(e,t,s){return[0,0,1]}upVectorScale(e,t,s){return{metersToTile:1}}}class As extends Mc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(st(t));this.n=(u+Math.sin(st(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:s,c:u,r0:f}=this,m=st(e-this.center[0]),y=st(t),b=Math.sqrt(u-2*s*Math.sin(y))/s;return{x:b*Math.sin(m*s),y:b*Math.cos(m*s)-f,z:0}}unproject(e,t){const{n:s,c:u,r0:f}=this,m=f+t;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const b=st(this.center[0])*s;y=rn(y,-Math.PI-b,Math.PI-b);const w=un(y/s)+this.center[0],M=Math.asin($t((u-(e*e+m*m)*s*s)/(2*s),-1,1)),R=$t(un(M),-85.051129,xs);return new Cr(w,R)}}const ju=1.340264,Fh=-.081106,Nd=893e-6,zh=.003796,Vu=Math.sqrt(3)/2;class Zm extends Mc{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Vu*Math.sin(t)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(Vu*(ju+3*Fh*u+f*(7*Nd+9*zh*u)))/Math.PI+.5),y:1-.5*(s*(ju+Fh*u+f*(Nd+zh*u))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let s=t=(2*(1-t)-1)*Math.PI,u=s*s,f=u*u*u;for(let M,R,L,j=0;j<12&&(R=s*(ju+Fh*u+f*(Nd+zh*u))-t,L=ju+3*Fh*u+f*(7*Nd+9*zh*u),M=R/L,s=$t(s-M,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(M)<1e-12));++j);const m=Vu*e*(ju+3*Fh*u+f*(7*Nd+9*zh*u))/Math.cos(s),y=Math.asin(Math.sin(s)/Vu),b=$t(180*m/Math.PI,-180,180),w=$t(180*y/Math.PI,-85.051129,xs);return new Cr(b,w)}}class P_ extends Mc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const s=360*(e-.5),u=$t(360*(.5-t),-85.051129,xs);return new Cr(s,u)}}const $u=Math.PI/2;function Ud(n){return Math.tan(($u+n)/2)}class Wm extends Mc{constructor(e){super(e),this.center=e.center||[0,30];const[t,s]=this.parallels=e.parallels||[30,30],u=st(t),f=st(s),m=Math.cos(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(Ud(f)/Ud(u)),this.f=m*Math.pow(Ud(u),this.n)/this.n}project(e,t){t=st(t),e=st(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?t<-$u+s&&(t=-$u+s):t>$u-s&&(t=$u-s);const m=f/Math.pow(Ud(t),u),y=m*Math.sin(u*e),b=f-m*Math.cos(u*e);return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:s,f:u}=this,f=u-t,m=Math.sign(f),y=Math.sign(s)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*m;f*s<0&&(b-=Math.PI*Math.sign(e)*m);const w=$t(un(b/s)+this.center[0],-180,180),M=$t(un(2*Math.atan(Math.pow(u/y,1/s))-$u),-85.051129,xs);return new Cr(w,M)}}class qm extends Mc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:ol(e),y:Vl(t),z:0}}unproject(e,t){const s=ea(e),u=Po(t);return new Cr(s,u)}}const ip=st(xs);class R_ extends Mc{project(e,t){const s=(t=st(t))*t,u=s*s;return{x:.5*((e=st(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let s=t=(2*(1-t)-1)*Math.PI,u=25,f=0,m=s*s;do{m=s*s;const w=m*m;f=(s*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-t)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),s=$t(s-f,-ip,ip)}while(Math.abs(f)>1e-6&&--u>0);m=s*s;const y=$t(un(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=un(s);return new Cr(y,b)}}const Xm=st(xs);class Ym extends Mc{project(e,t){t=st(t),e=st(e);const s=Math.cos(t),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),m=Math.sin(f)/f,y=.5*(e*u+2*s*Math.sin(e/2)/m)||0,b=.5*(t+Math.sin(t)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,t){let s=e=(2*e-.5)*Math.PI,u=t=(2*(1-t)-1)*Math.PI,f=25;const m=1e-6;let y=0,b=0;do{const w=Math.cos(u),M=Math.sin(u),R=2*M*w,L=M*M,j=w*w,V=Math.cos(s/2),X=Math.sin(s/2),ee=2*V*X,de=X*X,we=1-j*V*V,fe=we?1/we:0,ye=we?Math.acos(w*V)*Math.sqrt(1/we):0,Le=.5*(2*ye*w*X+2*s/Math.PI)-e,De=.5*(ye*M+u)-t,Je=.5*fe*(j*de+ye*w*V*L)+1/Math.PI,Xe=fe*(ee*R/4-ye*M*X),lt=.125*fe*(R*X-ye*M*j*ee),Lt=.5*fe*(L*V+ye*de*w)+.5,et=Xe*lt-Lt*Je;y=(De*Xe-Le*Lt)/et,b=(Le*lt-De*Je)/et,s=$t(s-y,-Math.PI,Math.PI),u=$t(u-b,-Xm,Xm)}while((Math.abs(y)>m||Math.abs(b)>m)&&--f>0);return new Cr(un(s),un(u))}}class op extends Mc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(st(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:s,cosPhi:u}=this;return{x:st(e)*u*s+.5,y:-Math.sin(st(t))/u*s+.5,z:0}}unproject(e,t){const{scale:s,cosPhi:u}=this,f=-(t-.5)/s,m=$t(un((e-.5)/s)/u,-180,180),y=Math.asin($t(f*u,-1,1)),b=$t(un(y),-85.051129,xs);return new Cr(m,b)}}class k_ extends qm{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,s){const u=kh(e,t,s);return to(u,u,uu(ul(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,t){const s=Ic(t.lat,t.lng),u=vo([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;gf(s,s,u,Qs(1,0)*an*f);const m=Ta(new Float64Array(16));return Su(m,e.pixelMatrix,e.globeMatrix),to(s,s,m),new Ye(s[0],s[1])}pixelsPerMeter(e,t){return Qs(1,0)*t}pixelSpaceConversion(e,t,s){const u=Xn(Qs(1,45)*t,Qs(1,e)*t,s);return this.pixelsPerMeter(e,t)/u}createTileMatrix(e,t,s){const u=Oh(ul(s.canonical));return Su(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,t){const{center:s}=e,u=uu(ul(t));return _c(u,u,st(s.lng)),gc(u,u,st(s.lat)),Qc(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,t,s,u){return Um(e,t,s,!0)||new Kc(0,0)}pointCoordinate3D(e,t,s){const u=this.pointCoordinate(e,t,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,t){return!Um(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(u,f){const m=u.cameraToCenterDistance,y=u._centerAltitude*f,b=u._camera,w=u._camera.forward(),M=yc([],sl([],w,-m),[0,0,y]),R=u.worldSize/(2*Math.PI),L=[0,0,-R],j=u.width/u.height,V=Math.tan(u.fovAboveCenter),X=sl([],b.up(),V),ee=sl([],b.right(),V*j),de=vo([],yc([],yc([],w,X),ee)),we=[];let fe;if(new tu(M,de).closestPointOnSphere(L,R,we)){const ye=yc([],we,L),Le=Ca([],ye,M);fe=Math.cos(u.fovAboveCenter)*ph(Le)}else{const ye=Ca([],M,L),Le=Ca([],L,M);vo(Le,Le);const De=ph(ye)-R;fe=Math.sqrt(De*(De+2*R));const Je=Math.acos(fe/(R+De))-Math.acos(Da(w,Le));fe*=Math.cos(Je)}return 1.01*fe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=hu(e.zoom);if(s>0){const u=Gm(e,Qs(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Xn(t,u+f*(1-Math.cos(m)),Math.pow(s,10))}return t}upVector(e,t,s){return kh(t,s,e,1)}upVectorScale(e){return{metersToTile:zd*Lh(ul(e))}}}function ka(n){const e=n.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new qm(n);case"equirectangular":return new P_(n);case"naturalEarth":return new R_(n);case"equalEarth":return new Zm(n);case"winkelTripel":return new Ym(n);case"albers":return t?new op(n):new As(n);case"lambertConformalConic":return t?new op(n):new Wm(n);case"globe":return new k_(n)}throw new Error(`Invalid projection name: ${n.name}`)}const sp=iu.VectorTileFeature.types,L_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jd(n,e,t,s,u,f,m,y,b,w,M,R,L){const j=y?Math.min(cu,Math.round(y[0])):0,V=y?Math.min(cu,Math.round(y[1])):0;n.emplaceBack(e,t,Math.round(32*s),Math.round(32*u),f,m,(j<<1)+(b?1:0),V,16*w,16*M,256*R,256*L)}function ap(n,e,t,s,u,f,m){n.emplaceBack(e,t,s,u,f,m)}function Bh(n,e,t,s,u){n.emplaceBack(e,t,s,u),n.emplaceBack(e,t,s,u),n.emplaceBack(e,t,s,u),n.emplaceBack(e,t,s,u)}function O_(n){for(const e of n.sections)if(l(e.text))return!0;return!1}class lp{constructor(e){this.layoutVertexArray=new Yr,this.indexArray=new Zn,this.programConfigurations=e,this.segments=new Vi,this.dynamicLayoutVertexArray=new cr,this.opacityVertexArray=new Lr,this.placedSymbolArray=new Qd,this.globeExtVertexArray=new hi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,l_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,L_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,a_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Yt(lp,"SymbolBuffers");class cp{constructor(e,t,s){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new s,this.segments=new Vi,this.collisionVertexArray=new Gr,this.collisionVertexArrayExt=new ui}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,c_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,u_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Yt(cp,"CollisionBuffers");class hl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ta([]),this.placementViewportMatrix=Ta([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Kn(this.zoom,t["text-size"]),this.iconSizeData=Kn(this.zoom,t["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>Ms[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new lp(new Iu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new lp(new Iu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Pp,this.lineVertexArray=new Rp,this.symbolInstances=new tf}calculateGlyphDependencies(e,t,s,u,f){for(let m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,u&&f){const y=Dh[e.charAt(m)];y&&(t[y.charCodeAt(0)]=!0)}}populate(e,t,s,u){const f=this.layers[0],m=f.layout,y="globe"===this.projection.name,b=m.get("text-font"),w=m.get("text-field"),M=m.get("icon-image"),R=("constant"!==w.value.kind||w.value.value instanceof Ci&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),L="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,j=m.get("symbol-sort-key");if(this.features=[],!R&&!L)return;const V=t.iconDependencies,X=t.glyphDependencies,ee=t.availableImages,de=new ne(this.zoom);for(const{feature:we,id:fe,index:ye,sourceLayerIndex:Le}of e){const De=f._featureFilter.needGeometry,Je=Gl(we,De);if(!f._featureFilter.filter(de,Je,s))continue;if(De||(Je.geometry=$l(we,s,u)),y&&1!==we.type&&s.z<=5){const et=Je.geometry,ut=.98078528056;for(let bt=0;bt<et.length;bt++)et[bt]=Hp(et[bt],ht=>ht,(ht,Rt)=>Da(kh(ht.x,ht.y,s,1),kh(Rt.x,Rt.y,s,1))<ut)}let Xe,lt;if(R){const et=f.getValueAndResolveTokens("text-field",Je,s,ee),ut=Ci.factory(et);O_(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===K()||this.hasRTLText&&re.isParsed())&&(Xe=d_(ut,f,Je))}if(L){const et=f.getValueAndResolveTokens("icon-image",Je,s,ee);lt=et instanceof gr?et:gr.fromString(et)}if(!Xe&&!lt)continue;const Lt=this.sortFeaturesByKey?j.evaluate(Je,{},s):void 0;if(this.features.push({id:fe,text:Xe,icon:lt,index:ye,sourceLayerIndex:Le,geometry:Je.geometry,properties:we.properties,type:sp[we.type],sortKey:Lt}),lt&&(V[lt.name]=!0),Xe){const et=b.evaluate(Je,{},s).join(","),ut="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ms.vertical)>=0;for(const bt of Xe.sections)if(bt.image)V[bt.image.name]=!0;else{const ht=k(Xe.toString()),Rt=bt.fontStack||et,vt=X[Rt]=X[Rt]||{};this.calculateGlyphDependencies(bt.text,vt,ut,this.allowVerticalPlacement,ht)}}}"line"===m.get("symbol-placement")&&(this.features=function(we){const fe={},ye={},Le=[];let De=0;function Je(et){Le.push(we[et]),De++}function Xe(et,ut,bt){const ht=ye[et];return delete ye[et],ye[ut]=ht,Le[ht].geometry[0].pop(),Le[ht].geometry[0]=Le[ht].geometry[0].concat(bt[0]),ht}function lt(et,ut,bt){const ht=fe[ut];return delete fe[ut],fe[et]=ht,Le[ht].geometry[0].shift(),Le[ht].geometry[0]=bt[0].concat(Le[ht].geometry[0]),ht}function Lt(et,ut,bt){const ht=bt?ut[0][ut[0].length-1]:ut[0][0];return`${et}:${ht.x}:${ht.y}`}for(let et=0;et<we.length;et++){const ut=we[et],bt=ut.geometry,ht=ut.text?ut.text.toString():null;if(!ht){Je(et);continue}const Rt=Lt(ht,bt),vt=Lt(ht,bt,!0);if(Rt in ye&&vt in fe&&ye[Rt]!==fe[vt]){const qt=lt(Rt,vt,bt),On=Xe(Rt,vt,Le[qt].geometry);delete fe[Rt],delete ye[vt],ye[Lt(ht,Le[On].geometry,!0)]=On,Le[qt].geometry=null}else Rt in ye?Xe(Rt,vt,bt):vt in fe?lt(Rt,vt,bt):(Je(et),fe[Rt]=De-1,ye[vt]=De-1)}return Le.filter(et=>et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((we,fe)=>we.sortKey-fe.sortKey)}update(e,t,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ka(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const s=this.lineVertexArray.length,u=e.segment;if(void 0!==u){let f=e.dist(t[u+1]),m=e.dist(t[u]);const y={};for(let b=u+1;b<t.length;b++)y[b]={x:t[b].x,y:t[b].y,tileUnitDistanceFromAnchor:f},b<t.length-1&&(f+=t[b+1].dist(t[b]));for(let b=u||0;b>=0;b--)y[b]={x:t[b].x,y:t[b].y,tileUnitDistanceFromAnchor:m},b>0&&(m+=t[b-1].dist(t[b]));for(let b=0;b<t.length;b++){const w=y[b];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,t,s,u,f,m,y,b,w,M,R,L,j,V){const X=e.indexArray,ee=e.layoutVertexArray,de=e.globeExtVertexArray,we=e.segments.prepareSegment(4*t.length,ee,X,this.canOverlap?m.sortKey:void 0),fe=this.glyphOffsetArray.length,ye=we.vertexLength,Le=this.allowVerticalPlacement&&y===Ms.vertical?Math.PI/2:0,De=m.text&&m.text.sections;for(let Xe=0;Xe<t.length;Xe++){const{tl:lt,tr:Lt,bl:et,br:ut,tex:bt,pixelOffsetTL:ht,pixelOffsetBR:Rt,minFontScaleX:vt,minFontScaleY:qt,glyphOffset:On,isSDF:Un,sectionIndex:vn}=t[Xe],Nt=we.vertexLength,tr=On[1];if(jd(ee,w.x,w.y,lt.x,tr+lt.y,bt.x,bt.y,s,Un,ht.x,ht.y,vt,qt),jd(ee,w.x,w.y,Lt.x,tr+Lt.y,bt.x+bt.w,bt.y,s,Un,Rt.x,ht.y,vt,qt),jd(ee,w.x,w.y,et.x,tr+et.y,bt.x,bt.y+bt.h,s,Un,ht.x,Rt.y,vt,qt),jd(ee,w.x,w.y,ut.x,tr+ut.y,bt.x+bt.w,bt.y+bt.h,s,Un,Rt.x,Rt.y,vt,qt),b){const Mn=b.anchor,Kt=b.up;ap(de,Mn.x,Mn.y,Mn.z,Kt[0],Kt[1],Kt[2]),ap(de,Mn.x,Mn.y,Mn.z,Kt[0],Kt[1],Kt[2]),ap(de,Mn.x,Mn.y,Mn.z,Kt[0],Kt[1],Kt[2]),ap(de,Mn.x,Mn.y,Mn.z,Kt[0],Kt[1],Kt[2]),Bh(e.dynamicLayoutVertexArray,Mn.x,Mn.y,Mn.z,Le)}else Bh(e.dynamicLayoutVertexArray,w.x,w.y,w.z,Le);X.emplaceBack(Nt,Nt+1,Nt+2),X.emplaceBack(Nt+1,Nt+2,Nt+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(On[0]),Xe!==t.length-1&&vn===t[Xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,m,m.index,{},j,V,De&&De[vn])}const Je=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Je.x,Je.y,Je.z,w.x,w.y,fe,this.glyphOffsetArray.length-fe,ye,M,R,w.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],y,0,!1,0,L,0)}_commitLayoutVertex(e,t,s,u,f,m,y){e.emplaceBack(t,s,u,f,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,t,s,u,f,m,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,M=y.tileAnchorX,R=y.tileAnchorY;for(let j=0;j<4;j++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,R,new Ye(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,R,new Ye(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,R,new Ye(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,m,M,R,new Ye(e.x1,e.y2)),b.vertexLength+=4;const L=s.indexArray;L.emplaceBack(w,w+1),L.emplaceBack(w+1,w+2),L.emplaceBack(w+2,w+3),L.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,s,u,f,m){for(let y=u;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,m,t,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,t,s,u,f,m){for(let y=u;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(e,t,y);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cp(_s,$f.members,ao),this.iconCollisionBox=new cp(_s,$f.members,ao);const s=ou(this.iconSizeData,e),u=ou(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,t,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,t,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,t,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,t,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,t,s,u){const f=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:u),m=Th(this.textSizeData,e,f)/24;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,t,s){const u=this.icon.placedSymbolArray.get(s),f=Th(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,t,s){e.emplaceBack(t,-s,-s),e.emplaceBack(t,s,-s),e.emplaceBack(t,s,s),e.emplaceBack(t,-s,s)}_updateTextDebugCollisionBoxes(e,t,s,u,f,m){for(let y=u;y<f;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,m,t,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,t,s,u,f){for(let m=u;m<f;m++){const y=s.get(m),b=this.getSymbolInstanceIconSize(e,t,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=ou(this.iconSizeData,e),u=ou(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,t,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,t,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,t,m.iconBoxStartIndex,m.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,t,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,s,u,f,m,y,b,w){const M={};for(let R=t;R<s;R++){const L=e.get(R);M.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.textFeatureIndex=L.featureIndex;break}for(let R=u;R<f;R++){const L=e.get(R);M.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.verticalTextFeatureIndex=L.featureIndex;break}for(let R=m;R<y;R++){const L=e.get(R);M.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.iconFeatureIndex=L.featureIndex;break}for(let R=b;R<w;R++){const L=e.get(R);M.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,padding:L.padding,projectedAnchorX:L.projectedAnchorX,projectedAnchorY:L.projectedAnchorY,projectedAnchorZ:L.projectedAnchorZ,tileAnchorX:L.tileAnchorX,tileAnchorY:L.tileAnchorY},M.verticalIconFeatureIndex=L.featureIndex;break}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const s=e.placedSymbolArray.get(t),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),s=Math.cos(e),u=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(t*b.tileAnchorX+s*b.tileAnchorY)),f.push(b.featureIndex)}return m.sort((y,b)=>u[y]-u[b]||f[b]-f[y]),m}addToSortKeyRanges(e,t){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===t?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const s=this.symbolInstances.get(t);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((u,f,m)=>{u>=0&&m.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Yt(hl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hl.MAX_GLYPHS=65535,hl.addDynamicAttributes=Bh;const F_=new at({"symbol-placement":new Ce(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Ce(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ce(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Be(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ce(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ce(Ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ce(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ce(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ce(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Be(Ke.layout_symbol["icon-size"]),"icon-text-fit":new Ce(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ce(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Be(Ke.layout_symbol["icon-image"]),"icon-rotate":new Be(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Ce(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Ce(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Be(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Be(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ce(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ce(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ce(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Be(Ke.layout_symbol["text-field"]),"text-font":new Be(Ke.layout_symbol["text-font"]),"text-size":new Be(Ke.layout_symbol["text-size"]),"text-max-width":new Be(Ke.layout_symbol["text-max-width"]),"text-line-height":new Be(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Be(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Be(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Be(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ce(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Be(Ke.layout_symbol["text-anchor"]),"text-max-angle":new Ce(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Ce(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Be(Ke.layout_symbol["text-rotate"]),"text-padding":new Ce(Ke.layout_symbol["text-padding"]),"text-keep-upright":new Ce(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Be(Ke.layout_symbol["text-transform"]),"text-offset":new Be(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new Ce(Ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ce(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new Ce(Ke.layout_symbol["text-optional"])});var up={paint:new at({"icon-opacity":new Be(Ke.paint_symbol["icon-opacity"]),"icon-color":new Be(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Be(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Be(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Be(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Ce(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ce(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Be(Ke.paint_symbol["text-opacity"]),"text-color":new Be(Ke.paint_symbol["text-color"],{runtimeType:Er,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Be(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Be(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Be(Ke.paint_symbol["text-halo-blur"]),"text-translate":new Ce(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new Ce(Ke.paint_symbol["text-translate-anchor"])}),layout:F_};class Nh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:os,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt(Nh,"FormatSectionOverride",{omit:["defaultValue"]});class Gu extends vs{constructor(e){super(e,up)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,s,u){const f=this.layout.get(e).evaluate(t,{},s,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||ac(m.value)||!f?f:(y=t.properties,f.replace(/{([^{}]+)}/g,(w,M)=>M in y?String(y[M]):""));var y}createBucket(e){return new hl(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of up.paint.overridableProperties){if(!Gu.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),s=new Nh(t),u=new fa(s,t.property.specification);let f=null;f="constant"===t.value.kind||"source"===t.value.kind?new pa("source",u):new ma("composite",u,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new ve(t.property,f,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,s){return!(!this.layout||t.isDataDriven()||s.isDataDriven())&&Gu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const s=e.get("text-field"),u=up.paint.properties[t];let f=!1;const m=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof Ci)m(s.value.value.sections);else if("source"===s.value.kind){const y=w=>{f||(w instanceof ia&&ei(w.value)===mo?m(w.value.sections):w instanceof Na?m(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return f}getProgramConfiguration(e){return new Yc(this,e)}}var z_={paint:new at({"background-color":new Ce(Ke.paint_background["background-color"]),"background-pattern":new Mt(Ke.paint_background["background-pattern"]),"background-opacity":new Ce(Ke.paint_background["background-opacity"])})},hp={paint:new at({"raster-opacity":new Ce(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ce(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ce(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ce(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Ce(Ke.paint_raster["raster-saturation"]),"raster-contrast":new Ce(Ke.paint_raster["raster-contrast"]),"raster-resampling":new Ce(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Ce(Ke.paint_raster["raster-fade-duration"])})};class Km extends vs{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var qy={paint:new at({"sky-type":new Ce(Ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ce(Ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ce(Ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ce(Ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ce(Ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ve(Ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ce(Ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ce(Ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ce(Ke.paint_sky["sky-opacity"])})};function Jm(n,e,t){const s=[0,0,1],u=ld([]);return cd(u,u,t?-st(n)+Math.PI:st(n)),om(u,u,-st(e)),Ng(s,s,u),vo(s,s)}const dp={circle:class extends vs{constructor(n){super(n,ff)}createBucket(n){return new Hl(n)}queryRadius(n){const e=n;return Ea("circle-radius",this,e)+Ea("circle-stroke-width",this,e)+od(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,t,s,u,f,m,y){const b=Yp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,t)+this.paint.get("circle-stroke-width").evaluate(e,t);return wf(n,s,f,m,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Yc(this,n)}},heatmap:class extends vs{createBucket(n){return new ud(n)}constructor(n){super(n,$g),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ro({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Ea("heatmap-radius",this,n)}queryIntersectsFeature(n,e,t,s,u,f,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,t);return wf(n,s,f,m,y,!0,!0,new Ye(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Yc(this,n)}},hillshade:class extends vs{constructor(n){super(n,Tf)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends vs{constructor(n){super(n,pm)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(n){return new Yc(this,n)}recalculate(n,e){super.recalculate(n,e);const t=this.paint._values["fill-outline-color"];"constant"===t.value.kind&&void 0===t.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Xl(n)}queryRadius(){return od(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,t,s,u,f){return!n.queryGeometry.isAboveHorizon&&dh(Xp(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends vs{constructor(n){super(n,bd)}createBucket(n){return new bh(n)}queryRadius(){return od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Yc(this,n)}queryIntersectsFeature(n,e,t,s,u,f,m,y,b){const w=Yp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,t),R=this.paint.get("fill-extrusion-base").evaluate(e,t),L=[0,0],j=y&&f.elevation,V=f.elevation?f.elevation.exaggeration():1,X=n.tile.getBucket(this);if(j&&X instanceof bh){const we=X.centroidVertexArray,fe=b+1;if(fe<we.length){const ye=we.get(fe);L[0]=ye.a_centroid_pos0,L[1]=ye.a_centroid_pos1}}if(0===L[0]&&1===L[1])return!1;"globe"===f.projection.name&&(s=Bf([s],[new Ye(0,0),new Ye(an,an)],n.tileID.canonical).map(we=>we.polygon).flat());const ee=(fe=s,ye=R,Le=M,De=w,Je=m,Xe=j?y:null,lt=L,Lt=V,et=f.center.lat,"globe"===(we=f).projection.name?function(bt,ht,Rt,vt,qt,On,Un,vn,Nt,tr,Mn){const Kt=[],Nr=[],Or=bt.projection.upVectorScale(Mn,bt.center.lat,bt.worldSize).metersToTile,Kr=[0,0,0,1],Wn=[0,0,0,1],_r=(Fr,Pr,Zr,ri)=>{Fr[0]=Pr,Fr[1]=Zr,Fr[2]=ri,Fr[3]=1},$r=vd();Rt>0&&(Rt+=$r),vt+=$r;for(const Fr of ht){const Pr=[],Zr=[];for(const ri of Fr){const no=ri.x+qt.x,Zo=ri.y+qt.y,ur=bt.projection.projectTilePoint(no,Zo,Mn),di=bt.projection.upVector(Mn,ri.x,ri.y);let Eo=Rt,Ir=vt;if(Un){const fi=xm(no,Zo,Rt,vt,Un,vn,Nt,tr);Eo+=fi.base,Ir+=fi.top}0!==Rt?_r(Kr,ur.x+di[0]*Or*Eo,ur.y+di[1]*Or*Eo,ur.z+di[2]*Or*Eo):_r(Kr,ur.x,ur.y,ur.z),_r(Wn,ur.x+di[0]*Or*Ir,ur.y+di[1]*Or*Ir,ur.z+di[2]*Or*Ir),to(Kr,Kr,On),to(Wn,Wn,On),Pr.push(wd(Kr)),Zr.push(wd(Wn))}Kt.push(Pr),Nr.push(Zr)}return[Kt,Nr]}(we,fe,ye,Le,De,Je,Xe,lt,Lt,et,n.tileID.canonical):Xe?function(bt,ht,Rt,vt,qt,On,Un,vn,Nt){const tr=[],Mn=[],Kt=[0,0,0,1];for(const Nr of bt){const Or=[],Kr=[];for(const Wn of Nr){const _r=Wn.x+vt.x,$r=Wn.y+vt.y,Fr=xm(_r,$r,ht,Rt,On,Un,vn,Nt);Kt[0]=_r,Kt[1]=$r,Kt[2]=Fr.base,Kt[3]=1,vc(Kt,Kt,qt),Kt[3]=Math.max(Kt[3],1e-5);const Pr=wd([Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]]);Kt[0]=_r,Kt[1]=$r,Kt[2]=Fr.top,Kt[3]=1,vc(Kt,Kt,qt),Kt[3]=Math.max(Kt[3],1e-5);const Zr=wd([Kt[0]/Kt[3],Kt[1]/Kt[3],Kt[2]/Kt[3]]);Or.push(Pr),Kr.push(Zr)}tr.push(Or),Mn.push(Kr)}return[tr,Mn]}(fe,ye,Le,De,Je,Xe,lt,Lt,et):function(bt,ht,Rt,vt,qt){const On=[],Un=[],vn=qt[8]*ht,Nt=qt[9]*ht,tr=qt[10]*ht,Mn=qt[11]*ht,Kt=qt[8]*Rt,Nr=qt[9]*Rt,Or=qt[10]*Rt,Kr=qt[11]*Rt;for(const Wn of bt){const _r=[],$r=[];for(const Fr of Wn){const Pr=Fr.x+vt.x,Zr=Fr.y+vt.y,ri=qt[0]*Pr+qt[4]*Zr+qt[12],no=qt[1]*Pr+qt[5]*Zr+qt[13],Zo=qt[2]*Pr+qt[6]*Zr+qt[14],ur=qt[3]*Pr+qt[7]*Zr+qt[15],di=ri+vn,Eo=no+Nt,Ir=Zo+tr,fi=Math.max(ur+Mn,1e-5),Wo=ri+Kt,ii=no+Nr,vi=Zo+Or,co=Math.max(ur+Kr,1e-5),wr=new Ye(di/fi,Eo/fi);wr.z=Ir/fi,_r.push(wr);const uo=new Ye(Wo/co,ii/co);uo.z=vi/co,$r.push(uo)}On.push(_r),Un.push($r)}return[On,Un]}(fe,ye,Le,De,Je)),de=n.queryGeometry;var we,fe,ye,Le,De,Je,Xe,lt,Lt,et;return function(we,fe,ye){let Le=1/0;dh(ye,fe)&&(Le=jf(ye,fe[0]));for(let De=0;De<fe.length;De++){const Je=fe[De],Xe=we[De];for(let lt=0;lt<Je.length-1;lt++){const Lt=Je[lt],et=[Lt,Je[lt+1],Xe[lt+1],Xe[lt],Lt];Zp(ye,et)&&(Le=Math.min(Le,jf(ye,et)))}}return Le!==1/0&&Le}(ee[0],ee[1],de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends vs{constructor(n){super(n,Tm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ns,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=ta.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Eh(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Yc(this,n)}queryRadius(n){const e=n,t=Dm(Ea("line-width",this,e),Ea("line-gap-width",this,e)),s=Ea("line-offset",this,e);return t/2+Math.abs(s)+od(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,t,s,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const m=Xp(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*Dm(this.paint.get("line-width").evaluate(e,t),this.paint.get("line-gap-width").evaluate(e,t)),b=this.paint.get("line-offset").evaluate(e,t);return b&&(s=function(w,M){const R=[],L=new Ye(0,0);for(let j=0;j<w.length;j++){const V=w[j],X=[];for(let ee=0;ee<V.length;ee++){const de=V[ee-1],we=V[ee],fe=V[ee+1],ye=0===ee?L:we.sub(de)._unit()._perp(),Le=ee===V.length-1?L:fe.sub(we)._unit()._perp(),De=ye._add(Le)._unit();De._mult(1/(De.x*Le.x+De.y*Le.y)),X.push(De._mult(M)._add(we))}R.push(X)}return R}(s,b*n.pixelToTileUnitsFactor)),function(w,M,R){for(let L=0;L<M.length;L++){const j=M[L];if(w.length>=3)for(let V=0;V<j.length;V++)if(Jc(w,j[V]))return!0;if(Fg(w,j,R))return!0}return!1}(m,s,y)}isTileClipped(){return!0}},symbol:Gu,background:class extends vs{constructor(n){super(n,z_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends vs{constructor(n){super(n,hp)}getProgramIds(){return["raster"]}},sky:class extends vs{constructor(n){super(n,qy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ro({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=n.style.light,m=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&dn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Jm(m.azimuthal,90-m.polar,e):Jm(s[0],90-s[1],e)}const t=this.paint.get("sky-gradient-center");return Jm(t[0],90-t[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class Vd{constructor(e,t,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(t,u)}update(e,t,s){const{width:u,height:f}=e,{context:m}=this,{gl:y}=m,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:M,ImageData:R,ImageBitmap:L}=Fe;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!t||!1!==t.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:j,y:V}=s||{x:0,y:0};e instanceof b||e instanceof w||e instanceof M||e instanceof R||L&&e instanceof L?y.texSubImage2D(y.TEXTURE_2D,0,j,V,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,j,V,u,f,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof b||e instanceof w||e instanceof M||e instanceof R||L&&e instanceof L?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,f,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,t){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class $d{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new al({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const s=this.getKey(e,t);return this.positions[s]}trim(){const e=this.width,t=this.height=en(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,y=!0;u.push({left:f,right:m,isDash:y,zeroLength:0===e[0]});let b=e[0];for(let w=1;w<e.length;w++){y=!y;const M=e[w];f=b*s,b+=M,m=b*s,u.push({left:f,right:m,isDash:y,zeroLength:0===M})}return u}addRoundDash(e,t,s){const u=t/2;for(let f=-s;f<=s;f++){const m=this.width*(this.nextRow+s+f);let y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);const M=Math.abs(w-b.left),R=Math.abs(w-b.right),L=Math.min(M,R);let j;const V=f/s*(u+1);if(b.isDash){const X=u-Math.abs(V);j=Math.sqrt(L*L+X*X)}else j=u-Math.sqrt(L*L+V*V);this.image.data[m+w]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e,t){for(let b=e.length-1;b>=0;--b){const w=e[b],M=e[b+1];w.zeroLength?e.splice(b,1):M&&M.isDash===w.isDash&&(M.left=w.left,e.splice(b,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const w=Math.abs(b-y.left),M=Math.abs(b-y.right),R=Math.min(w,M);this.image.data[f+b]=Math.max(0,Math.min(255,(y.isDash?R:-R)+t+128))}}addDash(e,t){const s=this.getKey(e,t);if(this.positions[s])return this.positions[s];const u="round"===t,f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return dn("LineAtlas out of space"),null;0===e.length&&e.push(1);let y=0;for(let M=0;M<e.length;M++)e[M]<0&&(dn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),y+=e[M];if(0!==y){const M=this.width/y,R=this.getDashRanges(e,this.width,M);u?this.addRoundDash(R,M,f):this.addRegularDash(R,"square"===t?.5*M:0)}const b=this.nextRow+f;this.nextRow+=m;const w={tl:[b,f],br:[y,0]};return this.positions[s]=w,w}}Yt($d,"LineAtlas");class Qm{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class eg{constructor(){this.tasks={},this.taskQueue=[],Ge(["process"],this),this.invoker=new Qm(this.process),this.nextId=0}add(e,t){const s=this.nextId++,u=function({type:f,isSymbolTile:m,zoom:y}){return y=y||0,"message"===f?0:"maybePrepare"!==f||m?"parseTile"!==f||m?"parseTile"===f&&m?300-y:"maybePrepare"===f&&m?400-y:500:200-y:100-y}(t);if(0===u){qn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:t,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){qn();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<t&&(t=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class fp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const s=e[t];this._stringToNumber[s]=t,this._numberToString[t]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const pp=["tile","layer","source","sourceLayer","state"];class dl{constructor(e,t,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of pp)void 0!==this[t]&&(e[t]=this[t]);return e}}const na=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,t=0,s=0,u=0,f=0,m=0,y=0;for(1&e?u=f=m=32:t=s=y=32;(e>>=1)>1;){const w=t+u>>1,M=s+f>>1;1&e?(u=t,f=s,t=m,s=y):(t=u,s=f,u=m,f=y),m=w,y=M}const b=4*n;na[b+0]=t,na[b+1]=s,na[b+2]=u,na[b+3]=f}const fl=new Uint16Array(2178),pl=new Uint8Array(1089),Uh=new Uint16Array(1089);function tg(n){return 0===n?-.03125:32===n?.03125:0}var ng=mt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Hu={type:2,extent:an,loadGeometry:()=>[[new Ye(0,0),new Ye(8193,0),new Ye(8193,8193),new Ye(0,8193),new Ye(0,0)]]};class mp{constructor(e,t,s,u,f){this.tileID=e,this.uid=At(),this.uses=0,this.tileSize=t,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<si.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Sc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const m={};if(!f)return m;for(const y of u){const b=y.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(M=>M.id===w)[0]));for(const w of b)m[w.id]=y}}return m}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof hl){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof hl&&f.hasRTLText){this.hasRTLText=!0,re.isLoading()||re.isLoaded()||"deferred"!==K()||se();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ks}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vd(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vd(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vd(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,s,u,f,m,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:m,params:f,tileTransform:this.tileTransform},e,t,s):{}}querySourceFeatures(e,t){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=t?t.sourceLayer:"",m=u._geojsonTileLayer||u[f];if(!m)return;const y=fs(t&&t.filter),{z:b,x:w,y:M}=this.tileID.canonical,R={z:b,x:w,y:M};for(let L=0;L<m.length;L++){const j=m.feature(L);if(y.needGeometry){const ee=Gl(j,!0);if(!y.filter(new ne(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!y.filter(new ne(this.tileID.overscaledZ),j))continue;const V=s.getId(j,f),X=new dl(j,b,w,M,V);X.tile=R,e.push(X)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const s=oi(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(t)if(this.expirationTime<t)u=!0;else{const f=this.expirationTime-t;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const s=this.latestFeatureIndex.loadVTLayers(),u=t.style.listImages();for(const f in this.buckets){if(!t.style.hasLayer(f))continue;const m=this.buckets[f],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],w=e[y];if(!b||!w||0===Object.keys(w).length)continue;if(m.update(w,b,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof Eh||m instanceof Xl){const R=t.style._getSourceCache(m.layers[0].source);t._terrain&&t._terrain.enabled&&R&&m.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(R.id,this.tileID)}const M=t&&t.style&&t.style.getLayer(f);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<si.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=si.now()+e}setTexture(e,t){const s=t.context,u=s.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Vd(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,t){const s={};for(const u of t)s[u]=!0;this.dependencies[e]=s}hasDependency(e,t){for(const s of e){const u=this.dependencies[s];if(u)for(const f of t)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const s=$l(Hu,this.tileID.canonical,this.tileTransform)[0],u=new Vt,f=new ys;for(let m=0;m<s.length;m++){const{x:y,y:b}=s[m];u.emplaceBack(y,b),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Bu.members),this._tileDebugSegments=Vi.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const s=$l(Hu,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const m=function(y,b){const w=Sc(y,b),M=Math.pow(2,y.z);for(let ee=0;ee<33;ee++)for(let de=0;de<33;de++){const we=ea((y.x+(de+tg(de))/32)/M),fe=Po((y.y+(ee+tg(ee))/32)/M),ye=b.project(we,fe),Le=33*ee+de;fl[2*Le+0]=Math.round((ye.x*w.scale-w.x)*an),fl[2*Le+1]=Math.round((ye.y*w.scale-w.y)*an)}pl.fill(0),Uh.fill(0);for(let ee=2045;ee>=0;ee--){const de=4*ee,we=na[de+0],fe=na[de+1],ye=na[de+2],Le=na[de+3],De=we+ye>>1,Je=fe+Le>>1,Xe=De+Je-fe,lt=Je+we-De,Lt=33*fe+we,et=33*Le+ye,ut=33*Je+De,bt=Math.hypot((fl[2*Lt+0]+fl[2*et+0])/2-fl[2*ut+0],(fl[2*Lt+1]+fl[2*et+1])/2-fl[2*ut+1])>=16;if(pl[ut]=pl[ut]||(bt?1:0),ee<1022){const ht=33*(fe+lt>>1)+(we+Xe>>1),Rt=33*(Le+lt>>1)+(ye+Xe>>1);pl[ut]=pl[ut]||pl[ht]||pl[Rt]}}const R=new fn,L=new Zn;let j=0;function V(ee,de){const we=33*de+ee;return 0===Uh[we]&&(R.emplaceBack(fl[2*we+0],fl[2*we+1],ee*an/32,de*an/32),Uh[we]=++j),Uh[we]-1}function X(ee,de,we,fe,ye,Le){const De=ee+we>>1,Je=de+fe>>1;if(Math.abs(ee-ye)+Math.abs(de-Le)>1&&pl[33*Je+De])X(ye,Le,ee,de,De,Je),X(we,fe,ye,Le,De,Je);else{const Xe=V(ee,de),lt=V(we,fe),Lt=V(ye,Le);L.emplaceBack(Xe,lt,Lt)}}return X(0,0,32,32,32,0),X(32,32,0,0,0,32),{vertices:R,indices:L}}(this.tileID.canonical,t);u=m.vertices,f=m.indices}else{u=new fn,f=new Zn;for(const{x:y,y:b}of s)u.emplaceBack(y,b,0,0);const m=lo(u.int16,void 0,4);for(let y=0;y<m.length;y+=3)f.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,ng.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Vi.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,t){const s=t.projection;if(!s||"globe"!==s.name||t.freezeTileCoverage)return;const u=this.tileID.canonical,f=uu(jm(u,t)),m=hu(t.zoom);let y;m>0&&(y=Jp(new Float64Array(16),t.globeMatrix));const b=(u.x+.5)/(1<<u.z)-ol(t.center.lng);let w=0;b>.5?w=-1:b<-.5&&(w=1),this._makeGlobeTileDebugBorderBuffer(e,u,t,f,y,m,w),this._makeGlobeTileDebugTextBuffer(e,u,t,f,y,m,w)}_globePoint(e,t,s,u,f,m,y,b){let w=kh(e,t,s);if(m){const M=1<<s.z,R=[((e/an+s.x)/M+b)*u,(t/an+s.y)/M*u,0];to(R,R,m),w=Ni(w,R,y)}return to(w,w,f)}_makeGlobeTileDebugBorderBuffer(e,t,s,u,f,m,y){const b=new Vt,w=new ys,M=new nn,R=(j,V,X,ee,de)=>{const we=(X-j)/(de-1),fe=(ee-V)/(de-1),ye=b.length;for(let Le=0;Le<de;Le++){const De=j+Le*we,Je=V+Le*fe;b.emplaceBack(De,Je);const Xe=this._globePoint(De,Je,t,s.worldSize,u,f,m,y);M.emplaceBack(Xe[0],Xe[1],Xe[2]),w.emplaceBack(ye+Le)}},L=an;R(0,0,L,0,16),R(L,0,L,L,16),R(L,L,0,L,16),R(0,L,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(b,Bu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(M,Bm.members),this._tileDebugSegments=Vi.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugTextBuffer(e,t,s,u,f,m,y){const b=new Vt,w=new Zn,M=new nn,R=25;w.reserve(32),b.reserve(R),M.reserve(R);const L=(j,V)=>R*j+V;for(let j=0;j<R;j++){const V=2048*j;for(let X=0;X<R;X++){const ee=2048*X;b.emplaceBack(ee,V);const de=this._globePoint(ee,V,t,s.worldSize,u,f,m,y);M.emplaceBack(de[0],de[1],de[2])}}for(let j=0;j<4;j++)for(let V=0;V<4;V++){const X=L(j,V),ee=L(j,V+1),de=L(j+1,V),we=L(j+1,V+1);w.emplaceBack(X,ee,de),w.emplaceBack(de,ee,we)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,Bu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,Bm.members),this._tileDebugTextSegments=Vi.simpleSegment(0,0,R,32)}}class Xy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,s){const u=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},xt(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,t,s){if(null===this.deletedStates[e])return;const u=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==t)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,t){const s=String(t),u=xt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][t];if(null===f)return{};for(const m in f)delete u[m]}return u}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),xt(this.state[u][m],this.stateChanges[u][m]),f[m]=this.state[u][m];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const m in this.state[u])f[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(null===this.deletedStates[u][m])this.state[u][m]={};else for(const y of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][y];f[m]=this.state[u][m]}s[u]=s[u]||{},xt(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,t)}}class rg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const s=this.toIdx(e,t);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function B_(n,e,t,s){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(t[m]<n[m]||t[m]>e[m])return null}else{const y=1/s[m];let b=(n[m]-t[m])*y,w=(e[m]-t[m])*y;if(b>w){const M=b;b=w,w=M}if(b>u&&(u=b),w<f&&(f=w),u>f)return null}return u}function ig(n,e,t,s,u,f,m,y,b,w,M){const R=s-n,L=u-e,j=f-t,V=m-n,X=y-e,ee=b-t,de=M[1]*ee-M[2]*X,we=M[2]*V-M[0]*ee,fe=M[0]*X-M[1]*V,ye=R*de+L*we+j*fe;if(Math.abs(ye)<1e-15)return null;const Le=1/ye,De=w[0]-n,Je=w[1]-e,Xe=w[2]-t,lt=(De*de+Je*we+Xe*fe)*Le;if(lt<0||lt>1)return null;const Lt=Je*j-Xe*L,et=Xe*R-De*j,ut=De*L-Je*R,bt=(M[0]*Lt+M[1]*et+M[2]*ut)*Le;return bt<0||lt+bt>1?null:(V*Lt+X*et+ee*ut)*Le}function og(n,e,t){return(n-e)/(t-e)}function sg(n,e,t,s,u,f,m,y,b){const w=1<<t,M=f-s,R=m-u,L=(n+1)/w*M+s,j=(e+0)/w*R+u,V=(e+1)/w*R+u;y[0]=(n+0)/w*M+s,y[1]=j,b[0]=L,b[1]=V}class ag{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(f){const m=Math.ceil(Math.log2(f.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const w=1/b,M=(j,V,X,ee,de)=>{const we=ee?1:0,fe=(j+1)*X-we,ye=V*X,Le=(V+1)*X-we;de[0]=j*X,de[1]=ye,de[2]=fe,de[3]=Le};let R=new rg(b);const L=[];for(let j=0;j<b*b;j++){M(j%b,Math.floor(j/b),w,!1,L);const V=ml(L[0],L[1],f),X=ml(L[2],L[1],f),ee=ml(L[2],L[3],f),de=ml(L[0],L[3],f);R.minimums.push(Math.min(V,X,ee,de)),R.maximums.push(Math.max(V,X,ee,de)),R.leaves.push(1)}for(y.push(R),b/=2;b>=1;b/=2){const j=y[y.length-1];R=new rg(b);for(let V=0;V<b*b;V++){M(V%b,Math.floor(V/b),2,!0,L);const X=j.getElevation(L[0],L[1]),ee=j.getElevation(L[2],L[1]),de=j.getElevation(L[2],L[3]),we=j.getElevation(L[0],L[3]),fe=j.isLeaf(L[0],L[1]),ye=j.isLeaf(L[2],L[1]),Le=j.isLeaf(L[2],L[3]),De=j.isLeaf(L[0],L[3]),Je=Math.min(X.min,ee.min,de.min,we.min),Xe=Math.max(X.max,ee.max,de.max,we.max),lt=fe&&ye&&Le&&De;R.maximums.push(Xe),R.minimums.push(Je),R.leaves.push(Xe-Je<=5&&lt?1:0)}y.push(R)}return y}(this.dem),s=t.length-1,u=t[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(t,0,0,s,0)}raycastRoot(e,t,s,u,f,m,y=1){return B_([e,t,-100],[s,u,this.maximums[0]*y],f,m)}raycast(e,t,s,u,f,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,t,s,u,f,m,y);if(null==b)return null;const w=[],M=[],R=[],L=[],j=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:V,t:X,nodex:ee,nodey:de,depth:we}=j.pop();if(this.leaves[V]){sg(ee,de,we,e,t,s,u,R,L);const ye=1<<we,Le=(ee+0)/ye,De=(ee+1)/ye,Je=(de+0)/ye,Xe=(de+1)/ye,lt=ml(Le,Je,this.dem)*y,Lt=ml(De,Je,this.dem)*y,et=ml(De,Xe,this.dem)*y,ut=ml(Le,Xe,this.dem)*y,bt=ig(R[0],R[1],lt,L[0],R[1],Lt,L[0],L[1],et,f,m),ht=ig(L[0],L[1],et,R[0],L[1],ut,R[0],R[1],lt,f,m),Rt=Math.min(null!==bt?bt:Number.MAX_VALUE,null!==ht?ht:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const vt=gf([],f,m,X);if(gp(lt,Lt,ut,et,og(vt[0],R[0],L[0]),og(vt[1],R[1],L[1]))>=vt[2])return X}continue}let fe=0;for(let ye=0;ye<this._siblingOffset.length;ye++){sg((ee<<1)+this._siblingOffset[ye][0],(de<<1)+this._siblingOffset[ye][1],we+1,e,t,s,u,R,L),R[2]=-100,L[2]=this.maximums[this.childOffsets[V]+ye]*y;const Le=B_(R,L,f,m);if(null!=Le){const De=Le;w[ye]=De;let Je=!1;for(let Xe=0;Xe<fe&&!Je;Xe++)De>=w[M[Xe]]&&(M.splice(Xe,0,ye),Je=!0);Je||(M[fe]=ye),fe++}}for(let ye=0;ye<fe;ye++){const Le=M[ye];j.push({idx:this.childOffsets[V]+Le,t:w[Le],nodex:(ee<<1)+this._siblingOffset[Le][0],nodey:(de<<1)+this._siblingOffset[Le][1],depth:we+1})}}return null}_addNode(e,t,s){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,s,u,f){if(1===e[u].isLeaf(t,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,y=e[m];let b=0,w=0;for(let M=0;M<this._siblingOffset.length;M++){const R=2*t+this._siblingOffset[M][0],L=2*s+this._siblingOffset[M][1],j=y.getElevation(R,L),V=y.isLeaf(R,L),X=this._addNode(j.min,j.max,V);V&&(b|=1<<M),w||(w=X)}for(let M=0;M<this._siblingOffset.length;M++)b&1<<M||this._construct(e,2*t+this._siblingOffset[M][0],2*s+this._siblingOffset[M][1],m,w+M)}}function gp(n,e,t,s,u,f){return Xn(Xn(n,t,f),Xn(e,s,f),u)}function ml(n,e,t){const s=t.dim,u=$t(n*s-.5,0,s-1),f=$t(e*s-.5,0,s-1),m=Math.floor(u),y=Math.floor(f),b=Math.min(m+1,s-1),w=Math.min(y+1,s-1);return gp(t.get(m,y),t.get(b,y),t.get(m,w),t.get(b,w),u-m,f-y)}const lg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Zu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,s,u=!1,f=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return dn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const m=this.dim=t.height-2,y=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let b=0;b<m;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(m,b)]=y[this._idx(m-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,m)]=y[this._idx(b,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ag(this)}get(e,t,s=!1){s&&(e=$t(e,-1,this.dim),t=$t(t,-1,this.dim));const u=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return lg[e]}get unpackVector(){return lg[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,s){return(256*e*256+256*t+s)/10-1e4}_unpackTerrarium(e,t,s){return 256*e+t+s/256-32768}static pack(e,t){const s=[0,0,0,0],u=Zu.getUnpackVector(t);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new bs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=t*this.dim,f=t*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(t){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const b=-t*this.dim,w=-s*this.dim;for(let M=m;M<y;M++)for(let R=u;R<f;R++){const L=4*this._idx(R,M),j=4*this._idx(R+b,M+w);this.pixels[L+0]=e.pixels[j+0],this.pixels[L+1]=e.pixels[j+1],this.pixels[L+2]=e.pixels[j+2],this.pixels[L+3]=e.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Yt(Zu,"DEMData"),Yt(ag,"DemMinMaxQuadTree",{omit:["dem"]});class N_{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:t,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===t?0:this.data[s].indexOf(t),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||t.push(u);for(const s of t)this.remove(s.value.tileID,s)}}class Wu{constructor(e,t,s){this.func=e,this.mask=t,this.range=s}}Wu.ReadOnly=!1,Wu.ReadWrite=!0,Wu.disabled=new Wu(519,Wu.ReadOnly,[0,1]);class yp{constructor(e,t,s,u,f,m){this.test=e,this.ref=t,this.mask=s,this.fail=u,this.depthFail=f,this.pass=m}}yp.disabled=new yp({func:519,mask:0},0,0,7680,7680,7680);class gl{constructor(e,t,s){this.blendFunction=e,this.blendColor=t,this.mask=s}}gl.Replace=[1,0],gl.disabled=new gl(gl.Replace,vr.transparent,[!1,!1,!1,!1]),gl.unblended=new gl(gl.Replace,vr.transparent,[!0,!0,!0,!0]),gl.alphaBlended=new gl([1,771],vr.transparent,[!0,!0,!0,!0]);class ko{constructor(e,t,s){this.enable=e,this.mode=t,this.frontFace=s}}ko.disabled=new ko(!1,1029,2305),ko.backCCW=new ko(!0,1029,2305),ko.backCW=new ko(!0,1029,2304),ko.frontCW=new ko(!0,1028,2304),ko.frontCCW=new ko(!0,1028,2305);class Xu extends Zt{constructor(e,t,s){super(),this.id=e,this._onlySymbols=s,t.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new N_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Xy,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const s=this._tiles[t];this._source.prepareTile(s)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,s.tileID),s.upload(e),s.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const s=this._tiles[t];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return Ht(this._tiles).map(e=>e.tileID).sort(Yu).map(e=>e.key)}getRenderableIds(e){const t=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&t.push(this._tiles[s]);return e?t.sort((s,u)=>{const f=s.tileID,m=u.tileID,y=new Ye(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),b=new Ye(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||b.y-y.y||b.x-y.x}).map(s=>s.tileID.key):t.map(s=>s.tileID).sort(Yu).map(s=>s.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=t),this._loadTile(s,this._tileLoaded.bind(this,s,e,t)))}_tileLoaded(e,t,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new tn(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=si.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new wt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let u=0;u<t.length;u++){const f=t[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const m=this.getTileByID(f);s(e,m),s(m,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-u.tileID.canonical.x;const y=f.tileID.canonical.y-u.tileID.canonical.y,b=Math.pow(2,u.tileID.canonical.z),w=f.tileID.key;0===m&&0===y||Math.abs(y)>1||(Math.abs(m)>1&&(1===Math.abs(m+b)?m+=b:1===Math.abs(m-b)&&(m-=b)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,m,y),u.neighboringTiles&&u.neighboringTiles[w]&&(u.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,s,u){for(const f in this._tiles){let m=this._tiles[f];if(u[f]||!m.hasData()||m.tileID.overscaledZ<=t||m.tileID.overscaledZ>s)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>t+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>t;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){u[y.key]=y;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=t?s:null}for(let s=e.overscaledZ-1;s>=t;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const s=Math.ceil(e.width/t)+1,u=Math.ceil(e.height/t)+1,f=Math.floor(s*u*5),m="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+t),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,t,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new xo(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const f=this._updateRetainedTiles(u);if(cg(this._source.type)&&0!==u.length){const y={},b={},w=Object.keys(f);for(const R of w){const L=f[R],j=this._tiles[R];if(!j||j.fadeEndTime&&j.fadeEndTime<=si.now())continue;const V=this.findLoadedParent(L,Math.max(L.overscaledZ-Xu.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),y[V.tileID.key]=V.tileID),b[R]=L}const M=u[u.length-1].overscaledZ;for(const R in this._tiles){const L=this._tiles[R];if(f[R]||!L.hasData())continue;let j=L.tileID;for(;j.overscaledZ>M;){j=j.scaledTo(j.overscaledZ-1);const V=this._tiles[j.key];if(V&&V.hasData()&&b[j.key]){f[R]=L.tileID;break}}}for(const R in y)f[R]||(this._coveredTiles[R]=!0,f[R]=y[R])}for(const y in f)this._tiles[y].clearFadeHold();const m=function(y,b){const w=[];for(const M in y)M in b||w.push(M);return w}(this._tiles,f);for(const y of m){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const s={},u=e.reduce((w,M)=>Math.min(w,M.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-Xu.maxOverzooming,this._source.minzoom),y=Math.max(f+Xu.maxUnderzooming,this._source.minzoom),b={};for(const w of e){const M=this._addTile(w);t[w.key]=w,M.hasData()||u<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,u,y,t);for(const w of e){let M=this._tiles[w.key];if(M.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const L=w.children(this._source.maxzoom)[0],j=this.getTile(L);if(j&&j.hasData()){t[L.key]=L;continue}}else{const L=w.children(this._source.maxzoom);if(t[L[0].key]&&t[L[1].key]&&t[L[2].key]&&t[L[3].key])continue}let R=M.wasRequested();for(let L=w.overscaledZ-1;L>=m;--L){const j=w.scaledTo(L);if(s[j.key]||(s[j.key]=!0,M=this.getTile(j),!M&&R&&(M=this._addTile(j)),M&&(t[j.key]=j,R=M.wasRequested(),M.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}t.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of t)this._loadedParentTiles[f]=s}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const s=Boolean(t);if(!s){const u=this.map?this.map.painter:null;t=new mp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,s||this._source.fire(new wt("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=t.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,s){const u=[],f=this.transform;if(!f)return u;const m="globe"===f.projection.name,y=ol(f.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let M;if(m){const R=w.tileID.canonical;if(0===R.z){const L=[Math.abs($t(y,...jh(R,-1))-y),Math.abs($t(y,...jh(R,1))-y)];M=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs($t(y,...jh(R,-1))-y),Math.abs($t(y,...jh(R,0))-y),Math.abs($t(y,...jh(R,1))-y)];M=[L.indexOf(Math.min(...L))-1]}}else M=[0];for(const R of M){const L=e.containsTile(w,f,t,R);L&&u.push(L)}}return u}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of t)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(cg(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=si.now())return!0}return!1}setFeatureState(e,t,s){this._state.updateState(e=e||"_geojsonTileLayer",t,s)}removeFeatureState(e,t,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,s)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,s){const u=this._tiles[e];u&&u.setDependencies(t,s)}reloadTilesForDependencies(e,t){for(const s in this._tiles)this._tiles[s].hasDependency(e,t)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,t))}_preloadTiles(e,t){const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of u){const b=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)s.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}Qt(Array.from(s.values()),(y,b)=>{const w=new mp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,M=>{"raster-dem"===this._source.type&&w.dem&&this._backfillDEM(w),b(M,w)})},t)}}function Yu(n,e){const t=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-t||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function cg(n){return"raster"===n||"image"===n||"video"===n}function jh(n,e){const t=1<<n.z;return[n.x/t+e,(n.x+1)/t+e]}Xu.maxOverzooming=10,Xu.maxUnderzooming=3;class Ku{constructor(e,t,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=s}static create(e,t,s){const u=s||e.findDEMTileFor(t);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,y=1<<t.canonical.z-m.canonical.z;return new Ku(u,u.tileSize/an/y,[(t.canonical.x/y-m.canonical.x)*f.dim,(t.canonical.y/y-m.canonical.y)*f.dim])}tileCoordToPixel(e,t){const s=t*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new Ye(u,f)}getElevationAt(e,t,s,u){const f=e*this._scale+this._offset[0],m=t*this._scale+this._offset[1],y=Math.floor(f),b=Math.floor(m),w=this._dem;return u=!!u,s?Xn(Xn(w.get(y,b,u),w.get(y,b+1,u),m-b),Xn(w.get(y+1,b,u),w.get(y+1,b+1,u),m-b),f-y):w.get(y,b,u)}getElevationAtPixel(e,t,s){return this._dem.get(e,t,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Qs(1,e)*this._dem.stride}}class ug{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ms(an,16,0),this.featureIndexArray=new Lp,this.promoteId=t}insert(e,t,s,u,f,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,m);const b=this.grid;for(let w=0;w<t.length;w++){const M=t[w],R=[1/0,1/0,-1/0,-1/0];for(let L=0;L<M.length;L++){const j=M[L];R[0]=Math.min(R[0],j.x),R[1]=Math.min(R[1],j.y),R[2]=Math.max(R[2],j.x),R[3]=Math.max(R[3],j.y)}R[0]<an&&R[1]<an&&R[2]>=0&&R[3]>=0&&b.insert(y,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new iu.VectorTile(new Ch(this.rawTileData)).layers,this.sourceLayerCoder=new fp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,s,u){this.loadVTLayers();const f=e.params||{},m=fs(f.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,M=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(V,X,ee,de)=>Wp(y.bufferedTilespaceGeometry,V,X,ee,de));M.sort(Vh);let R=null;b.elevation&&M.length>0&&(R=Ku.create(b.elevation,this.tileID));const L={};let j;for(let V=0;V<M.length;V++){const X=M[V];if(X===j)continue;j=X;const ee=this.featureIndexArray.get(X);let de=null;this.loadMatchingFeature(L,ee,m,f.layers,f.availableImages,t,s,u,(we,fe,ye,Le=0)=>(de||(de=$l(we,this.tileID.canonical,e.tileTransform)),fe.queryIntersectsFeature(y,we,ye,de,this.z,e.transform,e.pixelPosMatrix,R,Le)))}return L}loadMatchingFeature(e,t,s,u,f,m,y,b,w){const{featureIndex:M,bucketIndex:R,sourceLayerIndex:L,layoutVertexArrayOffset:j}=t,V=this.bucketLayerIDs[R];if(u&&!function(we,fe){for(let ye=0;ye<we.length;ye++)if(fe.indexOf(we[ye])>=0)return!0;return!1}(u,V))return;const X=this.sourceLayerCoder.decode(L),ee=this.vtLayers[X].feature(M);if(s.needGeometry){const we=Gl(ee,!0);if(!s.filter(new ne(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!s.filter(new ne(this.tileID.overscaledZ),ee))return;const de=this.getId(ee,X);for(let we=0;we<V.length;we++){const fe=V[we];if(u&&u.indexOf(fe)<0)continue;const ye=m[fe];if(!ye)continue;let Le={};void 0!==de&&b&&(Le=b.getState(ye.sourceLayer||"_geojsonTileLayer",de));const De=xt({},y[fe]);De.paint=La(De.paint,ye.paint,ee,Le,f),De.layout=La(De.layout,ye.layout,ee,Le,f);const Je=!w||w(ee,ye,Le,j);if(!Je)continue;const Xe=new dl(ee,this.z,this.x,this.y,de);Xe.layer=De;let lt=e[fe];void 0===lt&&(lt=e[fe]=[]),lt.push({featureIndex:M,feature:Xe,intersectionZ:Je})}}lookupSymbolFeatures(e,t,s,u,f,m,y,b){const w={};this.loadVTLayers();const M=fs(f);for(const R of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:u,featureIndex:R,layoutVertexArrayOffset:0},M,m,y,b,t);return w}loadFeature(e){const{featureIndex:t,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[t])return f[t];const m=this.vtLayers[u].feature(t);return f[t]=m,m}hasLayer(e){for(const t of this.bucketLayerIDs)for(const s of t)if(e===s)return!0;return!1}getId(e,t){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof s&&(s=Number(s))),s}}function La(n,e,t,s,u){return We(n,(f,m)=>{const y=e instanceof Ae?e.get(m):null;return y&&y.evaluate?y.evaluate(t,s,u):y})}function Vh(n,e){return e-n}Yt(ug,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Lo{constructor(e){const t={},s=[];for(const y in e){const b=e[y],w=t[y]={};for(const M in b.glyphs){const R=b.glyphs[+M];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const L=R.metrics.localGlyph?2:1,j={x:0,y:0,w:R.bitmap.width+2*L,h:R.bitmap.height+2*L};s.push(j),w[M]=j}}const{w:u,h:f}=Zf(s),m=new al({width:u||1,height:f||1});for(const y in e){const b=e[y];for(const w in b.glyphs){const M=b.glyphs[+w];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const R=t[y][w],L=M.metrics.localGlyph?2:1;al.copy(M.bitmap,m,{x:0,y:0},{x:R.x+L,y:R.y+L},M.bitmap)}}this.image=m,this.positions=t}}Yt(Lo,"GlyphAtlas");class du{constructor(e){this.tileID=new xo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Sc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Ks;const m=new fp(Object.keys(e.layers).sort()),y=new ug(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new $d(256,256),M={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},R=t.familiesBySource[this.source];for(const Le in R){const De=e.layers[Le];if(!De)continue;let Je=!1,Xe=!1;for(const et of R[Le])"symbol"===et[0].type?Je=!0:Xe=!0;if(!0===this.isSymbolTile&&!Je||!1===this.isSymbolTile&&!Xe)continue;1===De.version&&dn(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const lt=m.encode(Le),Lt=[];for(let et=0;et<De.length;et++){const ut=De.feature(et),bt=y.getId(ut,Le);Lt.push({feature:ut,id:bt,index:et,sourceLayerIndex:lt})}for(const et of R[Le]){const ut=et[0];void 0!==this.isSymbolTile&&"symbol"===ut.type!==this.isSymbolTile||ut.minzoom&&this.zoom<Math.floor(ut.minzoom)||ut.maxzoom&&this.zoom>=ut.maxzoom||"none"!==ut.visibility&&(Ju(et,this.zoom,s),(b[ut.id]=ut.createBucket({index:y.bucketLayerIDs.length,layers:et,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:lt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Lt,M,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(et.map(bt=>bt.id)))}}let L,j,V,X;w.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},de=We(M.glyphDependencies,Le=>Object.keys(Le).map(Number));Object.keys(de).length?u.send("getGlyphs",{uid:this.uid,stacks:de},(Le,De)=>{L||(L=Le,j=De,ye.call(this))},void 0,!1,ee):j={};const we=Object.keys(M.iconDependencies);we.length?u.send("getImages",{icons:we,source:this.source,tileID:this.tileID,type:"icons"},(Le,De)=>{L||(L=Le,V=De,ye.call(this))},void 0,!1,ee):V={};const fe=Object.keys(M.patternDependencies);function ye(){if(L)return f(L);if(j&&V&&X){const Le=new Lo(j),De=new Rm(V,X);for(const Je in b){const Xe=b[Je];Xe instanceof hl?(Ju(Xe.layers,this.zoom,s),Hy(Xe,j,Le.positions,V,De.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Xe.hasPattern&&(Xe instanceof Eh||Xe instanceof Xl||Xe instanceof bh)&&(Ju(Xe.layers,this.zoom,s),Xe.addFeatures(M,this.tileID.canonical,De.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:Ht(b).filter(Je=>!Je.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Le.image,lineAtlas:w,imageAtlas:De,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?Le.positions:null})}}fe.length?u.send("getImages",{icons:fe,source:this.source,tileID:this.tileID,type:"patterns"},(Le,De)=>{L||(L=Le,X=De,ye.call(this))},void 0,!1,ee):X={},ye.call(this)}}function Ju(n,e,t){const s=new ne(e);for(const u of n)u.recalculate(s,t)}class Rs{constructor(e){this.entries={},this.scheduler=e}request(e,t,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[m,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(m,y)},t):u(m,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((m,y)=>{f.result=[m,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,y)},t):b(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Gd(n,e,t){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=$e(n.request,(m,y,b,w)=>{m?u(m):y&&u(null,{vectorTile:t?void 0:new iu.VectorTile(new Ch(y)),rawData:y,cacheControl:b,expires:w})});return()=>{f.cancel(),u()}},e)}c.ARRAY_TYPE=ns,c.AUTH_ERR_MSG=ft,c.Aabb=rs,c.Actor=class{constructor(n,e,t){this.target=n,this.parent=e,this.mapId=t,this.callbacks={},this.cancelCallbacks={},Ge(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=qn()?n:Fe,this.scheduler=new eg}send(n,e,t,s,u=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);t&&(t.metadata=f,this.callbacks[m]=t);const y=xi(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:n,hasCallback:!!t,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:el(e,y)},y),{cancel:()=>{t&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,t=e.id;if(t&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[t];delete this.cancelCallbacks[t],s&&s.cancel()}else if(e.mustQueue||qn()){const s=this.callbacks[t];this.cancelCallbacks[t]=this.scheduler.add(()=>this.processTask(t,e),s&&s.metadata||{type:"message"})}else this.processTask(t,e)}processTask(n,e){if("<response>"===e.type){const t=this.callbacks[n];delete this.callbacks[n],t&&(e.error?t(gs(e.error)):t(null,gs(e.data)))}else{const t=xi(this.globalScope)?void 0:[],s=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?el(f):null,data:el(m,t)},t)}:f=>{},u=gs(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=Lu,c.Color=vr,c.ColorMode=gl,c.CullFaceMode=ko,c.DEMData=Zu,c.DataConstantProperty=Ce,c.DedupedRequest=Rs,c.DepthMode=Wu,c.EXTENT=an,c.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(!e||n.y<0||n.y>1)return!1;const t=e.getSource().maxzoom,s=1<<t,u=Math.floor(n.x),f=Math.floor((n.x-u)*s),m=Math.floor(n.y*s),y=this.findDEMTileFor(new xo(t,u,t,f,m));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,t=!0){null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,m=Math.floor(n.x),y=n.x-m,b=new xo(u,m,u,Math.floor(y*f),Math.floor(n.y*f)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const M=w.dem,R=1<<w.tileID.canonical.z,L=(y*R-w.tileID.canonical.x)*M.dim,j=(n.y*R-w.tileID.canonical.y)*M.dim,V=Math.floor(L),X=Math.floor(j);return(t?this.exaggeration():1)*Xn(Xn(M.get(V,X),M.get(V,X+1),j-X),Xn(M.get(V+1,X),M.get(V+1,X+1),j-X),L-V)}getAtTileOffset(n,e,t){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Kc(n.wrap+(n.canonical.x+e/an)/s,(n.canonical.y+t/an)/s))}getAtTileOffsetFunc(n,e,t,s){return u=>{const f=this.getAtTileOffset(n,u.x,u.y),m=s.upVector(n.canonical,u.x,u.y);return sl(m,m,f*s.upVectorScale(n.canonical,e,t).metersToTile),m}}getForTilePoints(n,e,t,s){const u=Ku.create(this,n,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],t)}),!0)}getMinMaxForTile(n){const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const t=e.dem.tree,s=e.tileID,u=1<<n.canonical.z-s.canonical.z;let f=n.canonical.x/u-s.canonical.x,m=n.canonical.y/u-s.canonical.y,y=0;for(let b=0;b<n.canonical.z-s.canonical.z&&!t.leaves[y];b++){f*=2,m*=2;const w=2*Math.floor(m)+Math.floor(f);y=t.childOffsets[y]+w,f%=1,m%=1}return{min:this.exaggeration()*t.minimums[y],max:this.exaggeration()*t.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,t){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=tn,c.EvaluationParameters=ne,c.Event=wt,c.Evented=Zt,c.FillExtrusionBucket=bh,c.Frustum=bf,c.FrustumCorners=xf,c.GLOBE_METERS_TO_ECEF=zd,c.GLOBE_RADIUS=Pa,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const e=new Vt,t=new Zn,s=65;for(let u=0;u<s;u++)for(let f=0;f<s;f++)e.emplaceBack(f,u);this._gridSegments=[];for(let u=0,f=0;u<Dc.length;u++){const m=Dc[u];for(let b=0;b<m;b++)for(let w=0;w<64;w++){const M=b*s+w;t.emplaceBack(M+1,M,M+s),t.emplaceBack(M+s,M+s+1,M+1)}const y=64*m*2;this._gridSegments.push(Vi.simpleSegment(0,f,(m+1)*s,y)),f+=y}this._gridBuffer=n.createVertexBuffer(e,Bu.members),this._gridIndexBuffer=n.createIndexBuffer(t,!0)}_createPoles(n){const e=new Zn;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const t=new so,s=new so;this._poleSegments=[];for(let u=0,f=0;u<5;u++){const m=360/(1<<u);t.emplaceBack(0,-Pa,0,.5,0),s.emplaceBack(0,-Pa,0,.5,1);for(let y=0;y<=64;y++){const b=y/64,w=Xn(0,m,b),[M,R,L]=Ql(A_,$m,w,Pa);t.emplaceBack(M,R,L,b,0),s.emplaceBack(M,R,L,b,1)}this._poleSegments.push(Vi.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(t,Fd,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Fd,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const t=new ao,s=64,u=s+1;this._wireframeSegments=[];for(let f=0,m=0;f<Dc.length;f++){const y=Dc[f];for(let w=0;w<y;w++)for(let M=0;M<s;M++){const R=w*u+M;t.emplaceBack(R,R+1),t.emplaceBack(R,R+u),t.emplaceBack(R,R+u+1)}const b=y*s*3;this._wireframeSegments.push(Vi.simpleSegment(0,m,(y+1)*u,b)),m+=b}this._wireframeIndexBuffer=n.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=Ec,c.ImagePosition=Wf,c.LineAtlas=$d,c.LngLat=Cr,c.LngLatBounds=mc,c.LocalGlyphMode=Ph,c.MAX_MERCATOR_LATITUDE=xs,c.MercatorCoordinate=Kc,c.ONE_EM=24,c.OverscaledTileID=xo,c.Properties=at,c.RGBAImage=bs,c.Ray=tu,c.RequestManager=class{constructor(n,e,t){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!t,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qr,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!_e(n))return n;const t=it(n);return t.path=`/styles/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!_e(n))return n;const t=it(n);return t.path=`/fonts/v1${t.path}`,this._makeAPIURL(t,this._customAccessToken||e)}normalizeSourceURL(n,e,t,s){if(!_e(n))return n;const u=it(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),t&&u.params.push(`language=${t}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,t,s){const u=it(n);return _e(n)?(u.path=`/styles/v1${u.path}/sprite${e}${t}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${t}`,cn(u))}normalizeTileURL(n,e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!_e(n))return n;const s=it(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||t&&"raster"!==s.authority&&512===t?"@2x":""}${mn.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Bn.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Bn.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const m of f){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||Bn.ACCESS_TOKEN;return Bn.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(n,e){const t=it(n);if(!t.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!t.path.match(/\.[\w]+$/))return n;let s="mapbox://";t.path.match(/^\/raster\/v1\//)?s+=`raster/${t.path.replace(`/${Bn.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${t.path.replace(`/${Bn.TILE_URL_VERSION}/`,"")}`;let u=t.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(n,e){const t=!!e&&_e(e),s=[];for(const u of n.tiles||[])xe(u)?s.push(this.canonicalizeTileURL(u,t)):s.push(u);return s}_makeAPIURL(n,e){const t="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=it(Bn.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!Bn.REQUIRE_ACCESS_TOKEN)return cn(n);if(e=e||Bn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${t}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${t}`)}return n.params=n.params.filter(u=>-1===u.indexOf("access_token")),n.params.push(`access_token=${e||""}`),cn(n)}},c.ResourceType=Pe,c.SegmentVector=Vi,c.SourceCache=Xu,c.StencilMode=yp,c.StructArrayLayout1ui2=ys,c.StructArrayLayout2f1f2i16=xa,c.StructArrayLayout2i4=Vt,c.StructArrayLayout2ui4=ao,c.StructArrayLayout3f12=ui,c.StructArrayLayout3ui6=Zn,c.StructArrayLayout4i8=fn,c.StructArrayLayout5f20=so,c.Texture=Vd,c.Tile=mp,c.Transitionable=ae,c.Uniform1f=ah,c.Uniform1i=class extends Js{constructor(n){super(n),this.current=0}set(n,e,t){this.fetchUniformLocation(n,e)&&this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},c.Uniform2f=class extends Js{constructor(n){super(n),this.current=[0,0]}set(n,e,t){this.fetchUniformLocation(n,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1])))}},c.Uniform3f=class extends Js{constructor(n){super(n),this.current=[0,0,0]}set(n,e,t){this.fetchUniformLocation(n,e)&&(t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2])))}},c.Uniform4f=ba,c.UniformColor=Cu,c.UniformMatrix2f=class extends Js{constructor(n){super(n),this.current=jp}set(n,e,t){if(this.fetchUniformLocation(n,e))for(let s=0;s<4;s++)if(t[s]!==this.current[s]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},c.UniformMatrix3f=class extends Js{constructor(n){super(n),this.current=Up}set(n,e,t){if(this.fetchUniformLocation(n,e))for(let s=0;s<9;s++)if(t[s]!==this.current[s]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},c.UniformMatrix4f=class extends Js{constructor(n){super(n),this.current=Np}set(n,e,t){if(this.fetchUniformLocation(n,e)){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let s=1;s<16;s++)if(t[s]!==this.current[s]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}}},c.UnwrappedTileID=Uf,c.ValidationError=Xt,c.VectorTileWorkerSource=class extends Zt{constructor(n,e,t,s,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=t,this.loadVectorData=u||Gd,this.loading={},this.loaded={},this.deduped=new Rs(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const t=n.uid,s=n&&n.request,u=s&&s.collectResourceTiming,f=this.loading[t]=new du(n);f.abort=this.loadVectorData(n,(m,y)=>{const b=!this.loading[t];if(delete this.loading[t],b||m||!y)return f.status="done",b||(this.loaded[t]=f),e(m);const w=y.rawData,M={};y.expires&&(M.expires=y.expires),y.cacheControl&&(M.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new iu.VectorTile(new Ch(w));const R=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,j)=>{if(L||!j)return e(L);const V={};if(u){const X=Vn(s);X.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(X)))}e(null,xt({rawTileData:w.slice(0)},j,M,V))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[t]=f})}reloadTile(n,e){const t=this.loaded,s=n.uid,u=this;if(t&&t[s]){const f=t[s];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=Sc(n.tileID.canonical,n.projection);const m=(y,b)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,w)),e(y,b)};"parsing"===f.status?f.reloadCallback=m:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(n,e){const t=n.uid,s=this.loading[t];s&&(s.abort&&s.abort(),delete this.loading[t]),e()}removeTile(n,e){const t=this.loaded,s=n.uid;t&&t[s]&&delete t[s],e()}},c.WritingMode=Ms,c.ZoomHistory=Rr,c.add=yc,c.addDynamicAttributes=Bh,c.adjoint=function(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],m=e[4],y=e[5],b=e[6],w=e[7],M=e[8];return n[0]=m*M-y*w,n[1]=u*w-s*M,n[2]=s*y-u*m,n[3]=y*b-f*M,n[4]=t*M-u*b,n[5]=u*f-t*y,n[6]=f*w-m*b,n[7]=s*b-t*w,n[8]=t*m-s*f,n},c.asyncAll=Qt,c.bezier=hn,c.bindAll=Ge,c.boundsAttributes=ng,c.bufferConvexPolygon=function(n,e){const t=[];for(let s=0;s<n.length;s++){const u=rn(s-1,-1,n.length-1),f=rn(s+1,-1,n.length-1),m=n[s],y=n[f],b=n[u].sub(m).unit(),w=y.sub(m).unit(),M=w.angleWithSep(b.x,b.y),R=b.add(w).unit().mult(-1*e/Math.sin(M/2));t.push(m.add(R))}return t},c.cacheEntryPossiblyAdded=function(n){ge++,ge>Ar&&(n.getActor().send("enforceCacheSizeLimit",kn),ge=0)},c.calculateGlobeLabelMatrix=function(n,e){const{x:t,y:s}=n.point,u=rp(t,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Su(u,u,Oh(ul(e)))},c.calculateGlobeMatrix=function(n){const{x:e,y:t}=n.point,{lng:s,lat:u}=n._center;return rp(e,t,n.worldSize,s,u)},c.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,t=e/Qs(1,n.center.lat),s=Ta(new Float64Array(16));return Wl(s,s,[n.point.x,n.point.y,0]),Qc(s,s,[t,t,e]),Float32Array.from(s)},c.circumferenceAtLatitude=lf,c.clamp=$t,c.clearTileCache=function(n){const e=ue(),t=[];for(const s in bn)e&&t.push(e.delete(s)),delete bn[s];n&&Promise.all(t).catch(n).then(()=>n())},c.clipLine=w_,c.clone=function(n){var e=new ns(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},c.clone$1=dt,c.collisionCircleLayout=h_,c.config=Bn,c.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},c.create=function(){var n=new ns(16);return ns!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},c.create$1=Kp,c.createExpression=Wa,c.createLayout=mt,c.createStyleLayer=function(n){return"custom"===n.type?new Km(n):new dp[n.type](n)},c.cross=rm,c.degToRad=st,c.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},c.div=function(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n},c.dot=Da,c.ease=Cn,c.easeCubicInOut=xn,c.emitValidationErrors=dc,c.endsWith=ot,c.enforceCacheSizeLimit=function(n){for(const e in bn)G(e),bn[e].then(t=>{t.keys().then(s=>{for(let u=0;u<s.length-n;u++)t.delete(s[u])})})},c.evaluateSizeForFeature=Th,c.evaluateSizeForZoom=ou,c.evaluateVariableOffset=D_,c.evented=Z,c.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},c.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},c.exported=si,c.exported$1=mn,c.extend=xt,c.extend$1=mi,c.fillExtrusionHeightLift=vd,c.filterObject=Gt,c.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},c.fromQuat=function(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],m=t+t,y=s+s,b=u+u,w=t*m,M=s*m,R=s*y,L=u*m,j=u*y,V=u*b,X=f*m,ee=f*y,de=f*b;return n[0]=1-R-V,n[1]=M+de,n[2]=L-ee,n[3]=0,n[4]=M-de,n[5]=1-w-V,n[6]=j+X,n[7]=0,n[8]=L+ee,n[9]=j-X,n[10]=1-w-R,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},c.fromRotation=function(n,e){var t=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=t,n[2]=0,n[3]=-t,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},c.fromScaling=Qp,c.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Tt[e]},c.getAABBPointSquareDist=function(n,e,t){let s=0;for(let u=0;u<2;++u){const f=t?t[u]:0;n[u]>f&&(s+=(n[u]-f)*(n[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},c.getAnchorAlignment=Md,c.getAnchorJustification=Fm,c.getBounds=function(n){let e=1/0,t=1/0,s=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),t=Math.min(t,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new Ye(e,t),max:new Ye(s,u)}},c.getColumn=yr,c.getGridMatrix=function(n,e,t){const s=e.getNorth(),u=e.getSouth(),f=e.getWest(),m=.015625;return[0,(e.getEast()-f)*m,1<<n.z,(u-s)/Dc[t],0,n.y,s,f,m]},c.getImage=It,c.getJSON=function(n,e){return Re(xt(n,{type:"json"}),e)},c.getLatitudinalLod=function(n){const e=80.051129;n=$t(n,-80.051129,e)/e*90;const t=Math.pow(Math.abs(Math.sin(st(n))),3);return Math.round(t*(Dc.length-1))},c.getMapSessionAPI=zr,c.getPerformanceMeasurement=Vn,c.getProjection=ka,c.getRTLTextPluginStatus=K,c.getReferrer=Ne,c.getTilePoint=function(n,{x:e,y:t},s=0){return new Ye(((e-s)*n.scale-n.x)*an,(t*n.scale-n.y)*an)},c.getTileVec3=function(n,e,t=0){return eu(((e.x-t)*n.scale-n.x)*an,(e.y*n.scale-n.y)*an,Og(e.z,e.y))},c.getVideo=function(n,e){const t=Fe.document.createElement("video");t.muted=!0,t.onloadstart=function(){e(null,t)};for(let s=0;s<n.length;s++){const u=Fe.document.createElement("source");le(n[s])||(t.crossOrigin="Anonymous"),u.src=n[s],t.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(n){const e=[0,0,0],t=Ta(new Float64Array(16));return Su(t,n.pixelMatrix,n.globeMatrix),to(e,e,t),new Ye(e[0],e[1])},c.globeDenormalizeECEF=Oh,c.globeECEFOrigin=function(n,e){const t=[0,0,0];return to(t,t,uu(ul(e.canonical))),to(t,t,n),t},c.globeNormalizeECEF=uu,c.globePixelsToTileUnits=function(n,e){return an/(512*Math.pow(2,n))*Lh(ul(e))},c.globePoleMatrixForTile=function(n,e,t){const s=Ta(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return _c(s,t.globeMatrix,u),Float32Array.from(s)},c.globeTileBounds=ul,c.globeTiltAtLngLat=Vm,c.globeToMercatorTransition=hu,c.globeUseCustomAntiAliasing=function(n,e,t){const s=hu(t.zoom),u=n.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!u&&!m&&f},c.identity=Ta,c.identity$1=ld,c.invert=Jp,c.isFullscreen=function(){return!!Fe.document.fullscreenElement||!!Fe.document.webkitFullscreenElement},c.isLngLatBehindGlobe=function(n,e){return Vm(n,e)>Math.PI/2*1.01},c.isMapAuthenticated=function(n){return dr.has(n)},c.isMapboxURL=_e,c.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!xi(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=Po,c.len=_f,c.length=ph,c.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},c.loadVectorTile=Gd,c.makeRequest=Re,c.mapValue=function(n,e,t,s,u){return $t((n-e)/(t-e)*(u-s)+s,s,u)},c.mercatorScale=Qh,c.mercatorXfromLng=ol,c.mercatorYfromLat=Vl,c.mercatorZfromAltitude=Qs,c.mul=em,c.mul$1=im,c.multiply=Su,c.multiply$1=function(n,e,t){var s=e[0],u=e[1],f=e[2],m=e[3],y=e[4],b=e[5],w=e[6],M=e[7],R=e[8],L=t[0],j=t[1],V=t[2],X=t[3],ee=t[4],de=t[5],we=t[6],fe=t[7],ye=t[8];return n[0]=L*s+j*m+V*w,n[1]=L*u+j*y+V*M,n[2]=L*f+j*b+V*R,n[3]=X*s+ee*m+de*w,n[4]=X*u+ee*y+de*M,n[5]=X*f+ee*b+de*R,n[6]=we*s+fe*m+ye*w,n[7]=we*u+fe*y+ye*M,n[8]=we*f+fe*b+ye*R,n},c.multiply$2=nm,c.nextPowerOfTwo=en,c.normalize=vo,c.normalize$1=function(n,e){var t=e[0],s=e[1],u=e[2],f=e[3],m=t*t+s*s+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),n[0]=t*m,n[1]=s*m,n[2]=u*m,n[3]=f*m,n},c.number=Xn,c.ortho=function(n,e,t,s,u,f,m){var y=1/(e-t),b=1/(s-u),w=1/(f-m);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+t)*y,n[13]=(u+s)*b,n[14]=(m+f)*w,n[15]=1,n},c.pbf=Ch,c.perspective=function(n,e,t,s,u){var f,m=1/Math.tan(e/2);return n[0]=m/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=u&&u!==1/0?(n[10]=(u+s)*(f=1/(s-u)),n[14]=2*u*s*f):(n[10]=-1,n[14]=-2*s),n},c.pick=function(n,e){const t={};for(let s=0;s<e.length;s++){const u=e[s];u in n&&(t[u]=n[u])}return t},c.plugin=re,c.pointGeometry=Ye,c.polygonContainsPoint=Jc,c.polygonIntersectsBox=Wp,c.polygonIntersectsPolygon=Zp,c.polygonizeBounds=function(n,e,t=0,s=!0){const u=new Ye(t,t),f=n.sub(u),m=e.add(u),y=[f,new Ye(m.x,f.y),m,new Ye(f.x,m.y)];return s&&y.push(f.clone()),y},c.posAttributes=Bu,c.postMapLoadEvent=ai,c.postTurnstileEvent=Ur,c.potpack=Zf,c.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},c.radToDeg=un,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(n){return n({pluginStatus:C,pluginURL:A}),Z.on("pluginStateChange",n),n},c.removeAuthState=function(n){dr.delete(n)},c.renderColorRamp=Ro,c.resample=cf,c.rotateX=gc,c.rotateX$1=om,c.rotateY=_c,c.rotateY$1=cd,c.rotateZ=function(n,e,t){var s=Math.sin(t),u=Math.cos(t),f=e[0],m=e[1],y=e[2],b=e[3],w=e[4],M=e[5],R=e[6],L=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+w*s,n[1]=m*u+M*s,n[2]=y*u+R*s,n[3]=b*u+L*s,n[4]=w*u-f*s,n[5]=M*u-m*s,n[6]=R*u-y*s,n[7]=L*u-b*s,n},c.rotateZ$1=function(n,e,t){t*=.5;var s=e[0],u=e[1],f=e[2],m=e[3],y=Math.sin(t),b=Math.cos(t);return n[0]=s*b+u*y,n[1]=u*b-s*y,n[2]=f*b+m*y,n[3]=m*b-f*y,n},c.scale=Qc,c.scale$1=yf,c.scale$2=sl,c.scaleAndAdd=gf,c.setCacheLimits=function(n,e){kn=n,Ar=e},c.setColumn=function(n,e,t){n[4*e+0]=t[0],n[4*e+1]=t[1],n[4*e+2]=t[2],n[4*e+3]=t[3]},c.setRTLTextPlugin=function(n,e,t=!1){if(C===p||C===_||C===v)throw new Error("setRTLTextPlugin cannot be called multiple times.");A=si.resolveURL(n),C=p,E=e,N(),t||se()},c.smoothstep=nr,c.spec=Ke,c.storeAuthState=function(n,e){e?dr.add(n):dr.delete(n)},c.sub=Ca,c.subtract=mh,c.symbolSize=Im,c.tileAABB=function(n,e,t,s,u,f,m,y,b){if("globe"===b.name)return function Nu(n,e,t){const s=e/n.worldSize,u=Number.MAX_VALUE,f=[-u,-u,-u],m=[u,u,u],y=n.globeMatrix;if(t.z<=1)return Rh(m,f,ul(t).getCorners(),y,s),new rs(m,f);const b=Uu(t),w=Cc(b);if(Rh(m,f,w,y,s),b.contains(n.center)){f[2]=0;const Je=n.point,Xe=[Je.x*s,Je.y*s,0];return mf(m,m,Xe),gh(f,f,Xe),new rs(m,f)}const M=[y[12]*s,y[13]*s,y[14]*s],R=b.getCenter(),L=$t(n.center.lat,-85.051129,xs),j=$t(R.lat,-85.051129,xs),V=ol(n.center.lng),X=Vl(L);let ee=V-ol(R.lng);const de=X-Vl(j);ee>.5?ee-=1:ee<-.5&&(ee+=1);let we=0;Math.abs(ee)>Math.abs(de)?we=ee>=0?1:3:(we=de>=0?0:2,gf(M,M,[y[4]*s,y[5]*s,y[6]*s],-Math.sin(st(de>=0?b.getSouth():b.getNorth()))*Pa));const fe=w[we],ye=w[(we+1)%4],Le=new S_(fe,ye,M),De=[Bd(Le,0)||fe[0],Bd(Le,1)||fe[1],Bd(Le,2)||fe[2]];return m[2]=Math.min(fe[2],ye[2]),mf(m,m,De),gh(f,f,De),new rs(m,f)}(n,e,new Lu(t,s,u));const w=Sc({z:t,x:s,y:u},b);return new rs([(f+w.x/w.scale)*e,e*(w.y/w.scale),m],[(f+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},c.tileCornersToBounds=Uu,c.tileTransform=Sc,c.transformMat3=function(n,e,t){var s=e[0],u=e[1],f=e[2];return n[0]=s*t[0]+u*t[3]+f*t[6],n[1]=s*t[1]+u*t[4]+f*t[7],n[2]=s*t[2]+u*t[5]+f*t[8],n},c.transformMat4=to,c.transformMat4$1=vc,c.transformQuat=Ng,c.transitionTileAABBinECEF=jm,c.translate=Wl,c.transpose=function(n,e){if(n===e){var t=e[1],s=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=t,n[5]=e[7],n[6]=s,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},c.triggerPluginCompletionEvent=z,c.uniqueId=At,c.updateGlobeVertexNormal=function(n,e,t,s,u){const f=5*e+2;n.float32[f+0]=t,n.float32[f+1]=s,n.float32[f+2]=u},c.validateCustomStyleLayer=function(n){const e=[],t=n.id;return void 0===t&&e.push({message:`layers.${t}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${t}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${t}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=n=>es(Qo(n)),c.validateFog=n=>es(Pi(n)),c.validateLayer=n=>es(Ll(n)),c.validateLight=n=>es(Ka(n)),c.validateSource=n=>es(Ol(n)),c.validateStyle=ya,c.validateTerrain=n=>es(Fl(n)),c.values=Ht,c.vectorTile=iu,c.version="2.10.0",c.warnOnce=dn,c.window=Fe,c.wrap=rn}),Ie(0,function(c){function Fe(ue){if("number"==typeof ue||"boolean"==typeof ue||"string"==typeof ue||null==ue)return JSON.stringify(ue);if(Array.isArray(ue)){let q="[";for(const he of ue)q+=`${Fe(he)},`;return`${q}]`}let G="{";for(const q of Object.keys(ue).sort())G+=`${q}:${Fe(ue[q])},`;return`${G}}`}function Jt(ue){let G="";for(const q of c.refProperties)G+=`/${Fe(ue[q])}`;return G}class kt{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,q){for(const ge of G)this._layerConfigs[ge.id]=ge,(this._layers[ge.id]=c.createStyleLayer(ge)).compileFilter(),this.keyCache[ge.id]&&delete this.keyCache[ge.id];for(const ge of q)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const he=function(ge,Pe){const Ue={};for(let Re=0;Re<ge.length;Re++){const $e=Pe&&Pe[ge[Re].id]||Jt(ge[Re]);Pe&&(Pe[ge[Re].id]=$e);let pt=Ue[$e];pt||(pt=Ue[$e]=[]),pt.push(ge[Re])}const Ne=[];for(const Re in Ue)Ne.push(Ue[Re]);return Ne}(c.values(this._layerConfigs),this.keyCache);for(const ge of he){const Pe=ge.map(Ee=>this._layers[Ee.id]),Ue=Pe[0];if("none"===Ue.visibility)continue;const Ne=Ue.source||"";let Re=this.familiesBySource[Ne];Re||(Re=this.familiesBySource[Ne]={});const $e=Ue.sourceLayer||"_geojsonTileLayer";let pt=Re[$e];pt||(pt=Re[$e]=[]),pt.push(Pe)}}}class Ye{loadTile(G,q){const{uid:he,encoding:ge,rawImageData:Pe,padding:Ue,buildQuadTree:Ne}=G,Re=c.window.ImageBitmap&&Pe instanceof c.window.ImageBitmap?this.getImageData(Pe,Ue):Pe;q(null,new c.DEMData(he,Re,ge,Ue<1,Ne))}getImageData(G,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const he=this.offscreenCanvasContext.getImageData(-q,-q,G.width+2*q,G.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}var gt=function ue(G,q){var he,ge=G&&G.type;if("FeatureCollection"===ge)for(he=0;he<G.features.length;he++)ue(G.features[he],q);else if("GeometryCollection"===ge)for(he=0;he<G.geometries.length;he++)ue(G.geometries[he],q);else if("Feature"===ge)ue(G.geometry,q);else if("Polygon"===ge)yt(G.coordinates,q);else if("MultiPolygon"===ge)for(he=0;he<G.coordinates.length;he++)yt(G.coordinates[he],q);return G};function yt(ue,G){if(0!==ue.length){tt(ue[0],G);for(var q=1;q<ue.length;q++)tt(ue[q],!G)}}function tt(ue,G){for(var q=0,he=0,ge=0,Pe=ue.length,Ue=Pe-1;ge<Pe;Ue=ge++){var Ne=(ue[ge][0]-ue[Ue][0])*(ue[Ue][1]+ue[ge][1]),Re=q+Ne;he+=Math.abs(q)>=Math.abs(Ne)?q-Re+Ne:Ne-Re+q,q=Re}q+he>=0!=!!G&&ue.reverse()}const st=c.vectorTile.VectorTileFeature.prototype.toGeoJSON;class un{constructor(G){this._feature=G,this.extent=c.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(1===this._feature.type){const G=[];for(const q of this._feature.geometry)G.push([new c.pointGeometry(q[0],q[1])]);return G}{const G=[];for(const q of this._feature.geometry){const he=[];for(const ge of q)he.push(new c.pointGeometry(ge[0],ge[1]));G.push(he)}return G}}toGeoJSON(G,q,he){return st.call(this,G,q,he)}}class Tt{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=G.length,this._features=G}feature(G){return new un(this._features[G])}}var xn=c.vectorTile.VectorTileFeature,hn=Cn;function Cn(ue,G){this.options=G||{},this.features=ue,this.length=ue.length}function $t(ue,G){this.id="number"==typeof ue.id?ue.id:void 0,this.type=ue.type,this.rawGeometry=1===ue.type?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=G||4096}Cn.prototype.feature=function(ue){return new $t(this.features[ue],this.options.extent)},$t.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var G=0;G<ue.length;G++){for(var q=ue[G],he=[],ge=0;ge<q.length;ge++)he.push(new c.pointGeometry(q[ge][0],q[ge][1]));this.geometry.push(he)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,G=1/0,q=-1/0,he=1/0,ge=-1/0,Pe=0;Pe<ue.length;Pe++)for(var Ue=ue[Pe],Ne=0;Ne<Ue.length;Ne++){var Re=Ue[Ne];G=Math.min(G,Re.x),q=Math.max(q,Re.x),he=Math.min(he,Re.y),ge=Math.max(ge,Re.y)}return[G,he,q,ge]},$t.prototype.toGeoJSON=xn.prototype.toGeoJSON;var nr=Qt,rn=hn;function Qt(ue){var G=new c.pbf;return function(q,he){for(var ge in q.layers)he.writeMessage(3,Ht,q.layers[ge])}(ue,G),G.finish()}function Ht(ue,G){var q;G.writeVarintField(15,ue.version||1),G.writeStringField(1,ue.name||""),G.writeVarintField(5,ue.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ue.length;q++)he.feature=ue.feature(q),G.writeMessage(2,xt,he);var ge=he.keys;for(q=0;q<ge.length;q++)G.writeStringField(3,ge[q]);var Pe=he.values;for(q=0;q<Pe.length;q++)G.writeMessage(4,Ze,Pe[q])}function xt(ue,G){var q=ue.feature;void 0!==q.id&&G.writeVarintField(1,q.id),G.writeMessage(2,sr,ue),G.writeVarintField(3,q.type),G.writeMessage(4,en,q)}function sr(ue,G){var q=ue.feature,he=ue.keys,ge=ue.values,Pe=ue.keycache,Ue=ue.valuecache;for(var Ne in q.properties){var Re=q.properties[Ne],$e=Pe[Ne];if(null!==Re){void 0===$e&&(he.push(Ne),Pe[Ne]=$e=he.length-1),G.writeVarint($e);var pt=typeof Re;"string"!==pt&&"boolean"!==pt&&"number"!==pt&&(Re=JSON.stringify(Re));var Ee=pt+":"+Re,le=Ue[Ee];void 0===le&&(ge.push(Re),Ue[Ee]=le=ge.length-1),G.writeVarint(le)}}}function At(ue,G){return(G<<3)+(7&ue)}function Ct(ue){return ue<<1^ue>>31}function en(ue,G){for(var q=ue.loadGeometry(),he=ue.type,ge=0,Pe=0,Ue=q.length,Ne=0;Ne<Ue;Ne++){var Re=q[Ne],$e=1;1===he&&($e=Re.length),G.writeVarint(At(1,$e));for(var pt=3===he?Re.length-1:Re.length,Ee=0;Ee<pt;Ee++){1===Ee&&1!==he&&G.writeVarint(At(2,pt-1));var le=Re[Ee].x-ge,oe=Re[Ee].y-Pe;G.writeVarint(Ct(le)),G.writeVarint(Ct(oe)),ge+=le,Pe+=oe}3===he&&G.writeVarint(At(7,1))}}function Ze(ue,G){var q=typeof ue;"string"===q?G.writeStringField(1,ue):"boolean"===q?G.writeBooleanField(7,ue):"number"===q&&(ue%1!=0?G.writeDoubleField(3,ue):ue<0?G.writeSVarintField(6,ue):G.writeVarintField(5,ue))}function Ge(ue,G,q,he,ge,Pe){if(ge-he<=q)return;const Ue=he+ge>>1;ot(ue,G,Ue,he,ge,Pe%2),Ge(ue,G,q,he,Ue-1,Pe+1),Ge(ue,G,q,Ue+1,ge,Pe+1)}function ot(ue,G,q,he,ge,Pe){for(;ge>he;){if(ge-he>600){const $e=ge-he+1,pt=q-he+1,Ee=Math.log($e),le=.5*Math.exp(2*Ee/3),oe=.5*Math.sqrt(Ee*le*($e-le)/$e)*(pt-$e/2<0?-1:1);ot(ue,G,q,Math.max(he,Math.floor(q-pt*le/$e+oe)),Math.min(ge,Math.floor(q+($e-pt)*le/$e+oe)),Pe)}const Ue=G[2*q+Pe];let Ne=he,Re=ge;for(We(ue,G,he,q),G[2*ge+Pe]>Ue&&We(ue,G,he,ge);Ne<Re;){for(We(ue,G,Ne,Re),Ne++,Re--;G[2*Ne+Pe]<Ue;)Ne++;for(;G[2*Re+Pe]>Ue;)Re--}G[2*he+Pe]===Ue?We(ue,G,he,Re):(Re++,We(ue,G,Re,ge)),Re<=q&&(he=Re+1),q<=Re&&(ge=Re-1)}}function We(ue,G,q,he){Gt(ue,q,he),Gt(G,2*q,2*he),Gt(G,2*q+1,2*he+1)}function Gt(ue,G,q){const he=ue[G];ue[G]=ue[q],ue[q]=he}function dt(ue,G,q,he){const ge=ue-q,Pe=G-he;return ge*ge+Pe*Pe}nr.fromVectorTileJs=Qt,nr.fromGeojsonVt=function(ue,G){G=G||{};var q={};for(var he in ue)q[he]=new hn(ue[he].features,G),q[he].name=he,q[he].version=G.version,q[he].extent=G.extent;return Qt({layers:q})},nr.GeoJSONWrapper=rn;const wn=ue=>ue[0],dn=ue=>ue[1];class Sr{constructor(G,q=wn,he=dn,ge=64,Pe=Float64Array){this.nodeSize=ge,this.points=G;const Ue=G.length<65536?Uint16Array:Uint32Array,Ne=this.ids=new Ue(G.length),Re=this.coords=new Pe(2*G.length);for(let $e=0;$e<G.length;$e++)Ne[$e]=$e,Re[2*$e]=q(G[$e]),Re[2*$e+1]=he(G[$e]);Ge(Ne,Re,ge,0,Ne.length-1,0)}range(G,q,he,ge){return function(Pe,Ue,Ne,Re,$e,pt,Ee){const le=[0,Pe.length-1,0],oe=[];let Oe,je;for(;le.length;){const It=le.pop(),Ut=le.pop(),_n=le.pop();if(Ut-_n<=Ee){for(let Zt=_n;Zt<=Ut;Zt++)Oe=Ue[2*Zt],je=Ue[2*Zt+1],Oe>=Ne&&Oe<=$e&&je>=Re&&je<=pt&&oe.push(Pe[Zt]);continue}const wt=Math.floor((_n+Ut)/2);Oe=Ue[2*wt],je=Ue[2*wt+1],Oe>=Ne&&Oe<=$e&&je>=Re&&je<=pt&&oe.push(Pe[wt]);const tn=(It+1)%2;(0===It?Ne<=Oe:Re<=je)&&(le.push(_n),le.push(wt-1),le.push(tn)),(0===It?$e>=Oe:pt>=je)&&(le.push(wt+1),le.push(Ut),le.push(tn))}return oe}(this.ids,this.coords,G,q,he,ge,this.nodeSize)}within(G,q,he){return function(ge,Pe,Ue,Ne,Re,$e){const pt=[0,ge.length-1,0],Ee=[],le=Re*Re;for(;pt.length;){const oe=pt.pop(),Oe=pt.pop(),je=pt.pop();if(Oe-je<=$e){for(let tn=je;tn<=Oe;tn++)dt(Pe[2*tn],Pe[2*tn+1],Ue,Ne)<=le&&Ee.push(ge[tn]);continue}const It=Math.floor((je+Oe)/2),Ut=Pe[2*It],_n=Pe[2*It+1];dt(Ut,_n,Ue,Ne)<=le&&Ee.push(ge[It]);const wt=(oe+1)%2;(0===oe?Ue-Re<=Ut:Ne-Re<=_n)&&(pt.push(je),pt.push(It-1),pt.push(wt)),(0===oe?Ue+Re>=Ut:Ne+Re>=_n)&&(pt.push(It+1),pt.push(Oe),pt.push(wt))}return Ee}(this.ids,this.coords,G,q,he,this.nodeSize)}}const En={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},qn=Math.fround||(oi=new Float32Array(1),ue=>(oi[0]=+ue,oi[0]));var oi;class pr{constructor(G){this.options=$i(Object.create(En),G),this.trees=new Array(this.options.maxZoom+1)}load(G){const{log:q,minZoom:he,maxZoom:ge,nodeSize:Pe}=this.options;q&&console.time("total time");const Ue=`prepare ${G.length} points`;q&&console.time(Ue),this.points=G;let Ne=[];for(let Re=0;Re<G.length;Re++)G[Re].geometry&&Ne.push(Jr(G[Re],Re));this.trees[ge+1]=new Sr(Ne,Mr,Li,Pe,Float32Array),q&&console.timeEnd(Ue);for(let Re=ge;Re>=he;Re--){const $e=+Date.now();Ne=this._cluster(Ne,Re),this.trees[Re]=new Sr(Ne,Mr,Li,Pe,Float32Array),q&&console.log("z%d: %d clusters in %dms",Re,Ne.length,+Date.now()-$e)}return q&&console.timeEnd("total time"),this}getClusters(G,q){let he=((G[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,G[1]));let Pe=180===G[2]?180:((G[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)he=-180,Pe=180;else if(he>Pe){const pt=this.getClusters([he,ge,180,Ue],q),Ee=this.getClusters([-180,ge,Pe,Ue],q);return pt.concat(Ee)}const Ne=this.trees[this._limitZoom(q)],Re=Ne.range(Vn(he),Oo(Ue),Vn(Pe),Oo(ge)),$e=[];for(const pt of Re){const Ee=Ne.points[pt];$e.push(Ee.numPoints?yr(Ee):this.points[Ee.index])}return $e}getChildren(G){const q=this._getOriginId(G),he=this._getOriginZoom(G),ge="No cluster with the specified id.",Pe=this.trees[he];if(!Pe)throw new Error(ge);const Ue=Pe.points[q];if(!Ue)throw new Error(ge);const Ne=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Re=Pe.within(Ue.x,Ue.y,Ne),$e=[];for(const pt of Re){const Ee=Pe.points[pt];Ee.parentId===G&&$e.push(Ee.numPoints?yr(Ee):this.points[Ee.index])}if(0===$e.length)throw new Error(ge);return $e}getLeaves(G,q,he){const ge=[];return this._appendLeaves(ge,G,q=q||10,he=he||0,0),ge}getTile(G,q,he){const ge=this.trees[this._limitZoom(G)],Pe=Math.pow(2,G),{extent:Ue,radius:Ne}=this.options,Re=Ne/Ue,$e=(he-Re)/Pe,pt=(he+1+Re)/Pe,Ee={features:[]};return this._addTileFeatures(ge.range((q-Re)/Pe,$e,(q+1+Re)/Pe,pt),ge.points,q,he,Pe,Ee),0===q&&this._addTileFeatures(ge.range(1-Re/Pe,$e,1,pt),ge.points,Pe,he,Pe,Ee),q===Pe-1&&this._addTileFeatures(ge.range(0,$e,Re/Pe,pt),ge.points,-1,he,Pe,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(G){let q=this._getOriginZoom(G)-1;for(;q<=this.options.maxZoom;){const he=this.getChildren(G);if(q++,1!==he.length)break;G=he[0].properties.cluster_id}return q}_appendLeaves(G,q,he,ge,Pe){const Ue=this.getChildren(q);for(const Ne of Ue){const Re=Ne.properties;if(Re&&Re.cluster?Pe+Re.point_count<=ge?Pe+=Re.point_count:Pe=this._appendLeaves(G,Re.cluster_id,he,ge,Pe):Pe<ge?Pe++:G.push(Ne),G.length===he)break}return Pe}_addTileFeatures(G,q,he,ge,Pe,Ue){for(const Ne of G){const Re=q[Ne],$e=Re.numPoints;let pt,Ee,le;if($e)pt=hr(Re),Ee=Re.x,le=Re.y;else{const je=this.points[Re.index];pt=je.properties,Ee=Vn(je.geometry.coordinates[0]),le=Oo(je.geometry.coordinates[1])}const oe={type:1,geometry:[[Math.round(this.options.extent*(Ee*Pe-he)),Math.round(this.options.extent*(le*Pe-ge))]],tags:pt};let Oe;$e?Oe=Re.id:this.options.generateId?Oe=Re.index:this.points[Re.index].id&&(Oe=this.points[Re.index].id),void 0!==Oe&&(oe.id=Oe),Ue.features.push(oe)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))}_cluster(G,q){const he=[],{radius:ge,extent:Pe,reduce:Ue,minPoints:Ne}=this.options,Re=ge/(Pe*Math.pow(2,q));for(let $e=0;$e<G.length;$e++){const pt=G[$e];if(pt.zoom<=q)continue;pt.zoom=q;const Ee=this.trees[q+1],le=Ee.within(pt.x,pt.y,Re),oe=pt.numPoints||1;let Oe=oe;for(const je of le){const It=Ee.points[je];It.zoom>q&&(Oe+=It.numPoints||1)}if(Oe>oe&&Oe>=Ne){let je=pt.x*oe,It=pt.y*oe,Ut=Ue&&oe>1?this._map(pt,!0):null;const _n=($e<<5)+(q+1)+this.points.length;for(const wt of le){const tn=Ee.points[wt];if(tn.zoom<=q)continue;tn.zoom=q;const Zt=tn.numPoints||1;je+=tn.x*Zt,It+=tn.y*Zt,tn.parentId=_n,Ue&&(Ut||(Ut=this._map(pt,!0)),Ue(Ut,this._map(tn)))}pt.parentId=_n,he.push(xi(je/Oe,It/Oe,_n,Oe,Ut))}else if(he.push(pt),Oe>1)for(const je of le){const It=Ee.points[je];It.zoom<=q||(It.zoom=q,he.push(It))}}return he}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,q){if(G.numPoints)return q?$i({},G.properties):G.properties;const he=this.points[G.index].properties,ge=this.options.map(he);return q&&ge===he?$i({},ge):ge}}function xi(ue,G,q,he,ge){return{x:qn(ue),y:qn(G),zoom:1/0,id:q,parentId:-1,numPoints:he,properties:ge}}function Jr(ue,G){const[q,he]=ue.geometry.coordinates;return{x:qn(Vn(q)),y:qn(Oo(he)),zoom:1/0,index:G,parentId:-1}}function yr(ue){return{type:"Feature",id:ue.id,properties:hr(ue),geometry:{type:"Point",coordinates:[(G=ue.x,360*(G-.5)),Jn(ue.y)]}};var G}function hr(ue){const G=ue.numPoints,q=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G;return $i($i({},ue.properties),{cluster:!0,cluster_id:ue.id,point_count:G,point_count_abbreviated:q})}function Vn(ue){return ue/360+.5}function Oo(ue){const G=Math.sin(ue*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function Jn(ue){const G=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function $i(ue,G){for(const q in G)ue[q]=G[q];return ue}function Mr(ue){return ue.x}function Li(ue){return ue.y}function si(ue,G,q,he){for(var ge,Pe=he,Ue=q-G>>1,Ne=q-G,Re=ue[G],$e=ue[G+1],pt=ue[q],Ee=ue[q+1],le=G+3;le<q;le+=3){var oe=Gi(ue[le],ue[le+1],Re,$e,pt,Ee);if(oe>Pe)ge=le,Pe=oe;else if(oe===Pe){var Oe=Math.abs(le-Ue);Oe<Ne&&(ge=le,Ne=Oe)}}Pe>he&&(ge-G>3&&si(ue,G,ge,he),ue[ge+2]=Pe,q-ge>3&&si(ue,ge,q,he))}function Gi(ue,G,q,he,ge,Pe){var Ue=ge-q,Ne=Pe-he;if(0!==Ue||0!==Ne){var Re=((ue-q)*Ue+(G-he)*Ne)/(Ue*Ue+Ne*Ne);Re>1?(q=ge,he=Pe):Re>0&&(q+=Ue*Re,he+=Ne*Re)}return(Ue=ue-q)*Ue+(Ne=G-he)*Ne}function Bn(ue,G,q,he){var ge={id:void 0===ue?null:ue,type:G,geometry:q,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var Ue=Pe.geometry,Ne=Pe.type;if("Point"===Ne||"MultiPoint"===Ne||"LineString"===Ne)mn(Pe,Ue);else if("Polygon"===Ne||"MultiLineString"===Ne)for(var Re=0;Re<Ue.length;Re++)mn(Pe,Ue[Re]);else if("MultiPolygon"===Ne)for(Re=0;Re<Ue.length;Re++)for(var $e=0;$e<Ue[Re].length;$e++)mn(Pe,Ue[Re][$e])}(ge),ge}function mn(ue,G){for(var q=0;q<G.length;q+=3)ue.minX=Math.min(ue.minX,G[q]),ue.minY=Math.min(ue.minY,G[q+1]),ue.maxX=Math.max(ue.maxX,G[q]),ue.maxY=Math.max(ue.maxY,G[q+1])}function pi(ue,G,q,he){if(G.geometry){var ge=G.geometry.coordinates,Pe=G.geometry.type,Ue=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),Ne=[],Re=G.id;if(q.promoteId?Re=G.properties[q.promoteId]:q.generateId&&(Re=he||0),"Point"===Pe)fo(ge,Ne);else if("MultiPoint"===Pe)for(var $e=0;$e<ge.length;$e++)fo(ge[$e],Ne);else if("LineString"===Pe)Oi(ge,Ne,Ue,!1);else if("MultiLineString"===Pe){if(q.lineMetrics){for($e=0;$e<ge.length;$e++)Oi(ge[$e],Ne=[],Ue,!1),ue.push(Bn(Re,"LineString",Ne,G.properties));return}io(ge,Ne,Ue,!1)}else if("Polygon"===Pe)io(ge,Ne,Ue,!0);else{if("MultiPolygon"!==Pe){if("GeometryCollection"===Pe){for($e=0;$e<G.geometry.geometries.length;$e++)pi(ue,{id:Re,geometry:G.geometry.geometries[$e],properties:G.properties},q,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for($e=0;$e<ge.length;$e++){var pt=[];io(ge[$e],pt,Ue,!0),Ne.push(pt)}}ue.push(Bn(Re,Pe,Ne,G.properties))}}function fo(ue,G){G.push(Xo(ue[0])),G.push(Qr(ue[1])),G.push(0)}function Oi(ue,G,q,he){for(var ge,Pe,Ue=0,Ne=0;Ne<ue.length;Ne++){var Re=Xo(ue[Ne][0]),$e=Qr(ue[Ne][1]);G.push(Re),G.push($e),G.push(0),Ne>0&&(Ue+=he?(ge*$e-Re*Pe)/2:Math.sqrt(Math.pow(Re-ge,2)+Math.pow($e-Pe,2))),ge=Re,Pe=$e}var pt=G.length-3;G[2]=1,si(G,0,pt,q),G[pt+2]=1,G.size=Math.abs(Ue),G.start=0,G.end=G.size}function io(ue,G,q,he){for(var ge=0;ge<ue.length;ge++){var Pe=[];Oi(ue[ge],Pe,q,he),G.push(Pe)}}function Xo(ue){return ue/360+.5}function Qr(ue){var G=Math.sin(ue*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function ft(ue,G,q,he,ge,Pe,Ue,Ne){if(he/=G,Pe>=(q/=G)&&Ue<he)return ue;if(Ue<q||Pe>=he)return null;for(var Re=[],$e=0;$e<ue.length;$e++){var pt=ue[$e],Ee=pt.geometry,le=pt.type,oe=0===ge?pt.minX:pt.minY,Oe=0===ge?pt.maxX:pt.maxY;if(oe>=q&&Oe<he)Re.push(pt);else if(!(Oe<q||oe>=he)){var je=[];if("Point"===le||"MultiPoint"===le)_e(Ee,je,q,he,ge);else if("LineString"===le)xe(Ee,je,q,he,ge,!1,Ne.lineMetrics);else if("MultiLineString"===le)it(Ee,je,q,he,ge,!1);else if("Polygon"===le)it(Ee,je,q,he,ge,!0);else if("MultiPolygon"===le)for(var It=0;It<Ee.length;It++){var Ut=[];it(Ee[It],Ut,q,he,ge,!0),Ut.length&&je.push(Ut)}if(je.length){if(Ne.lineMetrics&&"LineString"===le){for(It=0;It<je.length;It++)Re.push(Bn(pt.id,le,je[It],pt.tags));continue}"LineString"!==le&&"MultiLineString"!==le||(1===je.length?(le="LineString",je=je[0]):le="MultiLineString"),"Point"!==le&&"MultiPoint"!==le||(le=3===je.length?"Point":"MultiPoint"),Re.push(Bn(pt.id,le,je,pt.tags))}}}return Re.length?Re:null}function _e(ue,G,q,he,ge){for(var Pe=0;Pe<ue.length;Pe+=3){var Ue=ue[Pe+ge];Ue>=q&&Ue<=he&&(G.push(ue[Pe]),G.push(ue[Pe+1]),G.push(ue[Pe+2]))}}function xe(ue,G,q,he,ge,Pe,Ue){for(var Ne,Re,$e=ct(ue),pt=0===ge?Sn:ar,Ee=ue.start,le=0;le<ue.length-3;le+=3){var oe=ue[le],Oe=ue[le+1],je=ue[le+2],It=ue[le+3],Ut=ue[le+4],_n=0===ge?oe:Oe,wt=0===ge?It:Ut,tn=!1;Ue&&(Ne=Math.sqrt(Math.pow(oe-It,2)+Math.pow(Oe-Ut,2))),_n<q?wt>q&&(Re=pt($e,oe,Oe,It,Ut,q),Ue&&($e.start=Ee+Ne*Re)):_n>he?wt<he&&(Re=pt($e,oe,Oe,It,Ut,he),Ue&&($e.start=Ee+Ne*Re)):cn($e,oe,Oe,je),wt<q&&_n>=q&&(Re=pt($e,oe,Oe,It,Ut,q),tn=!0),wt>he&&_n<=he&&(Re=pt($e,oe,Oe,It,Ut,he),tn=!0),!Pe&&tn&&(Ue&&($e.end=Ee+Ne*Re),G.push($e),$e=ct(ue)),Ue&&(Ee+=Ne)}var Zt=ue.length-3;oe=ue[Zt],Oe=ue[Zt+1],je=ue[Zt+2],(_n=0===ge?oe:Oe)>=q&&_n<=he&&cn($e,oe,Oe,je),Zt=$e.length-3,Pe&&Zt>=3&&($e[Zt]!==$e[0]||$e[Zt+1]!==$e[1])&&cn($e,$e[0],$e[1],$e[2]),$e.length&&G.push($e)}function ct(ue){var G=[];return G.size=ue.size,G.start=ue.start,G.end=ue.end,G}function it(ue,G,q,he,ge,Pe){for(var Ue=0;Ue<ue.length;Ue++)xe(ue[Ue],G,q,he,ge,Pe,!1)}function cn(ue,G,q,he){ue.push(G),ue.push(q),ue.push(he)}function Sn(ue,G,q,he,ge,Pe){var Ue=(Pe-G)/(he-G);return ue.push(Pe),ue.push(q+(ge-q)*Ue),ue.push(1),Ue}function ar(ue,G,q,he,ge,Pe){var Ue=(Pe-q)/(ge-q);return ue.push(G+(he-G)*Ue),ue.push(Pe),ue.push(1),Ue}function yn(ue,G){for(var q=[],he=0;he<ue.length;he++){var ge,Pe=ue[he],Ue=Pe.type;if("Point"===Ue||"MultiPoint"===Ue||"LineString"===Ue)ge=Ur(Pe.geometry,G);else if("MultiLineString"===Ue||"Polygon"===Ue){ge=[];for(var Ne=0;Ne<Pe.geometry.length;Ne++)ge.push(Ur(Pe.geometry[Ne],G))}else if("MultiPolygon"===Ue)for(ge=[],Ne=0;Ne<Pe.geometry.length;Ne++){for(var Re=[],$e=0;$e<Pe.geometry[Ne].length;$e++)Re.push(Ur(Pe.geometry[Ne][$e],G));ge.push(Re)}q.push(Bn(Pe.id,Ue,ge,Pe.tags))}return q}function Ur(ue,G){var q=[];q.size=ue.size,void 0!==ue.start&&(q.start=ue.start,q.end=ue.end);for(var he=0;he<ue.length;he+=3)q.push(ue[he]+G,ue[he+1],ue[he+2]);return q}function mr(ue,G){if(ue.transformed)return ue;var q,he,ge,Pe=1<<ue.z,Ue=ue.x,Ne=ue.y;for(q=0;q<ue.features.length;q++){var Re=ue.features[q],$e=Re.geometry,pt=Re.type;if(Re.geometry=[],1===pt)for(he=0;he<$e.length;he+=2)Re.geometry.push(ai($e[he],$e[he+1],G,Pe,Ue,Ne));else for(he=0;he<$e.length;he++){var Ee=[];for(ge=0;ge<$e[he].length;ge+=2)Ee.push(ai($e[he][ge],$e[he][ge+1],G,Pe,Ue,Ne));Re.geometry.push(Ee)}}return ue.transformed=!0,ue}function ai(ue,G,q,he,ge,Pe){return[Math.round(q*(ue*he-ge)),Math.round(q*(G*he-Pe))]}function gn(ue,G,q,he,ge){for(var Pe=G===ge.maxZoom?0:ge.tolerance/((1<<G)*ge.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:he,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ne=0;Ne<ue.length;Ne++){Ue.numFeatures++,zr(Ue,ue[Ne],Pe,ge);var Re=ue[Ne].minX,$e=ue[Ne].minY,pt=ue[Ne].maxX,Ee=ue[Ne].maxY;Re<Ue.minX&&(Ue.minX=Re),$e<Ue.minY&&(Ue.minY=$e),pt>Ue.maxX&&(Ue.maxX=pt),Ee>Ue.maxY&&(Ue.maxY=Ee)}return Ue}function zr(ue,G,q,he){var ge=G.geometry,Pe=G.type,Ue=[];if("Point"===Pe||"MultiPoint"===Pe)for(var Ne=0;Ne<ge.length;Ne+=3)Ue.push(ge[Ne]),Ue.push(ge[Ne+1]),ue.numPoints++,ue.numSimplified++;else if("LineString"===Pe)dr(Ue,ge,ue,q,!1,!1);else if("MultiLineString"===Pe||"Polygon"===Pe)for(Ne=0;Ne<ge.length;Ne++)dr(Ue,ge[Ne],ue,q,"Polygon"===Pe,0===Ne);else if("MultiPolygon"===Pe)for(var Re=0;Re<ge.length;Re++){var $e=ge[Re];for(Ne=0;Ne<$e.length;Ne++)dr(Ue,$e[Ne],ue,q,!0,0===Ne)}if(Ue.length){var pt=G.tags||null;if("LineString"===Pe&&he.lineMetrics){for(var Ee in pt={},G.tags)pt[Ee]=G.tags[Ee];pt.mapbox_clip_start=ge.start/ge.size,pt.mapbox_clip_end=ge.end/ge.size}var le={geometry:Ue,type:"Polygon"===Pe||"MultiPolygon"===Pe?3:"LineString"===Pe||"MultiLineString"===Pe?2:1,tags:pt};null!==G.id&&(le.id=G.id),ue.features.push(le)}}function dr(ue,G,q,he,ge,Pe){var Ue=he*he;if(he>0&&G.size<(ge?Ue:he))q.numPoints+=G.length/3;else{for(var Ne=[],Re=0;Re<G.length;Re+=3)(0===he||G[Re+2]>Ue)&&(q.numSimplified++,Ne.push(G[Re]),Ne.push(G[Re+1])),q.numPoints++;ge&&function($e,pt){for(var Ee=0,le=0,oe=$e.length,Oe=oe-2;le<oe;Oe=le,le+=2)Ee+=($e[le]-$e[Oe])*($e[le+1]+$e[Oe+1]);if(Ee>0===pt)for(le=0,oe=$e.length;le<oe/2;le+=2){var je=$e[le],It=$e[le+1];$e[le]=$e[oe-2-le],$e[le+1]=$e[oe-1-le],$e[oe-2-le]=je,$e[oe-1-le]=It}}(Ne,Pe),ue.push(Ne)}}function Wr(ue,G){var q=(G=this.options=function(ge,Pe){for(var Ue in Pe)ge[Ue]=Pe[Ue];return ge}(Object.create(this.options),G)).debug;if(q&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge,Pe,Ue,Ne,Re,$e,he=function(ge,Pe){var Ue=[];if("FeatureCollection"===ge.type)for(var Ne=0;Ne<ge.features.length;Ne++)pi(Ue,ge.features[Ne],Pe,Ne);else pi(Ue,"Feature"===ge.type?ge:{geometry:ge},Pe);return Ue}(ue,G);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=he,Pe=G,Ue=Pe.buffer/Pe.extent,Ne=ge,Re=ft(ge,1,-1-Ue,Ue,0,-1,2,Pe),$e=ft(ge,1,1-Ue,2+Ue,0,-1,2,Pe),(Re||$e)&&(Ne=ft(ge,1,-Ue,1+Ue,0,-1,2,Pe)||[],Re&&(Ne=yn(Re,1).concat(Ne)),$e&&(Ne=Ne.concat(yn($e,-1)))),he=Ne).length&&this.splitTile(he,0,0,0),q&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kn(ue,G,q){return 32*((1<<ue)*q+G)+ue}function Ar(ue,G){const q=ue.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const he=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!he)return G(null,null);const ge=new Tt(he.features);let Pe=nr(ge);0===Pe.byteOffset&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),G(null,{vectorTile:ge,rawData:Pe.buffer})}Wr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wr.prototype.splitTile=function(ue,G,q,he,ge,Pe,Ue){for(var Ne=[ue,G,q,he],Re=this.options,$e=Re.debug;Ne.length;){he=Ne.pop(),q=Ne.pop(),G=Ne.pop(),ue=Ne.pop();var pt=1<<G,Ee=kn(G,q,he),le=this.tiles[Ee];if(!le&&($e>1&&console.time("creation"),le=this.tiles[Ee]=gn(ue,G,q,he,Re),this.tileCoords.push({z:G,x:q,y:he}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,q,he,le.numFeatures,le.numPoints,le.numSimplified),console.timeEnd("creation"));var oe="z"+G;this.stats[oe]=(this.stats[oe]||0)+1,this.total++}if(le.source=ue,ge){if(G===Re.maxZoom||G===ge)continue;var Oe=1<<ge-G;if(q!==Math.floor(Pe/Oe)||he!==Math.floor(Ue/Oe))continue}else if(G===Re.indexMaxZoom||le.numPoints<=Re.indexMaxPoints)continue;if(le.source=null,0!==ue.length){$e>1&&console.time("clipping");var je,It,Ut,_n,wt,tn,Zt=.5*Re.buffer/Re.extent,Ke=.5-Zt,mi=.5+Zt,$n=1+Zt;je=It=Ut=_n=null,wt=ft(ue,pt,q-Zt,q+mi,0,le.minX,le.maxX,Re),tn=ft(ue,pt,q+Ke,q+$n,0,le.minX,le.maxX,Re),ue=null,wt&&(je=ft(wt,pt,he-Zt,he+mi,1,le.minY,le.maxY,Re),It=ft(wt,pt,he+Ke,he+$n,1,le.minY,le.maxY,Re),wt=null),tn&&(Ut=ft(tn,pt,he-Zt,he+mi,1,le.minY,le.maxY,Re),_n=ft(tn,pt,he+Ke,he+$n,1,le.minY,le.maxY,Re),tn=null),$e>1&&console.timeEnd("clipping"),Ne.push(je||[],G+1,2*q,2*he),Ne.push(It||[],G+1,2*q,2*he+1),Ne.push(Ut||[],G+1,2*q+1,2*he),Ne.push(_n||[],G+1,2*q+1,2*he+1)}}},Wr.prototype.getTile=function(ue,G,q){var he=this.options,ge=he.extent,Pe=he.debug;if(ue<0||ue>24)return null;var Ue=1<<ue,Ne=kn(ue,G=(G%Ue+Ue)%Ue,q);if(this.tiles[Ne])return mr(this.tiles[Ne],ge);Pe>1&&console.log("drilling down to z%d-%d-%d",ue,G,q);for(var Re,$e=ue,pt=G,Ee=q;!Re&&$e>0;)$e--,pt=Math.floor(pt/2),Ee=Math.floor(Ee/2),Re=this.tiles[kn($e,pt,Ee)];return Re&&Re.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",$e,pt,Ee),Pe>1&&console.time("drilling down"),this.splitTile(Re.source,$e,pt,Ee,ue,G,q),Pe>1&&console.timeEnd("drilling down"),this.tiles[Ne]?mr(this.tiles[Ne],ge):null):null};class bn extends c.VectorTileWorkerSource{constructor(G,q,he,ge,Pe){super(G,q,he,ge,Ar),Pe&&(this.loadGeoJSON=Pe)}loadData(G,q){const he=G&&G.request,ge=he&&he.collectResourceTiming;this.loadGeoJSON(G,(Pe,Ue)=>{if(Pe||!Ue)return q(Pe);if("object"!=typeof Ue)return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{gt(Ue,!0);try{if(G.filter){const Re=c.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Re.result)throw new Error(Re.value.map(pt=>`${pt.key}: ${pt.message}`).join(", "));const $e=Ue.features.filter(pt=>Re.value.evaluate({zoom:0},pt));Ue={type:"FeatureCollection",features:$e}}this._geoJSONIndex=G.cluster?new pr(function({superclusterOptions:Re,clusterProperties:$e}){if(!$e||!Re)return Re;const pt={},Ee={},le={accumulated:null,zoom:0},oe={properties:null},Oe=Object.keys($e);for(const je of Oe){const[It,Ut]=$e[je],_n=c.createExpression(Ut),wt=c.createExpression("string"==typeof It?[It,["accumulated"],["get",je]]:It);pt[je]=_n.value,Ee[je]=wt.value}return Re.map=je=>{oe.properties=je;const It={};for(const Ut of Oe)It[Ut]=pt[Ut].evaluate(le,oe);return It},Re.reduce=(je,It)=>{oe.properties=It;for(const Ut of Oe)le.accumulated=je[Ut],je[Ut]=Ee[Ut].evaluate(le,oe)},Re}(G)).load(Ue.features):new Wr(Re=Ue,G.geojsonVtOptions)}catch(Re){return q(Re)}this.loaded={};const Ne={};if(ge){const Re=c.getPerformanceMeasurement(he);Re&&(Ne.resourceTiming={},Ne.resourceTiming[G.source]=JSON.parse(JSON.stringify(Re)))}q(null,Ne)}var Re})}reloadTile(G,q){const he=this.loaded;return he&&he[G.uid]?super.reloadTile(G,q):this.loadTile(G,q)}loadGeoJSON(G,q){if(G.request)c.getJSON(G.request,q);else{if("string"!=typeof G.data)return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(G.data))}catch{return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(he){q(he)}}getClusterChildren(G,q){try{q(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(he){q(he)}}getClusterLeaves(G,q){try{q(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(he){q(he)}}}class Fi{constructor(G){this.self=G,this.actor=new c.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:bn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,he)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=he},this.self.registerRTLTextPlugin=q=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=q.applyArabicShaping,c.plugin.processBidirectionalText=q.processBidirectionalText,c.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(G,q,he){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],he()}checkIfReady(G,q,he){he()}setReferrer(G,q){this.referrer=q}spriteLoaded(G,q){this.isSpriteLoaded[G]=q;for(const he in this.workerSources[G]){const ge=this.workerSources[G][he];for(const Pe in ge)ge[Pe]instanceof c.VectorTileWorkerSource&&(ge[Pe].isSpriteLoaded=q,ge[Pe].fire(new c.Event("isSpriteLoaded")))}}setImages(G,q,he){this.availableImages[G]=q;for(const ge in this.workerSources[G]){const Pe=this.workerSources[G][ge];for(const Ue in Pe)Pe[Ue].availableImages=q}he()}enableTerrain(G,q,he){this.terrain=q,he()}setProjection(G,q){this.projections[G]=c.getProjection(q)}setLayers(G,q,he){this.getLayerIndex(G).replace(q),he()}updateLayers(G,q,he){this.getLayerIndex(G).update(q.layers,q.removedIds),he()}loadTile(G,q,he){const ge=this.enableTerrain?c.extend({enableTerrain:this.terrain},q):q;ge.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,q.type,q.source).loadTile(ge,he)}loadDEMTile(G,q,he){const ge=this.enableTerrain?c.extend({buildQuadTree:this.terrain},q):q;this.getDEMWorkerSource(G,q.source).loadTile(ge,he)}reloadTile(G,q,he){const ge=this.enableTerrain?c.extend({enableTerrain:this.terrain},q):q;ge.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,q.type,q.source).reloadTile(ge,he)}abortTile(G,q,he){this.getWorkerSource(G,q.type,q.source).abortTile(q,he)}removeTile(G,q,he){this.getWorkerSource(G,q.type,q.source).removeTile(q,he)}removeSource(G,q,he){if(!this.workerSources[G]||!this.workerSources[G][q.type]||!this.workerSources[G][q.type][q.source])return;const ge=this.workerSources[G][q.type][q.source];delete this.workerSources[G][q.type][q.source],void 0!==ge.removeSource?ge.removeSource(q,he):he()}loadWorkerSource(G,q,he){try{this.self.importScripts(q.url),he()}catch(ge){he(ge.toString())}}syncRTLPluginState(G,q,he){try{c.plugin.setState(q);const ge=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=ge){this.self.importScripts(ge);const Pe=c.plugin.isParsed();he(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ge}`),Pe)}}catch(ge){he(ge.toString())}}getAvailableImages(G){let q=this.availableImages[G];return q||(q=[]),q}getLayerIndex(G){let q=this.layerIndexes[G];return q||(q=this.layerIndexes[G]=new kt),q}getWorkerSource(G,q,he){return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][q]||(this.workerSources[G][q]={}),this.workerSources[G][q][he]||(this.workerSources[G][q][he]=new this.workerSourceTypes[q]({send:(ge,Pe,Ue,Ne,Re,$e)=>{this.actor.send(ge,Pe,Ue,G,Re,$e)},scheduler:this.actor.scheduler},this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])),this.workerSources[G][q][he]}getDEMWorkerSource(G,q){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][q]||(this.demWorkerSources[G][q]=new Ye),this.demWorkerSources[G][q]}enforceCacheSizeLimit(G,q){c.enforceCacheSizeLimit(q)}getWorkerPerformanceMetrics(G,q,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fi(self)),Fi}),Ie(0,function(c){function Fe(h,r){if(Array.isArray(h)){if(!Array.isArray(r)||h.length!==r.length)return!1;for(let l=0;l<h.length;l++)if(!Fe(h[l],r[l]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==r){if("object"!=typeof r||Object.keys(h).length!==Object.keys(r).length)return!1;for(const l in h)if(!Fe(h[l],r[l]))return!1;return!0}return h===r}var Jt=kt;function kt(h){return r=h,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{_=new Worker(E),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(E),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()||(void 0===Ye[l=r&&r.failIfMajorPerformanceCaveat]&&(Ye[l]=function(p){var _,E,C,A,v=(E=p,C=document.createElement("canvas"),(A=Object.create(kt.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,C.getContext("webgl",A)||C.getContext("experimental-webgl",A));if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),!0===v.getShaderParameter(_,v.COMPILE_STATUS))}(l)),!Ye[l]||document.documentMode));var r,l}var Ye={};function gt(h,r,l){const p=c.window.document.createElement(h);return void 0!==r&&(p.className=r),l&&l.appendChild(p),p}function yt(h,r,l){const p=c.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(r))p.setAttributeNS(null,_,r[_]);return l&&l.appendChild(p),p}kt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const tt=c.window.document&&c.window.document.documentElement.style,st=tt&&void 0!==tt.userSelect?"userSelect":"WebkitUserSelect";let un;function Tt(){tt&&st&&(un=tt[st],tt[st]="none")}function xn(){tt&&st&&(tt[st]=un)}function hn(h){h.preventDefault(),h.stopPropagation(),c.window.removeEventListener("click",hn,!0)}function Cn(){c.window.addEventListener("click",hn,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",hn,!0)},0)}function $t(h,r){const l=h.getBoundingClientRect();return Qt(h,l,r)}function nr(h,r){const l=h.getBoundingClientRect(),p=[];for(let _=0;_<r.length;_++)p.push(Qt(h,l,r[_]));return p}function rn(h){return void 0!==c.window.InstallTrigger&&2===h.button&&h.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Qt(h,r,l){const p=h.offsetWidth===r.width?1:h.offsetWidth/r.width;return new c.pointGeometry((l.clientX-r.left)*p,(l.clientY-r.top)*p)}function Ht(h,r){var l=r[0],p=r[1],_=r[2],v=r[3],E=l*v-_*p;return E?(h[0]=v*(E=1/E),h[1]=-p*E,h[2]=-_*E,h[3]=l*E,h):null}function xt(h){const{userImage:r}=h;return!!(r&&r.render&&r.render())&&(h.data.replace(new Uint8Array(r.data.buffer)),!0)}class sr extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const _ of r){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(r,l){return!(r&&(4!==r.length||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let p=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const p={};for(const _ of r){this.images[_]||this.fire(new c.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:c.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],p=this.getImage(r);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new c.ImagePosition(_,p);this.patterns[r]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:l,h:p}=c.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],C=E.x+1,A=E.y+1,z=this.images[v].data,N=z.width,Z=z.height;c.RGBAImage.copy(z,_,{x:0,y:0},{x:C,y:A},{width:N,height:Z}),c.RGBAImage.copy(z,_,{x:0,y:Z-1},{x:C,y:A-1},{width:N,height:1}),c.RGBAImage.copy(z,_,{x:0,y:0},{x:C,y:A+Z},{width:N,height:1}),c.RGBAImage.copy(z,_,{x:N-1,y:0},{x:C-1,y:A},{width:1,height:Z}),c.RGBAImage.copy(z,_,{x:0,y:0},{x:C+N,y:A},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];xt(p)&&this.updateImage(l,p)}}}const At=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(h,r){return function([l,p,_]){const v=c.degToRad(p+90),E=c.degToRad(_);return{x:l*Math.cos(v)*Math.sin(E),y:l*Math.sin(v)*Math.sin(E),z:l*Math.cos(E),azimuthal:p,polar:_}}(h.expression.evaluate(r))}interpolate(h,r,l){return{x:c.number(h.x,r.x,l),y:c.number(h.y,r.y,l),z:c.number(h.z,r.z,l),azimuthal:c.number(h.azimuthal,r.azimuthal,l),polar:c.number(h.polar,r.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Ct="-transition";class en extends c.Evented{constructor(r){super(),this._transitionable=new c.Transitionable(At),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(c.validateLight,r,l))for(const p in r){const _=r[p];c.endsWith(p,Ct)?this._transitionable.setTransition(p.slice(0,-Ct.length),_):this._transitionable.setValue(p,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const Ze=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),Ge="-transition";class ot extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(Ze),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const p=r[l];c.endsWith(l,Ge)?this._transitionable.setTransition(l.slice(0,-Ge.length),p):this._transitionable.setValue(l,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function We(h,r,l,p){const _=c.smoothstep(45,65,l),[v,E]=Gt(h,p),C=c.length(r);let A=1-Math.min(1,Math.exp((C-v)/(E-v)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*_*h.alpha}function Gt(h,r){const l=.5/Math.tan(.5*r);return[h.range[0]+l,h.range[1]+l]}const dt=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),wn="-transition";class dn extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(dt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l="globe"===r.projection.name,p=c.globeToMercatorTransition(r.zoom),_=this.properties.get("range"),v=[.5,3];return{range:l?[c.number(v[0],_[0],p),c.number(v[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(c.validateFog,r,l)){for(const p of Object.keys(c.spec.fog))r&&void 0===r[p]&&(r[p]=c.spec.fog[p].default);for(const p in r){const _=r[p];c.endsWith(p,wn)?this._transitionable.setTransition(p.slice(0,-wn.length),_):this._transitionable.setValue(p,_)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,_,v){const E=c.MercatorCoordinate.fromLngLat(_),C=v.elevation?v.elevation.getAtPointOrZero(E):0,A=[E.x,E.y,C];return c.transformMat4(A,A,v.mercatorFogMatrix),We(p,A,v.pitch,v._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Gt(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Sr{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new Sr.Actor(p[_],l,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,p){c.asyncAll(this.actors,(_,v)=>{_.send(r,l,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function En(h,r,l){return r*(c.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Sr.Actor=c.Actor;class qn{constructor(r,l,p,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(r,l){let p,_;if(r instanceof c.pointGeometry||"number"==typeof r[0]){const v=c.pointGeometry.convert(r);p=[c.pointGeometry.convert(r)],_=l.isPointAboveHorizon(v)}else{const v=c.pointGeometry.convert(r[0]),E=c.pointGeometry.convert(r[1]);p=[v,E],_=c.polygonizeBounds(v,E).every(C=>l.isPointAboveHorizon(C))}return new qn(p,l.getCameraPoint(),_,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],_=c.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),c.bufferConvexPolygon(_,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],_=c.polygonizeBounds(l,p,r),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(r,l,p,_=0){const v=r.queryPadding/l._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let C=r.tileID.wrap+(E.unwrapped?_:0);const A=E.polygon.map(ie=>c.getTilePoint(r.tileTransform,ie,C));if(!c.polygonIntersectsBox(A,0,0,c.EXTENT,c.EXTENT))return;C=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const z=this.screenGeometryMercator.polygon.map(ie=>c.getTileVec3(r.tileTransform,ie,C)),N=z.map(ie=>new c.pointGeometry(ie[0],ie[1])),Z=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),K=c.getTileVec3(r.tileTransform,Z,C),se=z.map(ie=>{const te=c.sub(ie,ie,K);return c.normalize(te,te),new c.Ray(K,te)}),re=En(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:se,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(ne=c.getBounds(A),ne.min.x=c.clamp(ne.min.x,0,c.EXTENT),ne.min.y=c.clamp(ne.min.y,0,c.EXTENT),ne.max.x=c.clamp(ne.max.x,0,c.EXTENT),ne.max.y=c.clamp(ne.max.y,0,c.EXTENT),ne),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:re};var ne}_bufferedScreenMercator(r,l){const p=xi(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(r,l){const p=xi(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(r,l){const p=function(v,E){const C=c.multiply([],E.pixelMatrix,E.globeMatrix),A=[0,-c.GLOBE_RADIUS,0,1],z=[0,c.GLOBE_RADIUS,0,1],N=[0,0,0,1];c.transformMat4$1(A,A,C),c.transformMat4$1(z,z,C),c.transformMat4$1(N,N,C);const Z=new c.pointGeometry(A[0]/A[3],A[1]/A[3]),K=new c.pointGeometry(z[0]/z[3],z[1]/z[3]),se=c.polygonContainsPoint(v,Z)&&A[3]<N[3],re=c.polygonContainsPoint(v,K)&&z[3]<N[3];if(!se&&!re)return null;const ne=function(Ae,Ce,Be){for(let He=1;He<Ae.length;He++){const Mt=pr(Ce.pointCoordinate3D(Ae[He-1]).x),Ve=pr(Ce.pointCoordinate3D(Ae[He]).x);if(Be<0){if(Mt<Ve)return{idx:He,t:-Mt/(Ve-1-Mt)}}else if(Ve<Mt)return{idx:He,t:(1-Mt)/(Ve+1-Mt)}}return null}(v,E,se?-1:1);if(!ne)return null;const{idx:ie,t:te}=ne;let ae=ie>1?oi(v.slice(0,ie),E):[],ce=ie<v.length?oi(v.slice(ie),E):[];ae=ae.map(Ae=>new c.pointGeometry(pr(Ae.x),Ae.y)),ce=ce.map(Ae=>new c.pointGeometry(pr(Ae.x),Ae.y));const ke=[...ae];0===ke.length&&ke.push(ce[ce.length-1]);const Se=c.number(ke[ke.length-1].y,(0===ce.length?ae[0]:ce[0]).y,te);let ve;return ve=se?[new c.pointGeometry(0,Se),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,Se)]:[new c.pointGeometry(1,Se),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,Se)],ke.push(...ve),0===ce.length?ke.push(ae[0]):ke.push(...ce),{polygon:ke.map(Ae=>new c.MercatorCoordinate(Ae.x,Ae.y)),unwrapped:!1}}(r,l);if(p)return p;const _=function(v,E){let C=!1,A=-1/0,z=0;for(let Z=0;Z<v.length-1;Z++)v[Z].x>A&&(A=v[Z].x,z=Z);for(let Z=0;Z<v.length-1;Z++){const K=(z+Z)%(v.length-1),se=v[K],re=v[K+1];Math.abs(se.x-re.x)>.5&&(se.x<re.x?(se.x+=1,0===K&&(v[v.length-1].x+=1)):(re.x+=1,K+1===v.length-1&&(v[0].x+=1)),C=!0)}const N=c.mercatorXfromLng(E.center.lng);return C&&N<Math.abs(N-1)&&v.forEach(Z=>{Z.x-=1}),{polygon:v,unwrapped:C}}(oi(r,l).map(v=>new c.pointGeometry(pr(v.x),v.y)),l);return{polygon:_.polygon.map(v=>new c.MercatorCoordinate(v.x,v.y)),unwrapped:_.unwrapped}}}function oi(h,r){return c.resample(h,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function pr(h){return h<0?1+h%1:h%1}function xi(h){return 100*h|0}function Jr(h,r,l,p,_){const v=function(E,C){if(E)return _(E);if(C){const A=c.pick(c.extend(C,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(A.vectorLayers=C.vector_layers,A.vectorLayerIds=A.vectorLayers.map(z=>z.id)),C.language_options&&(A.languageOptions=C.language_options),C.language&&C.language[C.id]&&(A.language=C.language[C.id]),C.worldview_options&&(A.worldviewOptions=C.worldview_options),C.worldview?A.worldview=C.worldview[C.id]:C.worldview_default&&(A.worldview=C.worldview_default),A.tiles=r.canonicalizeTileset(A,h.url),_(null,A)}};return h.url?c.getJSON(r.transformRequest(r.normalizeSourceURL(h.url,null,l,p),c.ResourceType.Source),v):c.exported.frame(()=>v(null,h))}class yr{constructor(r,l,p){this.bounds=c.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),p=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),E=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=p&&r.x<v&&r.y>=_&&r.y<E}}class hr{constructor(r,l,p){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Oo{constructor(r,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];void 0!==_&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],E=l.attributes[v.name];void 0!==E&&r.vertexAttribPointer(E,v.components,r[Vn[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class $i extends Jn{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Mr extends Jn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Li extends Jn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class si extends Jn{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Gi extends Jn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Bn extends Jn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class mn extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class pi extends Jn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class fo extends Jn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Oi extends Jn{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class io extends Jn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Xo extends Jn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Qr extends Jn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class ft extends Jn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class _e extends Jn{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class xe extends Jn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ct extends Jn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class it extends Jn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class cn extends Jn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Sn extends Jn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class ar extends Jn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class yn extends Jn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ur extends Jn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class mr extends Jn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ai extends Jn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class gn extends Jn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class zr extends Jn{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class dr extends Jn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Wr extends Jn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class kn extends Jn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ar extends Jn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class bn extends Jn{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Fi extends bn{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ue extends bn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class G extends ue{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class q{constructor(r,l,p,_){this.context=r,this.width=l,this.height=p;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Fi(r,v),_&&(this.depthAttachment=new ue(r,v))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class he{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new $i(this),this.clearDepth=new Mr(this),this.clearStencil=new Li(this),this.colorMask=new si(this),this.depthMask=new Gi(this),this.stencilMask=new Bn(this),this.stencilFunc=new mn(this),this.stencilOp=new pi(this),this.stencilTest=new fo(this),this.depthRange=new Oi(this),this.depthTest=new io(this),this.depthFunc=new Xo(this),this.blend=new Qr(this),this.blendFunc=new ft(this),this.blendColor=new _e(this),this.blendEquation=new xe(this),this.cullFace=new ct(this),this.cullFaceSide=new it(this),this.frontFace=new cn(this),this.program=new Sn(this),this.activeTexture=new ar(this),this.viewport=new yn(this),this.bindFramebuffer=new Ur(this),this.bindRenderbuffer=new mr(this),this.bindTexture=new ai(this),this.bindVertexBuffer=new gn(this),this.bindElementBuffer=new zr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new dr(this),this.pixelStoreUnpack=new Wr(this),this.pixelStoreUnpackPremultiplyAlpha=new kn(this),this.pixelStoreUnpackFlipY=new Ar(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new hr(this,r,l)}createVertexBuffer(r,l,p){return new Oo(this,r,l,p)}createRenderbuffer(r,l,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,l,p){return new q(this,r,l,p)}clear({color:r,depth:l,stencil:p}){const _=this.gl;let v=0;r&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Fe(r.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ge extends c.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jr(this._options,this.map._requestManager,null,null,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(c.extend(this,l),l.bounds&&(this.tileBounds=new yr(l.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(l.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=c.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=c.getImage(this.map._requestManager.transformRequest(_,c.ResourceType.Tile),(v,E,C,A)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):v?(r.state="errored",l(v)):E?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:C,expires:A}),r.setTexture(E,this.map.painter),r.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,p){r.setTexture(l,p)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let Pe;function Ue(h,r,l,p,_,v,E,C){const A=[h,l,_,r,p,v,1,1,1],z=[E,C,1],N=c.adjoint([],A),[Z,K,se]=c.transformMat3(z,z,c.transpose(N,N));return c.multiply$1(A,[Z,0,0,0,K,0,0,0,se],A)}class Ne extends c.Evented{constructor(r,l,p,_){super(),this.id=r,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(r,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(p,_)=>{if(this._loaded=!0,p)this.fire(new c.ErrorEvent(p));else if(_){const{HTMLImageElement:v}=c.window;this.image=_ instanceof v?c.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,E=-1/0,C=-1/0;for(const Z of p)_=Math.min(_,Z.x),v=Math.min(v,Z.y),E=Math.max(E,Z.x),C=Math.max(C,Z.y);const A=Math.max(E-_,C-v),z=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),N=Math.pow(2,z);return new c.CanonicalTileID(z,Math.floor((_+E)/2*N),Math.floor((v+C)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const A in this.tiles){const z=this.tiles[A];"loaded"!==z.state&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[p,_,v,E]=this.coordinates.map(A=>{const z=l.projection.project(A[0],A[1]);return c.getTilePoint(l,z)._round()});this.perspectiveTransform=function(A,z,N,Z,K,se,re,ne,ie,te){const ae=Ue(0,0,A,0,0,z,A,z),ce=Ue(N,Z,K,se,re,ne,ie,te);return c.multiply$1(ce,c.adjoint(ae,ae),ce),[ce[6]/ce[8]*A/c.EXTENT,ce[7]/ce[8]*z/c.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,E.x,E.y,v.x,v.y);const C=this._boundsArray=new c.StructArrayLayout4i8;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(_.x,_.y,c.EXTENT,0),C.emplaceBack(E.x,E.y,0,c.EXTENT),C.emplaceBack(v.x,v.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(C,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,l=r.gl;this.texture?this.texture.update(this.image):(this.texture=new c.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Re={vector:class extends c.Evented{constructor(h,r,l,p){if(super(),this.id=h,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(r,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(h){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const r=this.language||this.map._language,l=this.worldview||this.map._worldview;this._tileJSONRequest=Jr(this._options,this.map._requestManager,r,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${r}`),l&&2!==l.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new c.ErrorEvent(p))):_&&(c.extend(this,_),_.bounds&&(this.tileBounds=new yr(_.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),h&&h(p)})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.load(()=>{const r=this.map.style._getSourceCaches(this.id);for(const l of r)l.clearTiles()})}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}_setLanguage(h){return h===this.language||this.setSourceProperty(()=>{this.language=h}),this}_setWorldview(h){return h===this.worldview?this:this.worldviewOptions&&h&&!this.worldviewOptions[h]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${h}".`),this):(this.setSourceProperty(()=>{this.worldview=h}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,c.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,h.actor&&"expired"!==h.state)"loading"===h.state?h.reloadCallback=r:h.request=h.actor.send("reloadTile",p,_.bind(this));else if(h.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const v=c.loadVectorTile.call({deduped:this._deduped},p,(E,C)=>{E||!C?_.call(this,E):(p.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},h.actor&&h.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);h.request={cancel:v}}function _(v,E){return delete h.request,h.aborted?r(null):v&&404!==v.status?r(v):(E&&E.resourceTiming&&(h.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&h.setExpiryData(E),h.loadVectorData(E,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ge,"raster-dem":class extends ge{constructor(h,r,l,p){super(h,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(h,r){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(h.state="errored",r(_)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",r(null))}h.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(_,v,E,C){if(delete h.request,h.aborted)h.state="unloaded",r(null);else if(_)h.state="errored",r(_);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:E,expires:C});const A=c.window.ImageBitmap&&v instanceof c.window.ImageBitmap&&(null==Pe&&(Pe=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),Pe),z=1-(v.width-c.prevPowerOfTwo(v.width))/2;z<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const N=A?v:c.exported.getImageData(v,z),Z={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:z};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",Z,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const r=h.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,_=0===r.x?h.wrap-1:h.wrap,v=(r.x+1+l)%l,E=r.x+1===l?h.wrap+1:h.wrap,C={};return C[new c.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y).key]={backfilled:!1},C[new c.OverscaledTileID(h.overscaledZ,E,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(C[new c.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y-1).key]={backfilled:!1},C[new c.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new c.OverscaledTileID(h.overscaledZ,E,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(C[new c.OverscaledTileID(h.overscaledZ,_,r.z,p,r.y+1).key]={backfilled:!1},C[new c.OverscaledTileID(h.overscaledZ,h.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new c.OverscaledTileID(h.overscaledZ,E,r.z,v,r.y+1).key]={backfilled:!1}),C}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends c.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=c.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*_,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*_,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},r),this}getClusterChildren(h,r){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},r),this}getClusterLeaves(h,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:r,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=c.extend({},this.workerOptions),r=this._data;"string"==typeof r?(h.request=this.map._requestManager.transformRequest(c.exported.resolveURL(r),c.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new c.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,r){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?r(null):p?r(p):(h.loadVectorData(_,this.map.painter,"reloadTile"===l),r(null))),void 0,"loadTile"===l)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ne{constructor(h,r,l,p){super(h,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const r of h.urls)this.urls.push(this.map._requestManager.transformRequest(r,c.ResourceType.Source).url);c.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const r=this.video.seekable;h<r.start(0)||h>r.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,r=h.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(h,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ne,canvas:class extends Ne{constructor(h,r,l,p){super(h,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(v=>"number"!=typeof v))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends c.Evented{constructor(h,r,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new yr(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:r,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,r){const{x:l,y:p,z:_}=h.tileID.canonical,v=new c.window.AbortController,E=this._implementation.loadTile({x:l,y:p,z:_},{signal:v.signal});if(!E)return this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null);E.cancel=()=>v.abort(),h.request=E.then(function(C){return delete h.request,h.aborted?(h.state="unloaded",r(null)):C?(A=C)instanceof c.window.ImageData||A instanceof c.window.ImageBitmap||A instanceof c.window.HTMLCanvasElement?(this.loadTileData(h,C),h.state="loaded",void r(null)):(h.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",r(null));var A}.bind(this)).catch(C=>{20!==C.code&&(h.state="errored",r(C))})}loadTileData(h,r){ge.loadTileData(h,r,this._map.painter)}unloadTileData(h){ge.unloadTileData(h,this._map.painter)}prepareTile(h){if(!this._implementation.prepareTile)return null;const{x:r,y:l,z:p}=h.tileID.canonical,_=this._implementation.prepareTile({x:r,y:l,z:p});return _?(this.loadTileData(h,_),h.state="loaded",_):null}unloadTile(h,r){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}r()}abortTile(h,r){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},$e=function(h,r,l,p){const _=new Re[r.type](h,r,l,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],_),_};function pt(h,r){const l=c.identity([]);return c.scale(l,l,[.5*h.width,.5*-h.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,h.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function Ee(h,r,l,p,_,v,E,C=!1){const A=h.tilesIn(p,E,C);A.sort(oe);const z=[];for(const Z of A)z.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(r,l,h._state,Z,_,v,pt(h.transform,Z.tile.tileID),C)});const N=function(Z){const K={},se={};for(const re of Z){const ne=re.queryResults,ie=re.wrappedTileID,te=se[ie]=se[ie]||{};for(const ae in ne){const ce=ne[ae],ke=te[ae]=te[ae]||{},Se=K[ae]=K[ae]||[];for(const ve of ce)ke[ve.featureIndex]||(ke[ve.featureIndex]=!0,Se.push(ve))}}return K}(z);for(const Z in N)N[Z].forEach(K=>{const se=K.feature,re=se.layer;re&&"background"!==re.type&&"sky"!==re.type&&(se.source=re.source,re["source-layer"]&&(se.sourceLayer=re["source-layer"]),se.state=void 0!==se.id?h.getFeatureState(re["source-layer"],se.id):{})});return N}function le(h,r){const l=h.getRenderableIds().map(v=>h.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){const E=l[v],C=E.tileID.canonical.key;_[C]||(_[C]=!0,E.querySourceFeatures(p,r))}return p}function oe(h,r){const l=h.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Oe(){return null!=be.workerClass?new be.workerClass:new c.window.Worker(be.workerUrl)}const je="mapboxgl_preloaded_worker_pool";class It{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<It.workerCount;)this.workers.push(new Oe);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[je]}numActive(){return Object.keys(this.active).length}}let Ut;function _n(){return Ut||(Ut=new It),Ut}function wt(h,r){const l={};for(const p in h)"ref"!==p&&(l[p]=h[p]);return c.refProperties.forEach(p=>{p in r&&(l[p]=r[p])}),l}function tn(h){h=h.slice();const r=Object.create(null);for(let l=0;l<h.length;l++)r[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=wt(h[l],r[h[l].ref]));return h}It.workerCount=2;const Zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ke(h,r,l){l.push({command:Zt.addSource,args:[h,r[h]]})}function mi(h,r,l){r.push({command:Zt.removeSource,args:[h]}),l[h]=!0}function $n(h,r,l,p){mi(h,l,p),Ke(h,r,l)}function Ti(h,r,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&"data"!==p&&!Fe(h[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&"data"!==p&&!Fe(h[l][p],r[l][p]))return!1;return!0}function Br(h,r,l,p,_,v){let E;for(E in r=r||{},h=h||{})h.hasOwnProperty(E)&&(Fe(h[E],r[E])||l.push({command:v,args:[p,E,r[E],_]}));for(E in r)r.hasOwnProperty(E)&&!h.hasOwnProperty(E)&&(Fe(h[E],r[E])||l.push({command:v,args:[p,E,r[E],_]}))}function qr(h){return h.id}function po(h,r){return h[r.id]=r,h}class Qn{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=c.clamp(r,0,1);let l=1,p=this._distances[l];const _=r*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const v=l-1,E=this._distances[v],C=p-E,A=C>0?(_-E)/C:0;return this.points[v].mult(1-A).add(this.points[l].mult(A))}}class os{constructor(r,l,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(r,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(r,l,p,_,v,E){this.boxCells[v].push(E)}_insertCircleCell(r,l,p,_,v,E){this.circleCells[v].push(E)}_query(r,l,p,_,v,E){if(p<0||r>this.width||_<0||l>this.height)return!v&&[];const C=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let A=0;A<this.boxKeys.length;A++)C.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],N=this.circles[3*A+1],Z=this.circles[3*A+2];C.push({key:this.circleKeys[A],x1:z-Z,y1:N-Z,x2:z+Z,y2:N+Z})}return E?C.filter(E):C}return this._forEachCell(r,l,p,_,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?C.length>0:C}_queryCircle(r,l,p,_,v){const E=r-p,C=r+p,A=l-p,z=l+p;if(C<0||E>this.width||z<0||A>this.height)return!_&&[];const N=[];return this._forEachCell(E,A,C,z,this._queryCellCircle,N,{hitTest:_,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?N.length>0:N}query(r,l,p,_,v){return this._query(r,l,p,_,!1,v)}hitTest(r,l,p,_,v){return this._query(r,l,p,_,!0,v)}hitTestCircle(r,l,p,_){return this._queryCircle(r,l,p,!0,_)}_queryCell(r,l,p,_,v,E,C,A){const z=C.seenUids,N=this.boxCells[v];if(null!==N){const K=this.bboxes;for(const se of N)if(!z.box[se]){z.box[se]=!0;const re=4*se;if(r<=K[re+2]&&l<=K[re+3]&&p>=K[re+0]&&_>=K[re+1]&&(!A||A(this.boxKeys[se]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[se],x1:K[re],y1:K[re+1],x2:K[re+2],y2:K[re+3]})}}}const Z=this.circleCells[v];if(null!==Z){const K=this.circles;for(const se of Z)if(!z.circle[se]){z.circle[se]=!0;const re=3*se;if(this._circleAndRectCollide(K[re],K[re+1],K[re+2],r,l,p,_)&&(!A||A(this.circleKeys[se]))){if(C.hitTest)return E.push(!0),!0;{const ne=K[re],ie=K[re+1],te=K[re+2];E.push({key:this.circleKeys[se],x1:ne-te,y1:ie-te,x2:ne+te,y2:ie+te})}}}}}_queryCellCircle(r,l,p,_,v,E,C,A){const z=C.circle,N=C.seenUids,Z=this.boxCells[v];if(null!==Z){const se=this.bboxes;for(const re of Z)if(!N.box[re]){N.box[re]=!0;const ne=4*re;if(this._circleAndRectCollide(z.x,z.y,z.radius,se[ne+0],se[ne+1],se[ne+2],se[ne+3])&&(!A||A(this.boxKeys[re])))return E.push(!0),!0}}const K=this.circleCells[v];if(null!==K){const se=this.circles;for(const re of K)if(!N.circle[re]){N.circle[re]=!0;const ne=3*re;if(this._circlesCollide(se[ne],se[ne+1],se[ne+2],z.x,z.y,z.radius)&&(!A||A(this.circleKeys[re])))return E.push(!0),!0}}}_forEachCell(r,l,p,_,v,E,C,A){const z=this._convertToXCellCoord(r),N=this._convertToYCellCoord(l),Z=this._convertToXCellCoord(p),K=this._convertToYCellCoord(_);for(let se=z;se<=Z;se++)for(let re=N;re<=K;re++)if(v.call(this,r,l,p,_,this.xCellCount*re+se,E,C,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,_,v,E){const C=_-r,A=v-l,z=p+E;return z*z>C*C+A*A}_circleAndRectCollide(r,l,p,_,v,E,C){const A=(E-_)/2,z=Math.abs(r-(_+A));if(z>A+p)return!1;const N=(C-v)/2,Z=Math.abs(l-(v+N));if(Z>N+p)return!1;if(z<=A||Z<=N)return!0;const K=z-A,se=Z-N;return K*K+se*se<=p*p}}const jt=Math.tan(85*Math.PI/180);function Fn(h,r,l,p,_,v,E){const C=c.create();if(l)if("globe"===v.name){const A=c.calculateGlobeLabelMatrix(_,r);c.multiply(C,C,A)}else{const A=Ht([],E);C[0]=A[0],C[1]=A[1],C[4]=A[2],C[5]=A[3],p||c.rotateZ(C,C,_.angle)}else c.multiply(C,_.labelPlaneMatrix,h);return C}function Tn(h,r,l,p,_,v,E){const C=Fn(h,r,l,p,_,v,E);return"globe"===v.name&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function Er(h,r,l,p,_,v,E){if(l){if("globe"===v.name){const C=Fn(h,r,l,p,_,v,E);return c.invert(C,C),c.multiply(C,h,C),C}{const C=c.clone(h),A=c.identity([]);return A[0]=E[0],A[1]=E[1],A[4]=E[2],A[5]=E[3],c.multiply(C,C,A),p||c.rotateZ(C,C,-_.angle),C}}return _.glCoordMatrix}function li(h,r,l=0){const p=[h.x,h.y,l,1];l?c.transformMat4$1(p,p,r):Tr(p,p,r);const _=p[3];return{point:[p[0]/_,p[1]/_,p[2]/_],signedDistanceFromCamera:_}}function Dn(h,r){const l=[h[0],h[1],h[2],1];c.transformMat4$1(l,l,r);const p=l[3];return{point:[l[0]/p,l[1]/p,l[2]/p],signedDistanceFromCamera:p}}function zi(h,r){return Math.min(.5+h/r*.5,1.5)}function mo(h,r){const l=h[0]/h[3],p=h[1]/h[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function To(h,r,l,p,_,v,E,C,A,z){const N=l.transform,Z=p?h.textSizeData:h.iconSizeData,K=c.evaluateSizeForZoom(Z,l.transform.zoom),se="globe"===N.projection.name,re=[256/l.width*2+1,256/l.height*2+1],ne=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ne.clear();let ie=null;se&&(ie=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const te=h.lineVertexArray,ae=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,ce=l.transform.width/l.transform.height;let ke=!1;for(let Se=0;Se<ae.length;Se++){const ve=ae.get(Se);if(ve.writingMode!==c.WritingMode.vertical||ke||0!==Se&&ae.get(Se-1).writingMode===c.WritingMode.horizontal||(ke=!0),(ve.hidden||ve.writingMode===c.WritingMode.vertical)&&!ke){Hi(ve.numGlyphs,ne);continue}ke=!1;const Ae=new c.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),Ce=A?A(Ae):[0,0,0],Be=N.projection.projectTilePoint(Ae.x,Ae.y,z.canonical),He=[Be.x+Ce[0],Be.y+Ce[1],Be.z+Ce[2]],Mt=[...He,1];if(c.transformMat4$1(Mt,Mt,r),!mo(Mt,re)){Hi(ve.numGlyphs,ne);continue}const Ve=zi(l.transform.cameraToCenterDistance,Mt[3]),at=c.evaluateSizeForFeature(Z,K,ve),_t=E?at/Ve:at*Ve,Bt=li(new c.pointGeometry(He[0],He[1]),_,He[2]);if(Bt.signedDistanceFromCamera<=0){Hi(ve.numGlyphs,ne);continue}let Qe={};const Pt=E?null:A,mt=Fa(ve,_t,!1,C,r,_,v,h.glyphOffsetArray,te,ne,ie,Bt.point,Ae,Qe,ce,Pt,N.projection,z,E);ke=mt.useVertical,Pt&&mt.needsFlipping&&(Qe={}),(mt.notEnoughRoom||ke||mt.needsFlipping&&Fa(ve,_t,!0,C,r,_,v,h.glyphOffsetArray,te,ne,ie,Bt.point,Ae,Qe,ce,Pt,N.projection,z,E).notEnoughRoom)&&Hi(ve.numGlyphs,ne)}p?(h.text.dynamicLayoutVertexBuffer.updateData(ne),ie&&h.text.globeExtVertexBuffer.updateData(ie)):(h.icon.dynamicLayoutVertexBuffer.updateData(ne),ie&&h.icon.globeExtVertexBuffer.updateData(ie))}function er(h,r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne){const ie=C.glyphStartIndex+C.numGlyphs,te=C.lineStartIndex,ae=C.lineStartIndex+C.lineLength,ce=r.getoffsetX(C.glyphStartIndex),ke=r.getoffsetX(ie-1),Se=Bi(h*ce,l,p,_,v,E,C.segment,te,ae,A,z,N,Z,K,!0,se,re,ne);if(!Se)return null;const ve=Bi(h*ke,l,p,_,v,E,C.segment,te,ae,A,z,N,Z,K,!0,se,re,ne);return ve?{first:Se,last:ve}:null}function jr(h,r,l,p){return h.writingMode===c.WritingMode.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*p?{useVertical:!0}:h.writingMode===c.WritingMode.vertical?r.y<l.y?{needsFlipping:!0}:null:0!==h.flipState&&function(_,v,E){const C=(v.x-_.x)*E;return 0===C||Math.abs((v.y-_.y)/C)>jt}(r,l,p)?1===h.flipState?{needsFlipping:!0}:null:r.x>l.x?{needsFlipping:!0}:null}function Fa(h,r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne,ie,te,ae){const ce=r/24,ke=h.lineOffsetX*ce,Se=h.lineOffsetY*ce;let ve;if(h.numGlyphs>1){const Ae=h.glyphStartIndex+h.numGlyphs,Ce=h.lineStartIndex,Be=h.lineStartIndex+h.lineLength,He=er(ce,C,ke,Se,l,Z,K,h,A,v,se,ne,!1,ie,te,ae);if(!He)return{notEnoughRoom:!0};const Mt=Dn(He.first.point,E).point,Ve=Dn(He.last.point,E).point,at=new c.pointGeometry(Mt[0],Mt[1]),_t=new c.pointGeometry(Ve[0],Ve[1]);if(p&&!l){const Bt=jr(h,at,_t,re);if(h.flipState=Bt&&Bt.needsFlipping?1:2,Bt)return Bt}ve=[He.first];for(let Bt=h.glyphStartIndex+1;Bt<Ae-1;Bt++)ve.push(Bi(ce*C.getoffsetX(Bt),ke,Se,l,Z,K,h.segment,Ce,Be,A,v,se,ne,!1,!1,ie,te,ae));ve.push(He.last)}else{if(p&&!l){const Ce=li(K,_).point,Be=h.lineStartIndex+h.segment+1,He=new c.pointGeometry(A.getx(Be),A.gety(Be)),Mt=li(He,_),Ve=Mt.signedDistanceFromCamera>0?Mt.point:Fo(K,He,Ce,1,_,void 0,ie,te.canonical),at=jr(h,new c.pointGeometry(Ce[0],Ce[1]),new c.pointGeometry(Ve[0],Ve[1]),re);if(h.flipState=at&&at.needsFlipping?1:2,at)return at}const Ae=Bi(ce*C.getoffsetX(h.glyphStartIndex),ke,Se,l,Z,K,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,A,v,se,ne,!1,!1,ie,te,ae);if(!Ae)return{notEnoughRoom:!0};ve=[Ae]}if(N)for(const Ae of ve)c.updateGlobeVertexNormal(N,z.length+0,Ae.up[0],Ae.up[1],Ae.up[2]),c.updateGlobeVertexNormal(N,z.length+1,Ae.up[0],Ae.up[1],Ae.up[2]),c.updateGlobeVertexNormal(N,z.length+2,Ae.up[0],Ae.up[1],Ae.up[2]),c.updateGlobeVertexNormal(N,z.length+3,Ae.up[0],Ae.up[1],Ae.up[2]),c.addDynamicAttributes(z,Ae.point[0],Ae.point[1],Ae.point[2],Ae.angle);else for(const Ae of ve)c.addDynamicAttributes(z,Ae.point[0],Ae.point[1],Ae.point[2],Ae.angle);return{}}function Do(h,r,l,p,_){const v=p.projectTilePoint(h.x,h.y,r);if(!_)return li(v,l,v.z);const E=_(h);return li(new c.pointGeometry(v.x+E[0],v.y+E[1]),l,v.z+E[2])}function Fo(h,r,l,p,_,v,E,C){const A=Do(h.add(h.sub(r)._unit()),C,_,E,v).point,z=c.sub([],l,A);return c.scaleAndAdd([],l,z,p/c.length(z))}function Bi(h,r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne,ie,te){const ae=p?h-r:h+r;let ce=ae>0?1:-1,ke=0;p&&(ce*=-1,ke=Math.PI),ce<0&&(ke+=Math.PI);let Se=ce>0?C+E:C+E+1,ve=_,Ae=_,Ce=0,Be=0;const He=Math.abs(ae),Mt=[],Ve=[];let at=v;const _t=()=>{const ln=Se-ce;return 0===Ce?v:new c.pointGeometry(z.getx(ln),z.gety(ln))},Bt=()=>Fo(_t(),at,Ae,He-Ce+1,N,K,ne,ie.canonical);for(;Ce+Be<=He;){if(Se+=ce,Se<C||Se>=A)return null;if(Ae=ve,Mt.push(ve),se&&Ve.push(at||_t()),ve=Z[Se],void 0===ve){at=new c.pointGeometry(z.getx(Se),z.gety(Se));const ln=Do(at,ie.canonical,N,ne,K);ve=ln.signedDistanceFromCamera>0?Z[Se]=ln.point:Bt()}else at=null;Ce+=Be,Be=c.distance(Ae,ve)}at=at||new c.pointGeometry(z.getx(Se),z.gety(Se));const Qe=_t();re&&K&&(Z[Se]=ve=void 0===Z[Se]?ve:Bt(),Be=c.distance(Ae,ve));const Pt=(He-Ce)/Be,mt=at.sub(Qe).mult(Pt)._add(Qe),Wt=c.sub([],ve,Ae),Vt=c.scaleAndAdd([],Ae,Wt,Pt);let nn=[0,0,1],fn=Wt[0],In=Wt[1];if(te&&(nn=ne.upVector(ie.canonical,mt.x,mt.y),0!==nn[0]||0!==nn[1]||1!==nn[2])){const ln=[1,0,0],Ln=[0,1,0];ln[0]=nn[2],ln[1]=0,ln[2]=-nn[0],c.cross(Ln,nn,ln),c.normalize(ln,ln),c.normalize(Ln,Ln),fn=c.dot(Wt,ln),In=c.dot(Wt,Ln)}if(l){const ln=c.cross([],nn,Wt);c.normalize(ln,ln),c.scaleAndAdd(Vt,Vt,ln,l*ce)}const cr=ke+Math.atan2(In,fn);return Mt.push(Vt),se&&Ve.push(mt),{point:Vt,angle:cr,path:Mt,tilePath:Ve,up:nn}}const Ls=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Hi(h,r){for(let l=0;l<h;l++){const p=r.length;r.resize(p+4),r.float32.set(Ls,4*p)}}function Tr(h,r,l){const p=r[0],_=r[1];return h[0]=l[0]*p+l[4]*_+l[12],h[1]=l[1]*p+l[5]*_+l[13],h[3]=l[3]*p+l[7]*_+l[15],h}const vr=100;class Di{constructor(r,l,p=new os(r.width+200,r.height+200,25),_=new os(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+vr,this.screenBottomBoundary=r.height+vr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,_,v,E,C,A){let z=p.projectedAnchorX,N=p.projectedAnchorY,Z=p.projectedAnchorZ;const K=p.elevation,se=p.tileID;if(K&&se){const Se=r.getProjection().upVector(se.canonical,p.tileAnchorX,p.tileAnchorY),ve=r.getProjection().upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=Se[0]*K*ve,N+=Se[1]*K*ve,Z+=Se[2]*K*ve}const re=this.projectAndGetPerspectiveRatio(C,[z,N,Z],p.tileID,"globe"===r.projection.name||!!K||this.transform.pitch>0,r.getProjection()),ne=E*re.perspectiveRatio,ie=(p.x1*l+_.x-p.padding)*ne+re.point.x,te=(p.y1*l+_.y-p.padding)*ne+re.point.y,ae=(p.x2*l+_.x+p.padding)*ne+re.point.x,ce=(p.y2*l+_.y+p.padding)*ne+re.point.y,ke=re.perspectiveRatio<=.55||re.occluded;return!this.isInsideGrid(ie,te,ae,ce)||!v&&this.grid.hitTest(ie,te,ae,ce,A)||ke?{box:[],offscreen:!1,occluded:re.occluded}:{box:[ie,te,ae,ce],offscreen:this.isOffscreen(ie,te,ae,ce),occluded:!1}}placeCollisionCircles(r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne){const ie=[],te=this.transform.elevation,ae=te?te.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,r.getProjection()):Qe=>[0,0,0],ce=new c.pointGeometry(p.tileAnchorX,p.tileAnchorY),ke=r.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,ne.canonical),Se=ae(ce),ve=[ke.x+Se[0],ke.y+Se[1],ke.z+Se[2]],Ae="globe"===r.projection.name,Ce=this.projectAndGetPerspectiveRatio(C,[ve[0],ve[1],ve[2]],ne,Ae||!!te||this.transform.pitch>0,r.getProjection()),{perspectiveRatio:Be}=Ce,He=(Z?E/Be:E*Be)/c.ONE_EM,Mt=li(new c.pointGeometry(ve[0],ve[1]),A,ve[2]).point,Ve=Ce.signedDistanceFromCamera>0?er(He,v,p.lineOffsetX*He,p.lineOffsetY*He,!1,Mt,ce,p,_,A,{},te&&!Z?ae:null,Z&&!!te,r.getProjection(),ne,Z):null;let at=!1,_t=!1,Bt=!0;if(Ve&&!Ce.occluded){const Qe=.5*se*Be+re,Pt=new c.pointGeometry(-100,-100),mt=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Wt=new Qn,Vt=Ve.first,nn=Ve.last;let fn=[];for(let ln=Vt.path.length-1;ln>=1;ln--)fn.push(Vt.path[ln]);for(let ln=1;ln<nn.path.length;ln++)fn.push(nn.path[ln]);const In=2.5*Qe;if(z){const ln=fn.map(te&&!Ae?(Ln,br)=>{const Yr=ae(br<Vt.path.length-1?Vt.tilePath[Vt.path.length-1-br]:nn.tilePath[br-Vt.path.length+2]);return Ln[2]=Yr[2],Dn(Ln,z)}:Ln=>Dn(Ln,z));fn=ln.some(Ln=>Ln.signedDistanceFromCamera<=0)?[]:ln.map(Ln=>Ln.point)}let cr=[];if(fn.length>0){const ln=fn.map(Lr=>new c.pointGeometry(Lr[0],Lr[1]));let Ln=1/0,br=-1/0,Yr=1/0,hi=-1/0;for(let Lr=0;Lr<ln.length;Lr++)Ln=Math.min(Ln,ln[Lr].x),Yr=Math.min(Yr,ln[Lr].y),br=Math.max(br,ln[Lr].x),hi=Math.max(hi,ln[Lr].y);cr=Ln>=Pt.x&&br<=mt.x&&Yr>=Pt.y&&hi<=mt.y?[ln]:br<Pt.x||Ln>mt.x||hi<Pt.y||Yr>mt.y?[]:c.clipLine([ln],Pt.x,Pt.y,mt.x,mt.y)}for(const ln of cr){Wt.reset(ln,.25*Qe);let Ln=0;Ln=Wt.length<=.5*Qe?1:Math.ceil(Wt.paddedLength/In)+1;for(let br=0;br<Ln;br++){const Yr=br/Math.max(Ln-1,1),hi=Wt.lerp(Yr),Lr=hi.x+vr,Ui=hi.y+vr;ie.push(Lr,Ui,Qe,0);const _s=Lr-Qe,xa=Ui-Qe,Gr=Lr+Qe,ui=Ui+Qe;if(Bt=Bt&&this.isOffscreen(_s,xa,Gr,ui),_t=_t||this.isInsideGrid(_s,xa,Gr,ui),!l&&this.grid.hitTestCircle(Lr,Ui,Qe,K)&&(at=!0,!N))return{circles:[],offscreen:!1,collisionDetected:at,occluded:!1}}}}return{circles:!N&&at||!_t?[]:ie,offscreen:Bt,collisionDetected:at,occluded:Ce.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,_=1/0,v=-1/0,E=-1/0;for(const N of r){const Z=new c.pointGeometry(N.x+vr,N.y+vr);p=Math.min(p,Z.x),_=Math.min(_,Z.y),v=Math.max(v,Z.x),E=Math.max(E,Z.y),l.push(Z)}const C=this.grid.query(p,_,v,E).concat(this.ignoredGrid.query(p,_,v,E)),A={},z={};for(const N of C){const Z=N.key;if(void 0===A[Z.bucketInstanceId]&&(A[Z.bucketInstanceId]={}),A[Z.bucketInstanceId][Z.featureIndex])continue;const K=[new c.pointGeometry(N.x1,N.y1),new c.pointGeometry(N.x2,N.y1),new c.pointGeometry(N.x2,N.y2),new c.pointGeometry(N.x1,N.y2)];c.polygonIntersectsPolygon(l,K)&&(A[Z.bucketInstanceId][Z.featureIndex]=!0,void 0===z[Z.bucketInstanceId]&&(z[Z.bucketInstanceId]=[]),z[Z.bucketInstanceId].push(Z.featureIndex))}return z}insertCollisionBox(r,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,_,v){const E=l?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let A=0;A<r.length;A+=4)E.insertCircle(C,r[A],r[A+1],r[A+2])}projectAndGetPerspectiveRatio(r,l,p,_,v){const E=[l[0],l[1],l[2],1];let C=!1;if(l[2]||this.transform.pitch>0){c.transformMat4$1(E,E,r);const A="globe"===v.name;this.fogState&&p&&!A&&(C=function(z,N,Z,K,se,re){const ne=re.calculateFogTileMatrix(se),ie=[N,Z,K];return c.transformMat4(ie,ie,ne),We(z,ie,re.pitch,re._fov)}(this.fogState,l[0],l[1],l[2],p.toUnwrapped(),this.transform)>.9)}else Tr(E,E,r);return{point:new c.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+vr,(-E[1]/E[3]+1)/2*this.transform.height+vr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/E[3]*.5,1.5),signedDistanceFromCamera:E[3],occluded:_&&E[2]>E[3]||C}}isOffscreen(r,l,p,_){return p<vr||r>=this.screenRightBoundary||_<vr||l>this.screenBottomBoundary}isInsideGrid(r,l,p,_){return p>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=c.identity([]);return c.translate(r,r,[-100,-100,0]),r}}function Xr(h,r,l){const p=r.createTileMatrix(h,h.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),h.projMatrix,p)}function Ci(h,r,l){if(r.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(r.projection),Xr(p,r.getProjection(),h)}function gr(h,r,l){return r.name===l.projection.name?h.projMatrix:Xr(l,r,h)}class Yo{constructor(r,l,p,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class gi{constructor(r,l,p,_,v,E=!1){this.text=new Yo(r?r.text:null,l,p,v),this.icon=new Yo(r?r.icon:null,l,_,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ei{constructor(r,l,p,_=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=_}}class za{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class xl{constructor(r,l,p,_,v){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class ia{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function Ii(h,r,l,p,_){const{horizontalAlign:v,verticalAlign:E}=c.getAnchorAlignment(h),C=-(v-.5)*r,A=-(E-.5)*l,z=c.evaluateVariableOffset(h,p);return new c.pointGeometry(C+z[0]*_,A+z[1]*_)}function Ba(h,r,l,p,_){const v=new c.pointGeometry(h,r);return l&&v._rotate(p?_:-_),v}class tc{constructor(r,l,p,_,v){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Di(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ia(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,_){const v=p.getBucket(l),E=p.latestFeatureIndex;if(!v||!E||l.id!==v.layerIds[0])return;const C=v.layers[0].layout,A=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/c.EXTENT,Z=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);const K=(se=p.tileID,re=v.getProjection(),ne=this.transform,re.name===this.projection?ne.calculateProjMatrix(se.toUnwrapped()):Xr(ne,re,se));var se,re,ne;const ie="map"===C.get("text-pitch-alignment"),te="map"===C.get("text-rotation-alignment");l.compileFilter();const ae=l.dynamicFilter(),ce=l.dynamicFilterNeedsFeature(),ke=this.transform.calculatePixelsToTileUnitsMatrix(p),Se=Tn(K,p.tileID.canonical,ie,te,this.transform,v.getProjection(),ke);let ve=null;if(ie){const Be=Er(K,p.tileID.canonical,ie,te,this.transform,v.getProjection(),ke);ve=c.multiply([],this.transform.labelPlaneMatrix,Be)}let Ae=null;ae&&p.latestFeatureIndex&&(Ae={unwrappedTileID:Z,dynamicFilter:ae,dynamicFilterNeedsFeature:ce,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new xl(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const Ce={bucket:v,layout:C,posMatrix:K,textLabelPlaneMatrix:Se,labelToScreenMatrix:ve,clippingData:Ae,scale:z,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const Be of v.sortKeyRanges){const{sortKey:He,symbolInstanceStart:Mt,symbolInstanceEnd:Ve}=Be;r.push({sortKey:He,symbolInstanceStart:Mt,symbolInstanceEnd:Ve,parameters:Ce})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne,ie,te,ae){const ce=[K.textOffset0,K.textOffset1],ke=Ii(r,p,_,ce,v),Se=this.collisionIndex.placeCollisionBox(re,v,l,Ba(ke.x,ke.y,E,C,this.transform.angle),Z,A,z,N.predicate);if((!ie||0!==this.collisionIndex.placeCollisionBox(re,re.getSymbolInstanceIconSize(ae,this.transform.zoom,se),ie,Ba(ke.x,ke.y,E,C,this.transform.angle),Z,A,z,N.predicate).box.length)&&Se.box.length>0){let ve;return this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(ve=this.prevPlacement.variableOffsets[K.crossTileID].anchor),this.variableOffsets[K.crossTileID]={textOffset:ce,width:p,height:_,anchor:r,textScale:v,prevAnchor:ve},this.markUsedJustification(re,r,K,ne),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ne,K),this.placedOrientations[K.crossTileID]=ne),{shift:ke,placedGlyphBoxes:Se}}}placeLayerBucketPart(r,l,p,_){const{bucket:v,layout:E,posMatrix:C,textLabelPlaneMatrix:A,labelToScreenMatrix:z,clippingData:N,textPixelRatio:Z,holdingForFade:K,collisionBoxArray:se,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ne,collisionGroup:ie}=r.parameters,te=E.get("text-optional"),ae=E.get("icon-optional"),ce=E.get("text-allow-overlap"),ke=E.get("icon-allow-overlap"),Se="map"===E.get("text-rotation-alignment"),ve="map"===E.get("text-pitch-alignment"),Ae="none"!==E.get("icon-text-fit"),Ce="viewport-y"===E.get("symbol-z-order");this.transform.setProjection(v.projection);let Be=ce&&(ke||!v.hasIconData()||ae),He=ke&&(ce||!v.hasTextData()||te);!v.collisionArrays&&se&&v.deserializeCollisionBoxes(se),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,se);const Mt=(Ve,at,_t)=>{if(N){const Gr={zoom:this.transform.zoom,pitch:this.transform.pitch};let ui=null;if(N.dynamicFilterNeedsFeature){const Zn=this.retainedQueryData[v.bucketInstanceId];ui=N.featureIndex.loadFeature({featureIndex:Ve.featureIndex,bucketIndex:Zn.bucketIndex,sourceLayerIndex:Zn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(Gr,ui,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new c.pointGeometry(Ve.tileAnchorX,Ve.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Ve.crossTileID]=new ei(!1,!1,!1,!0),void(l[Ve.crossTileID]=!0)}if(l[Ve.crossTileID])return;if(K)return void(this.placements[Ve.crossTileID]=new ei(!1,!1,!1));let Bt=!1,Qe=!1,Pt=!0,mt=!1,Wt=!1,Vt=null,nn={box:null,offscreen:null,occluded:null},fn={box:null,offscreen:null,occluded:null},In=null,cr=null,ln=null,Ln=0,br=0,Yr=0;_t.textFeatureIndex?Ln=_t.textFeatureIndex:Ve.useRuntimeCollisionCircles&&(Ln=Ve.featureIndex),_t.verticalTextFeatureIndex&&(br=_t.verticalTextFeatureIndex);const hi=Gr=>{Gr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||Gr.elevation)&&(Gr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,Gr.tileAnchorX,Gr.tileAnchorY):0)},Lr=_t.textBox;if(Lr){hi(Lr);const Gr=Zn=>{let ji=c.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Zn&&this.prevPlacement){const eo=this.prevPlacement.placedOrientations[Ve.crossTileID];eo&&(this.placedOrientations[Ve.crossTileID]=eo,ji=eo,this.markUsedOrientation(v,ji,Ve))}return ji},ui=(Zn,ji)=>{if(v.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&_t.verticalTextBox){for(const eo of v.writingModes)if(eo===c.WritingMode.vertical?(nn=ji(),fn=nn):nn=Zn(),nn&&nn.box&&nn.box.length)break}else nn=Zn()};if(E.get("text-variable-anchor")){let Zn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ve.crossTileID]){const Vr=this.prevPlacement.variableOffsets[Ve.crossTileID];Zn.indexOf(Vr.anchor)>0&&(Zn=Zn.filter(so=>so!==Vr.anchor),Zn.unshift(Vr.anchor))}const ji=(Vr,so,Xs)=>{const ao=v.getSymbolInstanceTextSize(re,Ve,this.transform.zoom,at),ys=(Vr.x2-Vr.x1)*ao+2*Vr.padding,Nl=(Vr.y2-Vr.y1)*ao+2*Vr.padding,Ul=Ae&&!ke?so:null;Ul&&hi(Ul);let Ho={box:[],offscreen:!1,occluded:!1};const Ys=ce?2*Zn.length:Zn.length;for(let Ks=0;Ks<Ys;++Ks){const pc=this.attemptAnchorPlacement(Zn[Ks%Zn.length],Vr,ys,Nl,ao,Se,ve,Z,C,ie,Ks>=Zn.length,Ve,at,v,Xs,Ul,re,ne);if(pc&&(Ho=pc.placedGlyphBoxes,Ho&&Ho.box&&Ho.box.length)){Bt=!0,Vt=pc.shift;break}}return Ho};ui(()=>ji(Lr,_t.iconBox,c.WritingMode.horizontal),()=>{const Vr=_t.verticalTextBox;return Vr&&hi(Vr),v.allowVerticalPlacement&&!(nn&&nn.box&&nn.box.length)&&Ve.numVerticalGlyphVertices>0&&Vr?ji(Vr,_t.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),nn&&(Bt=nn.box,Pt=nn.offscreen,mt=nn.occluded);const eo=Gr(nn&&nn.box);if(!Bt&&this.prevPlacement){const Vr=this.prevPlacement.variableOffsets[Ve.crossTileID];Vr&&(this.variableOffsets[Ve.crossTileID]=Vr,this.markUsedJustification(v,Vr.anchor,Ve,eo))}}else{const Zn=(ji,eo)=>{const Vr=v.getSymbolInstanceTextSize(re,Ve,this.transform.zoom,at),so=this.collisionIndex.placeCollisionBox(v,Vr,ji,new c.pointGeometry(0,0),ce,Z,C,ie.predicate);return so&&so.box&&so.box.length&&(this.markUsedOrientation(v,eo,Ve),this.placedOrientations[Ve.crossTileID]=eo),so};ui(()=>Zn(Lr,c.WritingMode.horizontal),()=>{const ji=_t.verticalTextBox;return v.allowVerticalPlacement&&Ve.numVerticalGlyphVertices>0&&ji?(hi(ji),Zn(ji,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(nn&&nn.box&&nn.box.length)}}if(In=nn,Bt=In&&In.box&&In.box.length>0,Pt=In&&In.offscreen,mt=In&&In.occluded,Ve.useRuntimeCollisionCircles){const Gr=v.text.placedSymbolArray.get(Ve.centerJustifiedTextSymbolIndex>=0?Ve.centerJustifiedTextSymbolIndex:Ve.verticalPlacedTextSymbolIndex),ui=c.evaluateSizeForFeature(v.textSizeData,re,Gr),Zn=E.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(v,ce,Gr,v.lineVertexArray,v.glyphOffsetArray,ui,C,A,z,p,ve,ie.predicate,Ve.collisionCircleDiameter*ui/c.ONE_EM,Zn,this.retainedQueryData[v.bucketInstanceId].tileID),Bt=ce||cr.circles.length>0&&!cr.collisionDetected,Pt=Pt&&cr.offscreen,mt=cr.occluded}if(_t.iconFeatureIndex&&(Yr=_t.iconFeatureIndex),_t.iconBox){const Gr=ui=>{hi(ui);const Zn=Ae&&Vt?Ba(Vt.x,Vt.y,Se,ve,this.transform.angle):new c.pointGeometry(0,0),ji=v.getSymbolInstanceIconSize(ne,this.transform.zoom,at);return this.collisionIndex.placeCollisionBox(v,ji,ui,Zn,ke,Z,C,ie.predicate)};fn&&fn.box&&fn.box.length&&_t.verticalIconBox?(ln=Gr(_t.verticalIconBox),Qe=ln.box.length>0):(ln=Gr(_t.iconBox),Qe=ln.box.length>0),Pt=Pt&&ln.offscreen,Wt=ln.occluded}const Ui=te||0===Ve.numHorizontalGlyphVertices&&0===Ve.numVerticalGlyphVertices,_s=ae||0===Ve.numIconVertices;if(Ui||_s?_s?Ui||(Qe=Qe&&Bt):Bt=Qe&&Bt:Qe=Bt=Qe&&Bt,Bt&&In&&In.box&&this.collisionIndex.insertCollisionBox(In.box,E.get("text-ignore-placement"),v.bucketInstanceId,fn&&fn.box&&br?br:Ln,ie.ID),Qe&&ln&&this.collisionIndex.insertCollisionBox(ln.box,E.get("icon-ignore-placement"),v.bucketInstanceId,Yr,ie.ID),cr&&(Bt&&this.collisionIndex.insertCollisionCircles(cr.circles,E.get("text-ignore-placement"),v.bucketInstanceId,Ln,ie.ID),p)){const Gr=v.bucketInstanceId;let ui=this.collisionCircleArrays[Gr];void 0===ui&&(ui=this.collisionCircleArrays[Gr]=new za);for(let Zn=0;Zn<cr.circles.length;Zn+=4)ui.circles.push(cr.circles[Zn+0]),ui.circles.push(cr.circles[Zn+1]),ui.circles.push(cr.circles[Zn+2]),ui.circles.push(cr.collisionDetected?1:0)}const xa="globe"!==v.projection.name;Be=Be&&(xa||!mt),He=He&&(xa||!Wt),this.placements[Ve.crossTileID]=new ei(Bt||Be,Qe||He,Pt||v.justReloaded),l[Ve.crossTileID]=!0};if(Ce){const Ve=v.getSortedSymbolIndexes(this.transform.angle);for(let at=Ve.length-1;at>=0;--at){const _t=Ve[at];Mt(v.symbolInstances.get(_t),_t,v.collisionArrays[_t])}}else for(let Ve=r.symbolInstanceStart;Ve<r.symbolInstanceEnd;Ve++)Mt(v.symbolInstances.get(Ve),Ve,v.collisionArrays[Ve]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const Ve=this.collisionCircleArrays[v.bucketInstanceId];c.invert(Ve.invProjMatrix,C),Ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,l,p,_){let v;v=_===c.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[c.getAnchorJustification(l)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=v>=0&&C!==v?0:p.crossTileID)}markUsedOrientation(r,l,p){const _=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,v=l===c.WritingMode.vertical?l:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of E)r.text.placedSymbolArray.get(C).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,v=l?l.opacities:{},E=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const A in this.placements){const z=this.placements[A],N=v[A];N?(this.opacities[A]=new gi(N,_,z.text,z.icon,null,z.clipped),p=p||z.text!==N.text.placed||z.icon!==N.icon.placed):(this.opacities[A]=new gi(null,_,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const A in v){const z=v[A];if(!this.opacities[A]){const N=new gi(z,_,!1,!1);N.isHidden()||(this.opacities[A]=N,p=p||z.text.placed||z.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in C)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=C[A]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const p={};for(const _ of l){const v=_.getBucket(r);v&&_.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(r,l,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),E=new gi(null,0,!1,!1,!0),C=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),N="map"===_.get("text-rotation-alignment"),Z="map"===_.get("text-pitch-alignment"),K="none"!==_.get("icon-text-fit"),se=new gi(null,0,C&&(A||!r.hasIconData()||_.get("icon-optional")),A&&(C||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const re=(ie,te,ae)=>{for(let ce=0;ce<te/4;ce++)ie.opacityVertexArray.emplaceBack(ae)};let ne=0;for(let ie=0;ie<r.symbolInstances.length;ie++){const te=r.symbolInstances.get(ie),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:ce,crossTileID:ke}=te;let Se=this.opacities[ke];l[ke]?Se=E:Se||(Se=se,this.opacities[ke]=Se),l[ke]=!0;const ve=ae>0||ce>0,Ae=te.numIconVertices>0,Ce=this.placedOrientations[te.crossTileID],Be=Ce===c.WritingMode.vertical,He=Ce===c.WritingMode.horizontal||Ce===c.WritingMode.horizontalOnly;if(!ve&&!Ae||Se.isHidden()||ne++,ve){const Mt=Ko(Se.text);re(r.text,ae,Be?_i:Mt),re(r.text,ce,He?_i:Mt);const Ve=Se.text.isHidden();[te.rightJustifiedTextSymbolIndex,te.centerJustifiedTextSymbolIndex,te.leftJustifiedTextSymbolIndex].forEach(Bt=>{Bt>=0&&(r.text.placedSymbolArray.get(Bt).hidden=Ve||Be?1:0)}),te.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(te.verticalPlacedTextSymbolIndex).hidden=Ve||He?1:0);const at=this.variableOffsets[te.crossTileID];at&&this.markUsedJustification(r,at.anchor,te,Ce);const _t=this.placedOrientations[te.crossTileID];_t&&(this.markUsedJustification(r,"left",te,_t),this.markUsedOrientation(r,_t,te))}if(Ae){const Mt=Ko(Se.icon);te.placedIconSymbolIndex>=0&&(re(r.icon,te.numIconVertices,Be?_i:Mt),r.icon.placedSymbolArray.get(te.placedIconSymbolIndex).hidden=Se.icon.isHidden()),te.verticalPlacedIconSymbolIndex>=0&&(re(r.icon,te.numVerticalIconVertices,He?_i:Mt),r.icon.placedSymbolArray.get(te.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Mt=r.collisionArrays[ie];if(Mt){let Ve=new c.pointGeometry(0,0),at=!0;if(Mt.textBox||Mt.verticalTextBox){if(z){const Bt=this.variableOffsets[ke];Bt?(Ve=Ii(Bt.anchor,Bt.width,Bt.height,Bt.textOffset,Bt.textScale),N&&Ve._rotate(Z?this.transform.angle:-this.transform.angle)):at=!1}v&&(at=!Se.clipped),Mt.textBox&&Co(r.textCollisionBox.collisionVertexArray,Se.text.placed,!at||Be,Ve.x,Ve.y),Mt.verticalTextBox&&Co(r.textCollisionBox.collisionVertexArray,Se.text.placed,!at||He,Ve.x,Ve.y)}const _t=at&&Boolean(!He&&Mt.verticalIconBox);Mt.iconBox&&Co(r.iconCollisionBox.collisionVertexArray,Se.icon.placed,_t,K?Ve.x:0,K?Ve.y:0),Mt.verticalIconBox&&Co(r.iconCollisionBox.collisionVertexArray,Se.icon.placed,!_t,K?Ve.x:0,K?Ve.y:0)}}}if(r.fullyClipped=0===ne,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ie.invProjMatrix,r.placementViewportMatrix=ie.viewportMatrix,r.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Co(h,r,l,p,_){h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0),h.emplaceBack(r?1:0,l?1:0,p||0,_||0)}const Na=Math.pow(2,25),bl=Math.pow(2,24),gu=Math.pow(2,17),wl=Math.pow(2,16),oa=Math.pow(2,9),kc=Math.pow(2,8),El=Math.pow(2,1);function Ko(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const r=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Na+r*bl+l*gu+r*wl+l*oa+r*kc+l*El+r}const _i=0;class ss{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,p,_,v){const E=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(E,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,A)=>C.sortKey-A.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,p,0===C.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class zo{constructor(r,l,p,_,v,E,C,A){this.placement=new tc(r,v,E,C,A),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p){const _=c.exported.now(),v=()=>{const E=c.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=l[r[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new ss(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const as=512/c.EXTENT/2;class sa{constructor(r,l,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const v=l.get(_),E=v.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,l){const p=as/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+r.tileAnchorX)*p),y:Math.floor((l.canonical.y*c.EXTENT+r.tileAnchorY)*p)}}findMatches(r,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let v=0;v<r.length;v++){const E=r.get(v);if(E.crossTileID)continue;const C=this.indexedSymbolInstances[E.key];if(!C)continue;const A=this.getScaledCoordinates(E,l);for(const z of C)if(Math.abs(z.coord.x-A.x)<=_&&Math.abs(z.coord.y-A.y)<=_&&!p[z.crossTileID]){p[z.crossTileID]=!0,E.crossTileID=z.crossTileID;break}}}}class Os{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _u{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(0!==l)for(const p in this.indexes){const _=this.indexes[p],v={};for(const E in _){const C=_[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),v[C.tileID.key]=C}this.indexes[p]=v}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>r.overscaledZ)for(const C in E){const A=E[C];A.tileID.isChildOf(r)&&A.findMatches(l.symbolInstances,r,_)}else{const C=E[r.scaledTo(Number(v)).key];C&&C.findMatches(l.symbolInstances,r,_)}}for(let v=0;v<l.symbolInstances.length;v++){const E=l.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),_[E.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new sa(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)r[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class Bo{constructor(){this.layerIndexes={},this.crossTileIDs=new Os,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,_){let v=this.layerIndexes[r.id];void 0===v&&(v=this.layerIndexes[r.id]=new _u);let E=!1;const C={};"globe"!==_.name&&v.handleWrapJump(p);for(const A of l){const z=A.getBucket(r);z&&r.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(A.tileID,z,this.crossTileIDs)&&(E=!0),C[z.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const ls=(h,r)=>c.emitValidationErrors(h,r&&r.filter(l=>"source.canvas"!==l.identifier)),aa=c.pick(Zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ua=c.pick(Zt,["setCenter","setZoom","setBearing","setPitch"]),Tl={version:8,layers:[],sources:{}},nc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ki extends c.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Sr(_n(),this),this.imageManager=new sr,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(r._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new c.LineAtlas(256,512),this.crossTileSymbolIndex=new Bo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new c.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const p=this;this._rtlTextPluginCallback=Ki.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,E)=>{if(c.triggerPluginCompletionEvent(v),E&&E.every(C=>C))for(const C in p._sourceCaches){const A=p._sourceCaches[C],z=A.getSource().type;"vector"!==z&&"geojson"!==z||A.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===v.id&&this._validateLayer(C)}})}loadURL(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const _=this.map._requestManager.transformRequest(r,c.ResourceType.Style);this._request=c.getJSON(_,(v,E)=>{this._request=null,v?this.fire(new c.ErrorEvent(v)):E&&this._load(E,p)})}loadJSON(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(r,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Tl,!1)}_updateLayerCount(r,l){const p=l?1:-1;r.is3D()&&(this._num3DLayers+=p),"circle"===r.type&&(this._numCircleLayers+=p),"symbol"===r.type&&(this._numSymbolLayers+=p)}_load(r,l){if(l&&ls(this,c.validateStyle(r)))return;this._loaded=!0,this.stylesheet=c.clone$1(r),this._updateMapProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=tn(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=c.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new en(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,p,_){let v,E,C;const A=c.exported.devicePixelRatio>1?"@2x":"";let z=c.getJSON(p.transformRequest(p.normalizeSpriteURL(l,A,".json"),c.ResourceType.SpriteJSON),(K,se)=>{z=null,C||(C=K,v=se,Z())}),N=c.getImage(p.transformRequest(p.normalizeSpriteURL(l,A,".png"),c.ResourceType.SpriteImage),(K,se)=>{N=null,C||(C=K,E=se,Z())});function Z(){if(C)_(C);else if(v&&E){const K=c.exported.getImageData(E),se={};for(const re in v){const{width:ne,height:ie,x:te,y:ae,sdf:ce,pixelRatio:ke,stretchX:Se,stretchY:ve,content:Ae}=v[re],Ce=new c.RGBAImage({width:ne,height:ie});c.RGBAImage.copy(K,Ce,{x:te,y:ae},{x:0,y:0},{width:ne,height:ie}),se[re]={data:Ce,pixelRatio:ke,sdf:ce,stretchX:Se,stretchY:ve,content:Ae}}_(null,se)}}return{cancel(){z&&(z.cancel(),z=null),N&&(N.cancel(),N=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const p=r.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const p of r){const _=this._layers[p];"custom"!==_.type&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&nc[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const E in this._updatedSources){const C=this._updatedSources[E];"reload"===C?this._reloadSource(E):"clear"===C&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){const C=this._getLayerSourceCache(v);C&&(C.used=!0)}const E=this.map.painter;if(E){const C=v.getProgramIds();if(!C)continue;const A=v.getProgramConfiguration(r.zoom);for(const z of C)E.useProgram(z,A)}}for(const _ in p){const v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),ls(this,c.validateStyle(r)))return!1;(r=c.clone$1(r)).layers=tn(r.layers);const l=function(_,v){if(!_)return[{command:Zt.setStyle,args:[v]}];let E=[];try{if(!Fe(_.version,v.version))return[{command:Zt.setStyle,args:[v]}];Fe(_.center,v.center)||E.push({command:Zt.setCenter,args:[v.center]}),Fe(_.zoom,v.zoom)||E.push({command:Zt.setZoom,args:[v.zoom]}),Fe(_.bearing,v.bearing)||E.push({command:Zt.setBearing,args:[v.bearing]}),Fe(_.pitch,v.pitch)||E.push({command:Zt.setPitch,args:[v.pitch]}),Fe(_.sprite,v.sprite)||E.push({command:Zt.setSprite,args:[v.sprite]}),Fe(_.glyphs,v.glyphs)||E.push({command:Zt.setGlyphs,args:[v.glyphs]}),Fe(_.transition,v.transition)||E.push({command:Zt.setTransition,args:[v.transition]}),Fe(_.light,v.light)||E.push({command:Zt.setLight,args:[v.light]}),Fe(_.fog,v.fog)||E.push({command:Zt.setFog,args:[v.fog]}),Fe(_.projection,v.projection)||E.push({command:Zt.setProjection,args:[v.projection]});const C={},A=[];!function(Z,K,se,re){let ne;for(ne in K=K||{},Z=Z||{})Z.hasOwnProperty(ne)&&(K.hasOwnProperty(ne)||mi(ne,se,re));for(ne in K)K.hasOwnProperty(ne)&&(Z.hasOwnProperty(ne)?Fe(Z[ne],K[ne])||("geojson"===Z[ne].type&&"geojson"===K[ne].type&&Ti(Z,K,ne)?se.push({command:Zt.setGeoJSONSourceData,args:[ne,K[ne].data]}):$n(ne,K,se,re)):Ke(ne,K,se))}(_.sources,v.sources,A,C);const z=[];_.layers&&_.layers.forEach(Z=>{Z.source&&C[Z.source]?E.push({command:Zt.removeLayer,args:[Z.id]}):z.push(Z)});let N=_.terrain;N&&C[N.source]&&(E.push({command:Zt.setTerrain,args:[void 0]}),N=void 0),E=E.concat(A),Fe(N,v.terrain)||E.push({command:Zt.setTerrain,args:[v.terrain]}),function(Z,K,se){K=K||[];const re=(Z=Z||[]).map(qr),ne=K.map(qr),ie=Z.reduce(po,{}),te=K.reduce(po,{}),ae=re.slice(),ce=Object.create(null);let ke,Se,ve,Ae,Ce,Be,He;for(ke=0,Se=0;ke<re.length;ke++)ve=re[ke],te.hasOwnProperty(ve)?Se++:(se.push({command:Zt.removeLayer,args:[ve]}),ae.splice(ae.indexOf(ve,Se),1));for(ke=0,Se=0;ke<ne.length;ke++)ve=ne[ne.length-1-ke],ae[ae.length-1-ke]!==ve&&(ie.hasOwnProperty(ve)?(se.push({command:Zt.removeLayer,args:[ve]}),ae.splice(ae.lastIndexOf(ve,ae.length-Se),1)):Se++,Be=ae[ae.length-ke],se.push({command:Zt.addLayer,args:[te[ve],Be]}),ae.splice(ae.length-ke,0,ve),ce[ve]=!0);for(ke=0;ke<ne.length;ke++)if(ve=ne[ke],Ae=ie[ve],Ce=te[ve],!ce[ve]&&!Fe(Ae,Ce))if(Fe(Ae.source,Ce.source)&&Fe(Ae["source-layer"],Ce["source-layer"])&&Fe(Ae.type,Ce.type)){for(He in Br(Ae.layout,Ce.layout,se,ve,null,Zt.setLayoutProperty),Br(Ae.paint,Ce.paint,se,ve,null,Zt.setPaintProperty),Fe(Ae.filter,Ce.filter)||se.push({command:Zt.setFilter,args:[ve,Ce.filter]}),Fe(Ae.minzoom,Ce.minzoom)&&Fe(Ae.maxzoom,Ce.maxzoom)||se.push({command:Zt.setLayerZoomRange,args:[ve,Ce.minzoom,Ce.maxzoom]}),Ae)Ae.hasOwnProperty(He)&&"layout"!==He&&"paint"!==He&&"filter"!==He&&"metadata"!==He&&"minzoom"!==He&&"maxzoom"!==He&&(0===He.indexOf("paint.")?Br(Ae[He],Ce[He],se,ve,He.slice(6),Zt.setPaintProperty):Fe(Ae[He],Ce[He])||se.push({command:Zt.setLayerProperty,args:[ve,He,Ce[He]]}));for(He in Ce)Ce.hasOwnProperty(He)&&!Ae.hasOwnProperty(He)&&"layout"!==He&&"paint"!==He&&"filter"!==He&&"metadata"!==He&&"minzoom"!==He&&"maxzoom"!==He&&(0===He.indexOf("paint.")?Br(Ae[He],Ce[He],se,ve,He.slice(6),Zt.setPaintProperty):Fe(Ae[He],Ce[He])||se.push({command:Zt.setLayerProperty,args:[ve,He,Ce[He]]}))}else se.push({command:Zt.removeLayer,args:[ve]}),Be=ae[ae.lastIndexOf(ve)+1],se.push({command:Zt.addLayer,args:[Ce,Be]})}(z,v.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Zt.setStyle,args:[v]}]}return E}(this.serialize(),r).filter(_=>!(_.command in Ua));if(0===l.length)return!1;const p=l.filter(_=>!(_.command in aa));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{"setTransition"!==_.command&&"setProjection"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=$e(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:_.serialize(),sourceId:r}));const v=E=>{const C=(E?"symbol:":"other:")+r,A=this._sourceCaches[C]=new c.SourceCache(C,_,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[r]=A,A.style=this,A.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}addLayer(r,l,p={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if("custom"===r.type){if(ls(this,c.validateCustomStyleLayer(r)))return;v=c.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(_,r.source),r=c.clone$1(r),r=c.extend(r,{source:_})),this._validate(c.validateLayer,`layers.${_}`,r,{arrayIndex:-1},p))return;v=c.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const E=l?this._order.indexOf(l):this._order.length;if(l&&-1===E)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const C=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&C&&"custom"!==v.type){const A=this._removedLayers[_];delete this._removedLayers[_],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const p=this._order.indexOf(r);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&-1===_?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===p||(null!=l&&(_.minzoom=l),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,p={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!Fe(_.filter,l))return null==l?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(c.validateFilter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=c.clone$1(l),this._updateLayer(_)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&c.clone$1(l.filter)}setLayoutProperty(r,l,p,_={}){this._checkLoaded();const v=this.getLayer(r);v?Fe(v.getLayoutProperty(l),p)||(v.setLayoutProperty(l,p,_),this._updateLayer(v)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const p=this.getLayer(r);if(p)return p.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,p,_={}){this._checkLoaded();const v=this.getLayer(r);v?Fe(v.getPaintProperty(l),p)||(v.setPaintProperty(l,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const p=this.getLayer(r);return p&&p.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const p=r.source,_=r.sourceLayer,v=this.getSource(p);if(!v)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.type;if("geojson"===E&&_)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!_)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(p);for(const A of C)A.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const p=r.source,_=this.getSource(p);if(!_)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.type,E="vector"===v?r.sourceLayer:void 0;if("vector"===v&&!E)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(p);for(const A of C)A.removeFeatureState(E,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,p=r.sourceLayer,_=this.getSource(l);if(_){if("vector"!==_.type||p)return void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=E=>"fill-extrusion"===this._layers[E].type,p={},_=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(l(C)){p[C]=E;for(const A of r){const z=A[C];if(z)for(const N of z)_.push(N)}}}_.sort((E,C)=>C.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(l(C))for(let A=_.length-1;A>=0;A--){const z=_[A].feature;if(p[z.layer.id]<E)break;v.push(z),_.pop()}else for(const A of r){const z=A[C];if(z)for(const N of z)v.push(N.feature)}}return v}queryRenderedFeatures(r,l,p){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of l.layers){const z=this._layers[A];if(!z)return this.fire(new c.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const v=[];l.availableImages=this._availableImages;const E=l&&l.layers?l.layers.some(A=>{const z=this.getLayer(A);return z&&z.is3D()}):this.has3DLayers(),C=qn.createFromScreenPoints(r,p);for(const A in this._sourceCaches){const z=this._sourceCaches[A].getSource().id;l.layers&&!_[z]||v.push(Ee(this._sourceCaches[A],this._layers,this._serializedLayers,C,l,p,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(A,z,N,Z,K,se,re){const ne={},ie=se.queryRenderedSymbols(Z),te=[];for(const ae of Object.keys(ie).map(Number))te.push(re[ae]);te.sort(oe);for(const ae of te){const ce=ae.featureIndex.lookupSymbolFeatures(ie[ae.bucketInstanceId],z,ae.bucketIndex,ae.sourceLayerIndex,K.filter,K.layers,K.availableImages,A);for(const ke in ce){const Se=ne[ke]=ne[ke]||[],ve=ce[ke];ve.sort((Ae,Ce)=>{const Be=ae.featureSortOrder;if(Be){const He=Be.indexOf(Ae.featureIndex);return Be.indexOf(Ce.featureIndex)-He}return Ce.featureIndex-Ae.featureIndex});for(const Ae of ve)Se.push(Ae)}}for(const ae in ne)ne[ae].forEach(ce=>{const ke=ce.feature,Se=N(A[ae]).getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Se});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(r);let _=[];for(const v of p)_=_.concat(le(v,l));return _}addSourceType(r,l,p){return Ki.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Ki.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const E in r)if(!Fe(r[E],p[E])){_=!0;break}if(!_)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof r.source){const p="terrain-dem-src";this.addSource(p,r.source),r=c.clone$1(r),r=c.extend(r,{source:p})}if(this._validate(c.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const p=this.terrain,_=p.get();for(const v of Object.keys(c.spec.terrain))!r.hasOwnProperty(v)&&c.spec.terrain[v].default&&(r[v]=c.spec.terrain[v].default);for(const v in r)if(!Fe(r[v],_[v])){p.set(r),this.stylesheet.terrain=r;const E=this._setTransitionParameters({duration:0});p.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new dn(r,this.map.transform);this.stylesheet.fog=r;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();0===Object.keys(r).length&&l.set(r);for(const _ in r)if(!Fe(r[_],p[_])){l.set(r),this.stylesheet.fog=r;const v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:c.exported.now(),transition:c.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new ot(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"symbol"===l.type&&this._updateLayer(l)}}_validate(r,l,p,_,v={}){return(!v||!1!==v.validate)&&ls(this,r.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:p,styleSpec:c.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const p of l)p.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const p of l)p.resume(),p.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,_,v=!1){let E=!1,C=!1;const A={};for(const z of this._order){const N=this._layers[z];if("symbol"!==N.type)continue;if(!A[N.source]){const K=this._getLayerSourceCache(N);if(!K)continue;A[N.source]=K.getRenderableIds(!0).map(se=>K.getTileByID(se)).sort((se,re)=>re.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(re.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(N,A[N.source],r.center.lng,r.projection);E=E||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),r.zoom))&&(this.pauseablePlacement=new zo(r,this._order,v,l,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const z of this._order){const N=this._layers[z];"symbol"===N.type&&this.placement.updateLayerOpacities(N,A[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return c.makeRequest(l,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return 0===l.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ki.getSourceType=function(h){return Re[h]},Ki.setSourceType=function(h,r){Re[h]=r},Ki.registerForPluginStateChange=c.registerForPluginStateChange;var Dl="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Fs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ja="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Cl="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",yi="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let cs={},us={};const No=[];Uo(Dl,No),Uo(ja,No),Uo(Cl,No),Uo(yi,No),cs=lr("",ja),us=lr(yi,Cl);const zs=lr("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),rc=Dl,Hn="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Bs={background:lr("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:lr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:lr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:lr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:lr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:lr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:lr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:lr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:lr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:lr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:lr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:lr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:lr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:lr("uniform lowp vec3 u_lightpos;varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;varying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvoid main() {vec4 color=v_color;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(v_normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying highp vec3 v_normal;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;vec3 pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_normal=normal;v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:lr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:lr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:lr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:lr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:lr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:lr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:lr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:lr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:lr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:lr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:lr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:lr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Fs),skyboxGradient:lr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Fs),skyboxCapture:lr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:lr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:lr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Uo(h,r){const l=h.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let p of l)if(p=p.trim(),"#"===p[0]&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const v of _)r.includes(v)||r.push(v)}}function lr(h,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},v=[...No];return Uo(h,v),Uo(r,v),{fragmentSource:h=h.replace(l,(E,C,A,z,N)=>(_[N]=!0,"define"===C?`\n#ifndef HAS_UNIFORM_u_${N}\nvarying ${A} ${z} ${N};\n#else\nuniform ${A} ${z} u_${N};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${N}\n    ${A} ${z} ${N} = u_${N};\n#endif\n`)),vertexSource:r=r.replace(l,(E,C,A,z,N)=>{const Z="float"===z?"vec2":"vec4",K=N.match(/color/)?"color":Z;return _[N]?"define"===C?`\n#ifndef HAS_UNIFORM_u_${N}\nuniform lowp float u_${N}_t;\nattribute ${A} ${Z} a_${N};\nvarying ${A} ${z} ${N};\n#else\nuniform ${A} ${z} u_${N};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${N}\n    ${N} = a_${N};\n#else\n    ${A} ${z} ${N} = u_${N};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${N}\n    ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);\n#else\n    ${A} ${z} ${N} = u_${N};\n#endif\n`:"define"===C?`\n#ifndef HAS_UNIFORM_u_${N}\nuniform lowp float u_${N}_t;\nattribute ${A} ${Z} a_${N};\n#else\nuniform ${A} ${z} u_${N};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${N}\n    ${A} ${z} ${N} = a_${N};\n#else\n    ${A} ${z} ${N} = u_${N};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${N}\n    ${A} ${z} ${N} = unpack_mix_${K}(a_${N}, u_${N}_t);\n#else\n    ${A} ${z} ${N} = u_${N};\n#endif\n`}),staticAttributes:p,usedDefines:v}}class Zi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,_,v,E,C){this.context=r;let A=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!A&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(A=!0);let z=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!z&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(z=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||A||z||this.boundIndexBuffer!==v||this.boundVertexOffset!==E)this.freshBind(l,p,_,v,E,C);else{r.bindVertexArrayOES.set(this.vao);for(const N of C)N&&N.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(r,l,p,_,v,E){let C;const A=r.numAttributes,z=this.context,N=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=E;else{C=z.currentNumAttributes||0;for(let Z=A;Z<C;Z++)N.disableVertexAttribArray(Z)}l.enableAttributes(N,r),l.bind(),l.setVertexAttribPointers(N,r,v);for(const Z of p)Z.enableAttributes(N,r),Z.bind(),Z.setVertexAttribPointers(N,r,v);for(const Z of E)Z&&(Z.enableAttributes(N,r),Z.bind(),Z.setVertexAttribPointers(N,r,v));_&&_.bind(),z.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function la(h,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new c.MercatorCoordinate(0,p/l).toLngLat().lat,new c.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Ns(h,r,l,p,_,v,E){const C=h.context,A=C.gl,z=l.fbo;if(!z)return;h.prepareDrawTile();const N=h.useProgram("hillshade");C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,z.colorAttachment.get());const Z=((ne,ie,te,ae)=>{const ce=te.paint.get("hillshade-shadow-color"),ke=te.paint.get("hillshade-highlight-color"),Se=te.paint.get("hillshade-accent-color");let ve=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===te.paint.get("hillshade-illumination-anchor")&&(ve-=ne.transform.angle);const Ae=!ne.options.moving;return{u_matrix:ae||ne.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:la(0,ie.tileID),u_light:[te.paint.get("hillshade-exaggeration"),ve],u_shadow:ce,u_highlight:ke,u_accent:Se}})(h,l,p,h.terrain?r.projMatrix:null);h.prepareDrawProgram(C,N,r.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:se,tileBoundsSegments:re}=h.getTileBoundsBuffers(l);N.draw(C,A.TRIANGLES,_,v,E,c.CullFaceMode.disabled,Z,p.id,K,se,re)}function Xn(h,r,l){if(!r.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||h.getTileTexture(l.stride);const v=l.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new c.Texture(p,v,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Ni(h,r,l,p,_,v){const E=h.context,C=E.gl;if(!r.dem)return;const A=r.dem;if(E.activeTexture.set(C.TEXTURE1),Xn(h,r,A),!r.demTexture)return;r.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const z=A.dim;E.activeTexture.set(C.TEXTURE0);let N=r.fbo;if(!N){const re=new c.Texture(E,{width:z,height:z,data:null},C.RGBA);re.bind(C.LINEAR,C.CLAMP_TO_EDGE),N=r.fbo=E.createFramebuffer(z,z,!0),N.colorAttachment.set(re.texture)}E.bindFramebuffer.set(N.framebuffer),E.viewport.set([0,0,z,z]);const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:K,tileBoundsSegments:se}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,p,_,v,c.CullFaceMode.disabled,((re,ne)=>{const ie=ne.stride,te=c.create();return c.ortho(te,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(te,te,[0,-c.EXTENT,0]),{u_matrix:te,u_image:1,u_dimension:[ie,ie],u_zoom:re.overscaledZ,u_unpack:ne.unpackVector}})(r.tileID,A),l.id,Z,K,se),r.needsHillshadePrepare=!1}const Va=h=>({u_matrix:new c.UniformMatrix4f(h),u_image0:new c.Uniform1i(h),u_skirt_height:new c.Uniform1f(h)}),ca=(h,r)=>({u_matrix:h,u_image0:0,u_skirt_height:r}),ua=(h,r,l,p,_,v,E,C,A,z,N,Z,K,se)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:A,u_frustum_bl:z,u_globe_pos:N,u_globe_radius:Z,u_viewport:K,u_grid_matrix:se?Float32Array.from(se):new Float32Array(9)});function jo(h,r){return null!=h&&null!=r&&!(!h.hasData()||!r.hasData())&&null!=h.demTexture&&null!=r.demTexture&&h.tileID.key!==r.tileID.key}const go=new class{constructor(){this.operations={}}newMorphing(h,r,l,p,_){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const r=this.operations[h];return{from:r.from,to:r.to,phase:r.phase}}update(h){for(const r in this.operations){const l=this.operations[r];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[r];break}}}_nextOp(h,r){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=r,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},ws={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Pn(h,r){const l=1<<h.z;return!r&&(0===h.x||h.x===l-1)||0===h.y||h.y===l-1}const Ji=h=>({u_matrix:h});function $a(h,r,l,p,_){if(_>0){const v=c.exported.now(),E=(v-h.timeAdded)/_,C=r?(v-r.timeAdded)/_:-1,A=l.getSource(),z=p.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),N=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(h.tileID.overscaledZ-z),Z=N&&h.refreshedUponExpiration?1:c.clamp(N?E:1-C,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),r?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class Us extends c.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new Sr(_n(),null),_=$e("mock-dem",l,p,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class Il extends c.SourceCache{constructor(r){const l=$e("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Sr(_n(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){const C=new c.Tile(E,this._source.tileSize*E.overscaleFactor(),r.tileZoom);C.state="loaded",this._tiles[E.key]=C}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const l=this.proxyCachedFBO[r];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sl extends c.OverscaledTileID{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Ga extends c.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,v]=function(A){const z=new c.StructArrayLayout4i8,N=new c.StructArrayLayout3ui6,Z=131;z.reserve(17161),N.reserve(33800);const K=c.EXTENT/128,se=c.EXTENT+K/2,re=se+K;for(let ie=-K;ie<re;ie+=K)for(let te=-K;te<re;te+=K){const ae=te<0||te>se||ie<0||ie>se?24575:0,ce=c.clamp(Math.round(te),0,c.EXTENT),ke=c.clamp(Math.round(ie),0,c.EXTENT);z.emplaceBack(ce+ae,ke,ce,ke)}const ne=(ie,te)=>{const ae=te*Z+ie;N.emplaceBack(ae+1,ae,ae+Z),N.emplaceBack(ae+Z,ae+Z+1,ae+1)};for(let ie=1;ie<129;ie++)for(let te=1;te<129;te++)ne(te,ie);return[0,129].forEach(ie=>{for(let te=0;te<130;te++)ne(te,ie),ne(ie,te)}),[z,N,32768]}(),E=r.context;this.gridBuffer=E.createVertexBuffer(p,c.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(_),this.gridSegments=c.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Il(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,0,c.EXTENT,0,c.EXTENT,0,1);const C=E.gl;this._overlapStencilMode=new c.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Us(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const v=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(l,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(A=>{const z=l.getTileByID(A).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(A,z){const N=z.transform.pointCoordinate(z.transform.getCameraPoint()),Z=new c.pointGeometry(N.x,N.y);A.sort((K,se)=>{if(se.overscaledZ-K.overscaledZ)return se.overscaledZ-K.overscaledZ;const re=new c.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ne=new c.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),ie=Z.mult(1<<K.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(re)-ie.distSqr(ne)})})(_,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const A in E){const z=E[A];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,r[A],v),z.usedForTerrain))continue;const N=r[A];z.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[l.id]=_.map(A=>new Sl(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const C={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const z=this.terrainTileForTile[A.key];if(!z)continue;const N=z.tileID.key;N in C||(this._visibleDemTiles.push(z),C[N]=N)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Xn(this.painter,_,v))}}_prepareDemTileUniforms(r,l,p,_){if(!l||null==l.demTexture)return!1;const v=r.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-v.z),C=_||"";return p[`u_dem_tl${C}`]=[v.x*E%1,v.y*E%1],p[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const p=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(r,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const v=_.dem.tree.minimums[0];return v>0&&r++,p+v},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new c.Texture(r,_,l.RGBA,{premultiply:!1}),v}setupElevationDraw(r,l,p){const _=this.painter.context,v=_.gl,E=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var C;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const A=this.painter.transform,z=A.projection,N=r.tileID.canonical;E.u_tile_tl_up=z.upVector(N,0,0),E.u_tile_tr_up=z.upVector(N,c.EXTENT,0),E.u_tile_br_up=z.upVector(N,c.EXTENT,c.EXTENT),E.u_tile_bl_up=z.upVector(N,0,c.EXTENT),E.u_tile_up_scale=p&&p.useDenormalizedUpVectorScale?c.GLOBE_METERS_TO_ECEF:z.upVectorScale(N,A.center.lat,A.worldSize).metersToTile;let Z=null,K=null,se=1;if(p&&p.morphing&&this._useVertexMorphing){const re=p.morphing.srcDemTile,ne=p.morphing.dstDemTile;se=p.morphing.phase,re&&ne&&(this._prepareDemTileUniforms(r,re,E,"_prev")&&(K=re),this._prepareDemTileUniforms(r,ne,E)&&(Z=ne))}if(K&&Z?(_.activeTexture.set(v.TEXTURE2),Z.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),K.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=se):(Z=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,Z,E)?Z.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&Z){const re=(1<<Z.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=re}p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,E)}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,E,C,A){if("globe"===_.transform.projection.name)!function(z,N,Z,K,se){const re=z.context,ne=re.gl;let ie,te;const ae=z.options.showTerrainWireframe?2:0,ce=z.transform,ke=c.globeUseCustomAntiAliasing(z,re,ce),Se=(Bt,Qe)=>{if(te===Bt)return;const Pt=[ws[Bt],"PROJECTION_GLOBE_VIEW"];ke&&Pt.push("CUSTOM_ANTIALIASING"),Qe&&Pt.push(ws[ae]),ie=z.useProgram("globeRaster",null,Pt),te=Bt},ve=z.colorModeForRenderPass(),Ae=new c.DepthMode(ne.LEQUAL,c.DepthMode.ReadWrite,z.depthRangeFor3D);go.update(se);const Ce=c.calculateGlobeMercatorMatrix(ce),Be=[c.mercatorXfromLng(ce.center.lng),c.mercatorYfromLat(ce.center.lat)],He=ae?[!1,!0]:[!1],Mt=z.globeSharedBuffers,Ve=[ce.width*c.exported.devicePixelRatio,ce.height*c.exported.devicePixelRatio],at=Float32Array.from(ce.globeMatrix),_t={useDenormalizedUpVectorScale:!0};if(He.forEach(Bt=>{te=-1;const Qe=Bt?ne.LINES:ne.TRIANGLES;for(const Pt of K){const mt=Z.getTile(Pt),Wt=c.StencilMode.disabled,Vt=N.prevTerrainTileForTile[Pt.key],nn=N.terrainTileForTile[Pt.key];jo(Vt,nn)&&go.newMorphing(Pt.key,Vt,nn,se,250),re.activeTexture.set(ne.TEXTURE0),mt.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const fn=go.getMorphValuesForProxy(Pt.key),In=fn?1:0;fn&&c.extend$1(_t,{morphing:{srcDemTile:fn.from,dstDemTile:fn.to,phase:c.easeCubicInOut(fn.phase)}});const cr=c.tileCornersToBounds(Pt.canonical),ln=c.getLatitudinalLod(cr.getCenter().lat),Ln=c.getGridMatrix(Pt.canonical,cr,ln),br=c.globeNormalizeECEF(c.globeTileBounds(Pt.canonical)),Yr=ua(ce.projMatrix,at,Ce,br,c.globeToMercatorTransition(ce.zoom),Be,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Ve,Ln);if(Se(In,Bt),N.setupElevationDraw(mt,ie,_t),z.prepareDrawProgram(re,ie,Pt.toUnwrapped()),Mt){const[hi,Lr,Ui]=Bt?Mt.getWirefameBuffers(z.context,ln):Mt.getGridBuffers(ln);ie.draw(re,Qe,Ae,Wt,ve,c.CullFaceMode.backCCW,Yr,"globe_raster",hi,Lr,Ui)}}}),Mt){const Bt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&Bt.push("CUSTOM_ANTIALIASING"),ie=z.useProgram("globeRaster",null,Bt);for(const Qe of K){const{x:Pt,y:mt,z:Wt}=Qe.canonical,Vt=0===mt,nn=mt===(1<<Wt)-1,[fn,In,cr,ln]=Mt.getPoleBuffers(Wt);if(ln&&(Vt||nn)){const Ln=Z.getTile(Qe);re.activeTexture.set(ne.TEXTURE0),Ln.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let br=c.globePoleMatrixForTile(Wt,Pt,ce);const Yr=c.globeNormalizeECEF(c.globeTileBounds(Qe.canonical)),hi=(Lr,Ui)=>Lr.draw(re,ne.TRIANGLES,Ae,c.StencilMode.disabled,ve,c.CullFaceMode.disabled,ua(ce.projMatrix,br,br,Yr,0,Be,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Ve),"globe_pole_raster",Ui,cr,ln);N.setupElevationDraw(Ln,ie,_t),z.prepareDrawProgram(re,ie,Qe.toUnwrapped()),Vt&&hi(ie,fn),nn&&(br=c.scale(c.create(),br,[1,-1,1]),hi(ie,In))}}}}(_,v,E,C,A);else{const z=_.context,N=z.gl;let Z,K;const se=_.options.showTerrainWireframe?2:0,re=(ce,ke)=>{if(K===ce)return;const Se=[ws[ce]];ke&&Se.push(ws[se]),Z=_.useProgram("terrainRaster",null,Se),K=ce},ne=_.colorModeForRenderPass(),ie=new c.DepthMode(N.LEQUAL,c.DepthMode.ReadWrite,_.depthRangeFor3D);go.update(A);const te=_.transform,ae=6*Math.pow(1.5,22-te.zoom)*v.exaggeration();(se?[!1,!0]:[!1]).forEach(ce=>{K=-1;const ke=ce?N.LINES:N.TRIANGLES,[Se,ve]=ce?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const Ae of C){const Ce=E.getTile(Ae),Be=c.StencilMode.disabled,He=v.prevTerrainTileForTile[Ae.key],Mt=v.terrainTileForTile[Ae.key];jo(He,Mt)&&go.newMorphing(Ae.key,He,Mt,A,250),z.activeTexture.set(N.TEXTURE0),Ce.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const Ve=go.getMorphValuesForProxy(Ae.key),at=Ve?1:0;let _t;Ve&&(_t={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:c.easeCubicInOut(Ve.phase)}});const Bt=ca(Ae.projMatrix,Pn(Ae.canonical,te.renderWorldCopies)?ae/10:ae);re(at,ce),v.setupElevationDraw(Ce,Z,_t),_.prepareDrawProgram(z,Z,Ae.toUnwrapped()),Z.draw(z,ke,ie,Be,ne,c.CullFaceMode.backCCW,Bt,"terrain_raster",v.gridBuffer,Se,ve)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],E=this._drapedRenderBatches.shift(),C=[],A=l.style.order;let z=0;for(const N of v){const Z=_.getTileByID(N.proxyTileKey),K=_.proxyCachedFBO[N.key]?_.proxyCachedFBO[N.key][r]:void 0,se=void 0!==K?_.renderCache[K]:this.pool[z++],re=void 0!==K;if(Z.texture=se.tex,re&&!se.dirty){C.push(Z.tileID);continue}let ne;p.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(p.clear({color:c.Color.transparent,stencil:0}),se.dirty=!1);for(let ie=E.start;ie<=E.end;++ie){const te=l.style._layers[A[ie]];if(te.isHidden(l.transform.zoom))continue;const ae=l.style._getLayerSourceCache(te),ce=ae?this.proxyToSource[N.key][ae.id]:[N];if(!ce)continue;const ke=ce;p.viewport.set([0,0,se.fb.width,se.fb.height]),ne!==(ae?ae.id:null)&&(this._setupStencil(se,ce,te,ae),ne=ae?ae.id:null),l.renderLayer(l,ae,te,ke)}this.renderedToTile?(se.dirty=!0,C.push(Z.tileID)):re||--z,5===z&&(z=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(0===l)return{efficiency:100};let p,_=0,v=0,E=!1;for(let C=0;C<l;++C){const A=r._layers[r.order[C]];this._style.isLayerDraped(A)?(E&&++_,++v):E||(E=!0,p=A.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const E=v.tileID,C=1<<E.overscaledZ,{x:A,y:z}=E.canonical,N=A/C,Z=(A+1)/C,K=z/C,se=(z+1)/C;return{minx:N,miny:K,maxx:Z,maxy:se,t:v.dem.tree.raycastRoot(N,K,Z,se,r,l,p),tile:v}});_.sort((v,E)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const v of _){if(null==v.t)return null;const E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,l,p);if(null!=E)return E}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new c.Texture(r,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=r.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new G(r,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),v=!!_&&1!==_.t,E=l.hasTransition();return"custom"!==l.type&&!p&&(v||E)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof ge){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if("raster"!==p.type||_||!v)continue;const E=p.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const A=this.proxyToSource[C.key][v.id];if(A)for(const z of A){const N=$a(v.getTile(z),v.findLoadedParent(z,0),v,this.painter.transform,E);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(v.id,z)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(0===l)return;const p=[];let _,v=0,E=this._style._layers[r[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<l;)E=this._style._layers[r[v]];for(;v<l;++v){const C=this._style._layers[r[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===_&&(_=v):void 0!==_&&(p.push({start:_,end:v-1}),_=void 0))}void 0!==_&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<E.length;++C){const A=Object.values(E[C]);l.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const C=p[E];if(l.getTileByID(C.key),void 0!==l.proxyCachedFBO[C.key]){const A=r[C.key],z=this.proxyToSource[C.key];let N=0;for(const Z in z){const K=z[Z],se=A[Z];if(!se||se.length!==K.length||K.some((re,ne)=>re!==se[ne]||_[Z]&&_[Z].hasOwnProperty(re.key))){N=-1;break}++N}for(const Z in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][Z]].dirty=N<0||N!==Object.values(A).length}}const v=[...this._drapedRenderBatches];v.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of v)for(const C of p){if(l.proxyCachedFBO[C.key])continue;let A=l.renderCachePool.pop();void 0===A&&l.renderCache.length<50&&(A=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==A&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][E.start]=A,l.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,E=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(r,l){const p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const E=p.useProgram("clippingMask");for(const C of r){const A=p._tileClippingMaskIDs[C.key]=--l;E.draw(_,v.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Ji(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];c.transformMat4$1(p,p,l.pixelMatrixInverse),c.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,v=c.mercatorZfromAltitude(1,l.center.lat),E=[_[0],_[1],_[2]/v,0],C=c.subtract([],p.slice(0,3),E);c.normalize(C,C);const A=this.raycast(E,C,this._exaggeration);return null!==A&&A?(c.scaleAndAdd(E,E,C,A),E[3]=E[2],E[2]*=v,E):null}drawDepth(){const r=this.painter,l=r.context,p=this.proxySourceCache,_=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=l.gl,C=l.createFramebuffer(_,v,!0);l.activeTexture.set(E.TEXTURE0);const A=new c.Texture(l,{width:_,height:v,data:null},E.RGBA);A.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(A.texture);const z=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);C.depthAttachment.set(z),this._depthFBO=C,this._depthTexture=A}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(E,C,A,z){if("globe"===E.transform.projection.name)return;const N=E.context,Z=N.gl;N.clear({depth:1});const K=E.useProgram("terrainDepth"),se=new c.DepthMode(Z.LESS,c.DepthMode.ReadWrite,E.depthRangeFor3D);for(const re of z){const ne=A.getTile(re),ie=ca(re.projMatrix,0);C.setupElevationDraw(ne,K),K.draw(N,Z.TRIANGLES,se,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,ie,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof Ne)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const A=v[C],z=this._findTileCoveringTileID(A,r);if(z){const N=this._createProxiedId(A,z,p[A.key]&&p[A.key][r.id]);_.push(N),this.proxyToSource[A.key][r.id]=[N]}}let E=!1;for(let C=0;C<l.length;C++){const A=r.getTile(l[C]);if(!A||!A.hasData())continue;const z=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==A.tileID.canonical.z){const N=this.proxyToSource[z.tileID.key][r.id],Z=this._createProxiedId(z.tileID,A,p[z.tileID.key]&&p[z.tileID.key][r.id]);N?N.splice(N.length-1,0,Z):this.proxyToSource[z.tileID.key][r.id]=[Z],_.push(Z),E=!0}}this._sourceTilesOverlap[r.id]=E}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],v=this.proxyCoords,E=r.getSource(),C=new c.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),A=E.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((N,Z)=>(N.min.x=Math.min(N.min.x,Z.x-C.x),N.min.y=Math.min(N.min.y,Z.y-C.y),N.max.x=Math.max(N.max.x,Z.x-C.x),N.max.y=Math.max(N.max.y,Z.y-C.y),N),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(N,Z)=>{const K=N.wrap+N.canonical.x/(1<<N.canonical.z),se=N.canonical.y/(1<<N.canonical.z),re=c.EXTENT/(1<<N.canonical.z),ne=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ie=Z.canonical.y/(1<<Z.canonical.z);return K+re<ne+A.min.x||K>ne+A.max.x||se+re<ie+A.min.y||se>ie+A.max.y};for(let N=0;N<v.length;N++){const Z=v[N];for(let K=0;K<l.length;K++){const se=r.getTile(l[K]);if(!se||!se.hasData()||z(Z,se.tileID))continue;const re=this._createProxiedId(Z,se,p[Z.key]&&p[Z.key][r.id]),ne=this.proxyToSource[Z.key][r.id];ne?ne.push(re):this.proxyToSource[Z.key][r.id]=[re],_.push(re)}}}_createProxiedId(r,l,p){let _=this.orthoMatrix;if(p){const v=p.find(E=>E.key===l.tileID.key);if(v)return v}if(l.tileID.key!==r.key){const v=r.canonical.z-l.tileID.canonical.z;let E,C,A;_=c.create();const z=l.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(E=c.EXTENT>>v,C=E*((l.tileID.canonical.x<<v)-r.canonical.x+z),A=E*((l.tileID.canonical.y<<v)-r.canonical.y)):(E=c.EXTENT<<-v,C=c.EXTENT*(l.tileID.canonical.x-(r.canonical.x+z<<-v)),A=c.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-v))),c.ortho(_,0,E,0,E,0,1),c.translate(_,_,[C,A,0])}return new Sl(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],v=_[r.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||null===v)return p;let E=p?p.tileID:r,C=E.overscaledZ;const A=l.getSource().minzoom,z=[];if(!v){const Z=l.getSource().maxzoom;if(r.canonical.z>=Z){const K=r.canonical.z-Z;l.getSource().reparseOverscaled?(C=Math.max(r.canonical.z+2,l.transform.tileZoom),E=new c.OverscaledTileID(C,r.wrap,Z,r.canonical.x>>K,r.canonical.y>>K)):0!==K&&(C=Z,E=new c.OverscaledTileID(C,r.wrap,Z,r.canonical.x>>K,r.canonical.y>>K))}E.key!==r.key&&(z.push(E.key),p=l.getTile(E))}const N=Z=>{z.forEach(K=>{_[K]=Z}),z.length=0};for(C-=1;C>=A&&(!p||!p.hasData());C--){p&&N(p.tileID.key);const Z=E.calculateScaledKey(C);if(p=l.getTileByID(Z),p&&p.hasData())break;const K=_[Z];if(null===K)break;void 0===K?z.push(Z):p=l.getTileByID(K)}return N(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let p=0;const _=new c.StructArrayLayout2ui4,v=131;for(let E=1;E<129;E++){for(let C=1;C<129;C++)p=E*v+C,_.emplaceBack(p,p+1),_.emplaceBack(p,p+v),_.emplaceBack(p+1,p+v),128===E&&_.emplaceBack(p+v,p+v+1);_.emplaceBack(p+1,p+1+v)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ha{static cacheKey(r,l,p,_){let v=`${l}${_?_.cacheKey:""}`;for(const E of p)r.usedDefines.includes(E)&&(v+=`/${E}`);return v}constructor(r,l,p,_,v,E){const C=r.gl;this.program=C.createProgram();const A=function(ie){const te=[];for(let ae=0;ae<ie.length;ae++){if(null===ie[ae])continue;const ce=ie[ae].split(" ");te.push(ce.pop())}return te}(p.staticAttributes),z=_?_.getBinderAttributes():[],N=A.concat(z);let Z=_?_.defines():[];Z=Z.concat(E.map(ie=>`#define ${ie}`));const K=Z.concat(r.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Hn):Hn,Hn,rc,zs.fragmentSource,us.fragmentSource,p.fragmentSource).join("\n"),se=Z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",rc,zs.vertexSource,us.vertexSource,cs.vertexSource,p.vertexSource).join("\n"),re=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(re,K),C.compileShader(re),C.attachShader(this.program,re);const ne=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ne,se),C.compileShader(ne),C.attachShader(this.program,ne),this.attributes={},this.numAttributes=N.length;for(let ie=0;ie<this.numAttributes;ie++)N[ie]&&(C.bindAttribLocation(this.program,ie,N[ie]),this.attributes[N[ie]]=ie);C.linkProgram(this.program),C.deleteShader(ne),C.deleteShader(re),this.fixedUniforms=v(r),this.binderUniforms=_?_.getUniforms(r):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(ie=r),u_dem_prev:new c.Uniform1i(ie),u_dem_unpack:new c.Uniform4f(ie),u_dem_tl:new c.Uniform2f(ie),u_dem_scale:new c.Uniform1f(ie),u_dem_tl_prev:new c.Uniform2f(ie),u_dem_scale_prev:new c.Uniform1f(ie),u_dem_size:new c.Uniform1f(ie),u_dem_lerp:new c.Uniform1f(ie),u_exaggeration:new c.Uniform1f(ie),u_depth:new c.Uniform1i(ie),u_depth_size_inv:new c.Uniform2f(ie),u_meter_to_dem:new c.Uniform1f(ie),u_label_plane_matrix_inv:new c.UniformMatrix4f(ie),u_tile_tl_up:new c.Uniform3f(ie),u_tile_tr_up:new c.Uniform3f(ie),u_tile_br_up:new c.Uniform3f(ie),u_tile_bl_up:new c.Uniform3f(ie),u_tile_up_scale:new c.Uniform1f(ie)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new c.UniformMatrix4f(ie),u_fog_range:new c.Uniform2f(ie),u_fog_color:new c.Uniform4f(ie),u_fog_horizon_blend:new c.Uniform1f(ie),u_fog_temporal_offset:new c.Uniform1f(ie),u_frustum_tl:new c.Uniform3f(ie),u_frustum_tr:new c.Uniform3f(ie),u_frustum_br:new c.Uniform3f(ie),u_frustum_bl:new c.Uniform3f(ie),u_globe_pos:new c.Uniform3f(ie),u_globe_radius:new c.Uniform1f(ie),u_globe_transition:new c.Uniform1f(ie),u_is_globe:new c.Uniform1i(ie),u_viewport:new c.Uniform2f(ie)}))(r))}var ie}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)p[_].set(this.program,_,l[_])}}draw(r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne){const ie=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(_),r.setColorMode(v),r.setCullFace(E);for(const ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,C[ae]);re&&re.setUniforms(this.program,r,this.binderUniforms,K,{zoom:se});const te={[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[l];for(const ae of Z.get()){const ce=ae.vaos||(ae.vaos={});(ce[A]||(ce[A]=new Zi)).bind(r,this,z,re?re.getPaintVertexBuffers():[],N,ae.vertexOffset,ne||[]),ie.drawElements(l,ae.primitiveLength*te,ie.UNSIGNED_SHORT,ae.primitiveOffset*te*2)}}}function ic(h,r,l){const p=1/En(l,1,r.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),v=l.tileSize*Math.pow(2,r.transform.tileZoom)/_,E=v*(l.tileID.canonical.x+l.tileID.wrap*_),C=v*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const St=c.create(),Gn=(h,r,l,p,_,v,E,C,A,z,N)=>{const Z=r.style.light,K=Z.properties.get("position"),se=[K.x,K.y,K.z],re=c.create$1();"viewport"===Z.properties.get("anchor")&&(c.fromRotation(re,-r.transform.angle),c.transformMat3(se,se,re));const ne=Z.properties.get("color"),ie=r.transform,te={u_matrix:h,u_lightpos:se,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:St,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v};return"globe"===ie.projection.name&&(te.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],te.u_zoom_transition=A,te.u_inv_rot_matrix=N,te.u_merc_center=z,te.u_up_dir=ie.projection.upVector(new c.CanonicalTileID(0,0,0),z[0]*c.EXTENT,z[1]*c.EXTENT),te.u_height_lift=C),te},Es=(h,r,l,p,_,v,E,C,A,z,N,Z,K)=>{const se=Gn(h,r,l,p,_,v,E,z,N,Z,K),re={u_height_factor:-Math.pow(2,E.overscaledZ)/A.tileSize/8};return c.extend(se,ic(C,r,A),re)},da=h=>({u_matrix:h}),ti=(h,r,l,p)=>c.extend(da(h),ic(l,r,p)),Si=(h,r)=>({u_matrix:h,u_world:r}),Wi=(h,r,l,p,_)=>c.extend(ti(h,r,l,p),{u_world:_}),_o=c.create(),js=(h,r,l,p,_,v)=>{const E=h.transform,C="globe"===E.projection.name;let A;if("map"===v.paint.get("circle-pitch-alignment"))if(C){const N=c.globePixelsToTileUnits(E.zoom,r.canonical)*E._pixelsPerMercatorPixel;A=Float32Array.from([N,0,0,N])}else A=E.calculatePixelsToTileUnitsMatrix(l);else A=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:h.translatePosMatrix(r.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:_o,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=p,z.u_merc_center=_,z.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],z.u_zoom_transition=c.globeToMercatorTransition(E.zoom);const N=_[0]*c.EXTENT,Z=_[1]*c.EXTENT;z.u_up_dir=E.projection.upVector(new c.CanonicalTileID(0,0,0),N,Z)}return z},Ml=h=>{const r=[];return"map"===h.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Lc=(h,r,l,p)=>{const _=c.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/_,r.pixelsToGLUnits[1]/_]}},Oc=(h,r,l=1)=>({u_matrix:h,u_color:r,u_overlay:0,u_overlay_scale:l}),Fc=c.create(),oc=(h,r,l,p,_,v,E)=>{const C=h.transform,A="globe"===C.projection.name,z=A?c.globePixelsToTileUnits(C.zoom,r.canonical)*C._pixelsPerMercatorPixel:En(l,1,v),N={u_matrix:r.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:Fc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){N.u_inv_rot_matrix=p,N.u_merc_center=_,N.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],N.u_zoom_transition=c.globeToMercatorTransition(C.zoom);const Z=_[0]*c.EXTENT,K=_[1]*c.EXTENT;N.u_up_dir=C.projection.upVector(new c.CanonicalTileID(0,0,0),Z,K)}return N},Mi=(h,r,l,p,_,v,E,C)=>{const A=h.transform,z=A.calculatePixelsToTileUnitsMatrix(r),N={u_matrix:Io(h,r,l,_),u_pixels_to_tile_units:z,u_device_pixel_ratio:E,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:C};if(yo(l)){const Z=hs(r,h.transform);N.u_texsize=r.lineAtlasTexture.size,N.u_scale=[Z,p.fromScale,p.toScale],N.u_mix=p.t}return N},Vo=(h,r,l,p,_,v)=>{const E=h.transform,C=hs(r,E);return{u_matrix:Io(h,r,l,_),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:v,u_image:0,u_scale:[C,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function hs(h,r){return 1/En(h,1,r.tileZoom)}function Io(h,r,l,p){return h.translatePosMatrix(p||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function yo(h){const r=h.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const zc=(h,r,l,p,_,v)=>{return{u_matrix:h,u_tl_parent:r,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(C=_.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(E=_.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ha(_.paint.get("raster-hue-rotate")),u_perspective_transform:v};var E,C};function Ha(h){h*=Math.PI/180;const r=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Bc=c.create(),sc=(h,r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne)=>{const ie=_.transform,te={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ie.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:ie.width/ie.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+A,u_pitch_with_map:+p,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Bc,u_up_vector:[0,-1,0]};return"globe"===ne.name&&(te.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],te.u_zoom_transition=Z,te.u_inv_rot_matrix=se,te.u_merc_center=K,te.u_camera_forward=ie._camera.forward(),te.u_ecef_origin=c.globeECEFOrigin(ie.globeMatrix,N.toUnwrapped()),te.u_tile_matrix=Float32Array.from(ie.globeMatrix),te.u_up_vector=re),te},Za=(h,r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne,ie)=>c.extend(sc(h,r,l,p,_,v,E,C,A,z,Z,K,se,re,ne,ie),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+N}),Ts=(h,r,l,p,_,v,E,C,A,z,N,Z,K,se,re,ne)=>c.extend(Za(h,r,l,p,_,v,E,C,!0,A,!0,N,Z,K,se,re,ne),{u_texsize_icon:z,u_texture_icon:1}),F=(h,r,l)=>({u_matrix:h,u_opacity:r,u_color:l}),W=(h,r,l,p,_,v)=>c.extend(function(E,C,A,z){const N=A.imageManager.getPattern(E.from.toString()),Z=A.imageManager.getPattern(E.to.toString()),{width:K,height:se}=A.imageManager.getPixelSize(),re=Math.pow(2,z.tileID.overscaledZ),ne=z.tileSize*Math.pow(2,A.transform.tileZoom)/re,ie=ne*(z.tileID.canonical.x+z.tileID.wrap*re),te=ne*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[K,se],u_mix:C.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/En(z,1,A.transform.tileZoom),u_pixel_coord_upper:[ie>>16,te>>16],u_pixel_coord_lower:[65535&ie,65535&te]}}(p,v,l,_),{u_matrix:h,u_opacity:r}),B={fillExtrusion:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_height_factor:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_scale:new c.Uniform3f(h),u_fade:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h)}),fill:h=>({u_matrix:new c.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_scale:new c.Uniform3f(h),u_fade:new c.Uniform1f(h)}),fillOutline:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_scale:new c.Uniform3f(h),u_fade:new c.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),collisionBox:h=>({u_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new c.UniformMatrix4f(h),u_inv_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_viewport_size:new c.Uniform2f(h)}),debug:h=>({u_color:new c.UniformColor(h),u_matrix:new c.UniformMatrix4f(h),u_overlay:new c.Uniform1i(h),u_overlay_scale:new c.Uniform1f(h)}),clippingMask:h=>({u_matrix:new c.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new c.Uniform1f(h),u_intensity:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),heatmapTexture:h=>({u_image:new c.Uniform1i(h),u_color_ramp:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h)}),hillshade:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_latrange:new c.Uniform2f(h),u_light:new c.Uniform2f(h),u_shadow:new c.UniformColor(h),u_highlight:new c.UniformColor(h),u_accent:new c.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_dimension:new c.Uniform2f(h),u_zoom:new c.Uniform1f(h),u_unpack:new c.Uniform4f(h)}),line:h=>({u_matrix:new c.UniformMatrix4f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_units_to_pixels:new c.Uniform2f(h),u_dash_image:new c.Uniform1i(h),u_gradient_image:new c.Uniform1i(h),u_image_height:new c.Uniform1f(h),u_texsize:new c.Uniform2f(h),u_scale:new c.Uniform3f(h),u_mix:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h),u_trim_offset:new c.Uniform2f(h)}),linePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_texsize:new c.Uniform2f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_units_to_pixels:new c.Uniform2f(h),u_scale:new c.Uniform3f(h),u_fade:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h)}),raster:h=>({u_matrix:new c.UniformMatrix4f(h),u_tl_parent:new c.Uniform2f(h),u_scale_parent:new c.Uniform1f(h),u_fade_t:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_image0:new c.Uniform1i(h),u_image1:new c.Uniform1i(h),u_brightness_low:new c.Uniform1f(h),u_brightness_high:new c.Uniform1f(h),u_saturation_factor:new c.Uniform1f(h),u_contrast_factor:new c.Uniform1f(h),u_spin_weights:new c.Uniform3f(h),u_perspective_transform:new c.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_texture:new c.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_is_halo:new c.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texsize_icon:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_texture_icon:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_is_halo:new c.Uniform1i(h)}),background:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_color:new c.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_pattern_tl_a:new c.Uniform2f(h),u_pattern_br_a:new c.Uniform2f(h),u_pattern_tl_b:new c.Uniform2f(h),u_pattern_br_b:new c.Uniform2f(h),u_texsize:new c.Uniform2f(h),u_mix:new c.Uniform1f(h),u_pattern_size_a:new c.Uniform2f(h),u_pattern_size_b:new c.Uniform2f(h),u_scale_a:new c.Uniform1f(h),u_scale_b:new c.Uniform1f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),terrainRaster:Va,terrainDepth:Va,skybox:h=>({u_matrix:new c.UniformMatrix4f(h),u_sun_direction:new c.Uniform3f(h),u_cubemap:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new c.UniformMatrix4f(h),u_color_ramp:new c.Uniform1i(h),u_center_direction:new c.Uniform3f(h),u_radius:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new c.UniformMatrix3f(h),u_sun_direction:new c.Uniform3f(h),u_sun_intensity:new c.Uniform1f(h),u_color_tint_r:new c.Uniform4f(h),u_color_tint_m:new c.Uniform4f(h),u_luminance:new c.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new c.UniformMatrix4f(h),u_globe_matrix:new c.UniformMatrix4f(h),u_normalize_matrix:new c.UniformMatrix4f(h),u_merc_matrix:new c.UniformMatrix4f(h),u_zoom_transition:new c.Uniform1f(h),u_merc_center:new c.Uniform2f(h),u_image0:new c.Uniform1i(h),u_grid_matrix:new c.UniformMatrix3f(h),u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_globe_pos:new c.Uniform3f(h),u_globe_radius:new c.Uniform1f(h),u_viewport:new c.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_horizon:new c.Uniform1f(h),u_transition:new c.Uniform1f(h),u_fadeout_range:new c.Uniform1f(h),u_color:new c.Uniform4f(h),u_high_color:new c.Uniform4f(h),u_space_color:new c.Uniform4f(h),u_star_intensity:new c.Uniform1f(h),u_star_density:new c.Uniform1f(h),u_star_size:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h),u_horizon_angle:new c.Uniform1f(h),u_rotation_matrix:new c.UniformMatrix4f(h)})};let Q;function Me(h,r,l,p,_,v,E){const C=h.context,A=C.gl,z=h.transform,N=h.useProgram("collisionBox"),Z=[];let K=0,se=0;for(let ke=0;ke<p.length;ke++){const Se=p[ke],ve=r.getTile(Se),Ae=ve.getBucket(l);if(!Ae)continue;const Ce=Ci(Se,Ae,z);let Be=Ce;0===_[0]&&0===_[1]||(Be=h.translatePosMatrix(Ce,ve,_,v));const He=E?Ae.textCollisionBox:Ae.iconCollisionBox,Mt=Ae.collisionCircleArray;if(Mt.length>0){const Ve=c.create(),at=Be;c.mul(Ve,Ae.placementInvProjMatrix,z.glCoordMatrix),c.mul(Ve,Ve,Ae.placementViewportMatrix),Z.push({circleArray:Mt,circleOffset:se,transform:at,invTransform:Ve,projection:Ae.getProjection()}),K+=Mt.length/4,se=K}He&&(h.terrain&&h.terrain.setupElevationDraw(ve,N),N.draw(C,A.LINES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,Lc(Be,z,ve,Ae.getProjection()),l.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,z.zoom,null,[He.collisionVertexBuffer,He.collisionVertexBufferExt]))}if(!E||!Z.length)return;const re=h.useProgram("collisionCircle"),ne=new c.StructArrayLayout2f1f2i16;ne.resize(4*K),ne._trim();let ie=0;for(const ke of Z)for(let Se=0;Se<ke.circleArray.length/4;Se++){const ve=4*Se,Ae=ke.circleArray[ve+0],Ce=ke.circleArray[ve+1],Be=ke.circleArray[ve+2],He=ke.circleArray[ve+3];ne.emplace(ie++,Ae,Ce,Be,He,0),ne.emplace(ie++,Ae,Ce,Be,He,1),ne.emplace(ie++,Ae,Ce,Be,He,2),ne.emplace(ie++,Ae,Ce,Be,He,3)}(!Q||Q.length<2*K)&&(Q=function(ke){const Se=2*ke,ve=new c.StructArrayLayout3ui6;ve.resize(Se),ve._trim();for(let Ae=0;Ae<Se;Ae++){const Ce=6*Ae;ve.uint16[Ce+0]=4*Ae+0,ve.uint16[Ce+1]=4*Ae+1,ve.uint16[Ce+2]=4*Ae+2,ve.uint16[Ce+3]=4*Ae+2,ve.uint16[Ce+4]=4*Ae+3,ve.uint16[Ce+5]=4*Ae+0}return ve}(K));const te=C.createIndexBuffer(Q,!0),ae=C.createVertexBuffer(ne,c.collisionCircleLayout.members,!0);for(const ke of Z){const Se={u_matrix:ke.transform,u_inv_matrix:ke.invTransform,u_camera_to_center_distance:(ce=z).getCameraToCenterDistance(ke.projection),u_viewport_size:[ce.width,ce.height]};re.draw(C,A.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,Se,l.id,ae,te,c.SegmentVector.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,z.zoom)}var ce;ae.destroy(),te.destroy()}const rt=c.create();function Dt(h,r,l,p,_,v){const{horizontalAlign:E,verticalAlign:C}=c.getAnchorAlignment(h),A=-(E-.5)*r,z=-(C-.5)*l,N=c.evaluateVariableOffset(h,p);return new c.pointGeometry((A/_+N[0])*v,(z/_+N[1])*v)}function sn(h,r,l,p,_,v,E,C,A,z,N){const Z=h.text.placedSymbolArray,K=h.text.dynamicLayoutVertexArray,se=h.icon.dynamicLayoutVertexArray,re={},ne=gr(C,h.getProjection(),v),ie=v.elevation,te=h.getProjection().upVectorScale(C.canonical,v.center.lat,v.worldSize);K.clear();for(let ae=0;ae<Z.length;ae++){const ce=Z.get(ae),ke=h.allowVerticalPlacement&&!ce.placedOrientation,Se=ce.hidden||!ce.crossTileID||ke?null:p[ce.crossTileID];if(Se){const ve=new c.pointGeometry(ce.tileAnchorX,ce.tileAnchorY),Ae=h.getProjection().upVector(C.canonical,ve.x,ve.y),Ce=ie?ie.getAtTileOffset(C,ve.x,ve.y):0,Be=Dn([ce.projectedAnchorX+Ce*Ae[0]*te.metersToTile,ce.projectedAnchorY+Ce*Ae[1]*te.metersToTile,ce.projectedAnchorZ+Ce*Ae[2]*te.metersToTile],l?ne:E),He=zi(v.getCameraToCenterDistance(h.getProjection()),Be.signedDistanceFromCamera);let Mt=_.evaluateSizeForFeature(h.textSizeData,z,ce)*He/c.ONE_EM;l&&(Mt*=h.tilePixelRatio/A);const{width:Ve,height:at,anchor:_t,textOffset:Bt,textScale:Qe}=Se,Pt=Dt(_t,Ve,at,Bt,Qe,Mt);let mt;if(l){const Vt=ve.add(Pt),{x:nn,y:fn,z:In}=h.getProjection().projectTilePoint(Vt.x,Vt.y,C.canonical);mt=Dn([nn+Ce*Ae[0]*te.metersToTile,fn+Ce*Ae[1]*te.metersToTile,In+Ce*Ae[2]*te.metersToTile],E).point}else{const Vt=r?Pt.rotate(-v.angle):Pt;mt=[Be.point[0]+Vt.x,Be.point[1]+Vt.y,0]}const Wt=h.allowVerticalPlacement&&ce.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let Vt=0;Vt<ce.numGlyphs;Vt++)c.addDynamicAttributes(K,mt[0],mt[1],mt[2],Wt);N&&ce.associatedIconIndex>=0&&(re[ce.associatedIconIndex]={shiftedAnchor:mt,angle:Wt})}else Hi(ce.numGlyphs,K)}if(N){se.clear();const ae=h.icon.placedSymbolArray;for(let ce=0;ce<ae.length;ce++){const ke=ae.get(ce);if(ke.hidden)Hi(ke.numGlyphs,se);else{const Se=re[ce];if(Se)for(let ve=0;ve<ke.numGlyphs;ve++)c.addDynamicAttributes(se,Se.shiftedAnchor[0],Se.shiftedAnchor[1],Se.shiftedAnchor[2],Se.angle);else Hi(ke.numGlyphs,se)}}h.icon.dynamicLayoutVertexBuffer.updateData(se)}h.text.dynamicLayoutVertexBuffer.updateData(K)}function xr(h,r,l){return l.iconsInText&&r?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function fr(h,r,l,p,_,v,E,C,A,z,N,Z){const K=h.context,se=K.gl,re=h.transform,ne="map"===C,ie="map"===A,te=ne&&"point"!==l.layout.get("symbol-placement"),ae=ne&&!ie&&!te,ce=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let ke=!1;const Se=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),ve=[c.mercatorXfromLng(re.center.lng),c.mercatorYfromLat(re.center.lat)],Ae=l.layout.get("text-variable-anchor"),Ce="globe"===re.projection.name,Be=[],He=[0,-1,0];let Mt=He;!Ce&&!re.mercatorFromTransition||ne||(Mt=function(Ve){const at=Ve._camera.getWorldToCamera(Ve.worldSize,1),_t=c.multiply([],at,Ve.globeMatrix);c.invert(_t,_t);const Bt=[0,0,0],Qe=[0,1,0,0];return c.transformMat4$1(Qe,Qe,_t),Bt[0]=Qe[0],Bt[1]=Qe[1],Bt[2]=Qe[2],c.normalize(Bt,Bt),Bt}(re));for(const Ve of p){const at=r.getTile(Ve),_t=at.getBucket(l);if(!_t||"mercator"===_t.projection.name&&Ce)continue;const Bt=_?_t.text:_t.icon;if(!Bt||_t.fullyClipped||!Bt.segments.get().length)continue;const Qe=Bt.programConfigurations.get(l.id),Pt=_||_t.sdfIcons,mt=_?_t.textSizeData:_t.iconSizeData,Wt=ie||0!==re.pitch,Vt=c.evaluateSizeForZoom(mt,re.zoom);let nn,fn,In,cr,ln=[0,0],Ln=null;if(_){if(fn=at.glyphAtlasTexture,In=se.LINEAR,nn=at.glyphAtlasTexture.size,_t.iconsInText){ln=at.imageAtlasTexture.size,Ln=at.imageAtlasTexture;const Ho="composite"===mt.kind||"camera"===mt.kind;cr=Wt||h.options.rotating||h.options.zooming||Ho?se.LINEAR:se.NEAREST}}else{const Ho=1!==l.layout.get("icon-size").constantOr(0)||_t.iconsNeedLinear;fn=at.imageAtlasTexture,In=Pt||h.options.rotating||h.options.zooming||Ho||Wt?se.LINEAR:se.NEAREST,nn=at.imageAtlasTexture.size}const br="globe"===_t.projection.name,Yr=br?Mt:He,hi=br?c.globeToMercatorTransition(re.zoom):0,Lr=gr(Ve,_t.getProjection(),re),Ui=re.calculatePixelsToTileUnitsMatrix(at),_s=Fn(Lr,at.tileID.canonical,ie,ne,re,_t.getProjection(),Ui),xa=h.terrain&&ie&&te?c.invert(c.create(),_s):rt,Gr=Er(Lr,at.tileID.canonical,ie,ne,re,_t.getProjection(),Ui),ui=Ae&&_t.hasTextData(),Zn="none"!==l.layout.get("icon-text-fit")&&ui&&_t.hasIconData();if(te){const Ho=re.elevation,Ys=Ho?Ho.getAtTileOffsetFunc(Ve,re.center.lat,re.worldSize,_t.getProjection()):pc=>[0,0,0],Ks=Tn(Lr,at.tileID.canonical,ie,ne,re,_t.getProjection(),Ui);To(_t,Lr,h,_,Ks,Gr,ie,z,Ys,Ve)}const ji=te||_&&Ae||Zn,eo=h.translatePosMatrix(Lr,at,v,E),Vr=ji?rt:_s,so=h.translatePosMatrix(Gr,at,v,E,!0),Xs=_t.getProjection().createInversionMatrix(re,Ve.canonical),ao=[];h.terrain&&ie&&ao.push("PITCH_WITH_MAP_TERRAIN"),br&&ao.push("PROJECTION_GLOBE_VIEW"),ji&&ao.push("PROJECTED_POS_ON_VIEWPORT");const ys=Pt&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let Nl;Nl=Pt?_t.iconsInText?Ts(mt.kind,Vt,ae,ie,h,eo,Vr,so,nn,ln,Ve,hi,ve,Xs,Yr,_t.getProjection()):Za(mt.kind,Vt,ae,ie,h,eo,Vr,so,_,nn,!0,Ve,hi,ve,Xs,Yr,_t.getProjection()):sc(mt.kind,Vt,ae,ie,h,eo,Vr,so,_,nn,Ve,hi,ve,Xs,Yr,_t.getProjection());const Ul={program:h.useProgram(xr(Pt,_,_t),Qe,ao),buffers:Bt,uniformValues:Nl,atlasTexture:fn,atlasTextureIcon:Ln,atlasInterpolation:In,atlasInterpolationIcon:cr,isSDF:Pt,hasHalo:ys,tile:at,labelPlaneMatrixInv:xa};if(ce&&_t.canOverlap){ke=!0;const Ho=Bt.segments.get();for(const Ys of Ho)Be.push({segments:new c.SegmentVector([Ys]),sortKey:Ys.sortKey,state:Ul})}else Be.push({segments:Bt.segments,sortKey:0,state:Ul})}ke&&Be.sort((Ve,at)=>Ve.sortKey-at.sortKey);for(const Ve of Be){const at=Ve.state;if(h.terrain&&h.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:!Ce,labelPlaneMatrixInv:at.labelPlaneMatrixInv}),K.activeTexture.set(se.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,se.CLAMP_TO_EDGE),at.atlasTextureIcon&&(K.activeTexture.set(se.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),at.isSDF){const _t=at.uniformValues;at.hasHalo&&(_t.u_is_halo=1,Dr(at.buffers,Ve.segments,l,h,at.program,Se,N,Z,_t)),_t.u_is_halo=0}Dr(at.buffers,Ve.segments,l,h,at.program,Se,N,Z,at.uniformValues)}}function Dr(h,r,l,p,_,v,E,C,A){const z=p.context,N=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];_.draw(z,z.gl.TRIANGLES,v,E,C,c.CullFaceMode.disabled,A,l.id,h.layoutVertexBuffer,h.indexBuffer,r,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),N)}function rr(h,r,l,p,_,v,E){const C=h.context.gl,A=l.paint.get("fill-pattern"),z=A&&A.constantOr(1),N=l.getCrossfadeParameters();let Z,K,se,re,ne;E?(K=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=C.LINES):(K=z?"fillPattern":"fill",Z=C.TRIANGLES);for(const ie of p){const te=r.getTile(ie);if(z&&!te.patternsLoaded())continue;const ae=te.getBucket(l);if(!ae)continue;h.prepareDrawTile();const ce=ae.programConfigurations.get(l.id),ke=h.useProgram(K,ce);z&&(h.context.activeTexture.set(C.TEXTURE0),te.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ce.updatePaintBuffers(N));const Se=A.constantOr(null);if(Se&&te.imageAtlas){const Ae=te.imageAtlas,Ce=Ae.patternPositions[Se.to.toString()],Be=Ae.patternPositions[Se.from.toString()];Ce&&Be&&ce.setConstantPatternPositions(Ce,Be)}const ve=h.translatePosMatrix(ie.projMatrix,te,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){re=ae.indexBuffer2,ne=ae.segments2;const Ae=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];se="fillOutlinePattern"===K&&z?Wi(ve,h,N,te,Ae):Si(ve,Ae)}else re=ae.indexBuffer,ne=ae.segments,se=z?ti(ve,h,N,te):da(ve);h.prepareDrawProgram(h.context,ke,ie.toUnwrapped()),ke.draw(h.context,Z,_,h.stencilModeForClipping(ie),v,c.CullFaceMode.disabled,se,l.id,ae.layoutVertexBuffer,re,ne,l.paint,h.transform.zoom,ce)}}function Nn(h,r,l,p,_,v,E){const C=h.context,A=C.gl,z=h.transform,N=l.paint.get("fill-extrusion-pattern"),Z=N.constantOr(1),K=l.getCrossfadeParameters(),se=l.paint.get("fill-extrusion-opacity"),re=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],ne=l.layout.get("fill-extrusion-edge-radius"),ie="globe"===z.projection.name?c.fillExtrusionHeightLift():0,te="globe"===z.projection.name,ae=te?c.globeToMercatorTransition(z.zoom):0,ce=[c.mercatorXfromLng(z.center.lng),c.mercatorYfromLat(z.center.lat)],ke=[];te&&(ke.push("PROJECTION_GLOBE_VIEW"),h.style.terrainSetForDrapingOnly()&&ke.push("TERRAIN")),re[0]>0&&ke.push("FAUX_AO");for(const Se of p){const ve=r.getTile(Se),Ae=ve.getBucket(l);if(!Ae||Ae.projection.name!==z.projection.name)continue;const Ce=Ae.programConfigurations.get(l.id),Be=h.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",Ce,ke);if(h.terrain){const Qe=h.terrain;if(h.style.terrainSetForDrapingOnly())Qe.setupElevationDraw(ve,Be,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(Qe.setupElevationDraw(ve,Be,{useMeterToDem:!0}),ir(C,r,Se,Ae,l,Qe),!Ae.centroidVertexBuffer){const Pt=Be.attributes.a_centroid_pos;void 0!==Pt&&A.vertexAttrib2f(Pt,0,0)}}}Z&&(h.context.activeTexture.set(A.TEXTURE0),ve.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Ce.updatePaintBuffers(K));const He=N.constantOr(null);if(He&&ve.imageAtlas){const Qe=ve.imageAtlas,Pt=Qe.patternPositions[He.to.toString()],mt=Qe.patternPositions[He.from.toString()];Pt&&mt&&Ce.setConstantPatternPositions(Pt,mt)}const Mt=h.translatePosMatrix(Se.projMatrix,ve,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ve=z.projection.createInversionMatrix(z,Se.canonical),at=l.paint.get("fill-extrusion-vertical-gradient"),_t=Z?Es(Mt,h,at,se,re,ne,Se,K,ve,ie,ae,ce,Ve):Gn(Mt,h,at,se,re,ne,Se,ie,ae,ce,Ve);h.prepareDrawProgram(C,Be,Se.toUnwrapped());const Bt=[];h.terrain&&Bt.push(Ae.centroidVertexBuffer),te&&Bt.push(Ae.layoutVertexExtBuffer),Be.draw(C,C.gl.TRIANGLES,_,v,E,c.CullFaceMode.backCCW,_t,l.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,l.paint,h.transform.zoom,Ce,Bt)}}function ir(h,r,l,p,_,v){const E=[te=>{let ae=te.canonical.x-1,ce=te.wrap;return ae<0&&(ae=(1<<te.canonical.z)-1,ce--),new c.OverscaledTileID(te.overscaledZ,ce,te.canonical.z,ae,te.canonical.y)},te=>{let ae=te.canonical.x+1,ce=te.wrap;return ae===1<<te.canonical.z&&(ae=0,ce++),new c.OverscaledTileID(te.overscaledZ,ce,te.canonical.z,ae,te.canonical.y)},te=>new c.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,(0===te.canonical.y?1<<te.canonical.z:te.canonical.y)-1),te=>new c.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,te.canonical.y===(1<<te.canonical.z)-1?0:te.canonical.y+1)],C=te=>{const ae=r.getSource().minzoom,ce=Se=>{const ve=r.getTileByID(Se);if(ve&&ve.hasData())return ve.getBucket(_)},ke=[0,-1,1];for(const Se of ke){if(te.overscaledZ+Se<ae)continue;const ve=ce(te.calculateScaledKey(te.overscaledZ+Se));if(ve)return ve}},A=[0,0,0],z=(te,ae)=>(A[0]=Math.min(te.min.y,ae.min.y),A[1]=Math.max(te.max.y,ae.max.y),A[2]=c.EXTENT-ae.min.x>te.max.x?ae.min.x-c.EXTENT:te.max.x,A),N=(te,ae)=>(A[0]=Math.min(te.min.x,ae.min.x),A[1]=Math.max(te.max.x,ae.max.x),A[2]=c.EXTENT-ae.min.y>te.max.y?ae.min.y-c.EXTENT:te.max.y,A),Z=[(te,ae)=>z(te,ae),(te,ae)=>z(ae,te),(te,ae)=>N(te,ae),(te,ae)=>N(ae,te)],K=new c.pointGeometry(0,0);let se,re,ne;const ie=(te,ae,ce,ke,Se)=>{const ve=[[ke?ce:te,ke?te:ce,0],[ke?ce:ae,ke?ae:ce,0]],Ae=Se<0?c.EXTENT+Se:Se,Ce=[ke?Ae:(te+ae)/2,ke?(te+ae)/2:Ae,0];return 0===ce&&Se<0||0!==ce&&Se>0?v.getForTilePoints(ne,[Ce],!0,re):ve.push(Ce),v.getForTilePoints(l,ve,!0,se),Math.max(ve[0][2],ve[1][2],Ce[2])/v.exaggeration()};for(let te=0;te<4;te++){const ae=(te<2?1:5)-te,ce=p.borders[te];if(0===ce.length)continue;const ke=ne=E[te](l),Se=C(ke);if(!(Se&&Se instanceof c.FillExtrusionBucket&&Se.enableTerrain)||p.borderDoneWithNeighborZ[te]===Se.canonical.z&&Se.borderDoneWithNeighborZ[ae]===p.canonical.z||(re=v.findDEMTileFor(ke),!re||!re.dem))continue;if(!se){const Be=v.findDEMTileFor(l);if(!Be||!Be.dem)return;se=Be}const ve=Se.borders[ae];let Ae=0;const Ce=Se.borderDoneWithNeighborZ[ae]!==p.canonical.z;if(p.canonical.z===Se.canonical.z){for(let Be=0;Be<ce.length;Be++){const He=p.featuresOnBorder[ce[Be]],Mt=He.borders[te];let Ve;for(;Ae<ve.length&&(Ve=Se.featuresOnBorder[ve[Ae]],!(Ve.borders[ae][1]>Mt[0]+3));)Ce&&Se.encodeCentroid(void 0,Ve,!1),Ae++;if(Ve&&Ae<ve.length){const at=Ae;let _t=0;for(;!(Ve.borders[ae][0]>Mt[1]-3)&&(_t++,++Ae!==ve.length);)Ve=Se.featuresOnBorder[ve[Ae]];if(Ve=Se.featuresOnBorder[ve[at]],He.intersectsCount()>1||Ve.intersectsCount()>1||1!==_t){1!==_t&&(Ae=at),p.encodeCentroid(void 0,He,!1),Ce&&Se.encodeCentroid(void 0,Ve,!1);continue}const Bt=Z[te](He,Ve),Qe=te%2?c.EXTENT-1:0;K.x=ie(Bt[0],Math.min(c.EXTENT-1,Bt[1]),Qe,te<2,Bt[2]),K.y=0,p.encodeCentroid(K,He,!1),Ce&&Se.encodeCentroid(K,Ve,!1)}else p.encodeCentroid(void 0,He,!1)}p.borderDoneWithNeighborZ[te]=Se.canonical.z,p.needsCentroidUpdate=!0,Ce&&(Se.borderDoneWithNeighborZ[ae]=p.canonical.z,Se.needsCentroidUpdate=!0)}else{for(const Be of ce)p.encodeCentroid(void 0,p.featuresOnBorder[Be],!1);if(Ce){for(const Be of ve)Se.encodeCentroid(void 0,Se.featuresOnBorder[Be],!1);Se.borderDoneWithNeighborZ[ae]=p.canonical.z,Se.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[te]=Se.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(h)}const Yn=new c.Color(1,0,0,1),qi=new c.Color(0,1,0,1),bi=new c.Color(0,0,1,1),Jo=new c.Color(1,0,1,1),Qi=new c.Color(0,1,1,1);function or(h,r,l){const p=h.context,_=h.transform,v=p.gl,E="globe"===_.projection.name,C=E?["PROJECTION_GLOBE_VIEW"]:null;let A=l.projMatrix;if(E&&c.globeToMercatorTransition(_.zoom)>0){const He=c.transitionTileAABBinECEF(l.canonical,_),Mt=c.globeDenormalizeECEF(He);A=c.multiply(new Float32Array(16),_.globeMatrix,Mt),c.multiply(A,_.projMatrix,A)}const z=h.useProgram("debug",null,C),N=r.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(N,z);const Z=c.DepthMode.disabled,K=c.StencilMode.disabled,se=h.colorModeForRenderPass();p.activeTexture.set(v.TEXTURE0),h.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),E?N._makeGlobeTileDebugBuffers(h.context,_):N._makeDebugTileBoundsBuffers(h.context,_.projection);const ne=N._tileDebugBuffer||h.debugBuffer,ie=N._tileDebugIndexBuffer||h.debugIndexBuffer,te=N._tileDebugSegments||h.debugSegments;z.draw(p,v.LINE_STRIP,Z,K,se,c.CullFaceMode.disabled,Oc(A,c.Color.red),"$debug",ne,ie,te,null,null,null,[N._globeTileDebugBorderBuffer]);const ae=N.latestRawTileData,ce=Math.floor((ae&&ae.byteLength||0)/1024),ke=r.getTile(l).tileSize,Se=512/Math.min(ke,512)*(l.overscaledZ/_.zoom)*.5;let ve=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ve+=` => ${l.overscaledZ}`),ve+=` ${ce}kb`,function(He,Mt){He.initDebugOverlayCanvas();const Ve=He.debugOverlayCanvas,at=He.context.gl,_t=He.debugOverlayCanvas.getContext("2d");_t.clearRect(0,0,Ve.width,Ve.height),_t.shadowColor="white",_t.shadowBlur=2,_t.lineWidth=1.5,_t.strokeStyle="white",_t.textBaseline="top",_t.font="bold 36px Open Sans, sans-serif",_t.fillText(Mt,5,5),_t.strokeText(Mt,5,5),He.debugOverlayTexture.update(Ve),He.debugOverlayTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE)}(h,ve);const Ae=N._tileDebugTextBuffer||h.debugBuffer,Ce=N._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Be=N._tileDebugTextSegments||h.debugSegments;z.draw(p,v.TRIANGLES,Z,K,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,Oc(A,c.Color.transparent,Se),"$debug",Ae,Ce,Be,null,null,null,[N._globeTileDebugTextBuffer])}function Ds(h,r,l,p){$s(h,0,r+l/2,h.transform.width,l,p)}function Vs(h,r,l,p){$s(h,r-l/2,0,l,h.transform.height,p)}function $s(h,r,l,p,_,v){const E=h.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,p*c.exported.devicePixelRatio,_*c.exported.devicePixelRatio),E.clear({color:v}),C.disable(C.SCISSOR_TEST)}const Gs=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Nc}=Gs;function $o(h,r,l,p){h.emplaceBack(r,l,p)}class Uc{constructor(r){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,$o(this.vertexArray,-1,-1,1),$o(this.vertexArray,1,-1,1),$o(this.vertexArray,-1,1,1),$o(this.vertexArray,1,1,1),$o(this.vertexArray,-1,-1,-1),$o(this.vertexArray,1,-1,-1),$o(this.vertexArray,-1,1,-1),$o(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Nc),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function So(h,r,l,p,_,v){const E=h.gl,C=r.paint.get("sky-atmosphere-color"),A=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:c.fromMat4(c.create$1(),p),u_sun_direction:_,u_sun_intensity:z,u_color_tint_r:[(re=C).r,re.g,re.b,re.a],u_color_tint_m:[(ne=A).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var re,ne;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),l.draw(h,E.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,N,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const fa=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ac{constructor(r){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new c.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,fa.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Wa={symbol:function(h,r,l,p,_){if("translucent"!==h.renderPass)return;const v=c.StencilMode.disabled,E=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(C,A,z,N,Z,K,se){const re=A.transform,ne="map"===Z,ie="map"===K;for(const te of C){const ae=N.getTile(te),ce=ae.getBucket(z);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const ke=c.evaluateSizeForZoom(ce.textSizeData,re.zoom),Se=gr(te,ce.getProjection(),re),ve=re.calculatePixelsToTileUnitsMatrix(ae),Ae=Fn(Se,ae.tileID.canonical,ie,ne,re,ce.getProjection(),ve),Ce="none"!==z.layout.get("icon-text-fit")&&ce.hasIconData();if(ke){const Be=Math.pow(2,re.zoom-ae.tileID.overscaledZ);sn(ce,ne,ie,se,c.symbolSize,re,Ae,te,Be,ke,Ce)}}}(p,h,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&fr(h,r,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,E),0!==l.paint.get("text-opacity").constantOr(1)&&fr(h,r,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,E),r.map.showCollisionBoxes&&(Me(h,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Me(h,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,r,l,p){if("translucent"!==h.renderPass)return;const _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),C=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===v.constantOr(1)||0===E.constantOr(1)))return;const A=h.context,z=A.gl,N=h.transform,Z=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),K=c.StencilMode.disabled,se=h.colorModeForRenderPass(),re="globe"===N.projection.name,ne=[c.mercatorXfromLng(N.center.lng),c.mercatorYfromLat(N.center.lat)],ie=[];for(let ae=0;ae<p.length;ae++){const ce=p[ae],ke=r.getTile(ce),Se=ke.getBucket(l);if(!Se||Se.projection.name!==N.projection.name)continue;const ve=Se.programConfigurations.get(l.id),Ae=Ml(l);re&&Ae.push("PROJECTION_GLOBE_VIEW");const Ce=h.useProgram("circle",ve,Ae),Be=Se.layoutVertexBuffer,He=Se.globeExtVertexBuffer,Mt=Se.indexBuffer,Ve=N.projection.createInversionMatrix(N,ce.canonical),at={programConfiguration:ve,program:Ce,layoutVertexBuffer:Be,globeExtVertexBuffer:He,indexBuffer:Mt,uniformValues:js(h,ce,ke,Ve,ne,l),tile:ke};if(C){const _t=Se.segments.get();for(const Bt of _t)ie.push({segments:new c.SegmentVector([Bt]),sortKey:Bt.sortKey,state:at})}else ie.push({segments:Se.segments,sortKey:0,state:at})}C&&ie.sort((ae,ce)=>ae.sortKey-ce.sortKey);const te={useDepthForOcclusion:!re};for(const ae of ie){const{programConfiguration:ce,program:ke,layoutVertexBuffer:Se,globeExtVertexBuffer:ve,indexBuffer:Ae,uniformValues:Ce,tile:Be}=ae.state,He=ae.segments;h.terrain&&h.terrain.setupElevationDraw(Be,ke,te),h.prepareDrawProgram(A,ke,Be.tileID.toUnwrapped()),ke.draw(A,z.TRIANGLES,Z,K,se,c.CullFaceMode.disabled,Ce,l.id,Se,Ae,He,l.paint,N.zoom,ce,[ve])}},heatmap:function(h,r,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const _=h.context,v=_.gl,E=c.StencilMode.disabled,C=new c.ColorMode([v.ONE,v.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(se,re,ne,ie){const te=se.gl,ae=re.width*ie,ce=re.height*ie;se.activeTexture.set(te.TEXTURE1),se.viewport.set([0,0,ae,ce]);let ke=ne.heatmapFbo;if(!ke||ke&&(ke.width!==ae||ke.height!==ce)){ke&&ke.destroy();const Se=te.createTexture();te.bindTexture(te.TEXTURE_2D,Se),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ke=ne.heatmapFbo=se.createFramebuffer(ae,ce,!1),function(ve,Ae,Ce,Be,He,Mt){const Ve=ve.gl;Ve.texImage2D(Ve.TEXTURE_2D,0,Ve.RGBA,He,Mt,0,Ve.RGBA,ve.extRenderToTextureHalfFloat?ve.extTextureHalfFloat.HALF_FLOAT_OES:Ve.UNSIGNED_BYTE,null),Be.colorAttachment.set(Ce)}(se,0,Se,ke,ae,ce)}else te.bindTexture(te.TEXTURE_2D,ke.colorAttachment.get()),se.bindFramebuffer.set(ke.framebuffer)})(_,h,l,"globe"===h.transform.projection.name?.5:.25),_.clear({color:c.Color.transparent});const A=h.transform,z="globe"===A.projection.name,N=z?["PROJECTION_GLOBE_VIEW"]:null,Z=z?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,K=[c.mercatorXfromLng(A.center.lng),c.mercatorYfromLat(A.center.lat)];for(let se=0;se<p.length;se++){const re=p[se];if(r.hasRenderableParent(re))continue;const ne=r.getTile(re),ie=ne.getBucket(l);if(!ie||ie.projection.name!==A.projection.name)continue;const te=ie.programConfigurations.get(l.id),ae=h.useProgram("heatmap",te,N),{zoom:ce}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ne,ae),h.prepareDrawProgram(_,ae,re.toUnwrapped());const ke=A.projection.createInversionMatrix(A,re.canonical);ae.draw(_,v.TRIANGLES,c.DepthMode.disabled,E,C,Z,oc(h,re,ne,ke,K,ce,l.paint.get("heatmap-intensity")),l.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,l.paint,h.transform.zoom,te,z?[ie.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,v){const E=_.context,C=E.gl,A=v.heatmapFbo;if(!A)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new c.Texture(E,v.colorRamp,C.RGBA)),z.bind(C.LINEAR,C.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,C.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,_.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(h,l))},line:function(h,r,l,p){if("translucent"!==h.renderPass)return;const _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===_.constantOr(1)||0===v.constantOr(1))return;const E=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),C=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture?1:c.exported.devicePixelRatio,z=l.paint.get("line-dasharray"),N=z.constantOr(1),Z=l.layout.get("line-cap"),K=l.paint.get("line-pattern"),se=K.constantOr(1),re=l.paint.get("line-gradient"),ne=l.getCrossfadeParameters(),ie=se?"linePattern":"line",te=h.context,ae=te.gl,ce=(Se=>{const ve=[];yo(Se)&&ve.push("RENDER_LINE_DASH"),Se.paint.get("line-gradient")&&ve.push("RENDER_LINE_GRADIENT");const Ae=Se.paint.get("line-trim-offset");0===Ae[0]&&0===Ae[1]||ve.push("RENDER_LINE_TRIM_OFFSET");const Ce=Se.paint.get("line-pattern").constantOr(1),Be=1!==Se.paint.get("line-opacity").constantOr(1);return!Ce&&Be&&ve.push("RENDER_LINE_ALPHA_DISCARD"),ve})(l);let ke=ce.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ke=!1);for(const Se of p){const ve=r.getTile(Se);if(se&&!ve.patternsLoaded())continue;const Ae=ve.getBucket(l);if(!Ae)continue;h.prepareDrawTile();const Ce=Ae.programConfigurations.get(l.id),Be=h.useProgram(ie,Ce,ce),He=K.constantOr(null);if(He&&ve.imageAtlas){const mt=ve.imageAtlas,Wt=mt.patternPositions[He.to.toString()],Vt=mt.patternPositions[He.from.toString()];Wt&&Vt&&Ce.setConstantPatternPositions(Wt,Vt)}const Mt=z.constantOr(null),Ve=Z.constantOr(null);if(!se&&Mt&&Ve&&ve.lineAtlas){const mt=ve.lineAtlas,Wt=mt.getDash(Mt.to,Ve),Vt=mt.getDash(Mt.from,Ve);Wt&&Vt&&Ce.setConstantPatternPositions(Wt,Vt)}let[at,_t]=l.paint.get("line-trim-offset");("round"===Ve||"square"===Ve)&&at!==_t&&(0===at&&(at-=1),1===_t&&(_t+=1));const Bt=h.terrain?Se.projMatrix:null,Qe=se?Vo(h,ve,l,ne,Bt,A):Mi(h,ve,l,ne,Bt,Ae.lineClipsArray.length,A,[at,_t]);if(re){const mt=Ae.gradients[l.id];let Wt=mt.texture;if(l.gradientVersion!==mt.version){let Vt=256;if(l.stepInterpolant){const nn=r.getSource().maxzoom,fn=Se.canonical.z===nn?Math.ceil(1<<h.transform.maxZoom-Se.canonical.z):1;Vt=c.clamp(c.nextPowerOfTwo(Ae.maxLineLength/c.EXTENT*1024*fn),256,te.maxTextureSize)}mt.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Vt,image:mt.gradient||void 0,clips:Ae.lineClipsArray}),mt.texture?mt.texture.update(mt.gradient):mt.texture=new c.Texture(te,mt.gradient,ae.RGBA),mt.version=l.gradientVersion,Wt=mt.texture}te.activeTexture.set(ae.TEXTURE1),Wt.bind(l.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}N&&(te.activeTexture.set(ae.TEXTURE0),ve.lineAtlasTexture.bind(ae.LINEAR,ae.REPEAT),Ce.updatePaintBuffers(ne)),se&&(te.activeTexture.set(ae.TEXTURE0),ve.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ce.updatePaintBuffers(ne)),h.prepareDrawProgram(te,Be,Se.toUnwrapped());const Pt=mt=>{Be.draw(te,ae.TRIANGLES,E,mt,C,c.CullFaceMode.disabled,Qe,l.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,l.paint,h.transform.zoom,Ce,[Ae.layoutVertexBuffer2])};if(ke){const mt=h.stencilModeForClipping(Se).ref;0===mt&&h.terrain&&te.clear({stencil:0});const Wt={func:ae.EQUAL,mask:255};Qe.u_alpha_discard_threshold=.8,Pt(new c.StencilMode(Wt,mt,255,ae.KEEP,ae.KEEP,ae.INVERT)),Qe.u_alpha_discard_threshold=0,Pt(new c.StencilMode(Wt,mt,255,ae.KEEP,ae.KEEP,ae.KEEP))}else Pt(h.stencilModeForClipping(Se))}ke&&(h.resetStencilClippingMasks(),h.terrain&&te.clear({stencil:0}))},fill:function(h,r,l,p){const _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const E=h.colorModeForRenderPass(),C=l.paint.get("fill-pattern"),A=h.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===_.constantOr(c.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(h.renderPass===A){const z=h.depthModeForSublayer(1,"opaque"===h.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);rr(h,r,l,p,z,E,!1)}if("translucent"===h.renderPass&&l.paint.get("fill-antialias")){const z=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);rr(h,r,l,p,z,E,!0)}},"fill-extrusion":function(h,r,l,p){const _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===h.renderPass){const v=new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))Nn(h,r,l,p,v,c.StencilMode.disabled,c.ColorMode.disabled),Nn(h,r,l,p,v,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const E=h.colorModeForRenderPass();Nn(h,r,l,p,v,c.StencilMode.disabled,E)}}},hillshade:function(h,r,l,p){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const _=h.context,v=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),E=h.colorModeForRenderPass(),C=h.terrain&&h.terrain.renderingToTexture,[A,z]="translucent"!==h.renderPass||C?[{},p]:h.stencilConfigForOverlap(p);for(const N of z){const Z=r.getTile(N);if(Z.needsHillshadePrepare&&"offscreen"===h.renderPass)Ni(h,Z,l,v,c.StencilMode.disabled,E);else if("translucent"===h.renderPass){const K=C&&h.terrain?h.terrain.stencilModeForRTTOverlap(N):A[N.overscaledZ];Ns(h,N,Z,l,v,K,E)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,r,l,p,_,v){if("translucent"!==h.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const E=h.context,C=E.gl,A=r.getSource(),z=h.useProgram("raster"),N=h.colorModeForRenderPass(),Z=h.terrain&&h.terrain.renderingToTexture,[K,se]=A instanceof Ne||Z?[{},p]:h.stencilConfigForOverlap(p),re=se[se.length-1].overscaledZ,ne=!h.options.moving;for(const ie of se){const te=Z?c.DepthMode.disabled:h.depthModeForSublayer(ie.overscaledZ-re,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,C.LESS),ae=ie.toUnwrapped(),ce=r.getTile(ie);if(Z&&(!ce||!ce.hasData()))continue;const ke=Z?ie.projMatrix:h.transform.calculateProjMatrix(ae,ne),Se=h.terrain&&Z?h.terrain.stencilModeForRTTOverlap(ie):K[ie.overscaledZ],ve=v?0:l.paint.get("raster-fade-duration");ce.registerFadeDuration(ve);const Ae=r.findLoadedParent(ie,0),Ce=$a(ce,Ae,r,h.transform,ve);let Be,He;h.terrain&&h.terrain.prepareDrawTile();const Mt="nearest"===l.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),ce.texture.bind(Mt,C.CLAMP_TO_EDGE),E.activeTexture.set(C.TEXTURE1),Ae?(Ae.texture.bind(Mt,C.CLAMP_TO_EDGE),Be=Math.pow(2,Ae.tileID.overscaledZ-ce.tileID.overscaledZ),He=[ce.tileID.canonical.x*Be%1,ce.tileID.canonical.y*Be%1]):ce.texture.bind(Mt,C.CLAMP_TO_EDGE);const Ve=zc(ke,He||[0,0],Be||1,Ce,l,A instanceof Ne?A.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(E,z,ae),A instanceof Ne)A.boundsBuffer&&A.boundsSegments&&z.draw(E,C.TRIANGLES,te,c.StencilMode.disabled,N,c.CullFaceMode.disabled,Ve,l.id,A.boundsBuffer,h.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:at,tileBoundsIndexBuffer:_t,tileBoundsSegments:Bt}=h.getTileBoundsBuffers(ce);z.draw(E,C.TRIANGLES,te,Se,N,c.CullFaceMode.disabled,Ve,l.id,at,_t,Bt)}}h.resetStencilClippingMasks()},background:function(h,r,l,p){const _=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(0===v)return;const E=h.context,C=E.gl,A=h.transform,z=A.tileSize,N=l.paint.get("background-pattern");if(h.isPatternMissing(N))return;const Z=!N&&1===_.a&&1===v&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==Z)return;const K=c.StencilMode.disabled,se=h.depthModeForSublayer(0,"opaque"===Z?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),re=h.colorModeForRenderPass(),ne=h.useProgram(N?"backgroundPattern":"background");let ie,te=p;te||(ie=h.getBackgroundTiles(),te=Object.values(ie).map(ce=>ce.tileID)),N&&(E.activeTexture.set(C.TEXTURE0),h.imageManager.bind(h.context));const ae=l.getCrossfadeParameters();for(const ce of te){const ke=ce.toUnwrapped(),Se=p?ce.projMatrix:h.transform.calculateProjMatrix(ke);h.prepareDrawTile();const ve=r?r.getTile(ce):ie?ie[ce.key]:new c.Tile(ce,z,A.zoom,h),Ae=N?W(Se,v,h,N,{tileID:ce,tileSize:z},ae):F(Se,v,_);h.prepareDrawProgram(E,ne,ke);const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:Be,tileBoundsSegments:He}=h.getTileBoundsBuffers(ve);ne.draw(E,C.TRIANGLES,se,K,re,c.CullFaceMode.disabled,Ae,l.id,Ce,Be,He)}},sky:function(h,r,l){const p=h.transform,_="mercator"===p.projection.name||"globe"===p.projection.name?1:c.smoothstep(7,8,p.zoom),v=l.paint.get("sky-opacity")*_;if(0===v)return;const E=h.context,C=l.paint.get("sky-type"),A=new c.DepthMode(E.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),z=h.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===h.renderPass?l.needsSkyboxCapture(h)&&(function(N,Z,K,se){const re=N.context,ne=re.gl;let ie=Z.skyboxFbo;if(!ie){ie=Z.skyboxFbo=re.createFramebuffer(32,32,!1),Z.skyboxGeometry=new Uc(re),Z.skyboxTexture=re.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,Z.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ke=0;ke<6;++ke)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(ie.framebuffer),re.viewport.set([0,0,32,32]);const te=Z.getCenter(N,!0),ae=N.useProgram("skyboxCapture"),ce=new Float64Array(16);c.identity(ce),c.rotateY(ce,ce,.5*-Math.PI),So(re,Z,ae,ce,te,0),c.identity(ce),c.rotateY(ce,ce,.5*Math.PI),So(re,Z,ae,ce,te,1),c.identity(ce),c.rotateX(ce,ce,.5*-Math.PI),So(re,Z,ae,ce,te,2),c.identity(ce),c.rotateX(ce,ce,.5*Math.PI),So(re,Z,ae,ce,te,3),c.identity(ce),So(re,Z,ae,ce,te,4),c.identity(ce),c.rotateY(ce,ce,Math.PI),So(re,Z,ae,ce,te,5),re.viewport.set([0,0,N.width,N.height])}(h,l),l.markSkyboxValid(h)):"sky"===h.renderPass&&function(N,Z,K,se,re){const ne=N.context,ie=ne.gl,te=N.transform,ae=N.useProgram("skybox");ne.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,Z.skyboxTexture);const ce={u_matrix:te.skyboxMatrix,u_sun_direction:Z.getCenter(N,!1),u_cubemap:0,u_opacity:se,u_temporal_offset:re};N.prepareDrawProgram(ne,ae),ae.draw(ne,ie.TRIANGLES,K,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,ce,"skybox",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(h,l,A,v,z):"gradient"===C&&"sky"===h.renderPass&&function(N,Z,K,se,re){const ne=N.context,ie=ne.gl,te=N.transform,ae=N.useProgram("skyboxGradient");Z.skyboxGeometry||(Z.skyboxGeometry=new Uc(ne)),ne.activeTexture.set(ie.TEXTURE0);let ce=Z.colorRampTexture;ce||(ce=Z.colorRampTexture=new c.Texture(ne,Z.colorRamp,ie.RGBA)),ce.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const ke=(Se=te.skyboxMatrix,ve=Z.getCenter(N,!1),Ae=Z.paint.get("sky-gradient-radius"),Ce=se,Be=re,{u_matrix:Se,u_color_ramp:0,u_center_direction:ve,u_radius:c.degToRad(Ae),u_opacity:Ce,u_temporal_offset:Be});var Se,ve,Ae,Ce,Be;N.prepareDrawProgram(ne,ae),ae.draw(ne,ie.TRIANGLES,K,c.StencilMode.disabled,N.colorModeForRenderPass(),c.CullFaceMode.backCW,ke,"skyboxGradient",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(h,l,A,v,z)},debug:function(h,r,l){for(let p=0;p<l.length;p++)or(h,r,l[p])},custom:function(h,r,l){const p=h.context,_=l.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===h.renderPass){const v=_.prerender;v&&(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),v.call(_,p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState())}else if("translucent"===h.renderPass){h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(c.StencilMode.disabled);const v="3d"===_.renderingMode?new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,c.DepthMode.ReadOnly);p.setDepthMode(v),_.render(p.gl,h.transform.customLayerMatrix()),p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}};class pa{constructor(r,l){this.context=new he(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bo,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ga(this,r));const _=this._terrain;this.transform.elevation=p?_:null,_.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const p=new c.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(c.EXTENT,0),p.emplaceBack(0,c.EXTENT),p.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=r.createVertexBuffer(p,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const _=new c.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const v=new c.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(c.EXTENT,0,c.EXTENT,0),v.emplaceBack(0,c.EXTENT,0,c.EXTENT),v.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(v,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const E=new c.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(E);const C=new c.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])C.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(C),this.emptyTexture=new c.Texture(r,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=c.create();const A=this.context.gl;this.stencilClearMode=new c.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new ac(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,Ji(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const A of p)if(void 0===this._tileClippingMaskIDs[A.key]){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(c.ColorMode.disabled),_.setDepthMode(c.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const A=l.getTile(C),z=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:Z,tileBoundsSegments:K}=this.getTileBoundsBuffers(A);E.draw(_,v.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:v.ALWAYS,mask:0},z,255,v.KEEP,v.KEEP,v.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Ji(C.projMatrix),"$clipping",N,Z,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((E,C)=>C.overscaledZ-E.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let C=0;C<v;C++)E[C+_]=new c.StencilMode({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[_]:c.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([r.CONSTANT_COLOR,r.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(r,l,p){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new c.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const A in _){const z=_[A];z.used&&z.prepare(this.context)}const v={},E={},C={};for(const A in _){const z=_[A];v[A]=z.getVisibleCoordinates(),E[A]=v[A].slice().reverse(),C[A]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),c.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const A of p){const z=this.style._layers[A],N=r._getLayerSourceCache(z);if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const Z=N?E[N.id]:void 0;("custom"===z.type||z.isSky()||Z&&Z.length)&&this.renderLayer(this,N,z,Z)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],z=r._getLayerSourceCache(A);if(A.isSky())continue;const N=z?E[z.id]:void 0;this._renderTileClippingMasks(A,z,N),this.renderLayer(this,z,A,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,z){const N=A.context,Z=N.gl,K=A.transform,se=new c.DepthMode(Z.LEQUAL,c.DepthMode.ReadOnly,[0,1]),re=A.useProgram("globeAtmosphere",null,"globe"===K.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ne=c.globeToMercatorTransition(K.zoom),ie=z.properties.get("color").toArray01(),te=z.properties.get("high-color").toArray01(),ae=z.properties.get("space-color").toArray01PremultipliedAlpha(),ce=c.identity$1([]);c.rotateY$1(ce,ce,-c.degToRad(K._center.lng)),c.rotateX$1(ce,ce,c.degToRad(K._center.lat)),c.rotateZ$1(ce,ce,K.angle),c.rotateX$1(ce,ce,-K._pitch);const ke=c.fromQuat(new Float32Array(16),ce),Se=c.mapValue(z.properties.get("star-intensity"),0,1,0,.25),Ae=c.mapValue(z.properties.get("horizon-blend"),0,1,5e-4,.25),Ce=c.globeUseCustomAntiAliasing(A,N,K)&&5e-4===Ae?K.worldSize/(2*Math.PI*1.025)-1:K.globeRadius,Be=A.frameCounter/1e3%1,He=c.length(K.globeCenterInViewSpace),Mt=Math.sqrt(Math.pow(He,2)-Math.pow(Ce,2)),Ve=Math.acos(Mt/He),at={u_frustum_tl:K.frustumCorners.TL,u_frustum_tr:K.frustumCorners.TR,u_frustum_br:K.frustumCorners.BR,u_frustum_bl:K.frustumCorners.BL,u_horizon:K.frustumCorners.horizon,u_transition:ne,u_fadeout_range:Ae,u_color:ie,u_high_color:te,u_space_color:ae,u_star_intensity:Se,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Be,u_horizon_angle:Ve,u_rotation_matrix:ke};A.prepareDrawProgram(N,re);const _t=A.atmosphereBuffer;_t&&re.draw(N,Z.TRIANGLES,se,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,at,"skybox",_t.vertexBuffer,_t.indexBuffer,_t.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],z=r._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,z,A,z?E[z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const A=this.style._layers[p[this.currentLayer]],z=r._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=z?("symbol"===A.type?C:E)[z.id]:void 0;this._renderTileClippingMasks(A,z,z?v[z.id]:void 0),this.renderLayer(this,z,A,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;c.values(this.style._layers).forEach(z=>{const N=r._getLayerSourceCache(z);N&&!z.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<N.getSource().maxzoom)&&(A=N)}),A&&this.options.showTileBoundaries&&Wa.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const z=A.transform.padding;Ds(A,A.transform.height-(z.top||0),3,Yn),Ds(A,z.bottom||0,3,qi),Vs(A,z.left||0,3,bi),Vs(A,A.transform.width-(z.right||0),3,Jo);const N=A.transform.centerPoint;var Z,K,se,re;$s(Z=A,(K=N.x)-1,(se=A.transform.height-N.y)-10,2,20,re=Qi),$s(Z,K-10,se-1,20,2,re)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,l,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)||Wa[p.type](r,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const _=r[p],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),l[p]=E}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const _ of r)p+=l.getQueryObjectEXT(_,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(_);return p}translatePosMatrix(r,l,p,_,v){if(!p[0]&&!p[1])return r;const E=v?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(E){const z=Math.sin(E),N=Math.cos(E);p=[p[0]*N-p[1]*z,p[0]*z+p[1]*N]}const C=[v?p[0]:En(l,p[0],this.transform.zoom),v?p[1]:En(l,p[1],this.transform.zoom),0],A=new Float32Array(16);return c.translate(A,r,C),A}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!l||!p}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!r&&0!==l.getOpacity(this.transform.pitch)&&p.push("FOG"),r&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(r,l,p){this.cache=this.cache||{};const _=p||[],v=this.currentGlobalDefines().concat(_),E=ha.cacheKey(Bs[r],r,v,l);return this.cache[E]||(this.cache[E]=new ha(this.context,r,Bs[r],l,B[r],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch),E=((C,A,z,N,Z,K,se,re,ne,ie,te)=>{const ae=C.transform,ce=A.properties.get("color").toArray01();ce[3]=N;const ke=C.frameCounter/1e3%1;return{u_fog_matrix:z?ae.calculateFogTileMatrix(z):C.identityMat,u_fog_range:A.getFovAdjustedRange(ae._fov),u_fog_color:ce,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:ke,u_frustum_tl:Z,u_frustum_tr:K,u_frustum_br:se,u_frustum_bl:re,u_globe_pos:ne,u_globe_radius:ie,u_viewport:te,u_globe_transition:c.globeToMercatorTransition(ae.zoom),u_is_globe:+("globe"===ae.projection.name)}})(this,_,p,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(r,E)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=r[_.key]||new c.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class ma{constructor(r=0,l=0,p=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=_}interpolate(r,l,p){return null!=l.top&&null!=r.top&&(this.top=c.number(r.top,l.top,p)),null!=l.bottom&&null!=r.bottom&&(this.bottom=c.number(r.bottom,l.bottom,p)),null!=l.left&&null!=r.left&&(this.left=c.number(r.left,l.left,p)),null!=l.right&&null!=r.right&&(this.right=c.number(r.right,l.right,p)),this}getCenter(r,l){const p=c.clamp((this.left+r-this.right)/2,0,r),_=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(p,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ma(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function lc(h,r){const l=c.getColumn(h,3);c.fromQuat(h,r),c.setColumn(h,3,l)}function qa(h,r){const l=c.identity$1([]);return c.rotateZ$1(l,l,-r),c.rotateX$1(l,l,-h),l}function Xa(h,r){const l=[h[0],h[1],0],p=[r[0],r[1],0];if(c.length(l)>=1e-15){const E=c.normalize([],l);c.scale$2(p,E,c.dot(p,E)),r[0]=p[0],r[1]=p[1]}const _=c.cross([],r,h);if(c.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return qa(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class Xt{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof c.MercatorCoordinate?r:new c.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(r)):0,_=this.position,v=c.MercatorCoordinate.fromLngLat(r,p),E=[v.x-_.x,v.y-_.y,v.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Xa(E,l)}setPitchBearing(r,l){this.orientation=qa(c.degToRad(r),c.degToRad(-l))}}class Xi{constructor(r,l){this._transform=c.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new c.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=c.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&c.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||c.identity$1([]),r&&lc(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=qa(r,l),lc(this._transform,this._orientation)}forward(){const r=c.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=c.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=c.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return c.invert(p,this.getWorldToCamera(r,l)),p}getWorldToCameraPosition(r,l,p){const _=this.position;c.scale$2(_,_,-r);const v=new Float64Array(16);return c.fromScaling(v,[p,p,p]),c.translate(v,v,_),v[10]*=l,v}getWorldToCamera(r,l){const p=new Float64Array(16),_=new Float64Array(4),v=this.position;return c.conjugate(_,this._orientation),c.scale$2(v,v,-r),c.fromQuat(p,_),c.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,_){const v=new Float64Array(16);return c.perspective(v,r,l,p,_),v}getDistanceToElevation(r){const l=0===r?0:c.mercatorZfromAltitude(r,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new Xi([...this.position],[...this.orientation])}}function Al(h,r){const l=Hs(h.projection,h.zoom,h.width,h.height),p=function(v,E,C,A,z){const N=new c.LngLat(C.lng-180*Go,C.lat),Z=new c.LngLat(C.lng+180*Go,C.lat),K=v.project(N.lng,N.lat),se=v.project(Z.lng,Z.lat),re=-Math.atan2(se.y-K.y,se.x-K.x),ne=c.MercatorCoordinate.fromLngLat(C);ne.y=c.clamp(ne.y,-.999975,.999975);const ie=ne.toLngLat(),te=v.project(ie.lng,ie.lat),ae=c.MercatorCoordinate.fromLngLat(ie);ae.x+=Go;const ce=ae.toLngLat(),ke=v.project(ce.lng,ce.lat),Se=ds(ke.x-te.x,ke.y-te.y,re),ve=c.MercatorCoordinate.fromLngLat(ie);ve.y+=Go;const Ae=ve.toLngLat(),Ce=v.project(Ae.lng,Ae.lat),Be=ds(Ce.x-te.x,Ce.y-te.y,re),He=Math.abs(Se.x)/Math.abs(Be.y),Mt=c.identity([]);c.rotateZ(Mt,Mt,-re*(1-(z?0:A)));const Ve=c.identity([]);return c.scale(Ve,Ve,[1,1-(1-He)*A,1]),Ve[4]=-Be.x/Be.y*A,c.rotateZ(Ve,Ve,re),c.multiply(Ve,Mt,Ve),Ve}(h.projection,0,h.center,l,r),_=Pl(h);return c.scale(p,p,[_,_,1]),p}function Pl(h){const r=h.projection,l=Hs(h.projection,h.zoom,h.width,h.height),p=cc(r,h.center),_=cc(r,c.LngLat.convert(r.center));return Math.pow(2,p*l+(1-l)*_)}function Hs(h,r,l,p,_=1/0){const v=h.range;if(!v)return 0;const E=Math.min(_,Math.max(l,p)),C=Math.log(E/1024)/Math.LN2;return c.smoothstep(v[0]+C,v[1]+C,r)}const Go=1/4e4;function cc(h,r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=new c.LngLat(r.lng-180*Go,l),_=new c.LngLat(r.lng+180*Go,l),v=h.project(p.lng,l),E=h.project(_.lng,l),C=c.MercatorCoordinate.fromLngLat(p),A=c.MercatorCoordinate.fromLngLat(_),z=E.x-v.x,N=E.y-v.y,Z=A.x-C.x,K=A.y-C.y,se=Math.sqrt((Z*Z+K*K)/(z*z+N*N));return Math.log(se)/Math.LN2}function ds(h,r,l){const p=Math.cos(l),_=Math.sin(l);return{x:h*p-r*_,y:h*_+r*p}}class Rl{constructor(r,l,p,_,v,E,C){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ma,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Xi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new Rl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r){const l=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||l)&&this._updateCameraOnTerrain(),(r||l)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const p=!Fe(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var p,_,v,E,C,A,z,N,Z,K;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,E=this.angle,C=(v=this.rotationMatrix)[0],A=v[1],z=v[2],N=v[3],Z=Math.sin(E),K=Math.cos(E),_[0]=C*K+z*Z,_[1]=A*K+N*Z,_[2]=C*-Z+z*K,_[3]=A*-Z+N*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=c.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,v=0;for(let E=0;E<l.length;E++){const C=new c.pointGeometry(l[E][0]*this.width,p+l[E][1]*(this.height-p)),A=r.pointCoordinate(C);if(!A)continue;const z=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);_+=A[3]*z,v+=z}return 0===v?NaN:_/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=c.length(c.sub([],this._camera.position,p));return c.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!c.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];c.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new Xt;return l.position=new c.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!c.length$1(r))return!1;c.normalize$1(r,r);const l=c.transformQuat([],[0,0,-1],r),p=c.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const _=Xa(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=c.clamp(r[2],_/p,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new c.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new c.pointGeometry(0,0)),_=this.pointCoordinate(new c.pointGeometry(this.width,0)),v=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new c.pointGeometry(0,this.height)),C=Math.floor(Math.min(p.x,_.x,v.x,E.x)),A=Math.floor(Math.max(p.x,_.x,v.x,E.x)),z=1;for(let N=C-z;N<=A+z;N++)0!==N&&l.push(new c.UnwrappedTileID(N,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,_=this.elevation&&!r.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==r.minzoom&&l<r.minzoom)return[];void 0!==r.maxzoom&&l>r.maxzoom&&(l=r.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,A=1<<l,z=[A*E.x,A*E.y,0],N="globe"===this.projection.name,Z=!N,K=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,Z),se=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=A*c.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),ie=[A*se.x,A*se.y,ne*(Z?1:re)],te=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,ce=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ke=r.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?Pl(this):1,ve=Qe=>{const mt=new c.MercatorCoordinate(Qe.x+25e-6,Qe.y,Qe.z),Wt=new c.MercatorCoordinate(Qe.x,Qe.y+25e-6,Qe.z),Vt=Qe.toLngLat(),nn=mt.toLngLat(),fn=Wt.toLngLat(),In=this.locationCoordinate(Vt),cr=this.locationCoordinate(nn),ln=this.locationCoordinate(fn),Ln=Math.hypot(cr.x-In.x,cr.y-In.y),br=Math.hypot(ln.x-In.x,ln.y-In.y);return Math.sqrt(Ln*br)*Se/25e-6},Ae=Qe=>{const Pt=ce,mt=ke;return{aabb:c.tileAABB(this,A,0,0,0,Qe,mt,Pt,this.projection),zoom:0,x:0,y:0,minZ:mt,maxZ:Pt,wrap:Qe,fullyVisible:!1}},Ce=[];let Be=[];const He=l,Mt=r.reparseOverscaled?p:l,Ve=Qe=>Qe*Qe,at=Ve((ne-this._centerAltitude)*re),_t=Qe=>{if(!this._elevation||!Qe.tileID||!v)return;const Pt=this._elevation.getMinMaxForTile(Qe.tileID),mt=Qe.aabb;Pt?(mt.min[2]=Pt.min,mt.max[2]=Pt.max,mt.center[2]=(mt.min[2]+mt.max[2])/2):(Qe.shouldSplit=Bt(Qe),Qe.shouldSplit||(mt.min[2]=mt.max[2]=mt.center[2]=this._centerAltitude))},Bt=Qe=>{if(Qe.zoom<ae)return!0;if(Qe.zoom===He)return!1;if(null!=Qe.shouldSplit)return Qe.shouldSplit;const Pt=Qe.aabb.distanceX(ie),mt=Qe.aabb.distanceY(ie);let Wt=at,Vt=1;if(N){Wt=Ve(Qe.aabb.distanceZ(ie));const fn=Math.pow(2,Qe.zoom),In=c.latFromMercatorY((Qe.y+1)/fn),cr=c.latFromMercatorY(Qe.y/fn),ln=Math.min(Math.max(C,In),cr),Ln=c.circumferenceAtLatitude(ln)/c.circumferenceAtLatitude(C);if(Vt=ln===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ln/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&Qe.zoom===He-1&&Ln>=.9)return!0}else if(_&&(Wt=Ve(Qe.aabb.distanceZ(ie)*re)),this.projection.isReprojectedInTileSpace&&p<=5){const fn=Math.pow(2,Qe.zoom),In=ve(new c.MercatorCoordinate((Qe.x+.5)/fn,(Qe.y+.5)/fn));Vt=In>.85?1:In}const nn=Pt*Pt+mt*mt+Wt;return nn<Ve((1<<He-Qe.zoom)*te*Vt*((fn,In)=>{if(In*Ve(.707)<fn)return 1;const cr=Math.sqrt(In/fn);return cr/(1.4144271570014144+(Math.pow(1.1,cr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Wt,at),nn))};if(this.renderWorldCopies)for(let Qe=1;Qe<=3;Qe++)Ce.push(Ae(-Qe)),Ce.push(Ae(Qe));for(Ce.push(Ae(0));Ce.length>0;){const Qe=Ce.pop(),Pt=Qe.x,mt=Qe.y;let Wt=Qe.fullyVisible;if(!Wt){const Vt=Qe.aabb.intersects(K);if(0===Vt)continue;Wt=2===Vt}if(Qe.zoom!==He&&Bt(Qe))for(let Vt=0;Vt<4;Vt++){const nn=(Pt<<1)+Vt%2,fn=(mt<<1)+(Vt>>1),In={aabb:v?Qe.aabb.quadrant(Vt):c.tileAABB(this,A,Qe.zoom+1,nn,fn,Qe.wrap,Qe.minZ,Qe.maxZ,this.projection),zoom:Qe.zoom+1,x:nn,y:fn,wrap:Qe.wrap,fullyVisible:Wt,tileID:void 0,shouldSplit:void 0,minZ:Qe.minZ,maxZ:Qe.maxZ};_&&!N&&(In.tileID=new c.OverscaledTileID(Qe.zoom+1===He?Mt:Qe.zoom+1,Qe.wrap,Qe.zoom+1,nn,fn),_t(In)),Ce.push(In)}else{const Vt=Qe.zoom===He?Mt:Qe.zoom;if(r.minzoom&&r.minzoom>Vt)continue;const nn=z[0]-(.5+Pt+(Qe.wrap<<Qe.zoom))*(1<<l-Qe.zoom),fn=z[1]-.5-mt,In=Qe.tileID?Qe.tileID:new c.OverscaledTileID(Vt,Qe.wrap,Qe.zoom,Pt,mt);Be.push({tileID:In,distanceSq:nn*nn+fn*fn})}}if(this.fogCullDistSq){const Qe=this.fogCullDistSq,Pt=this.horizonLineFromTop();Be=Be.filter(mt=>{const Wt=[0,0,0,1],Vt=[c.EXTENT,c.EXTENT,0,1],nn=this.calculateFogTileMatrix(mt.tileID.toUnwrapped());c.transformMat4$1(Wt,Wt,nn),c.transformMat4$1(Vt,Vt,nn);const fn=c.getAABBPointSquareDist(Wt,Vt);if(0===fn)return!0;let In=!1;const cr=this._elevation;if(cr&&fn>Qe&&0!==Pt){const ln=this.calculateProjMatrix(mt.tileID.toUnwrapped());let Ln;r.isTerrainDEM||(Ln=cr.getMinMaxForTile(mt.tileID)),Ln||(Ln={min:ke,max:ce});const br=c.furthestTileCorner(this.rotation),Yr=[br[0]*c.EXTENT,br[1]*c.EXTENT,Ln.max];c.transformMat4(Yr,Yr,ln),In=(1-Yr[1])*this.height*.5<Pt}return fn<Qe||In})}return Be.sort((Qe,Pt)=>Qe.distanceSq-Pt.distanceSq).map(Qe=>Qe.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,l);return new c.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){let p,_;const v=this.centerPoint;if("globe"===this.projection.name){const C=this.worldSize;p=(l.x-v.x)/C,_=(l.y-v.y)/C}else{const C=this.pointCoordinate(l),A=this.pointCoordinate(v);p=C.x-A.x,_=C.y-A.y}const E=this.locationCoordinate(r);this.setLocation(new c.MercatorCoordinate(E.x-p,E.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const p=l?c.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new c.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l??this._centerAltitude,_=[r.x,r.y,0,1],v=[r.x,r.y,1,1];c.transformMat4$1(_,_,this.pixelMatrixInverse),c.transformMat4$1(v,v,this.pixelMatrixInverse);const E=v[3];c.scale$1(_,_,1/_[3]),c.scale$1(v,v,1/E);const C=_[2],A=v[2];return{p0:_,p1:v,t:C===A?0:(p-C)/(A-C)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(p,p,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(p,p,1/p[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=c.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(p,p,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:_}=r,v=c.mercatorZfromAltitude(l[2],this._center.lat),E=c.mercatorZfromAltitude(p[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],p[0],_)/this.worldSize,c.number(l[1],p[1],_)/this.worldSize,c.number(v,E,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(r.y>_)return this.pointCoordinate(r);const v=.02*_,E=r.clone();for(let C=0;C<10&&_-p>v;C++){E.y=c.number(p,_,.66);const A=this.projection.pointCoordinate3D(this,E.x,E.y);A?(_=E.y,l=A):p=E.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return c.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new c.pointGeometry(_[0]/_[3],_[1]/_[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,l){const p=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(p,r),A=this.pointCoordinate(_,r);const z=this.pointCoordinate(v,l),N=this.pointCoordinate(E,l),Z=(K,se)=>(se.y-K.y)/(se.x-K.x);return C.y>1&&A.y>=0?C=new c.MercatorCoordinate((1-N.y)/Z(N,C)+N.x,1):C.y<0&&A.y<=1&&(C=new c.MercatorCoordinate(-N.y/Z(N,C)+N.x,0)),A.y>1&&C.y>=0?A=new c.MercatorCoordinate((1-z.y)/Z(z,A)+z.x,1):A.y<0&&C.y<=1&&(A=new c.MercatorCoordinate(-z.y/Z(z,A)+z.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(z))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((p,_)=>{if(_.dem){const v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=r.canonical,v=1/this.height,E=this.cameraWorldSize/this.zoomScale(_.z),C=(_.x+Math.pow(2,_.z)*r.wrap)*E,A=_.y*E,z=this.point,N=this.angle,Z=Math.sin(-N),K=-Math.cos(-N);return p[l]={bearing:[Z,K],center:[(z.x-C)*v,(z.y-A)*v],scale:E/c.EXTENT*v},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSize,r);return c.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(r,l=!1){const p=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const v=this.calculatePosMatrix(r,this.worldSize);return c.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(v,E){const{scale:C}=v.tileTransform,A=C*c.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return z=new Float32Array(4),K=(N=E.inverseAdjustmentMatrix)[1],se=N[2],re=N[3],ie=(Z=[A,A])[1],z[0]=N[0]*(ne=Z[0]),z[1]=K*ne,z[2]=se*ie,z[3]=re*ie,z;var z,N,Z,K,se,re,ne,ie}(r,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),v=c.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,_[2]/=v,c.normalize(_,_);const E=r.raycast(p,_,r.exaggeration());if(E){const C=c.scaleAndAdd([],p,_,E),A=new c.MercatorCoordinate(C[0],C[1],c.mercatorZfromAltitude(C[2],c.latFromMercatorY(C[1]))),z=(A.z+c.length([A.x-p[0],A.y-p[1],A.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=r.getAtPointOrZero(new c.MercatorCoordinate(...p)),v=this._minimumHeightOverTerrain()*Math.cos(c.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(E<v){const C=this.locationCoordinate(this._center,this._centerAltitude),A=[C.x-p[0],C.y-p[1],C.z-p[2]],z=c.length(A);A[2]-=(v-E)/this._pixelsPerMercatorPixel;const N=c.length(A);if(0===N)return;c.scale$2(A,A,z/N*this._pixelsPerMercatorPixel),this._camera.position=[C.x-A[0],C.y-A[1],C.z*this._pixelsPerMercatorPixel-A[2]],this._camera.orientation=Xa(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const K=this.center;return K.lat=c.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(K.lng=c.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:_}=this.point;let v=0,E=p,C=_;const A=this.width/2,z=this.height/2,N=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(_-z<N&&(C=N+z),_+z>Z&&(C=Z-z),Z-N<this.height&&(v=Math.max(v,this.height/(Z-N)),C=(Z+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,re=this.worldSize/2-(K+se)/2;E=(p+re+this.worldSize)%this.worldSize-re,E-A<K&&(E=K+A),E+A>se&&(E=se-A),se-K<this.width&&(v=Math.max(v,this.width/(se-K)),E=(se+K)/2)}E===p&&C===_||(this.center=this.unproject(new c.pointGeometry(E,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const p=Hs(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?l:1),v=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);v[8]=2*-r.x/this.width,v[9]=2*r.y/this.height;let E=c.mul([],v,_);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),ve=c.identity([]);c.translate(ve,ve,[Se.x*this.worldSize,Se.y*this.worldSize,0]),c.multiply(ve,ve,Al(this)),c.translate(ve,ve,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),c.multiply(E,E,ve),this.inverseAdjustmentMatrix=function(Ae){const Ce=Al(Ae,!0);return Ht([],[Ce[0],Ce[1],Ce[4],Ce[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],E,[this.worldSize,this.worldSize,this.worldSize/l,1]),this.projMatrix=E,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const C=c.invert([],v);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);c.identity(A),c.scale(A,A,[1,-1,1]),c.rotateX(A,A,this._pitch),c.rotateZ(A,A,this.angle);const z=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-r.x/this.width,z[9]=2*(r.y+N)/this.height,this.skyboxMatrix=c.multiply(A,z,A);const Z=this.point,K=Z.x,se=Z.y,re=this.width%2/2,ne=this.height%2/2,ie=Math.cos(this.angle),te=Math.sin(this.angle),ae=K-Math.round(K)+ie*re+te*ne,ce=se-Math.round(se)+ie*ne+te*re,ke=new Float64Array(E);if(c.translate(ke,ke,[ae>.5?ae-1:ae,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=ke,E=c.create(),c.scale(E,E,[this.width/2,-this.height/2,1]),c.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=c.create(),c.scale(E,E,[1,-1,1]),c.translate(E,E,[-1,-1,0]),c.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=c.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=E,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(Se,Se,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=E;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,l];c.scale$2(v,v,_),c.scale$2(p,p,-1),c.multiply$2(p,p,v);const E=c.create();c.translate(E,E,p),c.scale(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,r/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=r[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,r,_),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),C=Math.max((r[2]-v)/Math.cos(p),E),A=this._zoomFromMercatorZ(C);c.scaleAndAdd(r,r,l,C),this._pitch=c.clamp(p,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(_,-Math.PI,Math.PI),this._setZoom(c.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),_=Math.max(r.x,l.x),v=Math.min(r.y,l.y),E=Math.max(r.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new c.pointGeometry(p,v),new c.pointGeometry(_,E),new c.pointGeometry(p,E),new c.pointGeometry(_,v)],A=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const N of C){const Z=this.pointRayIntersection(N);if(Z.t<0)return!0;const K=this.rayIntersectionCoordinate(Z);if(K.x<A||K.y<0||K.x>z||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const p=c.length(c.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if("globe"===this.projection.name){const r=function(l,p){const _=[l[0],l[1],l[2],1];c.transformMat4$1(_,_,p);const v=Math.max(_[3],1e-6);return[_[0]/v,_[1]/v,_[2]/v,v]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,r))}}getCameraToCenterDistance(r){const l=Hs(r,this.zoom,this.width,this.height,1024),p=r.pixelSpaceConversion(this.center.lat,this.worldSize,l);return.5/Math.tan(.5*this._fov)*this.height*p}}function fs(h,r){let l=!1,p=null;const _=()=>{p=null,l&&(h(),p=setTimeout(_,r),l=!1)};return()=>(l=!0,p||_(),p)}class kl{constructor(r){this._hashName=r&&encodeURIComponent(r),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fs(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,c.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Zs(r);if(this._hashName){const p=this._hashName;let _=!1;const v=c.window.location.hash.slice(1).split("&").map(E=>{const C=E.split("=")[0];return C===p?(_=!0,`${C}=${l}`):E}).filter(E=>E);return _||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){const r=c.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,r)}}function Zs(h,r){const l=h.getCenter(),p=Math.round(100*h.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),E=Math.round(l.lng*v)/v,C=Math.round(l.lat*v)/v,A=h.getBearing(),z=h.getPitch();let N=r?`/${E}/${C}/${p}`:`${p}/${C}/${E}`;return(A||z)&&(N+="/"+Math.round(10*A)/10),z&&(N+=`/${Math.round(z)}`),N}const Cs={linearity:.3,easing:c.bezier(0,0,.3,1)},jc=c.extend({deceleration:2500,maxSpeed:1400},Cs),ih=c.extend({deceleration:20,maxSpeed:1400},Cs),yu=c.extend({deceleration:1e3,maxSpeed:360},Cs),Mo=c.extend({deceleration:1e3,maxSpeed:90},Cs);class Vc{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=c.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const v=ps(l.pan.mag(),p,c.extend({},jc,r||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,Is(_,v)}if(l.zoom){const v=ps(l.zoom,p,ih);_.zoom=this._map.transform.zoom+v.amount,Is(_,v)}if(l.bearing){const v=ps(l.bearing,p,yu);_.bearing=this._map.transform.bearing+c.clamp(v.amount,-179,179),Is(_,v)}if(l.pitch){const v=ps(l.pitch,p,Mo);_.pitch=this._map.transform.pitch+v.amount,Is(_,v)}if(_.zoom||_.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Is(h,r){(!h.duration||h.duration<r.duration)&&(h.duration=r.duration,h.easing=r.easing)}function ps(h,r,l){const{maxSpeed:p,linearity:_,deceleration:v}=l,E=c.clamp(h*_/(r/1e3),-p,p),C=Math.abs(E)/(v*_);return{easing:l.easing,duration:1e3*C,amount:E*(C/2)}}class Ai extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,_={}){const v=$t(l.getCanvasContainer(),p),E=l.unproject(v);super(r,c.extend({point:v,lngLat:E,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class Qo extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const _="touchend"===r?p.changedTouches:p.touches,v=nr(l.getCanvasContainer(),_),E=v.map(A=>l.unproject(A)),C=v.reduce((A,z,N,Z)=>A.add(z.div(Z.length)),new c.pointGeometry(0,0));super(r,{points:v,point:C,lngLats:E,lngLat:l.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class ga extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class vu{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new ga(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Ai(r.type,this._map,r))}mouseup(r){this._map.fire(new Ai(r.type,this._map,r))}preclick(r){const l=c.extend({},r);l.type="preclick",this._map.fire(new Ai(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Ai(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Ai(r.type,this._map,r))}mouseover(r){this._map.fire(new Ai(r.type,this._map,r))}mouseout(r){this._map.fire(new Ai(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Qo(r.type,this._map,r))}touchmove(r){this._map.fire(new Qo(r.type,this._map,r))}touchend(r){this._map.fire(new Qo(r.type,this._map,r))}touchcancel(r){this._map.fire(new Qo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $c{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Ai(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Ai(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ya{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&0===r.button&&(Tt(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=gt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(_.x,p.x),E=Math.max(_.x,p.x),C=Math.min(_.y,p.y),A=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${C}px)`,this._box.style.width=E-v+"px",this._box.style.height=A-C+"px")})}mouseupWindow(r,l){if(!this._active||0!==r.button)return;const p=this._startPos,_=l;if(this.reset(),Cn(),p.x!==_.x||p.y!==_.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),xn(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new c.Event(r,{originalEvent:l}))}}function Ll(h,r){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=r[p];return l}class _a{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new c.pointGeometry(0,0);for(const E of _)v._add(E);return v.div(_.length)}(l),this.touches=Ll(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const _=Ll(p,l);for(const v in this.touches){const E=this.touches[v],C=_[v];(!C||C.dist(E)>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class uc{constructor(r){this.singleTap=new _a(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const _=this.singleTap.touchend(r,l,p);if(_){const v=r.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(v&&E||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Ol{constructor(){this._zoomIn=new uc({numTouches:1,numTaps:2}),this._zoomOut=new uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const _=this._zoomIn.touchend(r,l,p),v=this._zoomOut.touchend(r,l,p);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ka={0:1,2:2};class Fl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=rn(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p)if(r.preventDefault(),null!=this._eventButton&&function(_,v){const E=Ka[v];return void 0===_.buttons||(_.buttons&E)!==E}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(r){this._lastPoint&&rn(r)===this._eventButton&&(this._moved&&Cn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pi extends Fl{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return 0===l&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class hc extends Fl{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class ci extends Fl{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Gc{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const _=Ll(p,l),v=new c.pointGeometry(0,0),E=new c.pointGeometry(0,0);let C=0;for(const z in _){const N=_[z],Z=this._touches[z];Z&&(v._add(N),E._add(N.sub(Z)),C++,_[z]=N)}if(this._touches=_,C<this._minTouches||!E.mag())return;const A=E.div(C);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ya{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[v,E]=_,C=Ja(p,l,v),A=Ja(p,l,E);if(!C||!A)return;const z=this._aroundCenter?null:C.add(A).div(2);return this._move([C,A],z,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,E=Ja(p,l,_),C=Ja(p,l,v);E&&C||(this._active&&Cn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ja(h,r,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return r[p]}function xu(h,r){return Math.log(h/r)/Math.LN2}class es extends ya{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(xu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xu(this._distance,p),pinchAround:l}}}function dc(h,r){return 180*h.angleWith(r)/Math.PI}class ms extends ya{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dc(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=dc(r,this._startVector);return Math.abs(p)<l}}function Yi(h){return Math.abs(h.y)>Math.abs(h.x)}class ts extends ya{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Yi(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const _=this._lastPoints;if(!_)return;const v=r[0].sub(_[0]),E=r[1].sub(_[1]);return this._map._cooperativeGestures&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(void 0!==this._valid)return this._valid;const _=r.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=r.y>0==l.y>0;return Yi(r)&&Yi(l)&&E}}const Yt={panStep:100,bearingStep:15,pitchStep:10};class va{constructor(){const r=Yt;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,_=0,v=0,E=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),E=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:C=>{const A=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Qa,zoom:l?Math.round(A)+l*(r.shiftKey?2:1):A,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qa(h){return h*(2-h)}const el=4.000244140625;class gs{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=c.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%el==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=$t(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>el?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==z&&(z=1/z);const N=l(),Z=Math.pow(2,N),K="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(K*z))),"wheel"===this._type&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),_=this._startZoom,v=this._easing;let E,C=!1;if("wheel"===this._type&&_&&v){const A=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),z=v(A);E=c.number(_,p,z),A<1?this._frameId||(this._frameId=!0):C=!0}else E=p,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:E-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=c.ease;if(this._prevEase){const p=this._prevEase,_=(c.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),E=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-E*E);l=c.bezier(E,C,.25,1)}return this._prevEase={start:c.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Rr{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bu{constructor(){this._tap=new uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wu{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hc{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oh{constructor(r,l,p,_){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fc=h=>h.zoom||h.drag||h.pitch||h.rotate;class Zc extends c.Event{}class Ws{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=c.sub([],l,r);this.radius=c.length(p[2]<0?c.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){c.div(r,r,this.constants),c.normalize(r,r),c.mul$1(r,r,this.constants);const l=c.scale$2([],r,this.radius);if(l[2]>0){const p=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),_=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),v=c.add([],l,c.scale$2([],c.sub([],c.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function tl(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class qh{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vc(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ws,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[_,v,E]of this._listeners)_.addEventListener(v,_===c.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[r,l,p]of this._listeners)r.removeEventListener(l,r===c.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new vu(l,r));const _=l.boxZoom=new Ya(l,r);this._add("boxZoom",_);const v=new Ol,E=new Wh;l.doubleClickZoom=new Rr(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const C=new bu;this._add("tapDragZoom",C);const A=l.touchPitch=new ts(l);this._add("touchPitch",A);const z=new hc(r),N=new ci(r);l.dragRotate=new Hc(r,z,N),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const Z=new Pi(r),K=new Gc(l,r);l.dragPan=new wu(p,Z,K),this._add("mousePan",Z),this._add("touchPan",K,["touchZoom","touchRotate"]);const se=new ms,re=new es;l.touchZoomRotate=new oh(p,re,se,C),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $c(l));const ne=l.scrollZoom=new gs(l,this);this._add("scrollZoom",ne,["mousePan"]);const ie=l.keyboard=new va;this._add("keyboard",ie);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[te]&&l[te].enable(r[te])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fc(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,l,p){for(const _ in r)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p="renderFrame"===r.type,_=p?void 0:r,v={needsRenderFrame:!1},E={},C={},A=r.touches?this._getMapTouches(r.touches):void 0,z=A?nr(this._el,A):p?void 0:$t(this._el,r);for(const{handlerName:K,handler:se,allowed:re}of this._handlers){if(!se.isEnabled())continue;let ne;this._blockedByActive(C,re,K)?se.reset():se[l||r.type]&&(ne=se[l||r.type](r,z,A),this.mergeHandlerResult(v,E,ne,K,_),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||se.isActive())&&(C[K]=se)}const N={};for(const K in this._previousActiveHandlers)C[K]||(N[K]=_);this._previousActiveHandlers=C,(Object.keys(N).length||tl(v))&&(this._changes.push([v,E,N]),this._triggerRenderFrame()),(Object.keys(C).length||tl(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=v;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(r,l,p,_,v){if(!p)return;c.extend(r,p);const E={handlerName:_,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(l.zoom=E),void 0!==p.panDelta&&(l.drag=E),void 0!==p.pitchDelta&&(l.pitch=E),void 0!==p.bearingDelta&&(l.rotate=E)}_applyChanges(){const r={},l={},p={};for(const[_,v,E]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new c.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(r.around=_.around),void 0!==_.aroundCoord&&(r.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),c.extend(l,v),c.extend(p,E);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const _=this._map,v=_.transform,E=ae=>[ae.x,ae.y,ae.z];if((ae=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!tl(r)){const ae=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ae!==v.zoom&&this._map._update(!0)}if(!tl(r))return void this._fireEvents(l,p,!0);let{panDelta:C,zoomDelta:A,bearingDelta:z,pitchDelta:N,around:Z,aroundCoord:K,pinchAround:se}=r;void 0!==se&&(Z=se),(ae=>l.drag&&!this._eventsInProgress.drag)()&&Z&&(this._dragOrigin=E(v.pointCoordinate3D(Z)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),Z=Z||_.transform.centerPoint,z&&(v.bearing+=z),N&&(v.pitch+=N),v._updateCameraState();const re=[0,0,0];if(C)if("mercator"===v.projection.name){const ae=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(Z).dir),ce=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(Z.sub(C)).dir);re[0]=ce[0]-ae[0],re[1]=ce[1]-ae[1]}else{const ae=v.pointCoordinate(Z);if("globe"===v.projection.name){C=C.rotate(-v.angle);const ce=v._pixelsPerMercatorPixel/v.worldSize;re[0]=-C.x*c.mercatorScale(c.latFromMercatorY(ae.y))*ce,re[1]=-C.y*c.mercatorScale(v.center.lat)*ce}else{const ce=v.pointCoordinate(Z.sub(C));ae&&ce&&(re[0]=ce.x-ae.x,re[1]=ce.y-ae.y)}}const ne=v.zoom,ie=[0,0,0];if(A){const ae=E(K||v.pointCoordinate3D(Z)),ce={dir:c.normalize([],c.sub([],ae,v._camera.position))};if(ce.dir[2]<0){const ke=v.zoomDeltaToMovement(ae,A);c.scale$2(ie,ce.dir,ke)}}const te=c.add(re,re,ie);v._translateCameraConstrained(te),A&&Math.abs(v.zoom-ne)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const _=fc(this._eventsInProgress),v=fc(r),E={};for(const N in r){const{originalEvent:Z}=r[N];this._eventsInProgress[N]||(E[`${N}start`]=Z),this._eventsInProgress[N]=r[N]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const N in E)this._fireEvent(N,E[N]);v&&this._fireEvent("move",v.originalEvent);for(const N in r){const{originalEvent:Z}=r[N];this._fireEvent(N,Z)}const C={};let A;for(const N in this._eventsInProgress){const{handlerName:Z,originalEvent:K}=this._eventsInProgress[N];this._handlersById[Z].isActive()||(delete this._eventsInProgress[N],A=l[Z]||K,C[`${N}end`]=A)}for(const N in C)this._fireEvent(N,C[N]);const z=fc(this._eventsInProgress);if(p&&(_||v)&&!z){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;N?(Z(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:A})):(this._map.fire(new c.Event("moveend",{originalEvent:A})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new c.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Zc("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ni="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Wc extends c.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=c.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,c.extend({offset:r},l),p)}panTo(r,l,p){return this.easeTo(c.extend({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(c.extend({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(c.extend({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,c.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){"globe"===this.transform.projection.name&&c.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),r=c.LngLatBounds.convert(r);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=c.extend(l,r.padding),r}_cameraForBoxAndBearing(r,l,p,_){const v=this._extendCameraOptions(_),E=this.transform,C=E.padding,A=E.project(c.LngLat.convert(r)),z=E.project(c.LngLat.convert(l)),N=new c.pointGeometry(A.x,z.y),Z=new c.pointGeometry(z.x,A.y),K=-c.degToRad(p),se=A.rotate(K),re=z.rotate(K),ne=N.rotate(K),ie=Z.rotate(K),te=new c.pointGeometry(Math.max(se.x,re.x,ne.x,ie.x),Math.max(se.y,re.y,ne.y,ie.y)),ae=new c.pointGeometry(Math.min(se.x,re.x,ne.x,ie.x),Math.min(se.y,re.y,ne.y,ie.y)),ce=te.sub(ae),ke=(E.width-((C.left||0)+(C.right||0)+v.padding.left+v.padding.right))/ce.x,Se=(E.height-((C.top||0)+(C.bottom||0)+v.padding.top+v.padding.bottom))/ce.y;if(Se<0||ke<0)return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ve=Math.min(E.scaleZoom(E.scale*Math.min(ke,Se)),v.maxZoom),Ae="number"==typeof v.offset.x&&"number"==typeof v.offset.y?new c.pointGeometry(v.offset.x,v.offset.y):c.pointGeometry.convert(v.offset),Ce=new c.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),Be=Ae.add(Ce).mult(E.scale/E.zoomScale(ve));return{center:E.unproject(A.add(z).div(2).sub(Be)),zoom:ve,bearing:p}}_cameraForBox(r,l,p,_,v){const E=this._extendCameraOptions(v);p=p||0,_=_||0,r=c.LngLat.convert(r),l=c.LngLat.convert(l);const C=this.transform.clone();C.padding=E.padding;const A=this.getFreeCameraOptions(),z=new c.LngLat(.5*(r.lng+l.lng),.5*(r.lat+l.lat)),N=.5*(p+_);if(C._camera.position[2]<c.mercatorZfromAltitude(N,z.lat))return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(z),C.setFreeCameraOptions(A);const Z=c.MercatorCoordinate.fromLngLat(r),K=c.MercatorCoordinate.fromLngLat(l),se=C.pointRayIntersection(C.centerPoint,N),re=[(ne=C.rayIntersectionCoordinate(se)).x,ne.y,ne.z];var ne;const ie=C.screenPointToMercatorRay(C.centerPoint),te="globe"!==C.projection.name;let ae,ce=0;do{const ke=Math.floor(C.zoom),Se=1<<ke,ve=Math.min(Se*Z.x,Se*K.x),Ae=Math.min(Se*Z.y,Se*K.y),Ce=Math.max(Se*Z.x,Se*K.x),Be=Math.max(Se*Z.y,Se*K.y),He=new c.Aabb([ve,Ae,p],[Ce,Be,_]),Mt=c.Frustum.fromInvProjectionMatrix(C.invProjMatrix,C.worldSize,ke,te);if(2!==He.intersects(Mt)){ae&&(C._camera.position=c.scaleAndAdd([],C._camera.position,ie.dir,-ae),C._updateStateFromCamera());break}const Ve=c.sub([],C._camera.position,re);ae=.5*c.length(Ve),C._camera.position=c.scaleAndAdd([],C._camera.position,ie.dir,ae);try{C._updateStateFromCamera()}catch{return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ce<10);return{center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}}fitBounds(r,l,p){return"globe"===this.transform.projection.name&&c.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(r,l),l,p)}_raycastElevationBox(r,l){const p=this.transform.elevation;if(!p)return;const _=new c.pointGeometry(r.x,l.y),v=new c.pointGeometry(l.x,r.y),E=p.pointCoordinate(r);if(!E)return;const C=p.pointCoordinate(l);if(!C)return;const A=p.pointCoordinate(_);if(!A)return;const z=p.pointCoordinate(v);if(!z)return;const N=new c.MercatorCoordinate(E[0],E[1]).toLngLat(),Z=new c.MercatorCoordinate(C[0],C[1]).toLngLat(),K=new c.MercatorCoordinate(A[0],A[1]).toLngLat(),se=new c.MercatorCoordinate(z[0],z[1]).toLngLat(),re=Math.min(N.lng,Math.min(Z.lng,Math.min(K.lng,se.lng))),ne=Math.min(N.lat,Math.min(Z.lat,Math.min(K.lat,se.lat))),ie=Math.max(N.lng,Math.max(Z.lng,Math.max(K.lng,se.lng))),te=Math.max(N.lat,Math.max(Z.lat,Math.max(K.lat,se.lat))),ae=Math.min(E[3],Math.min(C[3],Math.min(A[3],z[3]))),ce=Math.max(E[3],Math.max(C[3],Math.max(A[3],z[3])));return{minLngLat:new c.LngLat(re,ne),maxLngLat:new c.LngLat(ie,te),minAltitude:ae,maxAltitude:ce}}fitScreenCoordinates(r,l,p,_,v){let E,C,A,z;"globe"===this.transform.projection.name&&c.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const N=c.pointGeometry.convert(r),Z=c.pointGeometry.convert(l),K=this._raycastElevationBox(N,Z);if(K)E=K.minLngLat,C=K.maxLngLat,A=K.minAltitude,z=K.maxAltitude;else{if(this.transform.anyCornerOffEdge(N,Z))return this;E=this.transform.pointLocation(N),C=this.transform.pointLocation(Z)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(c.pointGeometry.convert(r)),this.transform.pointLocation(c.pointGeometry.convert(l)),p,_):this._cameraForBox(E,C,A,z,_),_,v)}_fitInternal(r,l,p){return r?(delete(l=c.extend(r,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,E=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(_=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=c.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.pitch=+r.pitch),null==r.padding||p.isPaddingEqual(r.padding)||(p.padding=r.padding),r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),_&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),v&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),E&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(ni),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return c.warnOnce(ni),this;this.stop();const _=p.zoom,v=p.pitch,E=p.bearing;p.setFreeCameraOptions(r);const C=_!==p.zoom,A=v!==p.pitch,z=E!==p.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),C&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),z&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),A&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),(!1===(r=c.extend({offset:[0,0],duration:500,easing:c.ease},r)).animate||!r.essential&&c.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),C=this.getPadding(),A="zoom"in r?+r.zoom:_,z="bearing"in r?this._normalizeBearing(r.bearing,v):v,N="pitch"in r?+r.pitch:E,Z="padding"in r?r.padding:p.padding,K=c.pointGeometry.convert(r.offset);let se,re,ne;if("globe"===p.projection.name){const Be=c.MercatorCoordinate.fromLngLat(p.center),He=K.rotate(-p.angle);Be.x+=He.x/p.worldSize,Be.y+=He.y/p.worldSize;const Mt=Be.toLngLat(),Ve=c.LngLat.convert(r.center||Mt);this._normalizeCenter(Ve),se=p.centerPoint.add(He),re=new c.pointGeometry(Be.x,Be.y).mult(p.worldSize),ne=new c.pointGeometry(c.mercatorXfromLng(Ve.lng),c.mercatorYfromLat(Ve.lat)).mult(p.worldSize).sub(re)}else{se=p.centerPoint.add(K);const Be=p.pointLocation(se),He=c.LngLat.convert(r.center||Be);this._normalizeCenter(He),re=p.project(Be),ne=p.project(He).sub(re)}const ie=p.zoomScale(A-_);let te,ae;r.around&&(te=c.LngLat.convert(r.around),ae=p.locationPoint(te));const ce=this._zooming||A!==_,ke=this._rotating||v!==z,Se=this._pitching||N!==E,ve=!p.isPaddingEqual(Z),Ae=Be=>He=>{if(ce&&(Be.zoom=c.number(_,A,He)),ke&&(Be.bearing=c.number(v,z,He)),Se&&(Be.pitch=c.number(E,N,He)),ve&&(Be.interpolatePadding(C,Z,He),se=Be.centerPoint.add(K)),te)Be.setLocationAtPoint(te,ae);else{const Mt=Be.zoomScale(Be.zoom-_),Ve=A>_?Math.min(2,ie):Math.max(.5,ie),at=Math.pow(Ve,1-He),_t=Be.unproject(re.add(ne.mult(He*at)).mult(Mt));Be.setLocationAtPoint(Be.renderWorldCopies?_t.wrap():_t,se)}return r.preloadOnly||this._fireMoveEvents(l),Be};if(r.preloadOnly){const Be=this._emulate(Ae,r.duration,p);return this._preloadTiles(Be),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=ke,this._pitching=Se,this._padding=ve,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Ce),this._ease(Ae(p),Be=>{p.recenterOnTerrain(),this._afterEase(l,Be)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new c.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new c.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new c.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new c.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new c.Event("move",r)),this._zooming&&this.fire(new c.Event("zoom",r)),this._rotating&&this.fire(new c.Event("rotate",r)),this._pitching&&this.fire(new c.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new c.Event("zoomend",r)),_&&this.fire(new c.Event("rotateend",r)),v&&this.fire(new c.Event("pitchend",r)),this.fire(new c.Event("moveend",r))}flyTo(r,l){if(!r.essential&&c.exported.prefersReducedMotion){const Wt=c.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wt,l)}this.stop(),r=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},r);const p=this.transform,_=this.getZoom(),v=this.getBearing(),E=this.getPitch(),C=this.getPadding(),A="zoom"in r?c.clamp(+r.zoom,p.minZoom,p.maxZoom):_,z="bearing"in r?this._normalizeBearing(r.bearing,v):v,N="pitch"in r?+r.pitch:E,Z="padding"in r?r.padding:p.padding,K=p.zoomScale(A-_),se=c.pointGeometry.convert(r.offset);let re=p.centerPoint.add(se);const ne=p.pointLocation(re),ie=c.LngLat.convert(r.center||ne);this._normalizeCenter(ie);const te=p.project(ne),ae=p.project(ie).sub(te);let ce=r.curve;const ke=Math.max(p.width,p.height),Se=ke/K,ve=ae.mag();if("minZoom"in r){const Wt=c.clamp(Math.min(r.minZoom,_,A),p.minZoom,p.maxZoom),Vt=ke/p.zoomScale(Wt-_);ce=Math.sqrt(Vt/ve*2)}const Ae=ce*ce;function Ce(Wt){const Vt=(Se*Se-ke*ke+(Wt?-1:1)*Ae*Ae*ve*ve)/(2*(Wt?Se:ke)*Ae*ve);return Math.log(Math.sqrt(Vt*Vt+1)-Vt)}function Be(Wt){return(Math.exp(Wt)-Math.exp(-Wt))/2}function He(Wt){return(Math.exp(Wt)+Math.exp(-Wt))/2}const Mt=Ce(0);let Ve=function(Wt){return He(Mt)/He(Mt+ce*Wt)},at=function(Wt){return ke*((He(Mt)*(Be(Vt=Mt+ce*Wt)/He(Vt))-Be(Mt))/Ae)/ve;var Vt},_t=(Ce(1)-Mt)/ce;if(Math.abs(ve)<1e-6||!isFinite(_t)){if(Math.abs(ke-Se)<1e-6)return this.easeTo(r,l);const Wt=Se<ke?-1:1;_t=Math.abs(Math.log(Se/ke))/ce,at=function(){return 0},Ve=function(Vt){return Math.exp(Wt*ce*Vt)}}r.duration="duration"in r?+r.duration:1e3*_t/("screenSpeed"in r?+r.screenSpeed/ce:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Bt=v!==z,Qe=N!==E,Pt=!p.isPaddingEqual(Z),mt=Wt=>Vt=>{const nn=Vt*_t,fn=1/Ve(nn);Wt.zoom=1===Vt?A:_+Wt.scaleZoom(fn),Bt&&(Wt.bearing=c.number(v,z,Vt)),Qe&&(Wt.pitch=c.number(E,N,Vt)),Pt&&(Wt.interpolatePadding(C,Z,Vt),re=Wt.centerPoint.add(se));const In=1===Vt?ie:Wt.unproject(te.add(ae.mult(at(nn))).mult(fn));return Wt.setLocationAtPoint(Wt.renderWorldCopies?In.wrap():In,re),Wt._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),Wt};if(r.preloadOnly){const Wt=this._emulate(mt,r.duration,p);return this._preloadTiles(Wt),this}return this._zooming=!0,this._rotating=Bt,this._pitching=Qe,this._padding=Pt,this._prepareEase(l,!1),this._ease(mt(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){!1===p.animate||0===p.duration?(r(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=c.wrap(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_emulate(r,l,p){const _=Math.ceil(15*l/1e3),v=[],E=r(p.clone());for(let C=0;C<=_;C++){const A=E(C/_);v.push(A.clone())}return v}}class qs{constructor(r={}){this.options=r,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=gt("button","mapboxgl-ctrl-attrib-button",this._container),gt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const p=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",p),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(r){const p=l.reduce((_,v,E)=>(v.value&&(_+=`${v.key}=${v.value}${E<l.length-1?"&":""}`),_),"?");r.href=`${c.config.FEEDBACK_URL}/${p}#${Zs(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const v=l[_];if(v.used){const E=v.getSource();E.attribution&&r.indexOf(E.attribution)<0&&r.push(E.attribution)}}r.sort((_,v)=>_.length-v.length),r=r.filter((_,v)=>{for(let E=v+1;E<r.length;E++)if(r[E].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Eu{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=gt("div","mapboxgl-ctrl");const l=gt("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class qc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function oo(h,r,l){if(h=new c.LngLat(h.lng,h.lat),r){const p=new c.LngLat(h.lng-360,h.lat),_=new c.LngLat(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),E=l.locationPoint(h).distSqr(r),C=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(p).distSqr(r)<E&&(C||Math.abs(p.lng-l.center.lng)<v)?h=p:l.locationPoint(_).distSqr(r)<E&&(C||Math.abs(_.lng-l.center.lng)<v)&&(h=_)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const Ao={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class zl extends c.Evented{constructor(r,l){if(super(),(r instanceof c.window.HTMLElement||l)&&(r=c.extend({element:r},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=c.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt("div");const _=41,v=27,E=yt("svg",{display:"block",height:_*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${_}`},this._element),C=yt("radialGradient",{id:"shadowGradient"},yt("defs",{},E));yt("stop",{offset:"10%","stop-opacity":.4},C),yt("stop",{offset:"100%","stop-opacity":.05},C),yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=c.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in Ao)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(24.6+_)],"bottom-right":[-_,-1*(24.6+_)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map;if(!r)return!1;const l=r.unproject(this._pos),p=r.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(l)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l);let _;r._showingGlobe()&&c.isLngLatBehindGlobe(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=.2)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${Ao[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||"map"!==p)return"";if(!l._showingGlobe()){const A=l.getPitch();return A?`rotateX(${A}deg)`:""}const _=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),v=r.sub(c.globeCenterToScreenPoint(l.transform)),E=Math.abs(v.x)+Math.abs(v.y);if(0===E)return"";const C=_/E;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const _=this.getRotationAlignment();if("map"===_)if(l._showingGlobe()){const v=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=c.radToDeg(Math.atan2(E.y,E.x))-90}else p=-l.getBearing();else if("horizon"===_){const v=c.smoothstep(4,6,l.getZoom()),E=c.globeCenterToScreenPoint(l.transform);E.y+=v*l.transform.height;const C=r.sub(E),A=c.radToDeg(Math.atan2(C.y,C.x));p=(A>90?A-270:A+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=oo(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===r?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=c.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(l){if(!this._isDragging){const p=this._clickTolerance||l._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map;l&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Bl{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=c.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const nl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function rl(h){h.parentNode&&h.parentNode.removeChild(h)}const Tu={showCompass:!0,showZoom:!0,visualizePitch:!1};class sh{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new hc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new ci({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),Tt()}move(r,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(r,l),v=_&&_.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const E=this.mousePitch.mousemoveWindow(r,l),C=E&&E.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){xn(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(c.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),$t(this.element,r)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,$t(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=nr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=nr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const I={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},S={maxWidth:100,unit:"metric"};function T(h,r,l){const p=k(r),_=p/r,v={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML=`${p}&nbsp;${v}`})}function k(h){const r=Math.pow(10,`${Math.floor(h)}`.length-1);let l=h/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(p){const _=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*_)/_}(l),r*l}const U={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Y=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function me(h=new c.pointGeometry(0,0),r="bottom"){if("number"==typeof h){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(r){case"top":return new c.pointGeometry(0,h);case"top-left":return new c.pointGeometry(l,l);case"top-right":return new c.pointGeometry(-l,l);case"bottom":return new c.pointGeometry(0,-h);case"bottom-left":return new c.pointGeometry(l,-l);case"bottom-right":return new c.pointGeometry(-l,-l);case"left":return new c.pointGeometry(h,0);case"right":return new c.pointGeometry(-h,0)}return new c.pointGeometry(0,0)}return h instanceof c.pointGeometry||Array.isArray(h)?c.pointGeometry.convert(h):c.pointGeometry.convert(h[r]||[0,0])}const be={version:c.version,supported:Jt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends Wc{constructor(h){if(null!=(h=c.extend({},Xc,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(h.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Rl(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language="auto"===h.language?c.window.navigator.language:h.language,this._worldview=h.worldview,this._renderTaskQueue=new qc,this._domRenderTaskQueue=new qc,this._controls=[],this._markers=[],this._mapId=c.uniqueId(),this._locale=c.extend({},nl,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bl(0),this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=c.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new qh(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new kl("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new qs({customAttribution:h.customAttribution})),this._logoControl=new Eu,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new c.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new c.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(h,r){if(void 0===r&&(r=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(h);return r>-1&&this._controls.splice(r,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),this.fire(new c.Event("resize",h)),r&&this.fire(new c.Event("moveend",h)),this}getBounds(){return"globe"===this.transform.projection.name&&c.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(c.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getLanguage(){return this._language}setLanguage(h){if(this._language="auto"===h?c.window.navigator.language:h,this.style)for(const r in this.style._sourceCaches){const l=this.style._sourceCaches[r]._source;l._setLanguage&&l._setLanguage(this._language)}for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){if(this._worldview=h,this.style)for(const r in this.style._sourceCaches){const l=this.style._sourceCaches[r]._source;l._setWorldview&&l._setWorldview(h)}return this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const h=this.transform,r=h.projection.name;let l;"globe"===r&&h.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):"mercator"===r&&h.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,r){return this._updateProjection(h||r||{name:"mercator"})}_updateProjection(h){let r;if(r="globe"===h.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0)}return this}project(h){return this.transform.locationPoint3D(c.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(c.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(h,r,l){if("mouseenter"===h||"mouseover"===h){let p=!1;const _=E=>{const C=r.filter(z=>this.getLayer(z)),A=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];A.length?p||(p=!0,l.call(this,new Ai(h,this,E.originalEvent,{features:A}))):p=!1},v=()=>{p=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:v}}}if("mouseleave"===h||"mouseout"===h){let p=!1;const _=E=>{const C=r.filter(A=>this.getLayer(A));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?p=!0:p&&(p=!1,l.call(this,new Ai(h,this,E.originalEvent)))},v=E=>{p&&(p=!1,l.call(this,new Ai(h,this,E.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:v}}}{const p=_=>{const v=r.filter(C=>this.getLayer(C)),E=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];E.length&&(_.features=E,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[h]:p}}}}on(h,r,l){if(void 0===l)return super.on(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,r,l){if(void 0===l)return super.once(h,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(h,r,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,r,l){if(void 0===l)return super.off(h,r);r=new Set(Array.isArray(r)?r:[r]);const p=(v,E)=>{if(v.size!==E.size)return!1;for(const C of v)if(!E.has(C))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(v=>{for(let E=0;E<v.length;E++){const C=v[E];if(C.listener===l&&p(C.layers,r)){for(const A in C.delegates)this.off(A,C.delegates[A]);return v.splice(E,1),this}}})(_),this}queryRenderedFeatures(h,r){return this.style?(void 0!==r||void 0===h||h instanceof c.pointGeometry||Array.isArray(h)||(r=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(h,r){return this.style.querySourceFeatures(h,r)}queryTerrainElevation(h,r){const l=this.transform.elevation;return l?(r=c.extend({},{exaggerated:!0},r),l.getAtPoint(c.MercatorCoordinate.fromLngLat(h),null,r.exaggerated)):null}setStyle(h,r){return!1!==(r=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(h,r))}_getUIString(h){const r=this._locale[h];if(null==r)throw new Error(`Missing UI string '${h}'`);return r}_updateStyle(h,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Ki(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,r){if("string"==typeof h){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(p,(_,v)=>{_?this.fire(new c.ErrorEvent(_)):v&&this._updateDiff(v,r)})}else"object"==typeof h&&this._updateDiff(h,r)}_updateDiff(h,r){try{this.style.setState(h)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(h,r){return this._lazyInitEmptyStyle(),this.style.addSource(h,r),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const r in h){const l=h[r]._tiles;for(const p in l){const _=l[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(h,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,r,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,r,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap){const{width:C,height:A,data:z}=c.exported.getImageData(r);this.style.addImage(h,{data:new c.RGBAImage({width:C,height:A},z),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:A}=r,z=r;this.style.addImage(h,{data:new c.RGBAImage({width:C,height:A},new Uint8Array(z.data)),pixelRatio:l,stretchX:_,stretchY:v,content:E,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,h)}}updateImage(h,r){const l=this.style.getImage(h);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap?c.exported.getImageData(r):r,{width:_,height:v}=p;void 0!==_&&void 0!==v?_===l.data.width&&v===l.data.height?(l.data.replace(p.data,!(r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${v})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,r){c.getImage(this._requestManager.transformRequest(h,c.ResourceType.Image),(l,p)=>{r(l,p instanceof c.window.HTMLImageElement?c.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,r){return this._lazyInitEmptyStyle(),this.style.addLayer(h,r),this._update(!0)}moveLayer(h,r){return this.style.moveLayer(h,r),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,r,l){return this.style.setLayerZoomRange(h,r,l),this._update(!0)}setFilter(h,r,l={}){return this.style.setFilter(h,r,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,r,l,p={}){return this.style.setPaintProperty(h,r,l,p),this._update(!0)}getPaintProperty(h,r){return this.style.getPaintProperty(h,r)}setLayoutProperty(h,r,l,p={}){return this.style.setLayoutProperty(h,r,l,p),this._update(!0)}getLayoutProperty(h,r){return this.style.getLayoutProperty(h,r)}setLight(h,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(h),this.transform):0}setFeatureState(h,r){return this.style.setFeatureState(h,r),this._update()}removeFeatureState(h,r){return this.style.removeFeatureState(h,r),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,_,v=this._container;for(;v&&(!p||!_);){const E=c.window.getComputedStyle(v).transform;E&&"none"!==E&&(l=E.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(p=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(_=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=gt("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=gt("div","mapboxgl-canvas-container",h);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=gt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=gt("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=gt("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,r){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${r}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const r=this._markers.indexOf(h);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const h=c.extend({},Jt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);r?(c.storeAuthState(r,!0),this.painter=new pa(r,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(r)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let r;const l=this.painter.context.extTimerQuery,p=c.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();let _=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,z=this.transform.pitch,N=c.exported.now();this.style.zoomHistory.update(A,N);const Z=new c.EvaluationParameters(A,{now:N,fadeDuration:v,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=Z.crossFadingFactor();1===K&&K===this._crossFadingFactor||(_=!0,this._crossFadingFactor=K),this.style.update(Z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerUpdate()):E=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const A=c.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const z=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new c.Event("gpu-timing-frame",{cpuTime:A,gpuTime:z})),c.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:z}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(A);this.fire(new c.Event("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(A);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:z}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(C||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,r=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((r||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const E=Math.abs(p-_);if(E>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,h,300)}else if(E>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===c.AUTH_ERR_MSG||401===h.status)){const r=this.painter.context.gl;c.storeAuthState(r,!1),this._logoControl instanceof Eu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(h,r,l){let p=l[1]-l[0];const _=h.length/4;for(let v=0;v<r.length;v++){const E=r[v];let C=0;for(let A=0;A<E.length;A+=4)E[A]===h[A]&&E[A+1]===h[A+1]&&E[A+2]===h[A+2]&&E[A+3]===h[A+3]&&(C+=1);p+=(l[v+2]-l[v+1])*(1-C/_)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),rl(this._canvasContainer),rl(this._controlContainer),rl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=c.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(h){const r=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(r,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,r){c.setCacheLimits(h,r)}get version(){return c.version}},NavigationControl:class{constructor(h){this.options=c.extend({},Tu,h),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),gt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),gt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=gt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const r=h.getZoom(),l=r===h.getMaxZoom(),p=r===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sh(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,r){const l=gt("button",h,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(h,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(h){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},I,h),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=fs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(r=>{this._supportsGeolocation="denied"!==r.state,h(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,h(this._supportsGeolocation))}_isOutOfMapMaxBounds(h){const r=this._map.getMaxBounds(),l=h.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",h)),this._finish()}}_updateCamera(h){const r=new c.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),_=c.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(h){if(h){const r=new c.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,r=c.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=gt("button","mapboxgl-ctrl-geolocate",this._container),gt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt("div","mapboxgl-user-location"),this._dotElement.appendChild(gt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(gt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new zl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=gt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:qs,ScaleControl:class{constructor(h){this.options=c.extend({},S,h),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=T.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-h/2,_=r.unproject([p,l]),v=r.unproject([p+h,l]),E=_.distanceTo(v);if("imperial"===this.options.unit){const C=3.2808*E;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else"nautical"===this.options.unit?this._setScale(h,E/1852,"nautical-mile"):E>=1e3?this._setScale(h,E/1e3,"kilometer"):this._setScale(h,E,"meter")}_setScale(h,r,l){const p=k(r),_=p/r;this._map._requestDomTask(()=>{this._container.style.width=h*_+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(p):`${p}&nbsp;nm`})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof c.window.HTMLElement?this._container=h.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=gt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);gt("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(h){super(),this.options=c.extend(Object.create(U),h),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=c.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(c.window.document.createTextNode(h))}setHTML(h){const r=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=gt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(h),this.options.closeButton){const l=this._closeButton=gt("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let r;return this._classList.delete(h)?r=!1:(this._classList.add(h),r=!0),this._updateClassList(),r}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const _=l.offsetWidth,v=l.offsetHeight,E=p.x<_/2,C=p.x>r.transform.width-_/2;if(p.y+h<v)return E?"top-left":C?"top-right":"top";if(p.y>r.transform.height-v){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),h.className=r.join(" ")}_update(h){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=gt("div","mapboxgl-popup",r.getContainer()),this._tip=gt("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=oo(this._lngLat,this._pos,r.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:r.project(this._lngLat),v=me(this.options.offset),E=this._anchor=this._getAnchor(v.y),C=me(this.options.offset,E),A=_.add(C).round();r._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Ao[E]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=c.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Y);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:zl,Style:Ki,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:Xt,Evented:c.Evented,config:c.config,prewarm:function(){_n().acquire(je)},clearPrewarmedResources:function(){const h=Ut;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(je),Ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(h){c.config.ACCESS_TOKEN=h},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(h){c.config.API_URL=h},get workerCount(){return It.workerCount},set workerCount(h){It.workerCount=h},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){c.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){c.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return be}),H}()},9751:(zn,zt,Te)=>{"use strict";Te.d(zt,{y:()=>Ye});var H=Te(2961),Ie=Te(727),nt=Te(8822),c=Te(9635),Fe=Te(2416),Jt=Te(576),kt=Te(2806);let Ye=(()=>{class st{constructor(Tt){Tt&&(this._subscribe=Tt)}lift(Tt){const xn=new st;return xn.source=this,xn.operator=Tt,xn}subscribe(Tt,xn,hn){const Cn=function tt(st){return st&&st instanceof H.Lv||function yt(st){return st&&(0,Jt.m)(st.next)&&(0,Jt.m)(st.error)&&(0,Jt.m)(st.complete)}(st)&&(0,Ie.Nn)(st)}(Tt)?Tt:new H.Hp(Tt,xn,hn);return(0,kt.x)(()=>{const{operator:$t,source:nr}=this;Cn.add($t?$t.call(Cn,nr):nr?this._subscribe(Cn):this._trySubscribe(Cn))}),Cn}_trySubscribe(Tt){try{return this._subscribe(Tt)}catch(xn){Tt.error(xn)}}forEach(Tt,xn){return new(xn=gt(xn))((hn,Cn)=>{const $t=new H.Hp({next:nr=>{try{Tt(nr)}catch(rn){Cn(rn),$t.unsubscribe()}},error:Cn,complete:hn});this.subscribe($t)})}_subscribe(Tt){var xn;return null===(xn=this.source)||void 0===xn?void 0:xn.subscribe(Tt)}[nt.L](){return this}pipe(...Tt){return(0,c.U)(Tt)(this)}toPromise(Tt){return new(Tt=gt(Tt))((xn,hn)=>{let Cn;this.subscribe($t=>Cn=$t,$t=>hn($t),()=>xn(Cn))})}}return st.create=un=>new st(un),st})();function gt(st){var un;return null!==(un=st??Fe.v.Promise)&&void 0!==un?un:Promise}},7579:(zn,zt,Te)=>{"use strict";Te.d(zt,{x:()=>kt});var H=Te(9751),Ie=Te(727);const c=(0,Te(3888).d)(gt=>function(){gt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Fe=Te(8737),Jt=Te(2806);let kt=(()=>{class gt extends H.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(tt){const st=new Ye(this,this);return st.operator=tt,st}_throwIfClosed(){if(this.closed)throw new c}next(tt){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const st of this.currentObservers)st.next(tt)}})}error(tt){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=tt;const{observers:st}=this;for(;st.length;)st.shift().error(tt)}})}complete(){(0,Jt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:tt}=this;for(;tt.length;)tt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var tt;return(null===(tt=this.observers)||void 0===tt?void 0:tt.length)>0}_trySubscribe(tt){return this._throwIfClosed(),super._trySubscribe(tt)}_subscribe(tt){return this._throwIfClosed(),this._checkFinalizedStatuses(tt),this._innerSubscribe(tt)}_innerSubscribe(tt){const{hasError:st,isStopped:un,observers:Tt}=this;return st||un?Ie.Lc:(this.currentObservers=null,Tt.push(tt),new Ie.w0(()=>{this.currentObservers=null,(0,Fe.P)(Tt,tt)}))}_checkFinalizedStatuses(tt){const{hasError:st,thrownError:un,isStopped:Tt}=this;st?tt.error(un):Tt&&tt.complete()}asObservable(){const tt=new H.y;return tt.source=this,tt}}return gt.create=(yt,tt)=>new Ye(yt,tt),gt})();class Ye extends kt{constructor(yt,tt){super(),this.destination=yt,this.source=tt}next(yt){var tt,st;null===(st=null===(tt=this.destination)||void 0===tt?void 0:tt.next)||void 0===st||st.call(tt,yt)}error(yt){var tt,st;null===(st=null===(tt=this.destination)||void 0===tt?void 0:tt.error)||void 0===st||st.call(tt,yt)}complete(){var yt,tt;null===(tt=null===(yt=this.destination)||void 0===yt?void 0:yt.complete)||void 0===tt||tt.call(yt)}_subscribe(yt){var tt,st;return null!==(st=null===(tt=this.source)||void 0===tt?void 0:tt.subscribe(yt))&&void 0!==st?st:Ie.Lc}}},2961:(zn,zt,Te)=>{"use strict";Te.d(zt,{Hp:()=>hn,Lv:()=>st});var H=Te(576),Ie=Te(727),nt=Te(2416),c=Te(7849);function Fe(){}const Jt=gt("C",void 0,void 0);function gt(Qt,Ht,xt){return{kind:Qt,value:Ht,error:xt}}var yt=Te(3410),tt=Te(2806);class st extends Ie.w0{constructor(Ht){super(),this.isStopped=!1,Ht?(this.destination=Ht,(0,Ie.Nn)(Ht)&&Ht.add(this)):this.destination=rn}static create(Ht,xt,sr){return new hn(Ht,xt,sr)}next(Ht){this.isStopped?nr(function Ye(Qt){return gt("N",Qt,void 0)}(Ht),this):this._next(Ht)}error(Ht){this.isStopped?nr(function kt(Qt){return gt("E",void 0,Qt)}(Ht),this):(this.isStopped=!0,this._error(Ht))}complete(){this.isStopped?nr(Jt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ht){this.destination.next(Ht)}_error(Ht){try{this.destination.error(Ht)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const un=Function.prototype.bind;function Tt(Qt,Ht){return un.call(Qt,Ht)}class xn{constructor(Ht){this.partialObserver=Ht}next(Ht){const{partialObserver:xt}=this;if(xt.next)try{xt.next(Ht)}catch(sr){Cn(sr)}}error(Ht){const{partialObserver:xt}=this;if(xt.error)try{xt.error(Ht)}catch(sr){Cn(sr)}else Cn(Ht)}complete(){const{partialObserver:Ht}=this;if(Ht.complete)try{Ht.complete()}catch(xt){Cn(xt)}}}class hn extends st{constructor(Ht,xt,sr){let At;if(super(),(0,H.m)(Ht)||!Ht)At={next:Ht??void 0,error:xt??void 0,complete:sr??void 0};else{let Ct;this&&nt.v.useDeprecatedNextContext?(Ct=Object.create(Ht),Ct.unsubscribe=()=>this.unsubscribe(),At={next:Ht.next&&Tt(Ht.next,Ct),error:Ht.error&&Tt(Ht.error,Ct),complete:Ht.complete&&Tt(Ht.complete,Ct)}):At=Ht}this.destination=new xn(At)}}function Cn(Qt){nt.v.useDeprecatedSynchronousErrorHandling?(0,tt.O)(Qt):(0,c.h)(Qt)}function nr(Qt,Ht){const{onStoppedNotification:xt}=nt.v;xt&&yt.z.setTimeout(()=>xt(Qt,Ht))}const rn={closed:!0,next:Fe,error:function $t(Qt){throw Qt},complete:Fe}},727:(zn,zt,Te)=>{"use strict";Te.d(zt,{Lc:()=>Jt,w0:()=>Fe,Nn:()=>kt});var H=Te(576);const nt=(0,Te(3888).d)(gt=>function(tt){gt(this),this.message=tt?`${tt.length} errors occurred during unsubscription:\n${tt.map((st,un)=>`${un+1}) ${st.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=tt});var c=Te(8737);class Fe{constructor(yt){this.initialTeardown=yt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let yt;if(!this.closed){this.closed=!0;const{_parentage:tt}=this;if(tt)if(this._parentage=null,Array.isArray(tt))for(const Tt of tt)Tt.remove(this);else tt.remove(this);const{initialTeardown:st}=this;if((0,H.m)(st))try{st()}catch(Tt){yt=Tt instanceof nt?Tt.errors:[Tt]}const{_finalizers:un}=this;if(un){this._finalizers=null;for(const Tt of un)try{Ye(Tt)}catch(xn){yt=yt??[],xn instanceof nt?yt=[...yt,...xn.errors]:yt.push(xn)}}if(yt)throw new nt(yt)}}add(yt){var tt;if(yt&&yt!==this)if(this.closed)Ye(yt);else{if(yt instanceof Fe){if(yt.closed||yt._hasParent(this))return;yt._addParent(this)}(this._finalizers=null!==(tt=this._finalizers)&&void 0!==tt?tt:[]).push(yt)}}_hasParent(yt){const{_parentage:tt}=this;return tt===yt||Array.isArray(tt)&&tt.includes(yt)}_addParent(yt){const{_parentage:tt}=this;this._parentage=Array.isArray(tt)?(tt.push(yt),tt):tt?[tt,yt]:yt}_removeParent(yt){const{_parentage:tt}=this;tt===yt?this._parentage=null:Array.isArray(tt)&&(0,c.P)(tt,yt)}remove(yt){const{_finalizers:tt}=this;tt&&(0,c.P)(tt,yt),yt instanceof Fe&&yt._removeParent(this)}}Fe.EMPTY=(()=>{const gt=new Fe;return gt.closed=!0,gt})();const Jt=Fe.EMPTY;function kt(gt){return gt instanceof Fe||gt&&"closed"in gt&&(0,H.m)(gt.remove)&&(0,H.m)(gt.add)&&(0,H.m)(gt.unsubscribe)}function Ye(gt){(0,H.m)(gt)?gt():gt.unsubscribe()}},2416:(zn,zt,Te)=>{"use strict";Te.d(zt,{v:()=>H});const H={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(zn,zt,Te)=>{"use strict";Te.d(zt,{E:()=>Ie});const Ie=new(Te(9751).y)(Fe=>Fe.complete())},2076:(zn,zt,Te)=>{"use strict";Te.d(zt,{D:()=>sr});var H=Te(8421),Ie=Te(9672),nt=Te(4482),c=Te(5403);function Fe(At,Ct=0){return(0,nt.e)((en,Ze)=>{en.subscribe((0,c.x)(Ze,Ge=>(0,Ie.f)(Ze,At,()=>Ze.next(Ge),Ct),()=>(0,Ie.f)(Ze,At,()=>Ze.complete(),Ct),Ge=>(0,Ie.f)(Ze,At,()=>Ze.error(Ge),Ct)))})}function Jt(At,Ct=0){return(0,nt.e)((en,Ze)=>{Ze.add(At.schedule(()=>en.subscribe(Ze),Ct))})}var gt=Te(9751),tt=Te(2202),st=Te(576);function Tt(At,Ct){if(!At)throw new Error("Iterable cannot be null");return new gt.y(en=>{(0,Ie.f)(en,Ct,()=>{const Ze=At[Symbol.asyncIterator]();(0,Ie.f)(en,Ct,()=>{Ze.next().then(Ge=>{Ge.done?en.complete():en.next(Ge.value)})},0,!0)})})}var xn=Te(3670),hn=Te(8239),Cn=Te(1144),$t=Te(6495),nr=Te(2206),rn=Te(4532),Qt=Te(3260);function sr(At,Ct){return Ct?function xt(At,Ct){if(null!=At){if((0,xn.c)(At))return function kt(At,Ct){return(0,H.Xf)(At).pipe(Jt(Ct),Fe(Ct))}(At,Ct);if((0,Cn.z)(At))return function yt(At,Ct){return new gt.y(en=>{let Ze=0;return Ct.schedule(function(){Ze===At.length?en.complete():(en.next(At[Ze++]),en.closed||this.schedule())})})}(At,Ct);if((0,hn.t)(At))return function Ye(At,Ct){return(0,H.Xf)(At).pipe(Jt(Ct),Fe(Ct))}(At,Ct);if((0,nr.D)(At))return Tt(At,Ct);if((0,$t.T)(At))return function un(At,Ct){return new gt.y(en=>{let Ze;return(0,Ie.f)(en,Ct,()=>{Ze=At[tt.h](),(0,Ie.f)(en,Ct,()=>{let Ge,ot;try{({value:Ge,done:ot}=Ze.next())}catch(We){return void en.error(We)}ot?en.complete():en.next(Ge)},0,!0)}),()=>(0,st.m)(Ze?.return)&&Ze.return()})}(At,Ct);if((0,Qt.L)(At))return function Ht(At,Ct){return Tt((0,Qt.Q)(At),Ct)}(At,Ct)}throw(0,rn.z)(At)}(At,Ct):(0,H.Xf)(At)}},8421:(zn,zt,Te)=>{"use strict";Te.d(zt,{Xf:()=>un});var H=Te(655),Ie=Te(1144),nt=Te(8239),c=Te(9751),Fe=Te(3670),Jt=Te(2206),kt=Te(4532),Ye=Te(6495),gt=Te(3260),yt=Te(576),tt=Te(7849),st=Te(8822);function un(Qt){if(Qt instanceof c.y)return Qt;if(null!=Qt){if((0,Fe.c)(Qt))return function Tt(Qt){return new c.y(Ht=>{const xt=Qt[st.L]();if((0,yt.m)(xt.subscribe))return xt.subscribe(Ht);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Qt);if((0,Ie.z)(Qt))return function xn(Qt){return new c.y(Ht=>{for(let xt=0;xt<Qt.length&&!Ht.closed;xt++)Ht.next(Qt[xt]);Ht.complete()})}(Qt);if((0,nt.t)(Qt))return function hn(Qt){return new c.y(Ht=>{Qt.then(xt=>{Ht.closed||(Ht.next(xt),Ht.complete())},xt=>Ht.error(xt)).then(null,tt.h)})}(Qt);if((0,Jt.D)(Qt))return $t(Qt);if((0,Ye.T)(Qt))return function Cn(Qt){return new c.y(Ht=>{for(const xt of Qt)if(Ht.next(xt),Ht.closed)return;Ht.complete()})}(Qt);if((0,gt.L)(Qt))return function nr(Qt){return $t((0,gt.Q)(Qt))}(Qt)}throw(0,kt.z)(Qt)}function $t(Qt){return new c.y(Ht=>{(function rn(Qt,Ht){var xt,sr,At,Ct;return(0,H.mG)(this,void 0,void 0,function*(){try{for(xt=(0,H.KL)(Qt);!(sr=yield xt.next()).done;)if(Ht.next(sr.value),Ht.closed)return}catch(en){At={error:en}}finally{try{sr&&!sr.done&&(Ct=xt.return)&&(yield Ct.call(xt))}finally{if(At)throw At.error}}Ht.complete()})})(Qt,Ht).catch(xt=>Ht.error(xt))})}},9646:(zn,zt,Te)=>{"use strict";Te.d(zt,{of:()=>nt});var H=Te(7669),Ie=Te(2076);function nt(...c){const Fe=(0,H.yG)(c);return(0,Ie.D)(c,Fe)}},5403:(zn,zt,Te)=>{"use strict";Te.d(zt,{x:()=>Ie});var H=Te(2961);function Ie(c,Fe,Jt,kt,Ye){return new nt(c,Fe,Jt,kt,Ye)}class nt extends H.Lv{constructor(Fe,Jt,kt,Ye,gt,yt){super(Fe),this.onFinalize=gt,this.shouldUnsubscribe=yt,this._next=Jt?function(tt){try{Jt(tt)}catch(st){Fe.error(st)}}:super._next,this._error=Ye?function(tt){try{Ye(tt)}catch(st){Fe.error(st)}finally{this.unsubscribe()}}:super._error,this._complete=kt?function(){try{kt()}catch(tt){Fe.error(tt)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Fe;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Jt}=this;super.unsubscribe(),!Jt&&(null===(Fe=this.onFinalize)||void 0===Fe||Fe.call(this))}}}},262:(zn,zt,Te)=>{"use strict";Te.d(zt,{K:()=>c});var H=Te(8421),Ie=Te(5403),nt=Te(4482);function c(Fe){return(0,nt.e)((Jt,kt)=>{let yt,Ye=null,gt=!1;Ye=Jt.subscribe((0,Ie.x)(kt,void 0,void 0,tt=>{yt=(0,H.Xf)(Fe(tt,c(Fe)(Jt))),Ye?(Ye.unsubscribe(),Ye=null,yt.subscribe(kt)):gt=!0})),gt&&(Ye.unsubscribe(),Ye=null,yt.subscribe(kt))})}},4351:(zn,zt,Te)=>{"use strict";Te.d(zt,{b:()=>nt});var H=Te(5577),Ie=Te(576);function nt(c,Fe){return(0,Ie.m)(Fe)?(0,H.z)(c,Fe,1):(0,H.z)(c,1)}},9300:(zn,zt,Te)=>{"use strict";Te.d(zt,{h:()=>nt});var H=Te(4482),Ie=Te(5403);function nt(c,Fe){return(0,H.e)((Jt,kt)=>{let Ye=0;Jt.subscribe((0,Ie.x)(kt,gt=>c.call(Fe,gt,Ye++)&&kt.next(gt)))})}},4004:(zn,zt,Te)=>{"use strict";Te.d(zt,{U:()=>nt});var H=Te(4482),Ie=Te(5403);function nt(c,Fe){return(0,H.e)((Jt,kt)=>{let Ye=0;Jt.subscribe((0,Ie.x)(kt,gt=>{kt.next(c.call(Fe,gt,Ye++))}))})}},8189:(zn,zt,Te)=>{"use strict";Te.d(zt,{J:()=>nt});var H=Te(5577),Ie=Te(4671);function nt(c=1/0){return(0,H.z)(Ie.y,c)}},5577:(zn,zt,Te)=>{"use strict";Te.d(zt,{z:()=>Ye});var H=Te(4004),Ie=Te(8421),nt=Te(4482),c=Te(9672),Fe=Te(5403),kt=Te(576);function Ye(gt,yt,tt=1/0){return(0,kt.m)(yt)?Ye((st,un)=>(0,H.U)((Tt,xn)=>yt(st,Tt,un,xn))((0,Ie.Xf)(gt(st,un))),tt):("number"==typeof yt&&(tt=yt),(0,nt.e)((st,un)=>function Jt(gt,yt,tt,st,un,Tt,xn,hn){const Cn=[];let $t=0,nr=0,rn=!1;const Qt=()=>{rn&&!Cn.length&&!$t&&yt.complete()},Ht=sr=>$t<st?xt(sr):Cn.push(sr),xt=sr=>{Tt&&yt.next(sr),$t++;let At=!1;(0,Ie.Xf)(tt(sr,nr++)).subscribe((0,Fe.x)(yt,Ct=>{un?.(Ct),Tt?Ht(Ct):yt.next(Ct)},()=>{At=!0},void 0,()=>{if(At)try{for($t--;Cn.length&&$t<st;){const Ct=Cn.shift();xn?(0,c.f)(yt,xn,()=>xt(Ct)):xt(Ct)}Qt()}catch(Ct){yt.error(Ct)}}))};return gt.subscribe((0,Fe.x)(yt,Ht,()=>{rn=!0,Qt()})),()=>{hn?.()}}(st,un,gt,tt)))}},8505:(zn,zt,Te)=>{"use strict";Te.d(zt,{b:()=>Fe});var H=Te(576),Ie=Te(4482),nt=Te(5403),c=Te(4671);function Fe(Jt,kt,Ye){const gt=(0,H.m)(Jt)||kt||Ye?{next:Jt,error:kt,complete:Ye}:Jt;return gt?(0,Ie.e)((yt,tt)=>{var st;null===(st=gt.subscribe)||void 0===st||st.call(gt);let un=!0;yt.subscribe((0,nt.x)(tt,Tt=>{var xn;null===(xn=gt.next)||void 0===xn||xn.call(gt,Tt),tt.next(Tt)},()=>{var Tt;un=!1,null===(Tt=gt.complete)||void 0===Tt||Tt.call(gt),tt.complete()},Tt=>{var xn;un=!1,null===(xn=gt.error)||void 0===xn||xn.call(gt,Tt),tt.error(Tt)},()=>{var Tt,xn;un&&(null===(Tt=gt.unsubscribe)||void 0===Tt||Tt.call(gt)),null===(xn=gt.finalize)||void 0===xn||xn.call(gt)}))}):c.y}},3410:(zn,zt,Te)=>{"use strict";Te.d(zt,{z:()=>H});const H={setTimeout(Ie,nt,...c){const{delegate:Fe}=H;return Fe?.setTimeout?Fe.setTimeout(Ie,nt,...c):setTimeout(Ie,nt,...c)},clearTimeout(Ie){const{delegate:nt}=H;return(nt?.clearTimeout||clearTimeout)(Ie)},delegate:void 0}},2202:(zn,zt,Te)=>{"use strict";Te.d(zt,{h:()=>Ie});const Ie=function H(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(zn,zt,Te)=>{"use strict";Te.d(zt,{L:()=>H});const H="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(zn,zt,Te)=>{"use strict";Te.d(zt,{_6:()=>Jt,jO:()=>c,yG:()=>Fe});var H=Te(576);function nt(kt){return kt[kt.length-1]}function c(kt){return(0,H.m)(nt(kt))?kt.pop():void 0}function Fe(kt){return function Ie(kt){return kt&&(0,H.m)(kt.schedule)}(nt(kt))?kt.pop():void 0}function Jt(kt,Ye){return"number"==typeof nt(kt)?kt.pop():Ye}},4742:(zn,zt,Te)=>{"use strict";Te.d(zt,{D:()=>Fe});const{isArray:H}=Array,{getPrototypeOf:Ie,prototype:nt,keys:c}=Object;function Fe(kt){if(1===kt.length){const Ye=kt[0];if(H(Ye))return{args:Ye,keys:null};if(function Jt(kt){return kt&&"object"==typeof kt&&Ie(kt)===nt}(Ye)){const gt=c(Ye);return{args:gt.map(yt=>Ye[yt]),keys:gt}}}return{args:kt,keys:null}}},8737:(zn,zt,Te)=>{"use strict";function H(Ie,nt){if(Ie){const c=Ie.indexOf(nt);0<=c&&Ie.splice(c,1)}}Te.d(zt,{P:()=>H})},3888:(zn,zt,Te)=>{"use strict";function H(Ie){const c=Ie(Fe=>{Error.call(Fe),Fe.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}Te.d(zt,{d:()=>H})},1810:(zn,zt,Te)=>{"use strict";function H(Ie,nt){return Ie.reduce((c,Fe,Jt)=>(c[Fe]=nt[Jt],c),{})}Te.d(zt,{n:()=>H})},2806:(zn,zt,Te)=>{"use strict";Te.d(zt,{O:()=>c,x:()=>nt});var H=Te(2416);let Ie=null;function nt(Fe){if(H.v.useDeprecatedSynchronousErrorHandling){const Jt=!Ie;if(Jt&&(Ie={errorThrown:!1,error:null}),Fe(),Jt){const{errorThrown:kt,error:Ye}=Ie;if(Ie=null,kt)throw Ye}}else Fe()}function c(Fe){H.v.useDeprecatedSynchronousErrorHandling&&Ie&&(Ie.errorThrown=!0,Ie.error=Fe)}},9672:(zn,zt,Te)=>{"use strict";function H(Ie,nt,c,Fe=0,Jt=!1){const kt=nt.schedule(function(){c(),Jt?Ie.add(this.schedule(null,Fe)):this.unsubscribe()},Fe);if(Ie.add(kt),!Jt)return kt}Te.d(zt,{f:()=>H})},4671:(zn,zt,Te)=>{"use strict";function H(Ie){return Ie}Te.d(zt,{y:()=>H})},1144:(zn,zt,Te)=>{"use strict";Te.d(zt,{z:()=>H});const H=Ie=>Ie&&"number"==typeof Ie.length&&"function"!=typeof Ie},2206:(zn,zt,Te)=>{"use strict";Te.d(zt,{D:()=>Ie});var H=Te(576);function Ie(nt){return Symbol.asyncIterator&&(0,H.m)(nt?.[Symbol.asyncIterator])}},576:(zn,zt,Te)=>{"use strict";function H(Ie){return"function"==typeof Ie}Te.d(zt,{m:()=>H})},3670:(zn,zt,Te)=>{"use strict";Te.d(zt,{c:()=>nt});var H=Te(8822),Ie=Te(576);function nt(c){return(0,Ie.m)(c[H.L])}},6495:(zn,zt,Te)=>{"use strict";Te.d(zt,{T:()=>nt});var H=Te(2202),Ie=Te(576);function nt(c){return(0,Ie.m)(c?.[H.h])}},8239:(zn,zt,Te)=>{"use strict";Te.d(zt,{t:()=>Ie});var H=Te(576);function Ie(nt){return(0,H.m)(nt?.then)}},3260:(zn,zt,Te)=>{"use strict";Te.d(zt,{L:()=>c,Q:()=>nt});var H=Te(655),Ie=Te(576);function nt(Fe){return(0,H.FC)(this,arguments,function*(){const kt=Fe.getReader();try{for(;;){const{value:Ye,done:gt}=yield(0,H.qq)(kt.read());if(gt)return yield(0,H.qq)(void 0);yield yield(0,H.qq)(Ye)}}finally{kt.releaseLock()}})}function c(Fe){return(0,Ie.m)(Fe?.getReader)}},4482:(zn,zt,Te)=>{"use strict";Te.d(zt,{A:()=>Ie,e:()=>nt});var H=Te(576);function Ie(c){return(0,H.m)(c?.lift)}function nt(c){return Fe=>{if(Ie(Fe))return Fe.lift(function(Jt){try{return c(Jt,this)}catch(kt){this.error(kt)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(zn,zt,Te)=>{"use strict";Te.d(zt,{Z:()=>c});var H=Te(4004);const{isArray:Ie}=Array;function c(Fe){return(0,H.U)(Jt=>function nt(Fe,Jt){return Ie(Jt)?Fe(...Jt):Fe(Jt)}(Fe,Jt))}},9635:(zn,zt,Te)=>{"use strict";Te.d(zt,{U:()=>nt,z:()=>Ie});var H=Te(4671);function Ie(...c){return nt(c)}function nt(c){return 0===c.length?H.y:1===c.length?c[0]:function(Jt){return c.reduce((kt,Ye)=>Ye(kt),Jt)}}},7849:(zn,zt,Te)=>{"use strict";Te.d(zt,{h:()=>nt});var H=Te(2416),Ie=Te(3410);function nt(c){Ie.z.setTimeout(()=>{const{onUnhandledError:Fe}=H.v;if(!Fe)throw c;Fe(c)})}},4532:(zn,zt,Te)=>{"use strict";function H(Ie){return new TypeError(`You provided ${null!==Ie&&"object"==typeof Ie?"an invalid object":`'${Ie}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Te.d(zt,{z:()=>H})},655:(zn,zt,Te)=>{"use strict";function Ye(Ze,Ge,ot,We){return new(ot||(ot=Promise))(function(dt,wn){function dn(qn){try{En(We.next(qn))}catch(oi){wn(oi)}}function Sr(qn){try{En(We.throw(qn))}catch(oi){wn(oi)}}function En(qn){qn.done?dt(qn.value):function Gt(dt){return dt instanceof ot?dt:new ot(function(wn){wn(dt)})}(qn.value).then(dn,Sr)}En((We=We.apply(Ze,Ge||[])).next())})}function Cn(Ze){return this instanceof Cn?(this.v=Ze,this):new Cn(Ze)}function $t(Ze,Ge,ot){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Gt,We=ot.apply(Ze,Ge||[]),dt=[];return Gt={},wn("next"),wn("throw"),wn("return"),Gt[Symbol.asyncIterator]=function(){return this},Gt;function wn(pr){We[pr]&&(Gt[pr]=function(xi){return new Promise(function(Jr,yr){dt.push([pr,xi,Jr,yr])>1||dn(pr,xi)})})}function dn(pr,xi){try{!function Sr(pr){pr.value instanceof Cn?Promise.resolve(pr.value.v).then(En,qn):oi(dt[0][2],pr)}(We[pr](xi))}catch(Jr){oi(dt[0][3],Jr)}}function En(pr){dn("next",pr)}function qn(pr){dn("throw",pr)}function oi(pr,xi){pr(xi),dt.shift(),dt.length&&dn(dt[0][0],dt[0][1])}}function rn(Ze){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ot,Ge=Ze[Symbol.asyncIterator];return Ge?Ge.call(Ze):(Ze=function st(Ze){var Ge="function"==typeof Symbol&&Symbol.iterator,ot=Ge&&Ze[Ge],We=0;if(ot)return ot.call(Ze);if(Ze&&"number"==typeof Ze.length)return{next:function(){return Ze&&We>=Ze.length&&(Ze=void 0),{value:Ze&&Ze[We++],done:!Ze}}};throw new TypeError(Ge?"Object is not iterable.":"Symbol.iterator is not defined.")}(Ze),ot={},We("next"),We("throw"),We("return"),ot[Symbol.asyncIterator]=function(){return this},ot);function We(dt){ot[dt]=Ze[dt]&&function(wn){return new Promise(function(dn,Sr){!function Gt(dt,wn,dn,Sr){Promise.resolve(Sr).then(function(En){dt({value:En,done:dn})},wn)}(dn,Sr,(wn=Ze[dt](wn)).done,wn.value)})}}}Te.d(zt,{FC:()=>$t,KL:()=>rn,mG:()=>Ye,qq:()=>Cn})},6895:(zn,zt,Te)=>{"use strict";Te.d(zt,{Do:()=>rn,EM:()=>Cl,HT:()=>Fe,JF:()=>zs,JJ:()=>_i,K0:()=>kt,Mx:()=>jt,O5:()=>er,S$:()=>Cn,V_:()=>yt,Ye:()=>Qt,b0:()=>nr,bD:()=>ls,ez:()=>Bo,q:()=>nt,w_:()=>Jt});var H=Te(8256);let Ie=null;function nt(){return Ie}function Fe(F){Ie||(Ie=F)}class Jt{}const kt=new H.OlP("DocumentToken");let Ye=(()=>{class F{historyGo(B){throw new Error("Not implemented")}}return F.\u0275fac=function(B){return new(B||F)},F.\u0275prov=H.Yz7({token:F,factory:function(){return function gt(){return(0,H.LFG)(tt)}()},providedIn:"platform"}),F})();const yt=new H.OlP("Location Initialized");let tt=(()=>{class F extends Ye{constructor(B){super(),this._doc=B,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return nt().getBaseHref(this._doc)}onPopState(B){const Q=nt().getGlobalEventTarget(this._doc,"window");return Q.addEventListener("popstate",B,!1),()=>Q.removeEventListener("popstate",B)}onHashChange(B){const Q=nt().getGlobalEventTarget(this._doc,"window");return Q.addEventListener("hashchange",B,!1),()=>Q.removeEventListener("hashchange",B)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(B){this.location.pathname=B}pushState(B,Q,Me){st()?this._history.pushState(B,Q,Me):this.location.hash=Me}replaceState(B,Q,Me){st()?this._history.replaceState(B,Q,Me):this.location.hash=Me}forward(){this._history.forward()}back(){this._history.back()}historyGo(B=0){this._history.go(B)}getState(){return this._history.state}}return F.\u0275fac=function(B){return new(B||F)(H.LFG(kt))},F.\u0275prov=H.Yz7({token:F,factory:function(){return function un(){return new tt((0,H.LFG)(kt))}()},providedIn:"platform"}),F})();function st(){return!!window.history.pushState}function Tt(F,W){if(0==F.length)return W;if(0==W.length)return F;let B=0;return F.endsWith("/")&&B++,W.startsWith("/")&&B++,2==B?F+W.substring(1):1==B?F+W:F+"/"+W}function xn(F){const W=F.match(/#|\?|$/),B=W&&W.index||F.length;return F.slice(0,B-("/"===F[B-1]?1:0))+F.slice(B)}function hn(F){return F&&"?"!==F[0]?"?"+F:F}let Cn=(()=>{class F{historyGo(B){throw new Error("Not implemented")}}return F.\u0275fac=function(B){return new(B||F)},F.\u0275prov=H.Yz7({token:F,factory:function(){return(0,H.f3M)(nr)},providedIn:"root"}),F})();const $t=new H.OlP("appBaseHref");let nr=(()=>{class F extends Cn{constructor(B,Q){super(),this._platformLocation=B,this._removeListenerFns=[],this._baseHref=Q??this._platformLocation.getBaseHrefFromDOM()??(0,H.f3M)(kt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}prepareExternalUrl(B){return Tt(this._baseHref,B)}path(B=!1){const Q=this._platformLocation.pathname+hn(this._platformLocation.search),Me=this._platformLocation.hash;return Me&&B?`${Q}${Me}`:Q}pushState(B,Q,Me,rt){const Dt=this.prepareExternalUrl(Me+hn(rt));this._platformLocation.pushState(B,Q,Dt)}replaceState(B,Q,Me,rt){const Dt=this.prepareExternalUrl(Me+hn(rt));this._platformLocation.replaceState(B,Q,Dt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(B=0){this._platformLocation.historyGo?.(B)}}return F.\u0275fac=function(B){return new(B||F)(H.LFG(Ye),H.LFG($t,8))},F.\u0275prov=H.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})(),rn=(()=>{class F extends Cn{constructor(B,Q){super(),this._platformLocation=B,this._baseHref="",this._removeListenerFns=[],null!=Q&&(this._baseHref=Q)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}path(B=!1){let Q=this._platformLocation.hash;return null==Q&&(Q="#"),Q.length>0?Q.substring(1):Q}prepareExternalUrl(B){const Q=Tt(this._baseHref,B);return Q.length>0?"#"+Q:Q}pushState(B,Q,Me,rt){let Dt=this.prepareExternalUrl(Me+hn(rt));0==Dt.length&&(Dt=this._platformLocation.pathname),this._platformLocation.pushState(B,Q,Dt)}replaceState(B,Q,Me,rt){let Dt=this.prepareExternalUrl(Me+hn(rt));0==Dt.length&&(Dt=this._platformLocation.pathname),this._platformLocation.replaceState(B,Q,Dt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(B=0){this._platformLocation.historyGo?.(B)}}return F.\u0275fac=function(B){return new(B||F)(H.LFG(Ye),H.LFG($t,8))},F.\u0275prov=H.Yz7({token:F,factory:F.\u0275fac}),F})(),Qt=(()=>{class F{constructor(B){this._subject=new H.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=B;const Q=this._locationStrategy.getBaseHref();this._baseHref=xn(sr(Q)),this._locationStrategy.onPopState(Me=>{this._subject.emit({url:this.path(!0),pop:!0,state:Me.state,type:Me.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(B=!1){return this.normalize(this._locationStrategy.path(B))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(B,Q=""){return this.path()==this.normalize(B+hn(Q))}normalize(B){return F.stripTrailingSlash(function xt(F,W){return F&&W.startsWith(F)?W.substring(F.length):W}(this._baseHref,sr(B)))}prepareExternalUrl(B){return B&&"/"!==B[0]&&(B="/"+B),this._locationStrategy.prepareExternalUrl(B)}go(B,Q="",Me=null){this._locationStrategy.pushState(Me,"",B,Q),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+hn(Q)),Me)}replaceState(B,Q="",Me=null){this._locationStrategy.replaceState(Me,"",B,Q),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+hn(Q)),Me)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(B=0){this._locationStrategy.historyGo?.(B)}onUrlChange(B){return this._urlChangeListeners.push(B),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Q=>{this._notifyUrlChangeListeners(Q.url,Q.state)})),()=>{const Q=this._urlChangeListeners.indexOf(B);this._urlChangeListeners.splice(Q,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(B="",Q){this._urlChangeListeners.forEach(Me=>Me(B,Q))}subscribe(B,Q,Me){return this._subject.subscribe({next:B,error:Q,complete:Me})}}return F.normalizeQueryParams=hn,F.joinWithSlash=Tt,F.stripTrailingSlash=xn,F.\u0275fac=function(B){return new(B||F)(H.LFG(Cn))},F.\u0275prov=H.Yz7({token:F,factory:function(){return function Ht(){return new Qt((0,H.LFG)(Cn))}()},providedIn:"root"}),F})();function sr(F){return F.replace(/\/index.html$/,"")}var Ct=(()=>((Ct=Ct||{})[Ct.Decimal=0]="Decimal",Ct[Ct.Percent=1]="Percent",Ct[Ct.Currency=2]="Currency",Ct[Ct.Scientific=3]="Scientific",Ct))(),We=(()=>((We=We||{})[We.Decimal=0]="Decimal",We[We.Group=1]="Group",We[We.List=2]="List",We[We.PercentSign=3]="PercentSign",We[We.PlusSign=4]="PlusSign",We[We.MinusSign=5]="MinusSign",We[We.Exponential=6]="Exponential",We[We.SuperscriptingExponent=7]="SuperscriptingExponent",We[We.PerMille=8]="PerMille",We[We.Infinity=9]="Infinity",We[We.NaN=10]="NaN",We[We.TimeSeparator=11]="TimeSeparator",We[We.CurrencyDecimal=12]="CurrencyDecimal",We[We.CurrencyGroup=13]="CurrencyGroup",We))();function yr(F,W){const B=(0,H.cg1)(F),Q=B[H.wAp.NumberSymbols][W];if(typeof Q>"u"){if(W===We.CurrencyDecimal)return B[H.wAp.NumberSymbols][We.Decimal];if(W===We.CurrencyGroup)return B[H.wAp.NumberSymbols][We.Group]}return Q}const $e=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Br(F){const W=parseInt(F);if(isNaN(W))throw new Error("Invalid integer literal when parsing "+F);return W}function jt(F,W){W=encodeURIComponent(W);for(const B of F.split(";")){const Q=B.indexOf("="),[Me,rt]=-1==Q?[B,""]:[B.slice(0,Q),B.slice(Q+1)];if(Me.trim()===W)return decodeURIComponent(rt)}return null}let er=(()=>{class F{constructor(B,Q){this._viewContainer=B,this._context=new jr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=Q}set ngIf(B){this._context.$implicit=this._context.ngIf=B,this._updateView()}set ngIfThen(B){Fa("ngIfThen",B),this._thenTemplateRef=B,this._thenViewRef=null,this._updateView()}set ngIfElse(B){Fa("ngIfElse",B),this._elseTemplateRef=B,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(B,Q){return!0}}return F.\u0275fac=function(B){return new(B||F)(H.Y36(H.s_b),H.Y36(H.Rgc))},F.\u0275dir=H.lG2({type:F,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),F})();class jr{constructor(){this.$implicit=null,this.ngIf=null}}function Fa(F,W){if(W&&!W.createEmbeddedView)throw new Error(`${F} must be a TemplateRef, but received '${(0,H.AaK)(W)}'.`)}let _i=(()=>{class F{constructor(B){this._locale=B}transform(B,Q,Me){if(!function as(F){return!(null==F||""===F||F!=F)}(B))return null;Me=Me||this._locale;try{return function Zt(F,W,B){return function _n(F,W,B,Q,Me,rt,Dt=!1){let sn="",xr=!1;if(isFinite(F)){let fr=function $n(F){let Q,Me,rt,Dt,sn,W=Math.abs(F)+"",B=0;for((Me=W.indexOf("."))>-1&&(W=W.replace(".","")),(rt=W.search(/e/i))>0?(Me<0&&(Me=rt),Me+=+W.slice(rt+1),W=W.substring(0,rt)):Me<0&&(Me=W.length),rt=0;"0"===W.charAt(rt);rt++);if(rt===(sn=W.length))Q=[0],Me=1;else{for(sn--;"0"===W.charAt(sn);)sn--;for(Me-=rt,Q=[],Dt=0;rt<=sn;rt++,Dt++)Q[Dt]=Number(W.charAt(rt))}return Me>22&&(Q=Q.splice(0,21),B=Me-1,Me=1),{digits:Q,exponent:B,integerLen:Me}}(F);Dt&&(fr=function mi(F){if(0===F.digits[0])return F;const W=F.digits.length-F.integerLen;return F.exponent?F.exponent+=2:(0===W?F.digits.push(0,0):1===W&&F.digits.push(0),F.integerLen+=2),F}(fr));let Dr=W.minInt,rr=W.minFrac,Nn=W.maxFrac;if(rt){const Qi=rt.match($e);if(null===Qi)throw new Error(`${rt} is not a valid digit info`);const or=Qi[1],Ds=Qi[3],Vs=Qi[5];null!=or&&(Dr=Br(or)),null!=Ds&&(rr=Br(Ds)),null!=Vs?Nn=Br(Vs):null!=Ds&&rr>Nn&&(Nn=rr)}!function Ti(F,W,B){if(W>B)throw new Error(`The minimum number of digits after fraction (${W}) is higher than the maximum (${B}).`);let Q=F.digits,Me=Q.length-F.integerLen;const rt=Math.min(Math.max(W,Me),B);let Dt=rt+F.integerLen,sn=Q[Dt];if(Dt>0){Q.splice(Math.max(F.integerLen,Dt));for(let rr=Dt;rr<Q.length;rr++)Q[rr]=0}else{Me=Math.max(0,Me),F.integerLen=1,Q.length=Math.max(1,Dt=rt+1),Q[0]=0;for(let rr=1;rr<Dt;rr++)Q[rr]=0}if(sn>=5)if(Dt-1<0){for(let rr=0;rr>Dt;rr--)Q.unshift(0),F.integerLen++;Q.unshift(1),F.integerLen++}else Q[Dt-1]++;for(;Me<Math.max(0,rt);Me++)Q.push(0);let xr=0!==rt;const fr=W+F.integerLen,Dr=Q.reduceRight(function(rr,Nn,ir,Yn){return Yn[ir]=(Nn+=rr)<10?Nn:Nn-10,xr&&(0===Yn[ir]&&ir>=fr?Yn.pop():xr=!1),Nn>=10?1:0},0);Dr&&(Q.unshift(Dr),F.integerLen++)}(fr,rr,Nn);let ir=fr.digits,Yn=fr.integerLen;const qi=fr.exponent;let bi=[];for(xr=ir.every(Qi=>!Qi);Yn<Dr;Yn++)ir.unshift(0);for(;Yn<0;Yn++)ir.unshift(0);Yn>0?bi=ir.splice(Yn,ir.length):(bi=ir,ir=[0]);const Jo=[];for(ir.length>=W.lgSize&&Jo.unshift(ir.splice(-W.lgSize,ir.length).join(""));ir.length>W.gSize;)Jo.unshift(ir.splice(-W.gSize,ir.length).join(""));ir.length&&Jo.unshift(ir.join("")),sn=Jo.join(yr(B,Q)),bi.length&&(sn+=yr(B,Me)+bi.join("")),qi&&(sn+=yr(B,We.Exponential)+"+"+qi)}else sn=yr(B,We.Infinity);return sn=F<0&&!xr?W.negPre+sn+W.negSuf:W.posPre+sn+W.posSuf,sn}(F,function Ke(F,W="-"){const B={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},Q=F.split(";"),Me=Q[0],rt=Q[1],Dt=-1!==Me.indexOf(".")?Me.split("."):[Me.substring(0,Me.lastIndexOf("0")+1),Me.substring(Me.lastIndexOf("0")+1)],sn=Dt[0],xr=Dt[1]||"";B.posPre=sn.substring(0,sn.indexOf("#"));for(let Dr=0;Dr<xr.length;Dr++){const rr=xr.charAt(Dr);"0"===rr?B.minFrac=B.maxFrac=Dr+1:"#"===rr?B.maxFrac=Dr+1:B.posSuf+=rr}const fr=sn.split(",");if(B.gSize=fr[1]?fr[1].length:0,B.lgSize=fr[2]||fr[1]?(fr[2]||fr[1]).length:0,rt){const Dr=Me.length-B.posPre.length-B.posSuf.length,rr=rt.indexOf("#");B.negPre=rt.substring(0,rr).replace(/'/g,""),B.negSuf=rt.slice(rr+Dr).replace(/'/g,"")}else B.negPre=W+B.posPre,B.negSuf=B.posSuf;return B}(function hr(F,W){return(0,H.cg1)(F)[H.wAp.NumberFormats][W]}(W,Ct.Decimal),yr(W,We.MinusSign)),W,We.Group,We.Decimal,B)}(function sa(F){if("string"==typeof F&&!isNaN(Number(F)-parseFloat(F)))return Number(F);if("number"!=typeof F)throw new Error(`${F} is not a number`);return F}(B),Me,Q)}catch(rt){throw function gr(F,W){return new H.vHH(2100,!1)}()}}}return F.\u0275fac=function(B){return new(B||F)(H.Y36(H.soG,16))},F.\u0275pipe=H.Yjl({name:"number",type:F,pure:!0,standalone:!0}),F})();let Bo=(()=>{class F{}return F.\u0275fac=function(B){return new(B||F)},F.\u0275mod=H.oAB({type:F}),F.\u0275inj=H.cJS({}),F})();const ls="browser";let Cl=(()=>{class F{}return F.\u0275prov=(0,H.Yz7)({token:F,providedIn:"root",factory:()=>new yi((0,H.LFG)(kt),window)}),F})();class yi{constructor(W,B){this.document=W,this.window=B,this.offset=()=>[0,0]}setOffset(W){this.offset=Array.isArray(W)?()=>W:W}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(W){this.supportsScrolling()&&this.window.scrollTo(W[0],W[1])}scrollToAnchor(W){if(!this.supportsScrolling())return;const B=function us(F,W){const B=F.getElementById(W)||F.getElementsByName(W)[0];if(B)return B;if("function"==typeof F.createTreeWalker&&F.body&&(F.body.createShadowRoot||F.body.attachShadow)){const Q=F.createTreeWalker(F.body,NodeFilter.SHOW_ELEMENT);let Me=Q.currentNode;for(;Me;){const rt=Me.shadowRoot;if(rt){const Dt=rt.getElementById(W)||rt.querySelector(`[name="${W}"]`);if(Dt)return Dt}Me=Q.nextNode()}}return null}(this.document,W);B&&(this.scrollToElement(B),B.focus())}setHistoryScrollRestoration(W){if(this.supportScrollRestoration()){const B=this.window.history;B&&B.scrollRestoration&&(B.scrollRestoration=W)}}scrollToElement(W){const B=W.getBoundingClientRect(),Q=B.left+this.window.pageXOffset,Me=B.top+this.window.pageYOffset,rt=this.offset();this.window.scrollTo(Q-rt[0],Me-rt[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const W=cs(this.window.history)||cs(Object.getPrototypeOf(this.window.history));return!(!W||!W.writable&&!W.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function cs(F){return Object.getOwnPropertyDescriptor(F,"scrollRestoration")}class zs{}},529:(zn,zt,Te)=>{"use strict";Te.d(zt,{JF:()=>io,WM:()=>yt,eN:()=>dt});var H=Te(6895),Ie=Te(8256),nt=Te(9646),c=Te(9751),Fe=Te(4351),Jt=Te(9300),kt=Te(4004);class Ye{}class gt{}class yt{constructor(_e){this.normalizedNames=new Map,this.lazyUpdate=null,_e?this.lazyInit="string"==typeof _e?()=>{this.headers=new Map,_e.split("\n").forEach(xe=>{const ct=xe.indexOf(":");if(ct>0){const it=xe.slice(0,ct),cn=it.toLowerCase(),Sn=xe.slice(ct+1).trim();this.maybeSetNormalizedName(it,cn),this.headers.has(cn)?this.headers.get(cn).push(Sn):this.headers.set(cn,[Sn])}})}:()=>{this.headers=new Map,Object.keys(_e).forEach(xe=>{let ct=_e[xe];const it=xe.toLowerCase();"string"==typeof ct&&(ct=[ct]),ct.length>0&&(this.headers.set(it,ct),this.maybeSetNormalizedName(xe,it))})}:this.headers=new Map}has(_e){return this.init(),this.headers.has(_e.toLowerCase())}get(_e){this.init();const xe=this.headers.get(_e.toLowerCase());return xe&&xe.length>0?xe[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(_e){return this.init(),this.headers.get(_e.toLowerCase())||null}append(_e,xe){return this.clone({name:_e,value:xe,op:"a"})}set(_e,xe){return this.clone({name:_e,value:xe,op:"s"})}delete(_e,xe){return this.clone({name:_e,value:xe,op:"d"})}maybeSetNormalizedName(_e,xe){this.normalizedNames.has(xe)||this.normalizedNames.set(xe,_e)}init(){this.lazyInit&&(this.lazyInit instanceof yt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(_e=>this.applyUpdate(_e)),this.lazyUpdate=null))}copyFrom(_e){_e.init(),Array.from(_e.headers.keys()).forEach(xe=>{this.headers.set(xe,_e.headers.get(xe)),this.normalizedNames.set(xe,_e.normalizedNames.get(xe))})}clone(_e){const xe=new yt;return xe.lazyInit=this.lazyInit&&this.lazyInit instanceof yt?this.lazyInit:this,xe.lazyUpdate=(this.lazyUpdate||[]).concat([_e]),xe}applyUpdate(_e){const xe=_e.name.toLowerCase();switch(_e.op){case"a":case"s":let ct=_e.value;if("string"==typeof ct&&(ct=[ct]),0===ct.length)return;this.maybeSetNormalizedName(_e.name,xe);const it=("a"===_e.op?this.headers.get(xe):void 0)||[];it.push(...ct),this.headers.set(xe,it);break;case"d":const cn=_e.value;if(cn){let Sn=this.headers.get(xe);if(!Sn)return;Sn=Sn.filter(ar=>-1===cn.indexOf(ar)),0===Sn.length?(this.headers.delete(xe),this.normalizedNames.delete(xe)):this.headers.set(xe,Sn)}else this.headers.delete(xe),this.normalizedNames.delete(xe)}}forEach(_e){this.init(),Array.from(this.normalizedNames.keys()).forEach(xe=>_e(this.normalizedNames.get(xe),this.headers.get(xe)))}}class st{encodeKey(_e){return hn(_e)}encodeValue(_e){return hn(_e)}decodeKey(_e){return decodeURIComponent(_e)}decodeValue(_e){return decodeURIComponent(_e)}}const Tt=/%(\d[a-f0-9])/gi,xn={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function hn(ft){return encodeURIComponent(ft).replace(Tt,(_e,xe)=>xn[xe]??_e)}function Cn(ft){return`${ft}`}class $t{constructor(_e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=_e.encoder||new st,_e.fromString){if(_e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function un(ft,_e){const xe=new Map;return ft.length>0&&ft.replace(/^\?/,"").split("&").forEach(it=>{const cn=it.indexOf("="),[Sn,ar]=-1==cn?[_e.decodeKey(it),""]:[_e.decodeKey(it.slice(0,cn)),_e.decodeValue(it.slice(cn+1))],yn=xe.get(Sn)||[];yn.push(ar),xe.set(Sn,yn)}),xe}(_e.fromString,this.encoder)}else _e.fromObject?(this.map=new Map,Object.keys(_e.fromObject).forEach(xe=>{const ct=_e.fromObject[xe],it=Array.isArray(ct)?ct.map(Cn):[Cn(ct)];this.map.set(xe,it)})):this.map=null}has(_e){return this.init(),this.map.has(_e)}get(_e){this.init();const xe=this.map.get(_e);return xe?xe[0]:null}getAll(_e){return this.init(),this.map.get(_e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(_e,xe){return this.clone({param:_e,value:xe,op:"a"})}appendAll(_e){const xe=[];return Object.keys(_e).forEach(ct=>{const it=_e[ct];Array.isArray(it)?it.forEach(cn=>{xe.push({param:ct,value:cn,op:"a"})}):xe.push({param:ct,value:it,op:"a"})}),this.clone(xe)}set(_e,xe){return this.clone({param:_e,value:xe,op:"s"})}delete(_e,xe){return this.clone({param:_e,value:xe,op:"d"})}toString(){return this.init(),this.keys().map(_e=>{const xe=this.encoder.encodeKey(_e);return this.map.get(_e).map(ct=>xe+"="+this.encoder.encodeValue(ct)).join("&")}).filter(_e=>""!==_e).join("&")}clone(_e){const xe=new $t({encoder:this.encoder});return xe.cloneFrom=this.cloneFrom||this,xe.updates=(this.updates||[]).concat(_e),xe}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(_e=>this.map.set(_e,this.cloneFrom.map.get(_e))),this.updates.forEach(_e=>{switch(_e.op){case"a":case"s":const xe=("a"===_e.op?this.map.get(_e.param):void 0)||[];xe.push(Cn(_e.value)),this.map.set(_e.param,xe);break;case"d":if(void 0===_e.value){this.map.delete(_e.param);break}{let ct=this.map.get(_e.param)||[];const it=ct.indexOf(Cn(_e.value));-1!==it&&ct.splice(it,1),ct.length>0?this.map.set(_e.param,ct):this.map.delete(_e.param)}}}),this.cloneFrom=this.updates=null)}}class rn{constructor(){this.map=new Map}set(_e,xe){return this.map.set(_e,xe),this}get(_e){return this.map.has(_e)||this.map.set(_e,_e.defaultValue()),this.map.get(_e)}delete(_e){return this.map.delete(_e),this}has(_e){return this.map.has(_e)}keys(){return this.map.keys()}}function Ht(ft){return typeof ArrayBuffer<"u"&&ft instanceof ArrayBuffer}function xt(ft){return typeof Blob<"u"&&ft instanceof Blob}function sr(ft){return typeof FormData<"u"&&ft instanceof FormData}class Ct{constructor(_e,xe,ct,it){let cn;if(this.url=xe,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=_e.toUpperCase(),function Qt(ft){switch(ft){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||it?(this.body=void 0!==ct?ct:null,cn=it):cn=ct,cn&&(this.reportProgress=!!cn.reportProgress,this.withCredentials=!!cn.withCredentials,cn.responseType&&(this.responseType=cn.responseType),cn.headers&&(this.headers=cn.headers),cn.context&&(this.context=cn.context),cn.params&&(this.params=cn.params)),this.headers||(this.headers=new yt),this.context||(this.context=new rn),this.params){const Sn=this.params.toString();if(0===Sn.length)this.urlWithParams=xe;else{const ar=xe.indexOf("?");this.urlWithParams=xe+(-1===ar?"?":ar<xe.length-1?"&":"")+Sn}}else this.params=new $t,this.urlWithParams=xe}serializeBody(){return null===this.body?null:Ht(this.body)||xt(this.body)||sr(this.body)||function At(ft){return typeof URLSearchParams<"u"&&ft instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof $t?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||sr(this.body)?null:xt(this.body)?this.body.type||null:Ht(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof $t?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(_e={}){const xe=_e.method||this.method,ct=_e.url||this.url,it=_e.responseType||this.responseType,cn=void 0!==_e.body?_e.body:this.body,Sn=void 0!==_e.withCredentials?_e.withCredentials:this.withCredentials,ar=void 0!==_e.reportProgress?_e.reportProgress:this.reportProgress;let yn=_e.headers||this.headers,Ur=_e.params||this.params;const mr=_e.context??this.context;return void 0!==_e.setHeaders&&(yn=Object.keys(_e.setHeaders).reduce((ai,gn)=>ai.set(gn,_e.setHeaders[gn]),yn)),_e.setParams&&(Ur=Object.keys(_e.setParams).reduce((ai,gn)=>ai.set(gn,_e.setParams[gn]),Ur)),new Ct(xe,ct,cn,{params:Ur,headers:yn,context:mr,reportProgress:ar,responseType:it,withCredentials:Sn})}}var en=(()=>((en=en||{})[en.Sent=0]="Sent",en[en.UploadProgress=1]="UploadProgress",en[en.ResponseHeader=2]="ResponseHeader",en[en.DownloadProgress=3]="DownloadProgress",en[en.Response=4]="Response",en[en.User=5]="User",en))();class Ze{constructor(_e,xe=200,ct="OK"){this.headers=_e.headers||new yt,this.status=void 0!==_e.status?_e.status:xe,this.statusText=_e.statusText||ct,this.url=_e.url||null,this.ok=this.status>=200&&this.status<300}}class Ge extends Ze{constructor(_e={}){super(_e),this.type=en.ResponseHeader}clone(_e={}){return new Ge({headers:_e.headers||this.headers,status:void 0!==_e.status?_e.status:this.status,statusText:_e.statusText||this.statusText,url:_e.url||this.url||void 0})}}class ot extends Ze{constructor(_e={}){super(_e),this.type=en.Response,this.body=void 0!==_e.body?_e.body:null}clone(_e={}){return new ot({body:void 0!==_e.body?_e.body:this.body,headers:_e.headers||this.headers,status:void 0!==_e.status?_e.status:this.status,statusText:_e.statusText||this.statusText,url:_e.url||this.url||void 0})}}class We extends Ze{constructor(_e){super(_e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${_e.url||"(unknown url)"}`:`Http failure response for ${_e.url||"(unknown url)"}: ${_e.status} ${_e.statusText}`,this.error=_e.error||null}}function Gt(ft,_e){return{body:_e,headers:ft.headers,context:ft.context,observe:ft.observe,params:ft.params,reportProgress:ft.reportProgress,responseType:ft.responseType,withCredentials:ft.withCredentials}}let dt=(()=>{class ft{constructor(xe){this.handler=xe}request(xe,ct,it={}){let cn;if(xe instanceof Ct)cn=xe;else{let yn,Ur;yn=it.headers instanceof yt?it.headers:new yt(it.headers),it.params&&(Ur=it.params instanceof $t?it.params:new $t({fromObject:it.params})),cn=new Ct(xe,ct,void 0!==it.body?it.body:null,{headers:yn,context:it.context,params:Ur,reportProgress:it.reportProgress,responseType:it.responseType||"json",withCredentials:it.withCredentials})}const Sn=(0,nt.of)(cn).pipe((0,Fe.b)(yn=>this.handler.handle(yn)));if(xe instanceof Ct||"events"===it.observe)return Sn;const ar=Sn.pipe((0,Jt.h)(yn=>yn instanceof ot));switch(it.observe||"body"){case"body":switch(cn.responseType){case"arraybuffer":return ar.pipe((0,kt.U)(yn=>{if(null!==yn.body&&!(yn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return yn.body}));case"blob":return ar.pipe((0,kt.U)(yn=>{if(null!==yn.body&&!(yn.body instanceof Blob))throw new Error("Response is not a Blob.");return yn.body}));case"text":return ar.pipe((0,kt.U)(yn=>{if(null!==yn.body&&"string"!=typeof yn.body)throw new Error("Response is not a string.");return yn.body}));default:return ar.pipe((0,kt.U)(yn=>yn.body))}case"response":return ar;default:throw new Error(`Unreachable: unhandled observe type ${it.observe}}`)}}delete(xe,ct={}){return this.request("DELETE",xe,ct)}get(xe,ct={}){return this.request("GET",xe,ct)}head(xe,ct={}){return this.request("HEAD",xe,ct)}jsonp(xe,ct){return this.request("JSONP",xe,{params:(new $t).append(ct,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(xe,ct={}){return this.request("OPTIONS",xe,ct)}patch(xe,ct,it={}){return this.request("PATCH",xe,Gt(it,ct))}post(xe,ct,it={}){return this.request("POST",xe,Gt(it,ct))}put(xe,ct,it={}){return this.request("PUT",xe,Gt(it,ct))}}return ft.\u0275fac=function(xe){return new(xe||ft)(Ie.LFG(Ye))},ft.\u0275prov=Ie.Yz7({token:ft,factory:ft.\u0275fac}),ft})();class wn{constructor(_e,xe){this.next=_e,this.interceptor=xe}handle(_e){return this.interceptor.intercept(_e,this.next)}}const dn=new Ie.OlP("HTTP_INTERCEPTORS");let Sr=(()=>{class ft{intercept(xe,ct){return ct.handle(xe)}}return ft.\u0275fac=function(xe){return new(xe||ft)},ft.\u0275prov=Ie.Yz7({token:ft,factory:ft.\u0275fac}),ft})();const Oo=/^\)\]\}',?\n/;let $i=(()=>{class ft{constructor(xe){this.xhrFactory=xe}handle(xe){if("JSONP"===xe.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new c.y(ct=>{const it=this.xhrFactory.build();if(it.open(xe.method,xe.urlWithParams),xe.withCredentials&&(it.withCredentials=!0),xe.headers.forEach((zr,dr)=>it.setRequestHeader(zr,dr.join(","))),xe.headers.has("Accept")||it.setRequestHeader("Accept","application/json, text/plain, */*"),!xe.headers.has("Content-Type")){const zr=xe.detectContentTypeHeader();null!==zr&&it.setRequestHeader("Content-Type",zr)}if(xe.responseType){const zr=xe.responseType.toLowerCase();it.responseType="json"!==zr?zr:"text"}const cn=xe.serializeBody();let Sn=null;const ar=()=>{if(null!==Sn)return Sn;const zr=it.statusText||"OK",dr=new yt(it.getAllResponseHeaders()),Wr=function Jn(ft){return"responseURL"in ft&&ft.responseURL?ft.responseURL:/^X-Request-URL:/m.test(ft.getAllResponseHeaders())?ft.getResponseHeader("X-Request-URL"):null}(it)||xe.url;return Sn=new Ge({headers:dr,status:it.status,statusText:zr,url:Wr}),Sn},yn=()=>{let{headers:zr,status:dr,statusText:Wr,url:kn}=ar(),Ar=null;204!==dr&&(Ar=typeof it.response>"u"?it.responseText:it.response),0===dr&&(dr=Ar?200:0);let bn=dr>=200&&dr<300;if("json"===xe.responseType&&"string"==typeof Ar){const Fi=Ar;Ar=Ar.replace(Oo,"");try{Ar=""!==Ar?JSON.parse(Ar):null}catch(ue){Ar=Fi,bn&&(bn=!1,Ar={error:ue,text:Ar})}}bn?(ct.next(new ot({body:Ar,headers:zr,status:dr,statusText:Wr,url:kn||void 0})),ct.complete()):ct.error(new We({error:Ar,headers:zr,status:dr,statusText:Wr,url:kn||void 0}))},Ur=zr=>{const{url:dr}=ar(),Wr=new We({error:zr,status:it.status||0,statusText:it.statusText||"Unknown Error",url:dr||void 0});ct.error(Wr)};let mr=!1;const ai=zr=>{mr||(ct.next(ar()),mr=!0);let dr={type:en.DownloadProgress,loaded:zr.loaded};zr.lengthComputable&&(dr.total=zr.total),"text"===xe.responseType&&!!it.responseText&&(dr.partialText=it.responseText),ct.next(dr)},gn=zr=>{let dr={type:en.UploadProgress,loaded:zr.loaded};zr.lengthComputable&&(dr.total=zr.total),ct.next(dr)};return it.addEventListener("load",yn),it.addEventListener("error",Ur),it.addEventListener("timeout",Ur),it.addEventListener("abort",Ur),xe.reportProgress&&(it.addEventListener("progress",ai),null!==cn&&it.upload&&it.upload.addEventListener("progress",gn)),it.send(cn),ct.next({type:en.Sent}),()=>{it.removeEventListener("error",Ur),it.removeEventListener("abort",Ur),it.removeEventListener("load",yn),it.removeEventListener("timeout",Ur),xe.reportProgress&&(it.removeEventListener("progress",ai),null!==cn&&it.upload&&it.upload.removeEventListener("progress",gn)),it.readyState!==it.DONE&&it.abort()}})}}return ft.\u0275fac=function(xe){return new(xe||ft)(Ie.LFG(H.JF))},ft.\u0275prov=Ie.Yz7({token:ft,factory:ft.\u0275fac}),ft})();const Mr=new Ie.OlP("XSRF_COOKIE_NAME"),Li=new Ie.OlP("XSRF_HEADER_NAME");class si{}let Gi=(()=>{class ft{constructor(xe,ct,it){this.doc=xe,this.platform=ct,this.cookieName=it,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const xe=this.doc.cookie||"";return xe!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,H.Mx)(xe,this.cookieName),this.lastCookieString=xe),this.lastToken}}return ft.\u0275fac=function(xe){return new(xe||ft)(Ie.LFG(H.K0),Ie.LFG(Ie.Lbi),Ie.LFG(Mr))},ft.\u0275prov=Ie.Yz7({token:ft,factory:ft.\u0275fac}),ft})(),Bn=(()=>{class ft{constructor(xe,ct){this.tokenService=xe,this.headerName=ct}intercept(xe,ct){const it=xe.url.toLowerCase();if("GET"===xe.method||"HEAD"===xe.method||it.startsWith("http://")||it.startsWith("https://"))return ct.handle(xe);const cn=this.tokenService.getToken();return null!==cn&&!xe.headers.has(this.headerName)&&(xe=xe.clone({headers:xe.headers.set(this.headerName,cn)})),ct.handle(xe)}}return ft.\u0275fac=function(xe){return new(xe||ft)(Ie.LFG(si),Ie.LFG(Li))},ft.\u0275prov=Ie.Yz7({token:ft,factory:ft.\u0275fac}),ft})(),mn=(()=>{class ft{constructor(xe,ct){this.backend=xe,this.injector=ct,this.chain=null}handle(xe){if(null===this.chain){const ct=this.injector.get(dn,[]);this.chain=ct.reduceRight((it,cn)=>new wn(it,cn),this.backend)}return this.chain.handle(xe)}}return ft.\u0275fac=function(xe){return new(xe||ft)(Ie.LFG(gt),Ie.LFG(Ie.zs3))},ft.\u0275prov=Ie.Yz7({token:ft,factory:ft.\u0275fac}),ft})(),Oi=(()=>{class ft{static disable(){return{ngModule:ft,providers:[{provide:Bn,useClass:Sr}]}}static withOptions(xe={}){return{ngModule:ft,providers:[xe.cookieName?{provide:Mr,useValue:xe.cookieName}:[],xe.headerName?{provide:Li,useValue:xe.headerName}:[]]}}}return ft.\u0275fac=function(xe){return new(xe||ft)},ft.\u0275mod=Ie.oAB({type:ft}),ft.\u0275inj=Ie.cJS({providers:[Bn,{provide:dn,useExisting:Bn,multi:!0},{provide:si,useClass:Gi},{provide:Mr,useValue:"XSRF-TOKEN"},{provide:Li,useValue:"X-XSRF-TOKEN"}]}),ft})(),io=(()=>{class ft{}return ft.\u0275fac=function(xe){return new(xe||ft)},ft.\u0275mod=Ie.oAB({type:ft}),ft.\u0275inj=Ie.cJS({providers:[dt,{provide:Ye,useClass:mn},$i,{provide:gt,useExisting:$i}],imports:[Oi.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),ft})()},8256:(zn,zt,Te)=>{"use strict";Te.d(zt,{tb:()=>Z0,AFp:()=>$0,ip1:()=>V0,CZH:()=>Tg,hGG:()=>Bw,z2F:()=>Cg,sBO:()=>ww,Sil:()=>rw,_Vd:()=>Wl,EJc:()=>tw,Xts:()=>Qh,SBq:()=>_c,lqb:()=>Zl,qLn:()=>tu,vpe:()=>Rc,XFs:()=>_e,OlP:()=>Rr,zs3:()=>xc,ZZ4:()=>wy,aQg:()=>Ey,soG:()=>Dg,YKP:()=>Xv,h0i:()=>Yd,PXZ:()=>gw,R0b:()=>vl,FiY:()=>Mt,Lbi:()=>Jb,g9A:()=>H0,Qsj:()=>pf,FYo:()=>em,JOm:()=>Sa,tp0:()=>at,Rgc:()=>Mp,dDg:()=>dw,eoX:()=>Q0,GfV:()=>eu,s_b:()=>bg,ifc:()=>ai,MMx:()=>K_,Lck:()=>H1,eFA:()=>nx,G48:()=>bw,Gpc:()=>nr,f3M:()=>ke,_c5:()=>zw,c2e:()=>Qb,zSh:()=>hf,wAp:()=>jn,vHH:()=>xt,lri:()=>K0,rWj:()=>J0,D6c:()=>Nw,cg1:()=>$_,kL8:()=>xv,dqk:()=>gn,Z0I:()=>Bn,sIi:()=>Yu,CqO:()=>vn,QGY:()=>On,QP$:()=>It,F4k:()=>Un,RDi:()=>Vr,AaK:()=>hn,qOj:()=>ml,TTD:()=>aa,_Bn:()=>qv,jDz:()=>Kv,xp6:()=>Th,uIk:()=>Gd,ekj:()=>$h,Suo:()=>v0,Xpm:()=>ge,lG2:()=>Ee,Yz7:()=>Mr,cJS:()=>si,oAB:()=>Re,Yjl:()=>le,Y36:()=>au,_UZ:()=>ut,qZA:()=>et,TgZ:()=>Lt,n5z:()=>ya,LFG:()=>ae,$8M:()=>dc,$Z:()=>Sd,NdJ:()=>Nt,CRH:()=>x0,oxw:()=>Kr,ALo:()=>u0,xi3:()=>h0,Q6J:()=>Je,iGM:()=>_0,LSH:()=>Cr,YNc:()=>ye,_uU:()=>ev,Oqu:()=>V_,hij:()=>mg,Gf:()=>y0});var H=Te(7579),Ie=Te(727),nt=Te(9751),c=Te(8189),Fe=Te(8421),Jt=Te(515),kt=Te(7669),Ye=Te(2076),yt=Te(2961),tt=Te(4482);function un(i,o,...a){if(!0===o)return void i();if(!1===o)return;const d=new yt.Hp({next:()=>{d.unsubscribe(),i()}});return o(...a).subscribe(d)}function Tt(i){for(let o in i)if(i[o]===Tt)return o;throw Error("Could not find renamed property on target object.")}function xn(i,o){for(const a in o)o.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(i[a]=o[a])}function hn(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(hn).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Cn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const $t=Tt({__forward_ref__:Tt});function nr(i){return i.__forward_ref__=nr,i.toString=function(){return hn(this())},i}function rn(i){return Qt(i)?i():i}function Qt(i){return"function"==typeof i&&i.hasOwnProperty($t)&&i.__forward_ref__===nr}class xt extends Error{constructor(o,a){super(function sr(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}(o,a)),this.code=o}}function At(i){return"string"==typeof i?i:null==i?"":String(i)}function ot(i,o){throw new xt(-201,!1)}function hr(i,o){null==i&&function Vn(i,o,a,d){throw new Error(`ASSERTION ERROR: ${i}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,i,null,"!=")}function Mr(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function si(i){return{providers:i.providers||[],imports:i.imports||[]}}function Gi(i){return mn(i,io)||mn(i,Qr)}function Bn(i){return null!==Gi(i)}function mn(i,o){return i.hasOwnProperty(o)?i[o]:null}function Oi(i){return i&&(i.hasOwnProperty(Xo)||i.hasOwnProperty(ft))?i[Xo]:null}const io=Tt({\u0275prov:Tt}),Xo=Tt({\u0275inj:Tt}),Qr=Tt({ngInjectableDef:Tt}),ft=Tt({ngInjectorDef:Tt});var _e=(()=>((_e=_e||{})[_e.Default=0]="Default",_e[_e.Host=1]="Host",_e[_e.Self=2]="Self",_e[_e.SkipSelf=4]="SkipSelf",_e[_e.Optional=8]="Optional",_e))();let xe;function it(i){const o=xe;return xe=i,o}function cn(i,o,a){const d=Gi(i);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&_e.Optional?null:void 0!==o?o:void ot(hn(i))}function ar(i){return{toString:i}.toString()}var yn=(()=>((yn=yn||{})[yn.OnPush=0]="OnPush",yn[yn.Default=1]="Default",yn))(),ai=(()=>{return(i=ai||(ai={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",ai;var i})();const gn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Wr={},kn=[],Ar=Tt({\u0275cmp:Tt}),bn=Tt({\u0275dir:Tt}),Fi=Tt({\u0275pipe:Tt}),ue=Tt({\u0275mod:Tt}),G=Tt({\u0275fac:Tt}),q=Tt({__NG_ELEMENT_ID__:Tt});let he=0;function ge(i){return ar(()=>{const a=!0===i.standalone,d={},g={type:i.type,providersResolver:null,decls:i.decls,vars:i.vars,factory:null,template:i.template||null,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:d,inputs:null,outputs:null,exportAs:i.exportAs||null,onPush:i.changeDetection===yn.OnPush,directiveDefs:null,pipeDefs:null,standalone:a,dependencies:a&&i.dependencies||null,getStandaloneInjector:null,selectors:i.selectors||kn,viewQuery:i.viewQuery||null,features:i.features||null,data:i.data||{},encapsulation:i.encapsulation||ai.Emulated,id:"c"+he++,styles:i.styles||kn,_:null,setInput:null,schemas:i.schemas||null,tView:null},x=i.dependencies,D=i.features;return g.inputs=pt(i.inputs,d),g.outputs=pt(i.outputs),D&&D.forEach(P=>P(g)),g.directiveDefs=x?()=>("function"==typeof x?x():x).map(Ue).filter(Ne):null,g.pipeDefs=x?()=>("function"==typeof x?x():x).map(je).filter(Ne):null,g})}function Ue(i){return oe(i)||Oe(i)}function Ne(i){return null!==i}function Re(i){return ar(()=>({type:i.type,bootstrap:i.bootstrap||kn,declarations:i.declarations||kn,imports:i.imports||kn,exports:i.exports||kn,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function pt(i,o){if(null==i)return Wr;const a={};for(const d in i)if(i.hasOwnProperty(d)){let g=i[d],x=g;Array.isArray(g)&&(x=g[1],g=g[0]),a[g]=d,o&&(o[g]=x)}return a}const Ee=ge;function le(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function oe(i){return i[Ar]||null}function Oe(i){return i[bn]||null}function je(i){return i[Fi]||null}function It(i){const o=oe(i)||Oe(i)||je(i);return null!==o&&o.standalone}function Ut(i,o){const a=i[ue]||null;if(!a&&!0===o)throw new Error(`Type ${hn(i)} does not have '\u0275mod' property.`);return a}function Di(i){return Array.isArray(i)&&"object"==typeof i[1]}function Xr(i){return Array.isArray(i)&&!0===i[1]}function Ci(i){return 0!=(8&i.flags)}function gr(i){return 2==(2&i.flags)}function Yo(i){return 1==(1&i.flags)}function gi(i){return null!==i.template}function ei(i){return 0!=(256&i[2])}function Bo(i,o){return i.hasOwnProperty(G)?i[G]:null}class ls{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function aa(){return Ua}function Ua(i){return i.type.prototype.ngOnChanges&&(i.setInput=nc),Tl}function Tl(){const i=Dl(this),o=i?.current;if(o){const a=i.previous;if(a===Wr)i.previous=o;else for(let d in o)a[d]=o[d];i.current=null,this.ngOnChanges(o)}}function nc(i,o,a,d){const g=Dl(i)||function Fs(i,o){return i[Ki]=o}(i,{previous:Wr,current:null}),x=g.current||(g.current={}),D=g.previous,P=this.declaredInputs[a],O=D[P];x[P]=new ls(O&&O.currentValue,o,D===Wr),i[d]=o}aa.ngInherit=!0;const Ki="__ngSimpleChanges__";function Dl(i){return i[Ki]||null}function Hn(i){for(;Array.isArray(i);)i=i[0];return i}function lr(i,o){return Hn(o[i])}function Zi(i,o){return Hn(o[i.index])}function Ns(i,o){return i.data[o]}function Ni(i,o){const a=o[i];return Di(a)?a:a[0]}function Va(i){return 4==(4&i[2])}function ca(i){return 64==(64&i[2])}function jo(i,o){return null==o?null:i[o]}function go(i){i[18]=0}function ws(i,o){i[5]+=o;let a=i,d=i[3];for(;null!==d&&(1===o&&1===a[5]||-1===o&&0===a[5]);)d[5]+=o,a=d,d=d[3]}const Pn={lFrame:Dt(null),bindingsEnabled:!0};function Ga(){return Pn.bindingsEnabled}function St(){return Pn.lFrame.lView}function Gn(){return Pn.lFrame.tView}function ti(){let i=Si();for(;null!==i&&64===i.type;)i=i.parent;return i}function Si(){return Pn.lFrame.currentTNode}function _o(i,o){const a=Pn.lFrame;a.currentTNode=i,a.isParent=o}function js(){return Pn.lFrame.isParent}function Io(){return Pn.lFrame.bindingIndex++}function Bc(i,o){const a=Pn.lFrame;a.bindingIndex=a.bindingRootIndex=i,Za(o)}function Za(i){Pn.lFrame.currentDirectiveIndex=i}function F(){return Pn.lFrame.currentQueryIndex}function W(i){Pn.lFrame.currentQueryIndex=i}function B(i){const o=i[1];return 2===o.type?o.declTNode:1===o.type?i[6]:null}function Q(i,o,a){if(a&_e.SkipSelf){let g=o,x=i;for(;!(g=g.parent,null!==g||a&_e.Host||(g=B(x),null===g||(x=x[15],10&g.type))););if(null===g)return!1;o=g,i=x}const d=Pn.lFrame=rt();return d.currentTNode=o,d.lView=i,!0}function Me(i){const o=rt(),a=i[1];Pn.lFrame=o,o.currentTNode=a.firstChild,o.lView=i,o.tView=a,o.contextLView=i,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function rt(){const i=Pn.lFrame,o=null===i?null:i.child;return null===o?Dt(i):o}function Dt(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function sn(){const i=Pn.lFrame;return Pn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const xr=sn;function fr(){const i=sn();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Nn(){return Pn.lFrame.selectedIndex}function ir(i){Pn.lFrame.selectedIndex=i}function Yn(){const i=Pn.lFrame;return Ns(i.tView,i.selectedIndex)}function Vs(i,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const x=i.data[a].type.prototype,{ngAfterContentInit:D,ngAfterContentChecked:P,ngAfterViewInit:O,ngAfterViewChecked:$,ngOnDestroy:J}=x;D&&(i.contentHooks||(i.contentHooks=[])).push(-a,D),P&&((i.contentHooks||(i.contentHooks=[])).push(a,P),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(a,P)),O&&(i.viewHooks||(i.viewHooks=[])).push(-a,O),$&&((i.viewHooks||(i.viewHooks=[])).push(a,$),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(a,$)),null!=J&&(i.destroyHooks||(i.destroyHooks=[])).push(a,J)}}function $s(i,o,a){$o(i,o,3,a)}function Gs(i,o,a,d){(3&i[2])===a&&$o(i,o,a,d)}function Nc(i,o){let a=i[2];(3&a)===o&&(a&=2047,a+=1,i[2]=a)}function $o(i,o,a,d){const x=d??-1,D=o.length-1;let P=0;for(let O=void 0!==d?65535&i[18]:0;O<D;O++)if("number"==typeof o[O+1]){if(P=o[O],null!=d&&P>=d)break}else o[O]<0&&(i[18]+=65536),(P<x||-1==x)&&(Uc(i,a,o,O),i[18]=(4294901760&i[18])+O+2),O++}function Uc(i,o,a,d){const g=a[d]<0,x=a[d+1],P=i[g?-a[d]:a[d]];if(g){if(i[2]>>11<i[18]>>16&&(3&i[2])===o){i[2]+=2048;try{x.call(P)}finally{}}}else try{x.call(P)}finally{}}class fa{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function Xi(i,o,a){let d=0;for(;d<a.length;){const g=a[d];if("number"==typeof g){if(0!==g)break;d++;const x=a[d++],D=a[d++],P=a[d++];i.setAttribute(o,D,P,x)}else{const x=g,D=a[++d];Pl(x)?i.setProperty(o,x,D):i.setAttribute(o,x,D),d++}}return d}function Al(i){return 3===i||4===i||6===i}function Pl(i){return 64===i.charCodeAt(0)}function Hs(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const g=o[d];"number"==typeof g?a=g:0===a||Go(i,a,g,null,-1===a||2===a?o[++d]:null)}}return i}function Go(i,o,a,d,g){let x=0,D=i.length;if(-1===o)D=-1;else for(;x<i.length;){const P=i[x++];if("number"==typeof P){if(P===o){D=-1;break}if(P>o){D=x-1;break}}}for(;x<i.length;){const P=i[x];if("number"==typeof P)break;if(P===a){if(null===d)return void(null!==g&&(i[x+1]=g));if(d===i[x+1])return void(i[x+2]=g)}x++,null!==d&&x++,null!==g&&x++}-1!==D&&(i.splice(D,0,o),x=D+1),i.splice(x++,0,a),null!==d&&i.splice(x++,0,d),null!==g&&i.splice(x++,0,g)}function cc(i){return-1!==i}function ds(i){return 32767&i}function fs(i,o){let a=function Rl(i){return i>>16}(i),d=o;for(;a>0;)d=d[15],a--;return d}let kl=!0;function Zs(i){const o=kl;return kl=i,o}let yu=0;const Mo={};function Is(i,o){const a=Ai(i,o);if(-1!==a)return a;const d=o[1];d.firstCreatePass&&(i.injectorIndex=o.length,ps(d.data,i),ps(o,null),ps(d.blueprint,null));const g=Qo(i,o),x=i.injectorIndex;if(cc(g)){const D=ds(g),P=fs(g,o),O=P[1].data;for(let $=0;$<8;$++)o[x+$]=P[D+$]|O[D+$]}return o[x+8]=g,x}function ps(i,o){i.push(0,0,0,0,0,0,0,0,o)}function Ai(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function Qo(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let a=0,d=null,g=o;for(;null!==g;){if(d=es(g),null===d)return-1;if(a++,g=g[15],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return-1}function ga(i,o,a){!function Vc(i,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty(q)&&(d=a[q]),null==d&&(d=a[q]=yu++);const g=255&d;o.data[i+(g>>5)]|=1<<g}(i,o,a)}function $c(i,o,a){if(a&_e.Optional)return i;ot()}function Ya(i,o,a,d){if(a&_e.Optional&&void 0===d&&(d=null),0==(a&(_e.Self|_e.Host))){const g=i[9],x=it(void 0);try{return g?g.get(o,d,a&_e.Optional):cn(o,d,a&_e.Optional)}finally{it(x)}}return $c(d,0,a)}function Ll(i,o,a,d=_e.Default,g){if(null!==i){if(1024&o[2]){const D=function xu(i,o,a,d,g){let x=i,D=o;for(;null!==x&&null!==D&&1024&D[2]&&!(256&D[2]);){const P=_a(x,D,a,d|_e.Self,Mo);if(P!==Mo)return P;let O=x.parent;if(!O){const $=D[21];if($){const J=$.get(a,Mo,d);if(J!==Mo)return J}O=es(D),D=D[15]}x=O}return g}(i,o,a,d,Mo);if(D!==Mo)return D}const x=_a(i,o,a,d,Mo);if(x!==Mo)return x}return Ya(o,a,d,g)}function _a(i,o,a,d,g){const x=function Fl(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(q)?i[q]:void 0;return"number"==typeof o?o>=0?255&o:Gc:o}(a);if("function"==typeof x){if(!Q(o,i,d))return d&_e.Host?$c(g,0,d):Ya(o,a,d,g);try{const D=x(d);if(null!=D||d&_e.Optional)return D;ot()}finally{xr()}}else if("number"==typeof x){let D=null,P=Ai(i,o),O=-1,$=d&_e.Host?o[16][6]:null;for((-1===P||d&_e.SkipSelf)&&(O=-1===P?Qo(i,o):o[P+8],-1!==O&&hc(d,!1)?(D=o[1],P=ds(O),o=fs(O,o)):P=-1);-1!==P;){const J=o[1];if(Pi(x,P,J.data)){const pe=uc(P,o,a,D,d,$);if(pe!==Mo)return pe}O=o[P+8],-1!==O&&hc(d,o[1].data[P+8]===$)&&Pi(x,P,o)?(D=J,P=ds(O),o=fs(O,o)):P=-1}}return g}function uc(i,o,a,d,g,x){const D=o[1],P=D.data[i+8],J=Ol(P,D,a,null==d?gr(P)&&kl:d!=D&&0!=(3&P.type),g&_e.Host&&x===P);return null!==J?Ka(o,D,J,P):Mo}function Ol(i,o,a,d,g){const x=i.providerIndexes,D=o.data,P=1048575&x,O=i.directiveStart,J=x>>20,ze=g?P+J:i.directiveEnd;for(let qe=d?P:P+J;qe<ze;qe++){const Et=D[qe];if(qe<O&&a===Et||qe>=O&&Et.type===a)return qe}if(g){const qe=D[O];if(qe&&gi(qe)&&qe.type===a)return O}return null}function Ka(i,o,a,d){let g=i[a];const x=o.data;if(function ac(i){return i instanceof fa}(g)){const D=g;D.resolving&&function en(i,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new xt(-200,`Circular dependency in DI detected for ${i}${a}`)}(function Ct(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():At(i)}(x[a]));const P=Zs(D.canSeeViewProviders);D.resolving=!0;const O=D.injectImpl?it(D.injectImpl):null;Q(i,d,_e.Default);try{g=i[a]=D.factory(void 0,x,i,d),o.firstCreatePass&&a>=d.directiveStart&&function Ds(i,o,a){const{ngOnChanges:d,ngOnInit:g,ngDoCheck:x}=o.type.prototype;if(d){const D=Ua(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(i,D),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,D)}g&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-i,g),x&&((a.preOrderHooks||(a.preOrderHooks=[])).push(i,x),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,x))}(a,x[a],o)}finally{null!==O&&it(O),Zs(P),D.resolving=!1,xr()}}return g}function Pi(i,o,a){return!!(a[o+(i>>5)]&1<<i)}function hc(i,o){return!(i&_e.Self||i&_e.Host&&o)}class ci{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return Ll(this._tNode,this._lView,o,d,a)}}function Gc(){return new ci(ti(),St())}function ya(i){return ar(()=>{const o=i.prototype.constructor,a=o[G]||Ja(o),d=Object.prototype;let g=Object.getPrototypeOf(i.prototype).constructor;for(;g&&g!==d;){const x=g[G]||Ja(g);if(x&&x!==a)return x;g=Object.getPrototypeOf(g)}return x=>new x})}function Ja(i){return Qt(i)?()=>{const o=Ja(rn(i));return o&&o()}:Bo(i)}function es(i){const o=i[1],a=o.type;return 2===a?o.declTNode:1===a?i[6]:null}function dc(i){return function vu(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const a=i.attrs;if(a){const d=a.length;let g=0;for(;g<d;){const x=a[g];if(Al(x))break;if(0===x)g+=2;else if("number"==typeof x)for(g++;g<d&&"string"==typeof a[g];)g++;else{if(x===o)return a[g+1];g+=2}}}return null}(ti(),i)}const Yi="__parameters__";function Qa(i,o,a){return ar(()=>{const d=function va(i){return function(...a){if(i){const d=i(...a);for(const g in d)this[g]=d[g]}}}(o);function g(...x){if(this instanceof g)return d.apply(this,x),this;const D=new g(...x);return P.annotation=D,P;function P(O,$,J){const pe=O.hasOwnProperty(Yi)?O[Yi]:Object.defineProperty(O,Yi,{value:[]})[Yi];for(;pe.length<=J;)pe.push(null);return(pe[J]=pe[J]||[]).push(D),O}}return a&&(g.prototype=Object.create(a.prototype)),g.prototype.ngMetadataName=i,g.annotationCls=g,g})}class Rr{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Mr({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function oo(i,o){void 0===o&&(o=i);for(let a=0;a<i.length;a++){let d=i[a];Array.isArray(d)?(o===i&&(o=i.slice(0,a)),oo(d,o)):o!==i&&o.push(d)}return o}function Ao(i,o){i.forEach(a=>Array.isArray(a)?Ao(a,o):o(a))}function zl(i,o,a){o>=i.length?i.push(a):i.splice(o,0,a)}function Bl(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function T(i,o,a){let d=U(i,o);return d>=0?i[1|d]=a:(d=~d,function Tu(i,o,a,d){let g=i.length;if(g==o)i.push(a,d);else if(1===g)i.push(d,i[0]),i[0]=a;else{for(g--,i.push(i[g-1],i[g]);g>o;)i[g]=i[g-2],g--;i[o]=a,i[o+1]=d}}(i,d,o,a)),d}function k(i,o){const a=U(i,o);if(a>=0)return i[1|a]}function U(i,o){return function me(i,o,a){let d=0,g=i.length>>a;for(;g!==d;){const x=d+(g-d>>1),D=i[x<<a];if(o===D)return x<<a;D>o?g=x:d=x+1}return~(g<<a)}(i,o,1)}const A={},z="__NG_DI_FLAG__",N="ngTempTokenPath",K=/\n/gm,re="__source";let ne;function ie(i){const o=ne;return ne=i,o}function te(i,o=_e.Default){if(void 0===ne)throw new xt(-203,!1);return null===ne?cn(i,void 0,o):ne.get(i,o&_e.Optional?null:void 0,o)}function ae(i,o=_e.Default){return(function ct(){return xe}()||te)(rn(i),o)}function ke(i,o=_e.Default){return"number"!=typeof o&&(o=0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)),ae(i,o)}function Se(i){const o=[];for(let a=0;a<i.length;a++){const d=rn(i[a]);if(Array.isArray(d)){if(0===d.length)throw new xt(900,!1);let g,x=_e.Default;for(let D=0;D<d.length;D++){const P=d[D],O=Ae(P);"number"==typeof O?-1===O?g=P.token:x|=O:g=P}o.push(ae(g,x))}else o.push(ae(d))}return o}function ve(i,o){return i[z]=o,i.prototype[z]=o,i}function Ae(i){return i[z]}const Mt=ve(Qa("Optional"),8),at=ve(Qa("SkipSelf"),4);let eo;function Vr(i){eo=i}class tf{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function jl(i){return i instanceof tf?i.changingThisBreaksApplicationSecurity:i}const Kh=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var an=(()=>((an=an||{})[an.NONE=0]="NONE",an[an.HTML=1]="HTML",an[an.STYLE=2]="STYLE",an[an.SCRIPT=3]="SCRIPT",an[an.URL=4]="URL",an[an.RESOURCE_URL=5]="RESOURCE_URL",an))();function Cr(i){const o=function xs(){const i=St();return i&&i[12]}();return o?o.sanitize(an.URL,i)||"":function Du(i,o){const a=function Fp(i){return i instanceof tf&&i.getTypeName()||null}(i);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(i,"URL")?jl(i):function Js(i){return(i=String(i)).match(Kh)?i:"unsafe:"+i}(At(i))}const Qh=new Rr("ENVIRONMENT_INITIALIZER"),Kc=new Rr("INJECTOR",-1),ed=new Rr("INJECTOR_DEF_TYPES");class cf{get(o,a=A){if(a===A){const d=new Error(`NullInjectorError: No provider for ${hn(o)}!`);throw d.name="NullInjectorError",d}return a}}function uf(...i){return{\u0275providers:Hp(0,i)}}function Hp(i,...o){const a=[],d=new Set;let g;return Ao(o,x=>{const D=x;nd(D,a,[],d)&&(g||(g=[]),g.push(D))}),void 0!==g&&td(g,a),a}function td(i,o){for(let a=0;a<i.length;a++){const{providers:g}=i[a];Ao(g,x=>{o.push(x)})}}function nd(i,o,a,d){if(!(i=rn(i)))return!1;let g=null,x=Oi(i);const D=!x&&oe(i);if(x||D){if(D&&!D.standalone)return!1;g=i}else{const O=i.ngModule;if(x=Oi(O),!x)return!1;g=O}const P=d.has(g);if(D){if(P)return!1;if(d.add(g),D.dependencies){const O="function"==typeof D.dependencies?D.dependencies():D.dependencies;for(const $ of O)nd($,o,a,d)}}else{if(!x)return!1;{if(null!=x.imports&&!P){let $;d.add(g);try{Ao(x.imports,J=>{nd(J,o,a,d)&&($||($=[]),$.push(J))})}finally{}void 0!==$&&td($,o)}if(!P){const $=Bo(g)||(()=>new g);o.push({provide:g,useFactory:$,deps:kn},{provide:ed,useValue:g,multi:!0},{provide:Qh,useValue:()=>ae(g),multi:!0})}const O=x.providers;null==O||P||Ao(O,J=>{o.push(J)})}}return g!==i&&void 0!==i.providers}const $l=Tt({provide:String,useValue:Tt});function Gl(i){return null!==i&&"object"==typeof i&&$l in i}function Hl(i){return"function"==typeof i}const hf=new Rr("Set Injector scope."),dh={},Fg={};let fh;function rd(){return void 0===fh&&(fh=new cf),fh}class Zl{}class df extends Zl{constructor(o,a,d,g){super(),this.parent=a,this.source=d,this.scopes=g,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,ff(o,D=>this.processProvider(D)),this.records.set(Kc,Ea(void 0,this)),g.has("environment")&&this.records.set(Zl,Ea(void 0,this));const x=this.records.get(hf);null!=x&&"string"==typeof x.value&&this.scopes.add(x.value),this.injectorDefTypes=new Set(this.get(ed.multi,kn,_e.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const a=ie(this),d=it(void 0);try{return o()}finally{ie(a),it(d)}}get(o,a=A,d=_e.Default){this.assertNotDestroyed();const g=ie(this),x=it(void 0);try{if(!(d&_e.SkipSelf)){let P=this.records.get(o);if(void 0===P){const O=function Yp(i){return"function"==typeof i||"object"==typeof i&&i instanceof Rr}(o)&&Gi(o);P=O&&this.injectableDefInScope(O)?Ea(id(o),dh):null,this.records.set(o,P)}if(null!=P)return this.hydrate(o,P)}return(d&_e.Self?rd():this.parent).get(o,a=d&_e.Optional&&a===A?null:a)}catch(D){if("NullInjectorError"===D.name){if((D[N]=D[N]||[]).unshift(hn(o)),g)throw D;return function Ce(i,o,a,d){const g=i[N];throw o[re]&&g.unshift(o[re]),i.message=function Be(i,o,a,d=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let g=hn(o);if(Array.isArray(o))g=o.map(hn).join(" -> ");else if("object"==typeof o){let x=[];for(let D in o)if(o.hasOwnProperty(D)){let P=o[D];x.push(D+":"+("string"==typeof P?JSON.stringify(P):hn(P)))}g=`{${x.join(", ")}}`}return`${a}${d?"("+d+")":""}[${g}]: ${i.replace(K,"\n  ")}`}("\n"+i.message,g,a,d),i.ngTokenPath=g,i[N]=null,i}(D,o,"R3InjectorError",this.source)}throw D}finally{it(x),ie(g)}}resolveInjectorInitializers(){const o=ie(this),a=it(void 0);try{const d=this.get(Qh.multi,kn,_e.Self);for(const g of d)g()}finally{ie(o),it(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(hn(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new xt(205,!1)}processProvider(o){let a=Hl(o=rn(o))?o:rn(o&&o.provide);const d=function Wp(i){return Gl(i)?Ea(void 0,i.useValue):Ea(qp(i),dh)}(o);if(Hl(o)||!0!==o.multi)this.records.get(a);else{let g=this.records.get(a);g||(g=Ea(void 0,dh,!0),g.factory=()=>Se(g.multi),this.records.set(a,g)),a=o,g.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===dh&&(a.value=Fg,a.value=a.factory()),"object"==typeof a.value&&a.value&&function Xp(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=rn(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function id(i){const o=Gi(i),a=null!==o?o.factory:Bo(i);if(null!==a)return a;if(i instanceof Rr)throw new xt(204,!1);if(i instanceof Function)return function Jc(i){const o=i.length;if(o>0)throw function nl(i,o){const a=[];for(let d=0;d<i;d++)a.push(o);return a}(o,"?"),new xt(204,!1);const a=function pi(i){const o=i&&(i[io]||i[Qr]);if(o){const a=function fo(i){if(i.hasOwnProperty("name"))return i.name;const o=(""+i).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(i);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(i);return null!==a?()=>a.factory(i):()=>new i}(i);throw new xt(204,!1)}function qp(i,o,a){let d;if(Hl(i)){const g=rn(i);return Bo(g)||id(g)}if(Gl(i))d=()=>rn(i.useValue);else if(function hh(i){return!(!i||!i.useFactory)}(i))d=()=>i.useFactory(...Se(i.deps||[]));else if(function uh(i){return!(!i||!i.useExisting)}(i))d=()=>ae(rn(i.useExisting));else{const g=rn(i&&(i.useClass||i.provide));if(!function od(i){return!!i.deps}(i))return Bo(g)||id(g);d=()=>new g(...Se(i.deps))}return d}function Ea(i,o,a=!1){return{factory:i,value:o,multi:a?[]:void 0}}function zg(i){return!!i.\u0275providers}function ff(i,o){for(const a of i)Array.isArray(a)?ff(a,o):zg(a)?ff(a.\u0275providers,o):o(a)}class ns{}class Su{resolveComponentFactory(o){throw function Kp(i){const o=Error(`No component factory found for ${hn(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let Wl=(()=>{class i{}return i.NULL=new Su,i})();function Qc(){return gc(ti(),St())}function gc(i,o){return new _c(Zi(i,o))}let _c=(()=>{class i{constructor(a){this.nativeElement=a}}return i.__NG_ELEMENT_ID__=Qc,i})();function Qp(i){return i instanceof _c?i.nativeElement:i}class em{}let pf=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function tm(){const i=St(),a=Ni(ti().index,i);return(Di(a)?a:i)[11]}(),i})(),ph=(()=>{class i{}return i.\u0275prov=Mr({token:i,providedIn:"root",factory:()=>null}),i})();class eu{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const yc=new eu("14.2.1"),mh={};function cd(i){return i.ngOriginalError}class tu{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&cd(o);for(;a&&cd(a);)a=cd(a);return a||null}}const ud=new Map;let am=0;const Df="__ngContext__";function lo(i,o){Di(o)?(i[Df]=o[20],function Ef(i){ud.set(i[20],i)}(o)):i[Df]=o}function _h(i){const o=i[Df];return"number"==typeof o?function al(i){return ud.get(i)||null}(o):o||null}function Mu(i){const o=_h(i);return o?Di(o)?o:o.lView:null}function ql(i){return i instanceof Function?i():i}var Sa=(()=>((Sa=Sa||{})[Sa.Important=1]="Important",Sa[Sa.DashCase=2]="DashCase",Sa))();function ru(i,o){return undefined(i,o)}function Pu(i){const o=i[3];return Xr(o)?o[3]:o}function xh(i){return md(i[13])}function Mf(i){return md(i[4])}function md(i){for(;null!==i&&!Xr(i);)i=i[4];return i}function Xl(i,o,a,d,g){if(null!=d){let x,D=!1;Xr(d)?x=d:Di(d)&&(D=!0,d=d[0]);const P=Hn(d);0===i&&null!==a?null==g?ku(o,a,P):Ma(o,a,P,g||null,!0):1===i&&null!==a?Ma(o,a,P,g||null,!0):2===i?function Uf(i,o,a){const d=yd(i,o);d&&function bh(i,o,a,d){i.removeChild(o,a,d)}(i,d,o,a)}(o,P,D):3===i&&o.destroyNode(P),null!=x&&function wd(i,o,a,d,g){const x=a[7];x!==Hn(a)&&Xl(o,i,d,x,g);for(let P=10;P<a.length;P++){const O=a[P];Yl(O[1],O,i,o,d,x)}}(o,i,x,a,g)}}function Pf(i,o,a){return i.createElement(o,a)}function Rf(i,o){const a=i[9],d=a.indexOf(o),g=o[3];512&o[2]&&(o[2]&=-513,ws(g,-1)),a.splice(d,1)}function gd(i,o){if(i.length<=10)return;const a=10+o,d=i[a];if(d){const g=d[17];null!==g&&g!==i&&Rf(g,d),o>0&&(i[a-1][4]=d[4]);const x=Bl(i,10+o);!function e_(i,o){Yl(i,o,o[11],2,null,null),o[0]=null,o[6]=null}(d[1],d);const D=x[19];null!==D&&D.detachView(x[1]),d[3]=null,d[4]=null,d[2]&=-65}return d}function gm(i,o){if(!(128&o[2])){const a=o[11];a.destroyNode&&Yl(i,o,a,3,null,null),function Ru(i){let o=i[13];if(!o)return kf(i[1],i);for(;o;){let a=null;if(Di(o))a=o[13];else{const d=o[10];d&&(a=d)}if(!a){for(;o&&!o[4]&&o!==i;)Di(o)&&kf(o[1],o),o=o[3];null===o&&(o=i),Di(o)&&kf(o[1],o),a=o&&o[4]}o=a}}(o)}}function kf(i,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function _d(i,o){let a;if(null!=i&&null!=(a=i.destroyHooks))for(let d=0;d<a.length;d+=2){const g=o[a[d]];if(!(g instanceof fa)){const x=a[d+1];if(Array.isArray(x))for(let D=0;D<x.length;D+=2){const P=g[x[D]],O=x[D+1];try{O.call(P)}finally{}}else try{x.call(g)}finally{}}}}(i,o),function iu(i,o){const a=i.cleanup,d=o[7];let g=-1;if(null!==a)for(let x=0;x<a.length-1;x+=2)if("string"==typeof a[x]){const D=a[x+1],P="function"==typeof D?D(o):Hn(o[D]),O=d[g=a[x+2]],$=a[x+3];"boolean"==typeof $?P.removeEventListener(a[x],O,$):$>=0?d[g=$]():d[g=-$].unsubscribe(),x+=2}else{const D=d[g=a[x+1]];a[x].call(D)}if(null!==d){for(let x=g+1;x<d.length;x++)(0,d[x])();o[7]=null}}(i,o),1===o[1].type&&o[11].destroy();const a=o[17];if(null!==a&&Xr(o[3])){a!==o[3]&&Rf(a,o);const d=o[19];null!==d&&d.detachView(i)}!function bs(i){ud.delete(i[20])}(o)}}function _m(i,o,a){return function ym(i,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[0];if(2&d.flags){const g=i.data[d.directiveStart].encapsulation;if(g===ai.None||g===ai.Emulated)return null}return Zi(d,a)}(i,o.parent,a)}function Ma(i,o,a,d,g){i.insertBefore(o,a,d,g)}function ku(i,o,a){i.appendChild(o,a)}function Lf(i,o,a,d,g){null!==d?Ma(i,o,a,d,g):ku(i,o,a)}function yd(i,o){return i.parentNode(o)}let zf=function Ff(i,o,a){return 40&i.type?Zi(i,a):null};function xd(i,o,a,d){const g=_m(i,d,o),x=o[11],P=function Of(i,o,a){return zf(i,o,a)}(d.parent||o[6],d,o);if(null!=g)if(Array.isArray(a))for(let O=0;O<a.length;O++)Lf(x,g,a[O],P,!1);else Lf(x,g,a,P,!1)}function bd(i,o){if(null!==o){const a=o.type;if(3&a)return Zi(o,i);if(4&a)return Lu(-1,i[o.index]);if(8&a){const d=o.child;if(null!==d)return bd(i,d);{const g=i[o.index];return Xr(g)?Lu(-1,g):Hn(g)}}if(32&a)return ru(o,i)()||Hn(i[o.index]);{const d=Nf(i,o);return null!==d?Array.isArray(d)?d[0]:bd(Pu(i[16]),d):bd(i,o.next)}}return null}function Nf(i,o){return null!==o?i[16][6].projection[o.projection]:null}function Lu(i,o){const a=10+i+1;if(a<o.length){const d=o[a],g=d[1].firstChild;if(null!==g)return bd(d,g)}return o[7]}function xo(i,o,a,d,g,x,D){for(;null!=a;){const P=d[a.index],O=a.type;if(D&&0===o&&(P&&lo(Hn(P),d),a.flags|=4),64!=(64&a.flags))if(8&O)xo(i,o,a.child,d,g,x,!1),Xl(o,i,g,P,x);else if(32&O){const $=ru(a,d);let J;for(;J=$();)Xl(o,i,g,J,x);Xl(o,i,g,P,x)}else 16&O?jf(i,o,d,a,g,x):Xl(o,i,g,P,x);a=D?a.projectionNext:a.next}}function Yl(i,o,a,d,g,x){xo(a,d,i.firstChild,o,g,x,!1)}function jf(i,o,a,d,g,x){const D=a[16],O=D[6].projection[d.projection];if(Array.isArray(O))for(let $=0;$<O.length;$++)Xl(o,i,g,O[$],x);else xo(i,o,O,D[3],g,x,!0)}function bm(i,o,a){i.setAttribute(o,"style",a)}function Vf(i,o,a){""===a?i.removeAttribute(o,"class"):i.setAttribute(o,"class",a)}function wm(i,o,a){let d=i.length;for(;;){const g=i.indexOf(o,a);if(-1===g)return g;if(0===g||i.charCodeAt(g-1)<=32){const x=o.length;if(g+x===d||i.charCodeAt(g+x)<=32)return g}a=g+1}}const Em="ng-template";function o_(i,o,a){let d=0;for(;d<i.length;){let g=i[d++];if(a&&"class"===g){if(g=i[d],-1!==wm(g.toLowerCase(),o,0))return!0}else if(1===g){for(;d<i.length&&"string"==typeof(g=i[d++]);)if(g.toLowerCase()===o)return!0;return!1}}return!1}function Eh(i){return 4===i.type&&i.value!==Em}function s_(i,o,a){return o===(4!==i.type||a?i.value:Em)}function Tm(i,o,a){let d=4;const g=i.attrs||[],x=function l_(i){for(let o=0;o<i.length;o++)if(Al(i[o]))return o;return i.length}(g);let D=!1;for(let P=0;P<o.length;P++){const O=o[P];if("number"!=typeof O){if(!D)if(4&d){if(d=2|1&d,""!==O&&!s_(i,O,a)||""===O&&1===o.length){if(ta(d))return!1;D=!0}}else{const $=8&d?O:o[++P];if(8&d&&null!==i.attrs){if(!o_(i.attrs,$,a)){if(ta(d))return!1;D=!0}continue}const pe=Dm(8&d?"class":O,g,Eh(i),a);if(-1===pe){if(ta(d))return!1;D=!0;continue}if(""!==$){let ze;ze=pe>x?"":g[pe+1].toLowerCase();const qe=8&d?ze:null;if(qe&&-1!==wm(qe,$,0)||2&d&&$!==ze){if(ta(d))return!1;D=!0}}}}else{if(!D&&!ta(d)&&!ta(O))return!1;if(D&&ta(O))continue;D=!1,d=O|1&d}}return ta(d)||D}function ta(i){return 0==(1&i)}function Dm(i,o,a,d){if(null===o)return-1;let g=0;if(d||!a){let x=!1;for(;g<o.length;){const D=o[g];if(D===i)return g;if(3===D||6===D)x=!0;else{if(1===D||2===D){let P=o[++g];for(;"string"==typeof P;)P=o[++g];continue}if(4===D)break;if(0===D){g+=4;continue}}g+=x?1:2}return-1}return function c_(i,o){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){const d=i[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,i)}function Cm(i,o,a=!1){for(let d=0;d<o.length;d++)if(Tm(i,o[d],a))return!0;return!1}function $f(i,o){return i?":not("+o.trim()+")":o}function h_(i){let o=i[0],a=1,d=2,g="",x=!1;for(;a<i.length;){let D=i[a];if("string"==typeof D)if(2&d){const P=i[++a];g+="["+D+(P.length>0?'="'+P+'"':"")+"]"}else 8&d?g+="."+D:4&d&&(g+=" "+D);else""!==g&&!ta(D)&&(o+=$f(x,g),g=""),d=D,x=x||!ta(d);a++}return""!==g&&(o+=$f(x,g)),o}const Kn={};function Th(i){ou(Gn(),St(),Nn()+i,!1)}function ou(i,o,a,d){if(!d)if(3==(3&o[2])){const x=i.preOrderCheckHooks;null!==x&&$s(o,x,a)}else{const x=i.preOrderHooks;null!==x&&Gs(o,x,0,a)}ir(a)}function Ed(i,o=null,a=null,d){const g=Hf(i,o,a,d);return g.resolveInjectorInitializers(),g}function Hf(i,o=null,a=null,d,g=new Set){const x=[a||kn,uf(i)];return d=d||("object"==typeof i?void 0:hn(i)),new df(x,o||rd(),d||null,g)}let xc=(()=>{class i{static create(a,d){if(Array.isArray(a))return Ed({name:""},d,a,"");{const g=a.name??"";return Ed({name:g},a.parent,a.providers,g)}}}return i.THROW_IF_NOT_FOUND=A,i.NULL=new cf,i.\u0275prov=Mr({token:i,providedIn:"any",factory:()=>ae(Kc)}),i.__NG_ELEMENT_ID__=-1,i})();function au(i,o=_e.Default){const a=St();return null===a?ae(i,o):Ll(ti(),a,rn(i),o)}function Sd(){throw new Error("invalid")}function Mh(i,o){return i<<17|o<<2}function Aa(i){return i>>17&32767}function Ad(i){return 2|i}function cl(i){return(131068&i)>>2}function Pd(i,o){return-131069&i|o<<2}function Kf(i){return 1|i}function Bd(i,o){const a=i.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const g=a[d],x=a[d+1];if(-1!==x){const D=i.data[x];W(g),D.contentQueries(2,o[x],x)}}}function Rh(i,o,a,d,g,x,D,P,O,$,J){const pe=o.blueprint.slice();return pe[0]=g,pe[2]=76|d,(null!==J||i&&1024&i[2])&&(pe[2]|=1024),go(pe),pe[3]=pe[15]=i,pe[8]=a,pe[10]=D||i&&i[10],pe[11]=P||i&&i[11],pe[12]=O||i&&i[12]||null,pe[9]=$||i&&i[9]||null,pe[6]=x,pe[20]=function lm(){return am++}(),pe[21]=J,pe[16]=2==o.type?i[16]:pe,pe}function Nu(i,o,a,d,g){let x=i.data[o];if(null===x)x=function Uu(i,o,a,d,g){const x=Si(),D=js(),O=i.data[o]=function Gm(i,o,a,d,g,x){return{type:a,index:d,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:x,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,D?x:x&&x.parent,a,o,d,g);return null===i.firstChild&&(i.firstChild=O),null!==x&&(D?null==x.child&&null!==O.parent&&(x.child=O):null===x.next&&(x.next=O)),O}(i,o,a,d,g),function zc(){return Pn.lFrame.inI18n}()&&(x.flags|=64);else if(64&x.type){x.type=a,x.value=d,x.attrs=g;const D=function Wi(){const i=Pn.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();x.injectorIndex=null===D?-1:D.injectorIndex}return _o(x,!0),x}function Cc(i,o,a,d){if(0===a)return-1;const g=o.length;for(let x=0;x<a;x++)o.push(d),i.blueprint.push(d),i.data.push(null);return g}function Ql(i,o,a){Me(o);try{const d=i.viewQuery;null!==d&&dp(1,d,a);const g=i.template;null!==g&&Lh(i,o,g,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Bd(i,o),i.staticViewQueries&&dp(2,i.viewQuery,a);const x=i.components;null!==x&&function jm(i,o){for(let a=0;a<o.length;a++)F_(i,o[a])}(o,x)}catch(d){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),d}finally{o[2]&=-5,fr()}}function Ic(i,o,a,d){const g=o[2];if(128!=(128&g)){Me(o);try{go(o),function hs(i){return Pn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==a&&Lh(i,o,a,2,d);const D=3==(3&g);if(D){const $=i.preOrderCheckHooks;null!==$&&$s(o,$,null)}else{const $=i.preOrderHooks;null!==$&&Gs(o,$,0,null),Nc(o,0)}if(function lp(i){for(let o=xh(i);null!==o;o=Mf(o)){if(!o[2])continue;const a=o[9];for(let d=0;d<a.length;d++){const g=a[d],x=g[3];0==(512&g[2])&&ws(x,1),g[2]|=512}}}(o),function O_(i){for(let o=xh(i);null!==o;o=Mf(o))for(let a=10;a<o.length;a++){const d=o[a],g=d[1];ca(d)&&Ic(g,d,g.template,d[8])}}(o),null!==i.contentQueries&&Bd(i,o),D){const $=i.contentCheckHooks;null!==$&&$s(o,$)}else{const $=i.contentHooks;null!==$&&Gs(o,$,1),Nc(o,1)}!function S_(i,o){const a=i.hostBindingOpCodes;if(null!==a)try{for(let d=0;d<a.length;d++){const g=a[d];if(g<0)ir(~g);else{const x=g,D=a[++d],P=a[++d];Bc(D,x),P(2,o[x])}}}finally{ir(-1)}}(i,o);const P=i.components;null!==P&&function ul(i,o){for(let a=0;a<o.length;a++)cp(i,o[a])}(o,P);const O=i.viewQuery;if(null!==O&&dp(2,O,d),D){const $=i.viewCheckHooks;null!==$&&$s(o,$)}else{const $=i.viewHooks;null!==$&&Gs(o,$,2),Nc(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,ws(o[3],-1))}finally{fr()}}}function kh(i,o,a,d){const g=o[10],D=Va(o);try{!D&&g.begin&&g.begin(),D&&Ql(i,o,d),Ic(i,o,a,d)}finally{!D&&g.end&&g.end()}}function Lh(i,o,a,d,g){const x=Nn(),D=2&d;try{ir(-1),D&&o.length>22&&ou(i,o,22,!1),a(d,g)}finally{ir(x)}}function uu(i,o,a){!Ga()||(function $u(i,o,a,d){const g=a.directiveStart,x=a.directiveEnd;i.firstCreatePass||Is(a,o),lo(d,o);const D=a.initialInputs;for(let P=g;P<x;P++){const O=i.data[P],$=gi(O);$&&k_(o,a,O);const J=Ka(o,i,P,a);lo(J,o),null!==D&&L_(0,P-g,J,O,0,D),$&&(Ni(a.index,o)[8]=J)}}(i,o,a,Zi(a,o)),128==(128&a.flags)&&function Ud(i,o,a){const d=a.directiveStart,g=a.directiveEnd,x=a.index,D=function sc(){return Pn.lFrame.currentDirectiveIndex}();try{ir(x);for(let P=d;P<g;P++){const O=i.data[P],$=o[P];Za(P),(null!==O.hostBindings||0!==O.hostVars||null!==O.hostAttrs)&&Wm(O,$)}}finally{ir(-1),Za(D)}}(i,o,a))}function Oh(i,o,a=Zi){const d=o.localNames;if(null!==d){let g=o.index+1;for(let x=0;x<d.length;x+=2){const D=d[x+1],P=-1===D?a(o,i):i[D];i[g++]=P}}}function rp(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=hu(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function hu(i,o,a,d,g,x,D,P,O,$){const J=22+d,pe=J+g,ze=function Vm(i,o){const a=[];for(let d=0;d<o;d++)a.push(d<i?null:Kn);return a}(J,pe),qe="function"==typeof $?$():$;return ze[1]={type:i,blueprint:ze,template:a,queries:null,viewQuery:P,declTNode:o,data:ze.slice().fill(null,J),bindingStartIndex:J,expandoStartIndex:pe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof x?x():x,pipeRegistry:"function"==typeof D?D():D,firstChild:null,schemas:O,consts:qe,incompleteFirstPass:!1}}function $m(i,o,a,d){const g=$d(o);null===a?g.push(d):(g.push(a),i.firstCreatePass&&Qm(i).push(d,g.length-1))}function Sc(i,o,a){for(let d in i)if(i.hasOwnProperty(d)){const g=i[d];(a=null===a?{}:a).hasOwnProperty(d)?a[d].push(o,g):a[d]=[o,g]}return a}function Hm(i,o){const d=o.directiveEnd,g=i.data,x=o.attrs,D=[];let P=null,O=null;for(let $=o.directiveStart;$<d;$++){const J=g[$],pe=J.inputs,ze=null===x||Eh(o)?null:jd(pe,x);D.push(ze),P=Sc(pe,$,P),O=Sc(J.outputs,$,O)}null!==P&&(P.hasOwnProperty("class")&&(o.flags|=16),P.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=D,o.inputs=P,o.outputs=O}function ju(i,o){const a=Ni(o,i);16&a[2]||(a[2]|=32)}function Vu(i,o,a,d){let g=!1;if(Ga()){const x=function qm(i,o,a){const d=i.directiveRegistry;let g=null;if(d)for(let x=0;x<d.length;x++){const D=d[x];Cm(a,D.selectors,!1)&&(g||(g=[]),ga(Is(a,o),i,D.type),gi(D)?(ip(i,a),g.unshift(D)):g.push(D))}return g}(i,o,a),D=null===d?null:{"":-1};if(null!==x){g=!0,Ym(a,i.data.length,x.length);for(let J=0;J<x.length;J++){const pe=x[J];pe.providersResolver&&pe.providersResolver(pe)}let P=!1,O=!1,$=Cc(i,o,x.length,null);for(let J=0;J<x.length;J++){const pe=x[J];a.mergedAttrs=Hs(a.mergedAttrs,pe.hostAttrs),op(i,a,o,$,pe),Xm($,pe,D),null!==pe.contentQueries&&(a.flags|=8),(null!==pe.hostBindings||null!==pe.hostAttrs||0!==pe.hostVars)&&(a.flags|=128);const ze=pe.type.prototype;!P&&(ze.ngOnChanges||ze.ngOnInit||ze.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(a.index),P=!0),!O&&(ze.ngOnChanges||ze.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(a.index),O=!0),$++}Hm(i,a)}D&&function R_(i,o,a){if(o){const d=i.localNames=[];for(let g=0;g<o.length;g+=2){const x=a[o[g+1]];if(null==x)throw new xt(-301,!1);d.push(o[g],x)}}}(a,d,D)}return a.mergedAttrs=Hs(a.mergedAttrs,a.attrs),g}function Zm(i,o,a,d,g,x){const D=x.hostBindings;if(D){let P=i.hostBindingOpCodes;null===P&&(P=i.hostBindingOpCodes=[]);const O=~o.index;(function P_(i){let o=i.length;for(;o>0;){const a=i[--o];if("number"==typeof a&&a<0)return a}return 0})(P)!=O&&P.push(O),P.push(d,g,D)}}function Wm(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function ip(i,o){o.flags|=2,(i.components||(i.components=[])).push(o.index)}function Xm(i,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=i;gi(o)&&(a[""]=i)}}function Ym(i,o,a){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+a,i.providerIndexes=o}function op(i,o,a,d,g){i.data[d]=g;const x=g.factory||(g.factory=Bo(g.type)),D=new fa(x,gi(g),au);i.blueprint[d]=D,a[d]=D,Zm(i,o,0,d,Cc(i,a,g.hostVars,Kn),g)}function k_(i,o,a){const d=Zi(o,i),g=rp(a),x=i[10],D=Nh(i,Rh(i,g,null,a.onPush?32:16,d,o,x,x.createRenderer(d,a),null,null,null));i[o.index]=D}function ka(i,o,a,d,g,x){const D=Zi(i,o);!function sp(i,o,a,d,g,x,D){if(null==x)i.removeAttribute(o,g,a);else{const P=null==D?At(x):D(x,d||"",g);i.setAttribute(o,g,P,a)}}(o[11],D,x,i.value,a,d,g)}function L_(i,o,a,d,g,x){const D=x[o];if(null!==D){const P=d.setInput;for(let O=0;O<D.length;){const $=D[O++],J=D[O++],pe=D[O++];null!==P?d.setInput(a,pe,$,J):a[J]=pe}}}function jd(i,o){let a=null,d=0;for(;d<o.length;){const g=o[d];if(0!==g)if(5!==g){if("number"==typeof g)break;i.hasOwnProperty(g)&&(null===a&&(a=[]),a.push(g,i[g],o[d+1])),d+=2}else d+=2;else d+=4}return a}function Bh(i,o,a,d){return new Array(i,!0,!1,o,null,0,d,a,null,null)}function cp(i,o){const a=Ni(o,i);if(ca(a)){const d=a[1];48&a[2]?Ic(d,a,d.template,a[8]):a[5]>0&&hl(a)}}function hl(i){for(let d=xh(i);null!==d;d=Mf(d))for(let g=10;g<d.length;g++){const x=d[g];if(ca(x))if(512&x[2]){const D=x[1];Ic(D,x,D.template,x[8])}else x[5]>0&&hl(x)}const a=i[1].components;if(null!==a)for(let d=0;d<a.length;d++){const g=Ni(a[d],i);ca(g)&&g[5]>0&&hl(g)}}function F_(i,o){const a=Ni(o,i),d=a[1];(function up(i,o){for(let a=o.length;a<i.blueprint.length;a++)o.push(i.blueprint[a])})(d,a),Ql(d,a,a[8])}function Nh(i,o){return i[13]?i[14][4]=o:i[13]=o,i[14]=o,o}function Gu(i){for(;i;){i[2]|=32;const o=Pu(i);if(ei(i)&&!o)return i;i=o}return null}function dp(i,o,a){W(0),o(i,a)}function $d(i){return i[7]||(i[7]=[])}function Qm(i){return i.cleanup||(i.cleanup=[])}function fp(i,o){const a=i[9],d=a?a.get(tu,null):null;d&&d.handleError(o)}function pp(i,o,a,d,g){for(let x=0;x<a.length;){const D=a[x++],P=a[x++],O=o[D],$=i.data[D];null!==$.setInput?$.setInput(O,g,d,P):O[P]=g}}function is(i,o,a){let d=a?i.styles:null,g=a?i.classes:null,x=0;if(null!==o)for(let D=0;D<o.length;D++){const P=o[D];"number"==typeof P?x=P:1==x?g=Cn(g,P):2==x&&(d=Cn(d,P+": "+o[++D]+";"))}a?i.styles=d:i.stylesWithoutHost=d,a?i.classes=g:i.classesWithoutHost=g}function Ps(i,o,a,d,g=!1){for(;null!==a;){const x=o[a.index];if(null!==x&&d.push(Hn(x)),Xr(x))for(let P=10;P<x.length;P++){const O=x[P],$=O[1].firstChild;null!==$&&Ps(O[1],O,$,d)}const D=a.type;if(8&D)Ps(i,o,a.child,d);else if(32&D){const P=ru(a,o);let O;for(;O=P();)d.push(O)}else if(16&D){const P=Nf(o,a);if(Array.isArray(P))d.push(...P);else{const O=Pu(o[16]);Ps(O[1],O,P,d,!0)}}a=g?a.projectionNext:a.next}return d}class na{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return Ps(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(Xr(o)){const a=o[8],d=a?a.indexOf(this):-1;d>-1&&(gd(o,d),Bl(a,d))}this._attachedToViewContainer=!1}gm(this._lView[1],this._lView)}onDestroy(o){$m(this._lView[1],this._lView,null,o)}markForCheck(){Gu(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){!function hp(i,o,a){const d=o[10];d.begin&&d.begin();try{Ic(i,o,i.template,a)}catch(g){throw fp(o,g),g}finally{d.end&&d.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function mm(i,o){Yl(i,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new xt(902,!1);this._appRef=o}}class fl extends na{constructor(o){super(o),this._view=o}detectChanges(){!function Km(i){!function z_(i){for(let o=0;o<i.components.length;o++){const a=i.components[o],d=Mu(a);if(null!==d){const g=d[1];kh(g,d,g.template,a)}}}(i[8])}(this._view)}checkNoChanges(){}get context(){return null}}class pl extends Wl{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=oe(o);return new Hu(a,this.ngModule)}}function Uh(i){const o=[];for(let a in i)i.hasOwnProperty(a)&&o.push({propName:i[a],templateName:a});return o}class ng{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){const g=this.injector.get(o,mh,d);return g!==mh||a===mh?g:this.parentInjector.get(o,a,d)}}class Hu extends ns{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function bo(i){return i.map(h_).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return Uh(this.componentDef.inputs)}get outputs(){return Uh(this.componentDef.outputs)}create(o,a,d,g){let x=(g=g||this.ngModule)instanceof Zl?g:g?.injector;x&&null!==this.componentDef.getStandaloneInjector&&(x=this.componentDef.getStandaloneInjector(x)||x);const D=x?new ng(o,x):o,P=D.get(em,null);if(null===P)throw new xt(407,!1);const O=D.get(ph,null),$=P.createRenderer(null,this.componentDef),J=this.componentDef.selectors[0][0]||"div",pe=d?function A_(i,o,a){return i.selectRootElement(o,a===ai.ShadowDom)}($,d,this.componentDef.encapsulation):Pf(P.createRenderer(null,this.componentDef),J,function tg(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(J)),ze=this.componentDef.onPush?288:272,qe={components:[]},Et=hu(0,null,null,1,0,null,null,null,null,null),Ft=Rh(null,Et,qe,ze,null,null,P,$,O,D,null);let on,pn;Me(Ft);try{const An=function ig(i,o,a,d,g,x){const D=a[1];a[22]=i;const O=Nu(D,22,2,"#host",null),$=O.mergedAttrs=o.hostAttrs;null!==$&&(is(O,$,!0),null!==i&&(Xi(g,i,$),null!==O.classes&&Vf(g,i,O.classes),null!==O.styles&&bm(g,i,O.styles)));const J=d.createRenderer(i,o),pe=Rh(a,rp(o),null,o.onPush?32:16,a[22],O,d,J,x||null,null,null);return D.firstCreatePass&&(ga(Is(O,a),D,o.type),ip(D,O),Ym(O,a.length,1)),Nh(a,pe),a[22]=pe}(pe,this.componentDef,Ft,P,$);if(pe)if(d)Xi($,pe,["ng-version",yc.full]);else{const{attrs:Ot,classes:Rn}=function ll(i){const o=[],a=[];let d=1,g=2;for(;d<i.length;){let x=i[d];if("string"==typeof x)2===g?""!==x&&o.push(x,i[++d]):8===g&&a.push(x);else{if(!ta(g))break;g=x}d++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);Ot&&Xi($,pe,Ot),Rn&&Rn.length>0&&Vf($,pe,Rn.join(" "))}if(pn=Ns(Et,22),void 0!==a){const Ot=pn.projection=[];for(let Rn=0;Rn<this.ngContentSelectors.length;Rn++){const kr=a[Rn];Ot.push(null!=kr?Array.from(kr):null)}}on=function og(i,o,a,d,g){const x=a[1],D=function zh(i,o,a){const d=ti();i.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),op(i,d,o,Cc(i,o,1,null),a),Hm(i,d));const g=Ka(o,i,d.directiveStart,d);lo(g,o);const x=Zi(d,o);return x&&lo(x,o),g}(x,a,o);if(d.components.push(D),i[8]=D,null!==g)for(const O of g)O(D,o);if(o.contentQueries){const O=ti();o.contentQueries(1,D,O.directiveStart)}const P=ti();return!x.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(ir(P.index),Zm(a[1],P,0,P.directiveStart,P.directiveEnd,o),Wm(o,D)),D}(An,this.componentDef,Ft,qe,[ag]),Ql(Et,Ft,null)}finally{fr()}return new rg(this.componentType,on,gc(pn,Ft),Ft,pn)}}class rg extends class sd{}{constructor(o,a,d,g,x){super(),this.location=d,this._rootLView=g,this._tNode=x,this.instance=a,this.hostView=this.changeDetectorRef=new fl(g),this.componentType=o}setInput(o,a){const d=this._tNode.inputs;let g;if(null!==d&&(g=d[o])){const x=this._rootLView;pp(x[1],x,g,o,a),ju(x,this._tNode.index)}}get injector(){return new ci(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function ag(){const i=ti();Vs(St()[1],i)}function ml(i){let o=function gp(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),a=!0;const d=[i];for(;o;){let g;if(gi(i))g=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new xt(903,!1);g=o.\u0275dir}if(g){if(a){d.push(g);const D=i;D.inputs=Zu(i.inputs),D.declaredInputs=Zu(i.declaredInputs),D.outputs=Zu(i.outputs);const P=g.hostBindings;P&&_p(i,P);const O=g.viewQuery,$=g.contentQueries;if(O&&N_(i,O),$&&Wu(i,$),xn(i.inputs,g.inputs),xn(i.declaredInputs,g.declaredInputs),xn(i.outputs,g.outputs),gi(g)&&g.data.animation){const J=i.data;J.animation=(J.animation||[]).concat(g.data.animation)}}const x=g.features;if(x)for(let D=0;D<x.length;D++){const P=x[D];P&&P.ngInherit&&P(i),P===ml&&(a=!1)}}o=Object.getPrototypeOf(o)}!function lg(i){let o=0,a=null;for(let d=i.length-1;d>=0;d--){const g=i[d];g.hostVars=o+=g.hostVars,g.hostAttrs=Hs(g.hostAttrs,a=Hs(a,g.hostAttrs))}}(d)}function Zu(i){return i===Wr?{}:i===kn?[]:i}function N_(i,o){const a=i.viewQuery;i.viewQuery=a?(d,g)=>{o(d,g),a(d,g)}:o}function Wu(i,o){const a=i.contentQueries;i.contentQueries=a?(d,g,x)=>{o(d,g,x),a(d,g,x)}:o}function _p(i,o){const a=i.hostBindings;i.hostBindings=a?(d,g)=>{o(d,g),a(d,g)}:o}let qu=null;function ko(){if(!qu){const i=gn.Symbol;if(i&&i.iterator)qu=i.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const d=o[a];"entries"!==d&&"size"!==d&&Map.prototype[d]===Map.prototype.entries&&(qu=d)}}}return qu}function Yu(i){return!!Ku(i)&&(Array.isArray(i)||!(i instanceof Map)&&ko()in i)}function Ku(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function Lo(i,o,a){return!Object.is(i[o],a)&&(i[o]=a,!0)}function Gd(i,o,a,d){const g=St();return Lo(g,Io(),o)&&(Gn(),ka(Yn(),g,i,o,a,d)),Gd}function ye(i,o,a,d,g,x,D,P){const O=St(),$=Gn(),J=i+22,pe=$.firstCreatePass?function fe(i,o,a,d,g,x,D,P,O){const $=o.consts,J=Nu(o,i,4,D||null,jo($,P));Vu(o,a,J,jo($,O)),Vs(o,J);const pe=J.tViews=hu(2,J,d,g,x,o.directiveRegistry,o.pipeRegistry,null,o.schemas,$);return null!==o.queries&&(o.queries.template(o,J),pe.queries=o.queries.embeddedTView(J)),J}(J,$,O,o,a,d,g,x,D):$.data[J];_o(pe,!1);const ze=O[11].createComment("");xd($,O,ze,pe),lo(ze,O),Nh(O,O[J]=Bh(ze,O,ze,pe)),Yo(pe)&&uu($,O,pe),null!=D&&Oh(O,pe,P)}function Je(i,o,a){const d=St();return Lo(d,Io(),o)&&function As(i,o,a,d,g,x,D,P){const O=Zi(o,a);let J,$=o.inputs;!P&&null!=$&&(J=$[d])?(pp(i,a,J,d,g),gr(o)&&ju(a,o.index)):3&o.type&&(d=function Mc(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(d),g=null!=D?D(g,o.value||"",d):g,x.setProperty(O,d,g))}(Gn(),Yn(),d,i,o,d[11],a,!1),Je}function Xe(i,o,a,d,g){const D=g?"class":"style";pp(i,a,o.inputs[D],D,d)}function Lt(i,o,a,d){const g=St(),x=Gn(),D=22+i,P=g[11],O=g[D]=Pf(P,o,function or(){return Pn.lFrame.currentNamespace}()),$=x.firstCreatePass?function lt(i,o,a,d,g,x,D){const P=o.consts,$=Nu(o,i,2,g,jo(P,x));return Vu(o,a,$,jo(P,D)),null!==$.attrs&&is($,$.attrs,!1),null!==$.mergedAttrs&&is($,$.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,$),$}(D,x,g,0,o,a,d):x.data[D];_o($,!0);const J=$.mergedAttrs;null!==J&&Xi(P,O,J);const pe=$.classes;null!==pe&&Vf(P,O,pe);const ze=$.styles;return null!==ze&&bm(P,O,ze),64!=(64&$.flags)&&xd(x,g,O,$),0===function Us(){return Pn.lFrame.elementDepthCount}()&&lo(O,g),function Il(){Pn.lFrame.elementDepthCount++}(),Yo($)&&(uu(x,g,$),function np(i,o,a){if(Ci(o)){const g=o.directiveEnd;for(let x=o.directiveStart;x<g;x++){const D=i.data[x];D.contentQueries&&D.contentQueries(1,a[x],x)}}}(x,$,g)),null!==d&&Oh(g,$),Lt}function et(){let i=ti();js()?function Ml(){Pn.lFrame.isParent=!1}():(i=i.parent,_o(i,!1));const o=i;!function Sl(){Pn.lFrame.elementDepthCount--}();const a=Gn();return a.firstCreatePass&&(Vs(a,i),Ci(i)&&a.queries.elementEnd(i)),null!=o.classesWithoutHost&&function lc(i){return 0!=(16&i.flags)}(o)&&Xe(a,o,St(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function qa(i){return 0!=(32&i.flags)}(o)&&Xe(a,o,St(),o.stylesWithoutHost,!1),et}function ut(i,o,a,d){return Lt(i,o,a,d),et(),ut}function On(i){return!!i&&"function"==typeof i.then}function Un(i){return!!i&&"function"==typeof i.subscribe}const vn=Un;function Nt(i,o,a,d){const g=St(),x=Gn(),D=ti();return function Kt(i,o,a,d,g,x,D,P){const O=Yo(d),J=i.firstCreatePass&&Qm(i),pe=o[8],ze=$d(o);let qe=!0;if(3&d.type||P){const on=Zi(d,o),pn=P?P(on):on,An=ze.length,Ot=P?kr=>P(Hn(kr[d.index])):d.index;let Rn=null;if(!P&&O&&(Rn=function Mn(i,o,a,d){const g=i.cleanup;if(null!=g)for(let x=0;x<g.length-1;x+=2){const D=g[x];if(D===a&&g[x+1]===d){const P=o[7],O=g[x+2];return P.length>O?P[O]:null}"string"==typeof D&&(x+=2)}return null}(i,o,g,d.index)),null!==Rn)(Rn.__ngLastListenerFn__||Rn).__ngNextListenerFn__=x,Rn.__ngLastListenerFn__=x,qe=!1;else{x=Or(d,o,pe,x,!1);const kr=a.listen(pn,g,x);ze.push(x,kr),J&&J.push(g,Ot,An,An+1)}}else x=Or(d,o,pe,x,!1);const Et=d.outputs;let Ft;if(qe&&null!==Et&&(Ft=Et[g])){const on=Ft.length;if(on)for(let pn=0;pn<on;pn+=2){const ki=o[Ft[pn]][Ft[pn+1]].subscribe(x),Zh=ze.length;ze.push(x,ki),J&&J.push(g,d.index,Zh,-(Zh+1))}}}(x,g,g[11],D,i,o,0,d),Nt}function Nr(i,o,a,d){try{return!1!==a(d)}catch(g){return fp(i,g),!1}}function Or(i,o,a,d,g){return function x(D){if(D===Function)return d;Gu(2&i.flags?Ni(i.index,o):o);let O=Nr(o,0,d,D),$=x.__ngNextListenerFn__;for(;$;)O=Nr(o,0,$,D)&&O,$=$.__ngNextListenerFn__;return g&&!1===O&&(D.preventDefault(),D.returnValue=!1),O}}function Kr(i=1){return function Dr(i){return(Pn.lFrame.contextLView=function rr(i,o){for(;i>0;)o=o[15],i--;return o}(i,Pn.lFrame.contextLView))[8]}(i)}function vi(i,o,a,d,g){const x=i[a+1],D=null===o;let P=d?Aa(x):cl(x),O=!1;for(;0!==P&&(!1===O||D);){const J=i[P+1];co(i[P],o)&&(O=!0,i[P+1]=d?Kf(J):Ad(J)),P=d?Aa(J):cl(J)}O&&(i[a+1]=d?Ad(x):Kf(x))}function co(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&U(i,o)>=0}function $h(i,o){return function wi(i,o,a,d){const g=St(),x=Gn(),D=function yo(i){const o=Pn.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,a}(2);x.firstUpdatePass&&function Zd(i,o,a,d){const g=i.data;if(null===g[a+1]){const x=g[Nn()],D=function nh(i,o){return o>=i.expandoStartIndex}(i,a);(function Qy(i,o){return 0!=(i.flags&(o?16:32))})(x,d)&&null===o&&!D&&(o=!1),o=function fg(i,o,a,d){const g=function Ts(i){const o=Pn.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let x=d?o.residualClasses:o.residualStyles;if(null===g)0===(d?o.classBindings:o.styleBindings)&&(a=wp(a=j_(null,i,o,a,d),o.attrs,d),x=null);else{const D=o.directiveStylingLast;if(-1===D||i[D]!==g)if(a=j_(g,i,o,a,d),null===x){let O=function pu(i,o,a){const d=a?o.classBindings:o.styleBindings;if(0!==cl(d))return i[Aa(d)]}(i,o,d);void 0!==O&&Array.isArray(O)&&(O=j_(null,i,o,O[1],d),O=wp(O,o.attrs,d),function wx(i,o,a,d){i[Aa(a?o.classBindings:o.styleBindings)]=d}(i,o,d,O))}else x=function Ex(i,o,a){let d;const g=o.directiveEnd;for(let x=1+o.directiveStylingLast;x<g;x++)d=wp(d,i[x].hostAttrs,a);return wp(d,o.attrs,a)}(i,o,d)}return void 0!==x&&(d?o.residualClasses=x:o.residualStyles=x),a}(g,x,o,d),function Wo(i,o,a,d,g,x){let D=x?o.classBindings:o.styleBindings,P=Aa(D),O=cl(D);i[d]=a;let J,$=!1;if(Array.isArray(a)){const pe=a;J=pe[1],(null===J||U(pe,J)>0)&&($=!0)}else J=a;if(g)if(0!==O){const ze=Aa(i[P+1]);i[d+1]=Mh(ze,P),0!==ze&&(i[ze+1]=Pd(i[ze+1],d)),i[P+1]=function Jl(i,o){return 131071&i|o<<17}(i[P+1],d)}else i[d+1]=Mh(P,0),0!==P&&(i[P+1]=Pd(i[P+1],d)),P=d;else i[d+1]=Mh(O,0),0===P?P=d:i[O+1]=Pd(i[O+1],d),O=d;$&&(i[d+1]=Ad(i[d+1])),vi(i,J,d,!0),vi(i,J,d,!1),function ii(i,o,a,d,g){const x=g?i.residualClasses:i.residualStyles;null!=x&&"string"==typeof o&&U(x,o)>=0&&(a[d+1]=Kf(a[d+1]))}(o,J,i,d,x),D=Mh(P,O),x?o.classBindings=D:o.styleBindings=D}(g,x,o,a,D,d)}}(x,i,D,d),o!==Kn&&Lo(g,D,o)&&function Ky(i,o,a,d,g,x,D,P){if(!(3&o.type))return;const O=i.data,$=O[P+1];pg(function Yf(i){return 1==(1&i)}($)?Jy(O,o,a,g,cl($),D):void 0)||(pg(x)||function Xf(i){return 2==(2&i)}($)&&(x=Jy(O,null,a,g,P,D)),function xm(i,o,a,d,g){if(o)g?i.addClass(a,d):i.removeClass(a,d);else{let x=-1===d.indexOf("-")?void 0:Sa.DashCase;null==g?i.removeStyle(a,d,x):("string"==typeof g&&g.endsWith("!important")&&(g=g.slice(0,-10),x|=Sa.Important),i.setStyle(a,d,g,x))}}(d,D,lr(Nn(),a),g,x))}(x,x.data[Nn()],g,g[11],i,g[D+1]=function Cx(i,o){return null==i||("string"==typeof o?i+=o:"object"==typeof i&&(i=hn(jl(i)))),i}(o,a),d,D)}(i,o,null,!0),$h}function j_(i,o,a,d,g){let x=null;const D=a.directiveEnd;let P=a.directiveStylingLast;for(-1===P?P=a.directiveStart:P++;P<D&&(x=o[P],d=wp(d,x.hostAttrs,g),x!==i);)P++;return null!==i&&(a.directiveStylingLast=P),d}function wp(i,o,a){const d=a?1:2;let g=-1;if(null!==o)for(let x=0;x<o.length;x++){const D=o[x];"number"==typeof D?g=D:g===d&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),T(i,D,!!a||o[++x]))}return void 0===i?null:i}function Jy(i,o,a,d,g,x){const D=null===o;let P;for(;g>0;){const O=i[g],$=Array.isArray(O),J=$?O[1]:O,pe=null===J;let ze=a[g+1];ze===Kn&&(ze=pe?kn:void 0);let qe=pe?k(ze,d):J===d?ze:void 0;if($&&!pg(qe)&&(qe=k(O,d)),pg(qe)&&(P=qe,D))return P;const Et=i[g+1];g=D?Aa(Et):cl(Et)}if(null!==o){let O=x?o.residualClasses:o.residualStyles;null!=O&&(P=k(O,d))}return P}function pg(i){return void 0!==i}function ev(i,o=""){const a=St(),d=Gn(),g=i+22,x=d.firstCreatePass?Nu(d,g,1,o,null):d.data[g],D=a[g]=function Af(i,o){return i.createText(o)}(a[11],o);xd(d,a,D,x),_o(x,!1)}function V_(i){return mg("",i,""),V_}function mg(i,o,a){const d=St(),g=function e(i,o,a,d){return Lo(i,Io(),a)?o+At(a)+d:Kn}(d,i,o,a);return g!==Kn&&function dl(i,o,a){const d=lr(o,i);!function pm(i,o,a){i.setValue(o,a)}(i[11],d,a)}(d,Nn(),g),mg}const Gh=void 0;var Zx=["en",[["a","p"],["AM","PM"],Gh],[["AM","PM"],Gh,Gh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Gh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Gh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Gh,"{1} 'at' {0}",Gh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Hx(i){const a=Math.floor(Math.abs(i)),d=i.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let Wd={};function $_(i){const o=function Wx(i){return i.toLowerCase().replace(/_/g,"-")}(i);let a=bv(o);if(a)return a;const d=o.split("-")[0];if(a=bv(d),a)return a;if("en"===d)return Zx;throw new xt(701,!1)}function xv(i){return $_(i)[jn.PluralCase]}function bv(i){return i in Wd||(Wd[i]=gn.ng&&gn.ng.common&&gn.ng.common.locales&&gn.ng.common.locales[i]),Wd[i]}var jn=(()=>((jn=jn||{})[jn.LocaleId=0]="LocaleId",jn[jn.DayPeriodsFormat=1]="DayPeriodsFormat",jn[jn.DayPeriodsStandalone=2]="DayPeriodsStandalone",jn[jn.DaysFormat=3]="DaysFormat",jn[jn.DaysStandalone=4]="DaysStandalone",jn[jn.MonthsFormat=5]="MonthsFormat",jn[jn.MonthsStandalone=6]="MonthsStandalone",jn[jn.Eras=7]="Eras",jn[jn.FirstDayOfWeek=8]="FirstDayOfWeek",jn[jn.WeekendRange=9]="WeekendRange",jn[jn.DateFormat=10]="DateFormat",jn[jn.TimeFormat=11]="TimeFormat",jn[jn.DateTimeFormat=12]="DateTimeFormat",jn[jn.NumberSymbols=13]="NumberSymbols",jn[jn.NumberFormats=14]="NumberFormats",jn[jn.CurrencyCode=15]="CurrencyCode",jn[jn.CurrencySymbol=16]="CurrencySymbol",jn[jn.CurrencyName=17]="CurrencyName",jn[jn.Currencies=18]="Currencies",jn[jn.Directionality=19]="Directionality",jn[jn.PluralCase=20]="PluralCase",jn[jn.ExtraData=21]="ExtraData",jn))();const qd="en-US";let wv=qd;function Z_(i,o,a,d,g){if(i=rn(i),Array.isArray(i))for(let x=0;x<i.length;x++)Z_(i[x],o,a,d,g);else{const x=Gn(),D=St();let P=Hl(i)?i:rn(i.provide),O=qp(i);const $=ti(),J=1048575&$.providerIndexes,pe=$.directiveStart,ze=$.providerIndexes>>20;if(Hl(i)||!i.multi){const qe=new fa(O,g,au),Et=q_(P,o,g?J:J+ze,pe);-1===Et?(ga(Is($,D),x,P),W_(x,i,o.length),o.push(P),$.directiveStart++,$.directiveEnd++,g&&($.providerIndexes+=1048576),a.push(qe),D.push(qe)):(a[Et]=qe,D[Et]=qe)}else{const qe=q_(P,o,J+ze,pe),Et=q_(P,o,J,J+ze),Ft=qe>=0&&a[qe],on=Et>=0&&a[Et];if(g&&!on||!g&&!Ft){ga(Is($,D),x,P);const pn=function G1(i,o,a,d,g){const x=new fa(i,a,au);return x.multi=[],x.index=o,x.componentProviders=0,Wv(x,g,d&&!a),x}(g?$1:V1,a.length,g,d,O);!g&&on&&(a[Et].providerFactory=pn),W_(x,i,o.length,0),o.push(P),$.directiveStart++,$.directiveEnd++,g&&($.providerIndexes+=1048576),a.push(pn),D.push(pn)}else W_(x,i,qe>-1?qe:Et,Wv(a[g?Et:qe],O,!g&&d));!g&&d&&on&&a[Et].componentProviders++}}}function W_(i,o,a,d){const g=Hl(o),x=function Zp(i){return!!i.useClass}(o);if(g||x){const O=(x?rn(o.useClass):o).prototype.ngOnDestroy;if(O){const $=i.destroyHooks||(i.destroyHooks=[]);if(!g&&o.multi){const J=$.indexOf(a);-1===J?$.push(a,[d,O]):$[J+1].push(d,O)}else $.push(a,O)}}}function Wv(i,o,a){return a&&i.componentProviders++,i.multi.push(o)-1}function q_(i,o,a,d){for(let g=a;g<d;g++)if(o[g]===i)return g;return-1}function V1(i,o,a,d){return X_(this.multi,[])}function $1(i,o,a,d){const g=this.multi;let x;if(this.providerFactory){const D=this.providerFactory.componentProviders,P=Ka(a,a[1],this.providerFactory.index,d);x=P.slice(0,D),X_(g,x);for(let O=D;O<P.length;O++)x.push(P[O])}else x=[],X_(g,x);return x}function X_(i,o){for(let a=0;a<i.length;a++)o.push((0,i[a])());return o}function qv(i,o=[]){return a=>{a.providersResolver=(d,g)=>function j1(i,o,a){const d=Gn();if(d.firstCreatePass){const g=gi(i);Z_(a,d.data,d.blueprint,g,!0),Z_(o,d.data,d.blueprint,g,!1)}}(d,g?g(i):i,o)}}class Yd{}class Xv{}function H1(i,o){return new Yv(i,o??null)}class Yv extends Yd{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new pl(this);const d=Ut(o);this._bootstrapComponents=ql(d.bootstrap),this._r3Injector=Hf(o,a,[{provide:Yd,useValue:this},{provide:Wl,useValue:this.componentFactoryResolver}],hn(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class Y_ extends Xv{constructor(o){super(),this.moduleType=o}create(o){return new Yv(this.moduleType,o)}}class Z1 extends Yd{constructor(o,a,d){super(),this.componentFactoryResolver=new pl(this),this.instance=null;const g=new df([...o,{provide:Yd,useValue:this},{provide:Wl,useValue:this.componentFactoryResolver}],a||rd(),d,new Set(["environment"]));this.injector=g,g.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function K_(i,o,a=null){return new Z1(i,o,a).injector}let W1=(()=>{class i{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a.id)){const d=Hp(0,a.type),g=d.length>0?K_([d],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a.id,g)}return this.cachedInjectors.get(a.id)}ngOnDestroy(){try{for(const a of this.cachedInjectors.values())null!==a&&a.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Mr({token:i,providedIn:"environment",factory:()=>new i(ae(Zl))}),i})();function Kv(i){i.getStandaloneInjector=o=>o.get(W1).getOrCreateStandaloneInjector(i)}function s0(i,o,a,d,g,x,D){const P=o+a;return function du(i,o,a,d){const g=Lo(i,o,a);return Lo(i,o+1,d)||g}(i,P,g,x)?function La(i,o,a){return i[o]=a}(i,P+2,D?d.call(D,g,x):d(g,x)):function Ip(i,o){const a=i[o];return a===Kn?void 0:a}(i,P+2)}function u0(i,o){const a=Gn();let d;const g=i+22;a.firstCreatePass?(d=function db(i,o){if(o)for(let a=o.length-1;a>=0;a--){const d=o[a];if(i===d.name)return d}}(o,a.pipeRegistry),a.data[g]=d,d.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(g,d.onDestroy)):d=a.data[g];const x=d.factory||(d.factory=Bo(d.type)),D=it(au);try{const P=Zs(!1),O=x();return Zs(P),function Le(i,o,a,d){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),o[a]=d}(a,St(),g,O),O}finally{it(D)}}function h0(i,o,a,d){const g=i+22,x=St(),D=function Xn(i,o){return i[o]}(x,g);return function Sp(i,o){return i[1].data[o].pure}(x,g)?s0(x,function Mi(){const i=Pn.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}(),o,D.transform,a,d,D):D.transform(a,d)}function Q_(i){return o=>{setTimeout(i,void 0,o)}}const Rc=class _b extends H.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let g=o,x=a||(()=>null),D=d;if(o&&"object"==typeof o){const O=o;g=O.next?.bind(O),x=O.error?.bind(O),D=O.complete?.bind(O)}this.__isAsync&&(x=Q_(x),g&&(g=Q_(g)),D&&(D=Q_(D)));const P=super.subscribe({next:g,error:x,complete:D});return o instanceof Ie.w0&&o.add(P),P}};function yb(){return this._results[ko()]()}class ey{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=ko(),d=ey.prototype;d[a]||(d[a]=yb)}get changes(){return this._changes||(this._changes=new Rc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const g=oo(o);(this._changesDetected=!function qc(i,o,a){if(i.length!==o.length)return!1;for(let d=0;d<i.length;d++){let g=i[d],x=o[d];if(a&&(g=a(g),x=a(x)),x!==g)return!1}return!0}(d._results,g,a))&&(d._results=g,d.length=g.length,d.last=g[this.length-1],d.first=g[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Mp=(()=>{class i{}return i.__NG_ELEMENT_ID__=bb,i})();const vb=Mp,xb=class extends vb{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}createEmbeddedView(o,a){const d=this._declarationTContainer.tViews,g=Rh(this._declarationLView,d,o,16,null,d.declTNode,null,null,null,null,a||null);g[17]=this._declarationLView[this._declarationTContainer.index];const D=this._declarationLView[19];return null!==D&&(g[19]=D.createEmbeddedView(d)),Ql(d,g,o),new na(g)}};function bb(){return xg(ti(),St())}function xg(i,o){return 4&i.type?new xb(o,i,gc(i,o)):null}let bg=(()=>{class i{}return i.__NG_ELEMENT_ID__=wb,i})();function wb(){return p0(ti(),St())}const Eb=bg,d0=class extends Eb{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return gc(this._hostTNode,this._hostLView)}get injector(){return new ci(this._hostTNode,this._hostLView)}get parentInjector(){const o=Qo(this._hostTNode,this._hostLView);if(cc(o)){const a=fs(o,this._hostLView),d=ds(o);return new ci(a[1].data[d+8],a)}return new ci(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=f0(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,d){let g,x;"number"==typeof d?g=d:null!=d&&(g=d.index,x=d.injector);const D=o.createEmbeddedView(a||{},x);return this.insert(D,g),D}createComponent(o,a,d,g,x){const D=o&&!function qs(i){return"function"==typeof i}(o);let P;if(D)P=a;else{const pe=a||{};P=pe.index,d=pe.injector,g=pe.projectableNodes,x=pe.environmentInjector||pe.ngModuleRef}const O=D?o:new Hu(oe(o)),$=d||this.parentInjector;if(!x&&null==O.ngModule){const ze=(D?$:this.parentInjector).get(Zl,null);ze&&(x=ze)}const J=O.create($,g,void 0,x);return this.insert(J.hostView,P),J}insert(o,a){const d=o._lView,g=d[1];if(function ua(i){return Xr(i[3])}(d)){const J=this.indexOf(o);if(-1!==J)this.detach(J);else{const pe=d[3],ze=new d0(pe,pe[6],pe[3]);ze.detach(ze.indexOf(o))}}const x=this._adjustIndex(a),D=this._lContainer;!function n_(i,o,a,d){const g=10+d,x=a.length;d>0&&(a[g-1][4]=o),d<x-10?(o[4]=a[g],zl(a,10+d,o)):(a.push(o),o[4]=null),o[3]=a;const D=o[17];null!==D&&a!==D&&function r_(i,o){const a=i[9];o[16]!==o[3][3][16]&&(i[2]=!0),null===a?i[9]=[o]:a.push(o)}(D,o);const P=o[19];null!==P&&P.insertView(i),o[2]|=64}(g,d,D,x);const P=Lu(x,D),O=d[11],$=yd(O,D[7]);return null!==$&&function t_(i,o,a,d,g,x){d[0]=g,d[6]=o,Yl(i,d,a,1,g,x)}(g,D[6],O,d,$,P),o.attachToViewContainerRef(),zl(ty(D),x,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=f0(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=gd(this._lContainer,a);d&&(Bl(ty(this._lContainer),a),gm(d[1],d))}detach(o){const a=this._adjustIndex(o,-1),d=gd(this._lContainer,a);return d&&null!=Bl(ty(this._lContainer),a)?new na(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function f0(i){return i[8]}function ty(i){return i[8]||(i[8]=[])}function p0(i,o){let a;const d=o[i.index];if(Xr(d))a=d;else{let g;if(8&i.type)g=Hn(d);else{const x=o[11];g=x.createComment("");const D=Zi(i,o);Ma(x,yd(x,D),g,function vm(i,o){return i.nextSibling(o)}(x,D),!1)}o[i.index]=a=Bh(d,o,g,i),Nh(o,a)}return new d0(a,i,o)}class ny{constructor(o){this.queryList=o,this.matches=null}clone(){return new ny(this.queryList)}setDirty(){this.queryList.setDirty()}}class ry{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,g=[];for(let x=0;x<d;x++){const D=a.getByIndex(x);g.push(this.queries[D.indexInDeclarationView].clone())}return new ry(g)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==E0(o,a).matches&&this.queries[a].setDirty()}}class m0{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class iy{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const g=null!==a?a.length:0,x=this.getByIndex(d).embeddedTView(o,g);x&&(x.indexInDeclarationView=d,null!==a?a.push(x):a=[x])}return null!==a?new iy(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class oy{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new oy(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let g=0;g<d.length;g++){const x=d[g];this.matchTNodeWithReadOption(o,a,Cb(a,x)),this.matchTNodeWithReadOption(o,a,Ol(a,o,x,!1,!1))}else d===Mp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,Ol(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const g=this.metadata.read;if(null!==g)if(g===_c||g===bg||g===Mp&&4&a.type)this.addMatch(a.index,-2);else{const x=Ol(a,o,g,!1,!1);null!==x&&this.addMatch(a.index,x)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function Cb(i,o){const a=i.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function Sb(i,o,a,d){return-1===a?function Ib(i,o){return 11&i.type?gc(i,o):4&i.type?xg(i,o):null}(o,i):-2===a?function Mb(i,o,a){return a===_c?gc(o,i):a===Mp?xg(o,i):a===bg?p0(o,i):void 0}(i,o,d):Ka(i,i[1],a,o)}function g0(i,o,a,d){const g=o[19].queries[d];if(null===g.matches){const x=i.data,D=a.matches,P=[];for(let O=0;O<D.length;O+=2){const $=D[O];P.push($<0?null:Sb(o,x[$],D[O+1],a.metadata.read))}g.matches=P}return g.matches}function sy(i,o,a,d){const g=i.queries.getByIndex(a),x=g.matches;if(null!==x){const D=g0(i,o,g,a);for(let P=0;P<x.length;P+=2){const O=x[P];if(O>0)d.push(D[P/2]);else{const $=x[P+1],J=o[-O];for(let pe=10;pe<J.length;pe++){const ze=J[pe];ze[17]===ze[3]&&sy(ze[1],ze,$,d)}if(null!==J[9]){const pe=J[9];for(let ze=0;ze<pe.length;ze++){const qe=pe[ze];sy(qe[1],qe,$,d)}}}}}return d}function _0(i){const o=St(),a=Gn(),d=F();W(d+1);const g=E0(a,d);if(i.dirty&&Va(o)===(2==(2&g.metadata.flags))){if(null===g.matches)i.reset([]);else{const x=g.crossesNgTemplate?sy(a,o,d,[]):g0(a,o,g,d);i.reset(x,Qp),i.notifyOnChanges()}return!0}return!1}function y0(i,o,a){const d=Gn();d.firstCreatePass&&(w0(d,new m0(i,o,a),-1),2==(2&o)&&(d.staticViewQueries=!0)),b0(d,St(),o)}function v0(i,o,a,d){const g=Gn();if(g.firstCreatePass){const x=ti();w0(g,new m0(o,a,d),x.index),function Pb(i,o){const a=i.contentQueries||(i.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(i.queries.length-1,o)}(g,i),2==(2&a)&&(g.staticContentQueries=!0)}b0(g,St(),a)}function x0(){return function Ab(i,o){return i[19].queries[o].queryList}(St(),F())}function b0(i,o,a){const d=new ey(4==(4&a));$m(i,o,d,d.destroy),null===o[19]&&(o[19]=new ry),o[19].queries.push(new ny(d))}function w0(i,o,a){null===i.queries&&(i.queries=new iy),i.queries.track(new oy(o,a))}function E0(i,o){return i.queries.getByIndex(o)}function Eg(...i){}const V0=new Rr("Application Initializer");let Tg=(()=>{class i{constructor(a){this.appInits=a,this.resolve=Eg,this.reject=Eg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,g)=>{this.resolve=d,this.reject=g})}runInitializers(){if(this.initialized)return;const a=[],d=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const x=this.appInits[g]();if(On(x))a.push(x);else if(vn(x)){const D=new Promise((P,O)=>{x.subscribe({complete:P,error:O})});a.push(D)}}Promise.all(a).then(()=>{d()}).catch(g=>{this.reject(g)}),0===a.length&&d(),this.initialized=!0}}return i.\u0275fac=function(a){return new(a||i)(ae(V0,8))},i.\u0275prov=Mr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const $0=new Rr("AppId",{providedIn:"root",factory:function G0(){return`${hy()}${hy()}${hy()}`}});function hy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const H0=new Rr("Platform Initializer"),Jb=new Rr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Z0=new Rr("appBootstrapListener");let Qb=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Mr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Dg=new Rr("LocaleId",{providedIn:"root",factory:()=>ke(Dg,_e.Optional|_e.SkipSelf)||function ew(){return typeof $localize<"u"&&$localize.locale||qd}()}),tw=new Rr("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class nw{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let rw=(()=>{class i{compileModuleSync(a){return new Y_(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const d=this.compileModuleSync(a),x=ql(Ut(a).declarations).reduce((D,P)=>{const O=oe(P);return O&&D.push(new Hu(O)),D},[]);return new nw(d,x)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Mr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const sw=(()=>Promise.resolve(0))();function dy(i){typeof Zone>"u"?sw.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class vl{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Rc(!1),this.onMicrotaskEmpty=new Rc(!1),this.onStable=new Rc(!1),this.onError=new Rc(!1),typeof Zone>"u")throw new xt(908,!1);Zone.assertZonePatched();const g=this;if(g._nesting=0,g._outer=g._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const x=Zone.AsyncStackTaggingZoneSpec;g._inner=g._inner.fork(new x("Angular"))}Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!d&&a,g.shouldCoalesceRunChangeDetection=d,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function aw(){let i=gn.requestAnimationFrame,o=gn.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a);const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function uw(i){const o=()=>{!function cw(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(gn,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,py(i),i.isCheckStableRunning=!0,fy(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),py(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,g,x,D,P)=>{try{return X0(i),a.invokeTask(g,x,D,P)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===x.type||i.shouldCoalesceRunChangeDetection)&&o(),Y0(i)}},onInvoke:(a,d,g,x,D,P,O)=>{try{return X0(i),a.invoke(g,x,D,P,O)}finally{i.shouldCoalesceRunChangeDetection&&o(),Y0(i)}},onHasTask:(a,d,g,x)=>{a.hasTask(g,x),d===g&&("microTask"==x.change?(i._hasPendingMicrotasks=x.microTask,py(i),fy(i)):"macroTask"==x.change&&(i.hasPendingMacrotasks=x.macroTask))},onHandleError:(a,d,g,x)=>(a.handleError(g,x),i.runOutsideAngular(()=>i.onError.emit(x)),!1)})}(g)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!vl.isInAngularZone())throw new xt(909,!1)}static assertNotInAngularZone(){if(vl.isInAngularZone())throw new xt(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,g){const x=this._inner,D=x.scheduleEventTask("NgZoneEvent: "+g,o,lw,Eg,Eg);try{return x.runTask(D,a,d)}finally{x.cancelTask(D)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const lw={};function fy(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function py(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function X0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function Y0(i){i._nesting--,fy(i)}class hw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Rc,this.onMicrotaskEmpty=new Rc,this.onStable=new Rc,this.onError=new Rc}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,g){return o.apply(a,d)}}const K0=new Rr(""),J0=new Rr("");let my,dw=(()=>{class i{constructor(a,d,g){this._ngZone=a,this.registry=d,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,my||(function fw(i){my=i}(g),g.addToWindow(d)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{vl.assertNotInAngularZone(),dy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())dy(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(d=>!d.updateCb||!d.updateCb(a)||(clearTimeout(d.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,d,g){let x=-1;d&&d>0&&(x=setTimeout(()=>{this._callbacks=this._callbacks.filter(D=>D.timeoutId!==x),a(this._didWork,this.getPendingTasks())},d)),this._callbacks.push({doneCb:a,timeoutId:x,updateCb:g})}whenStable(a,d,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,d,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,d,g){return[]}}return i.\u0275fac=function(a){return new(a||i)(ae(vl),ae(Q0),ae(J0))},i.\u0275prov=Mr({token:i,factory:i.\u0275fac}),i})(),Q0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(a,d){this._applications.set(a,d)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,d=!0){return my?.findTestabilityInTree(this,a,d)??null}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Mr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})(),rh=null;const ex=new Rr("AllowMultipleToken"),gy=new Rr("PlatformDestroyListeners");class gw{constructor(o,a){this.name=o,this.token=a}}function nx(i,o,a=[]){const d=`Platform: ${o}`,g=new Rr(d);return(x=[])=>{let D=_y();if(!D||D.injector.get(ex,!1)){const P=[...a,...x,{provide:g,useValue:!0}];i?i(P):function _w(i){if(rh&&!rh.get(ex,!1))throw new xt(400,!1);rh=i;const o=i.get(ix);(function tx(i){const o=i.get(H0,null);o&&o.forEach(a=>a())})(i)}(function rx(i=[],o){return xc.create({name:o,providers:[{provide:hf,useValue:"platform"},{provide:gy,useValue:new Set([()=>rh=null])},...i]})}(P,d))}return function vw(i){const o=_y();if(!o)throw new xt(401,!1);return o}()}}function _y(){return rh?.get(ix)??null}let ix=(()=>{class i{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,d){const g=function sx(i,o){let a;return a="noop"===i?new hw:("zone.js"===i?void 0:i)||new vl(o),a}(d?.ngZone,function ox(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(d)),x=[{provide:vl,useValue:g}];return g.run(()=>{const D=xc.create({providers:x,parent:this.injector,name:a.moduleType.name}),P=a.create(D),O=P.injector.get(tu,null);if(!O)throw new xt(402,!1);return g.runOutsideAngular(()=>{const $=g.onError.subscribe({next:J=>{O.handleError(J)}});P.onDestroy(()=>{Ig(this._modules,P),$.unsubscribe()})}),function ax(i,o,a){try{const d=a();return On(d)?d.catch(g=>{throw o.runOutsideAngular(()=>i.handleError(g)),g}):d}catch(d){throw o.runOutsideAngular(()=>i.handleError(d)),d}}(O,g,()=>{const $=P.injector.get(Tg);return $.runInitializers(),$.donePromise.then(()=>(function Ev(i){hr(i,"Expected localeId to be defined"),"string"==typeof i&&(wv=i.toLowerCase().replace(/_/g,"-"))}(P.injector.get(Dg,qd)||qd),this._moduleDoBootstrap(P),P))})})}bootstrapModule(a,d=[]){const g=lx({},d);return function pw(i,o,a){const d=new Y_(a);return Promise.resolve(d)}(0,0,a).then(x=>this.bootstrapModuleFactory(x,g))}_moduleDoBootstrap(a){const d=a.injector.get(Cg);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(g=>d.bootstrap(g));else{if(!a.instance.ngDoBootstrap)throw new xt(403,!1);a.instance.ngDoBootstrap(d)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new xt(404,!1);this._modules.slice().forEach(d=>d.destroy()),this._destroyListeners.forEach(d=>d());const a=this._injector.get(gy,null);a&&(a.forEach(d=>d()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(a){return new(a||i)(ae(xc))},i.\u0275prov=Mr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function lx(i,o){return Array.isArray(o)?o.reduce(lx,i):{...i,...o}}let Cg=(()=>{class i{constructor(a,d,g){this._zone=a,this._injector=d,this._exceptionHandler=g,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const x=new nt.y(P=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{P.next(this._stable),P.complete()})}),D=new nt.y(P=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{vl.assertNotInAngularZone(),dy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,P.next(!0))})})});const $=this._zone.onUnstable.subscribe(()=>{vl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{P.next(!1)}))});return()=>{O.unsubscribe(),$.unsubscribe()}});this.isStable=function gt(...i){const o=(0,kt.yG)(i),a=(0,kt._6)(i,1/0),d=i;return d.length?1===d.length?(0,Fe.Xf)(d[0]):(0,c.J)(a)((0,Ye.D)(d,o)):Jt.E}(x,D.pipe(function st(i={}){const{connector:o=(()=>new H.x),resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:g=!0}=i;return x=>{let D,P,O,$=0,J=!1,pe=!1;const ze=()=>{P?.unsubscribe(),P=void 0},qe=()=>{ze(),D=O=void 0,J=pe=!1},Et=()=>{const Ft=D;qe(),Ft?.unsubscribe()};return(0,tt.e)((Ft,on)=>{$++,!pe&&!J&&ze();const pn=O=O??o();on.add(()=>{$--,0===$&&!pe&&!J&&(P=un(Et,g))}),pn.subscribe(on),!D&&$>0&&(D=new yt.Hp({next:An=>pn.next(An),error:An=>{pe=!0,ze(),P=un(qe,a,An),pn.error(An)},complete:()=>{J=!0,ze(),P=un(qe,d),pn.complete()}}),(0,Fe.Xf)(Ft).subscribe(D))})(x)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(a,d){const g=a instanceof ns;if(!this._injector.get(Tg).done)throw!g&&It(a),new xt(405,false);let D;D=g?a:this._injector.get(Wl).resolveComponentFactory(a),this.componentTypes.push(D.componentType);const P=function mw(i){return i.isBoundToModule}(D)?void 0:this._injector.get(Yd),$=D.create(xc.NULL,[],d||D.selector,P),J=$.location.nativeElement,pe=$.injector.get(K0,null);return pe?.registerApplication(J),$.onDestroy(()=>{this.detachView($.hostView),Ig(this.components,$),pe?.unregisterApplication(J)}),this._loadComponent($),$}tick(){if(this._runningTick)throw new xt(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){const d=a;Ig(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(Z0,[]).concat(this._bootstrapListeners).forEach(g=>g(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>Ig(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new xt(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(a){return new(a||i)(ae(vl),ae(Zl),ae(tu))},i.\u0275prov=Mr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Ig(i,o){const a=i.indexOf(o);a>-1&&i.splice(a,1)}let ux=!0;function bw(){ux=!1}let ww=(()=>{class i{}return i.__NG_ELEMENT_ID__=Ew,i})();function Ew(i){return function Tw(i,o,a){if(gr(i)&&!a){const d=Ni(i.index,o);return new na(d,d)}return 47&i.type?new na(o[16],o):null}(ti(),St(),16==(16&i))}class mx{constructor(){}supports(o){return Yu(o)}create(o){return new Aw(o)}}const Mw=(i,o)=>o;class Aw{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Mw}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,g=0,x=null;for(;a||d;){const D=!d||a&&a.currentIndex<_x(d,g,x)?a:d,P=_x(D,g,x),O=D.currentIndex;if(D===d)g--,d=d._nextRemoved;else if(a=a._next,null==D.previousIndex)g++;else{x||(x=[]);const $=P-g,J=O-g;if($!=J){for(let ze=0;ze<$;ze++){const qe=ze<x.length?x[ze]:x[ze]=0,Et=qe+ze;J<=Et&&Et<$&&(x[ze]=qe+1)}x[D.previousIndex]=J-$}}P!==O&&o(D,P,O)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!Yu(o))throw new xt(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let g,x,D,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let P=0;P<this.length;P++)x=o[P],D=this._trackByFn(P,x),null!==a&&Object.is(a.trackById,D)?(d&&(a=this._verifyReinsertion(a,x,D,P)),Object.is(a.item,x)||this._addIdentityChange(a,x)):(a=this._mismatch(a,x,D,P),d=!0),a=a._next}else g=0,function jh(i,o){if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else{const a=i[ko()]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,P=>{D=this._trackByFn(g,P),null!==a&&Object.is(a.trackById,D)?(d&&(a=this._verifyReinsertion(a,P,D,g)),Object.is(a.item,P)||this._addIdentityChange(a,P)):(a=this._mismatch(a,P,D,g),d=!0),a=a._next,g++}),this.length=g;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,g){let x;return null===o?x=this._itTail:(x=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,x,g)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,g))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,x,g)):o=this._addAfter(new Pw(a,d),x,g),o}_verifyReinsertion(o,a,d,g){let x=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==x?o=this._reinsertAfter(x,o._prev,g):o.currentIndex!=g&&(o.currentIndex=g,this._addToMoves(o,g)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const g=o._prevRemoved,x=o._nextRemoved;return null===g?this._removalsHead=x:g._nextRemoved=x,null===x?this._removalsTail=g:x._prevRemoved=g,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const g=null===a?this._itHead:a._next;return o._next=g,o._prev=a,null===g?this._itTail=o:g._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new gx),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gx),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Pw{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Rw{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class gx{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new Rw,this.map.set(a,d)),d.add(o)}get(o,a){const g=this.map.get(o);return g?g.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function _x(i,o,a){const d=i.previousIndex;if(null===d)return d;let g=0;return a&&d<a.length&&(g=a[d]),d+o+g}class yx{constructor(){}supports(o){return o instanceof Map||Ku(o)}create(){return new kw}}class kw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||Ku(o)))throw new xt(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,g)=>{if(a&&a.key===g)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const x=this._getOrCreateRecordForKey(g,d);a=this._insertBeforeOrAppend(a,x)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const g=this._records.get(o);this._maybeAddToChanges(g,a);const x=g._prev,D=g._next;return x&&(x._next=D),D&&(D._prev=x),g._next=null,g._prev=null,g}const d=new Lw(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class Lw{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function vx(){return new wy([new mx])}let wy=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(null!=d){const g=d.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||vx()),deps:[[i,new at,new Mt]]}}find(a){const d=this.factories.find(g=>g.supports(a));if(null!=d)return d;throw new xt(901,!1)}}return i.\u0275prov=Mr({token:i,providedIn:"root",factory:vx}),i})();function xx(){return new Ey([new yx])}let Ey=(()=>{class i{constructor(a){this.factories=a}static create(a,d){if(d){const g=d.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:d=>i.create(a,d||xx()),deps:[[i,new at,new Mt]]}}find(a){const d=this.factories.find(g=>g.supports(a));if(d)return d;throw new xt(901,!1)}}return i.\u0275prov=Mr({token:i,providedIn:"root",factory:xx}),i})();const zw=nx(null,"core",[]);let Bw=(()=>{class i{constructor(a){}}return i.\u0275fac=function(a){return new(a||i)(ae(Cg))},i.\u0275mod=Re({type:i}),i.\u0275inj=si({}),i})();function Nw(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},1481:(zn,zt,Te)=>{"use strict";Te.d(zt,{Dx:()=>ft,b2:()=>fo,q6:()=>Gi});var H=Te(6895),Ie=Te(8256);class nt extends H.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends nt{static makeCurrent(){(0,H.HT)(new c)}onAndCancel(le,oe,Oe){return le.addEventListener(oe,Oe,!1),()=>{le.removeEventListener(oe,Oe,!1)}}dispatchEvent(le,oe){le.dispatchEvent(oe)}remove(le){le.parentNode&&le.parentNode.removeChild(le)}createElement(le,oe){return(oe=oe||this.getDefaultDocument()).createElement(le)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(le){return le.nodeType===Node.ELEMENT_NODE}isShadowRoot(le){return le instanceof DocumentFragment}getGlobalEventTarget(le,oe){return"window"===oe?window:"document"===oe?le:"body"===oe?le.body:null}getBaseHref(le){const oe=function Jt(){return Fe=Fe||document.querySelector("base"),Fe?Fe.getAttribute("href"):null}();return null==oe?null:function Ye(Ee){kt=kt||document.createElement("a"),kt.setAttribute("href",Ee);const le=kt.pathname;return"/"===le.charAt(0)?le:`/${le}`}(oe)}resetBaseElement(){Fe=null}getUserAgent(){return window.navigator.userAgent}getCookie(le){return(0,H.Mx)(document.cookie,le)}}let kt,Fe=null;const gt=new Ie.OlP("TRANSITION_ID"),tt=[{provide:Ie.ip1,useFactory:function yt(Ee,le,oe){return()=>{oe.get(Ie.CZH).donePromise.then(()=>{const Oe=(0,H.q)(),je=le.querySelectorAll(`style[ng-transition="${Ee}"]`);for(let It=0;It<je.length;It++)Oe.remove(je[It])})}},deps:[gt,H.K0,Ie.zs3],multi:!0}];let un=(()=>{class Ee{build(){return new XMLHttpRequest}}return Ee.\u0275fac=function(oe){return new(oe||Ee)},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})();const Tt=new Ie.OlP("EventManagerPlugins");let xn=(()=>{class Ee{constructor(oe,Oe){this._zone=Oe,this._eventNameToPlugin=new Map,oe.forEach(je=>je.manager=this),this._plugins=oe.slice().reverse()}addEventListener(oe,Oe,je){return this._findPluginFor(Oe).addEventListener(oe,Oe,je)}addGlobalEventListener(oe,Oe,je){return this._findPluginFor(Oe).addGlobalEventListener(oe,Oe,je)}getZone(){return this._zone}_findPluginFor(oe){const Oe=this._eventNameToPlugin.get(oe);if(Oe)return Oe;const je=this._plugins;for(let It=0;It<je.length;It++){const Ut=je[It];if(Ut.supports(oe))return this._eventNameToPlugin.set(oe,Ut),Ut}throw new Error(`No event manager plugin found for event ${oe}`)}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(Tt),Ie.LFG(Ie.R0b))},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})();class hn{constructor(le){this._doc=le}addGlobalEventListener(le,oe,Oe){const je=(0,H.q)().getGlobalEventTarget(this._doc,le);if(!je)throw new Error(`Unsupported event target ${je} for event ${oe}`);return this.addEventListener(je,oe,Oe)}}let Cn=(()=>{class Ee{constructor(){this._stylesSet=new Set}addStyles(oe){const Oe=new Set;oe.forEach(je=>{this._stylesSet.has(je)||(this._stylesSet.add(je),Oe.add(je))}),this.onStylesAdded(Oe)}onStylesAdded(oe){}getAllStyles(){return Array.from(this._stylesSet)}}return Ee.\u0275fac=function(oe){return new(oe||Ee)},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})(),$t=(()=>{class Ee extends Cn{constructor(oe){super(),this._doc=oe,this._hostNodes=new Map,this._hostNodes.set(oe.head,[])}_addStylesToHost(oe,Oe,je){oe.forEach(It=>{const Ut=this._doc.createElement("style");Ut.textContent=It,je.push(Oe.appendChild(Ut))})}addHost(oe){const Oe=[];this._addStylesToHost(this._stylesSet,oe,Oe),this._hostNodes.set(oe,Oe)}removeHost(oe){const Oe=this._hostNodes.get(oe);Oe&&Oe.forEach(nr),this._hostNodes.delete(oe)}onStylesAdded(oe){this._hostNodes.forEach((Oe,je)=>{this._addStylesToHost(oe,je,Oe)})}ngOnDestroy(){this._hostNodes.forEach(oe=>oe.forEach(nr))}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(H.K0))},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})();function nr(Ee){(0,H.q)().remove(Ee)}const rn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Qt=/%COMP%/g;function Ze(Ee,le,oe){for(let Oe=0;Oe<le.length;Oe++){let je=le[Oe];Array.isArray(je)?Ze(Ee,je,oe):(je=je.replace(Qt,Ee),oe.push(je))}return oe}function Ge(Ee){return le=>{if("__ngUnwrap__"===le)return Ee;!1===Ee(le)&&(le.preventDefault(),le.returnValue=!1)}}let We=(()=>{class Ee{constructor(oe,Oe,je){this.eventManager=oe,this.sharedStylesHost=Oe,this.appId=je,this.rendererByCompId=new Map,this.defaultRenderer=new Gt(oe)}createRenderer(oe,Oe){if(!oe||!Oe)return this.defaultRenderer;switch(Oe.encapsulation){case Ie.ifc.Emulated:{let je=this.rendererByCompId.get(Oe.id);return je||(je=new Sr(this.eventManager,this.sharedStylesHost,Oe,this.appId),this.rendererByCompId.set(Oe.id,je)),je.applyToHost(oe),je}case 1:case Ie.ifc.ShadowDom:return new En(this.eventManager,this.sharedStylesHost,oe,Oe);default:if(!this.rendererByCompId.has(Oe.id)){const je=Ze(Oe.id,Oe.styles,[]);this.sharedStylesHost.addStyles(je),this.rendererByCompId.set(Oe.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(xn),Ie.LFG($t),Ie.LFG(Ie.AFp))},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})();class Gt{constructor(le){this.eventManager=le,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(le,oe){return oe?document.createElementNS(rn[oe]||oe,le):document.createElement(le)}createComment(le){return document.createComment(le)}createText(le){return document.createTextNode(le)}appendChild(le,oe){(dn(le)?le.content:le).appendChild(oe)}insertBefore(le,oe,Oe){le&&(dn(le)?le.content:le).insertBefore(oe,Oe)}removeChild(le,oe){le&&le.removeChild(oe)}selectRootElement(le,oe){let Oe="string"==typeof le?document.querySelector(le):le;if(!Oe)throw new Error(`The selector "${le}" did not match any elements`);return oe||(Oe.textContent=""),Oe}parentNode(le){return le.parentNode}nextSibling(le){return le.nextSibling}setAttribute(le,oe,Oe,je){if(je){oe=je+":"+oe;const It=rn[je];It?le.setAttributeNS(It,oe,Oe):le.setAttribute(oe,Oe)}else le.setAttribute(oe,Oe)}removeAttribute(le,oe,Oe){if(Oe){const je=rn[Oe];je?le.removeAttributeNS(je,oe):le.removeAttribute(`${Oe}:${oe}`)}else le.removeAttribute(oe)}addClass(le,oe){le.classList.add(oe)}removeClass(le,oe){le.classList.remove(oe)}setStyle(le,oe,Oe,je){je&(Ie.JOm.DashCase|Ie.JOm.Important)?le.style.setProperty(oe,Oe,je&Ie.JOm.Important?"important":""):le.style[oe]=Oe}removeStyle(le,oe,Oe){Oe&Ie.JOm.DashCase?le.style.removeProperty(oe):le.style[oe]=""}setProperty(le,oe,Oe){le[oe]=Oe}setValue(le,oe){le.nodeValue=oe}listen(le,oe,Oe){return"string"==typeof le?this.eventManager.addGlobalEventListener(le,oe,Ge(Oe)):this.eventManager.addEventListener(le,oe,Ge(Oe))}}function dn(Ee){return"TEMPLATE"===Ee.tagName&&void 0!==Ee.content}class Sr extends Gt{constructor(le,oe,Oe,je){super(le),this.component=Oe;const It=Ze(je+"-"+Oe.id,Oe.styles,[]);oe.addStyles(It),this.contentAttr=function Ct(Ee){return"_ngcontent-%COMP%".replace(Qt,Ee)}(je+"-"+Oe.id),this.hostAttr=function en(Ee){return"_nghost-%COMP%".replace(Qt,Ee)}(je+"-"+Oe.id)}applyToHost(le){super.setAttribute(le,this.hostAttr,"")}createElement(le,oe){const Oe=super.createElement(le,oe);return super.setAttribute(Oe,this.contentAttr,""),Oe}}class En extends Gt{constructor(le,oe,Oe,je){super(le),this.sharedStylesHost=oe,this.hostEl=Oe,this.shadowRoot=Oe.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const It=Ze(je.id,je.styles,[]);for(let Ut=0;Ut<It.length;Ut++){const _n=document.createElement("style");_n.textContent=It[Ut],this.shadowRoot.appendChild(_n)}}nodeOrShadowRoot(le){return le===this.hostEl?this.shadowRoot:le}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(le,oe){return super.appendChild(this.nodeOrShadowRoot(le),oe)}insertBefore(le,oe,Oe){return super.insertBefore(this.nodeOrShadowRoot(le),oe,Oe)}removeChild(le,oe){return super.removeChild(this.nodeOrShadowRoot(le),oe)}parentNode(le){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(le)))}}let qn=(()=>{class Ee extends hn{constructor(oe){super(oe)}supports(oe){return!0}addEventListener(oe,Oe,je){return oe.addEventListener(Oe,je,!1),()=>this.removeEventListener(oe,Oe,je)}removeEventListener(oe,Oe,je){return oe.removeEventListener(Oe,je)}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(H.K0))},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})();const oi=["alt","control","meta","shift"],pr={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xi={alt:Ee=>Ee.altKey,control:Ee=>Ee.ctrlKey,meta:Ee=>Ee.metaKey,shift:Ee=>Ee.shiftKey};let Jr=(()=>{class Ee extends hn{constructor(oe){super(oe)}supports(oe){return null!=Ee.parseEventName(oe)}addEventListener(oe,Oe,je){const It=Ee.parseEventName(Oe),Ut=Ee.eventCallback(It.fullKey,je,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,H.q)().onAndCancel(oe,It.domEventName,Ut))}static parseEventName(oe){const Oe=oe.toLowerCase().split("."),je=Oe.shift();if(0===Oe.length||"keydown"!==je&&"keyup"!==je)return null;const It=Ee._normalizeKey(Oe.pop());let Ut="",_n=Oe.indexOf("code");if(_n>-1&&(Oe.splice(_n,1),Ut="code."),oi.forEach(tn=>{const Zt=Oe.indexOf(tn);Zt>-1&&(Oe.splice(Zt,1),Ut+=tn+".")}),Ut+=It,0!=Oe.length||0===It.length)return null;const wt={};return wt.domEventName=je,wt.fullKey=Ut,wt}static matchEventFullKeyCode(oe,Oe){let je=pr[oe.key]||oe.key,It="";return Oe.indexOf("code.")>-1&&(je=oe.code,It="code."),!(null==je||!je)&&(je=je.toLowerCase()," "===je?je="space":"."===je&&(je="dot"),oi.forEach(Ut=>{Ut!==je&&(0,xi[Ut])(oe)&&(It+=Ut+".")}),It+=je,It===Oe)}static eventCallback(oe,Oe,je){return It=>{Ee.matchEventFullKeyCode(It,oe)&&je.runGuarded(()=>Oe(It))}}static _normalizeKey(oe){return"esc"===oe?"escape":oe}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(H.K0))},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:Ee.\u0275fac}),Ee})();const Gi=(0,Ie.eFA)(Ie._c5,"browser",[{provide:Ie.Lbi,useValue:H.bD},{provide:Ie.g9A,useValue:function $i(){c.makeCurrent()},multi:!0},{provide:H.K0,useFactory:function Li(){return(0,Ie.RDi)(document),document},deps:[]}]),Bn=new Ie.OlP(""),mn=[{provide:Ie.rWj,useClass:class st{addToWindow(le){Ie.dqk.getAngularTestability=(Oe,je=!0)=>{const It=le.findTestabilityInTree(Oe,je);if(null==It)throw new Error("Could not find testability for element.");return It},Ie.dqk.getAllAngularTestabilities=()=>le.getAllTestabilities(),Ie.dqk.getAllAngularRootElements=()=>le.getAllRootElements(),Ie.dqk.frameworkStabilizers||(Ie.dqk.frameworkStabilizers=[]),Ie.dqk.frameworkStabilizers.push(Oe=>{const je=Ie.dqk.getAllAngularTestabilities();let It=je.length,Ut=!1;const _n=function(wt){Ut=Ut||wt,It--,0==It&&Oe(Ut)};je.forEach(function(wt){wt.whenStable(_n)})})}findTestabilityInTree(le,oe,Oe){return null==oe?null:le.getTestability(oe)??(Oe?(0,H.q)().isShadowRoot(oe)?this.findTestabilityInTree(le,oe.host,!0):this.findTestabilityInTree(le,oe.parentElement,!0):null)}},deps:[]},{provide:Ie.lri,useClass:Ie.dDg,deps:[Ie.R0b,Ie.eoX,Ie.rWj]},{provide:Ie.dDg,useClass:Ie.dDg,deps:[Ie.R0b,Ie.eoX,Ie.rWj]}],pi=[{provide:Ie.zSh,useValue:"root"},{provide:Ie.qLn,useFactory:function Mr(){return new Ie.qLn},deps:[]},{provide:Tt,useClass:qn,multi:!0,deps:[H.K0,Ie.R0b,Ie.Lbi]},{provide:Tt,useClass:Jr,multi:!0,deps:[H.K0]},{provide:We,useClass:We,deps:[xn,$t,Ie.AFp]},{provide:Ie.FYo,useExisting:We},{provide:Cn,useExisting:$t},{provide:$t,useClass:$t,deps:[H.K0]},{provide:xn,useClass:xn,deps:[Tt,Ie.R0b]},{provide:H.JF,useClass:un,deps:[]},[]];let fo=(()=>{class Ee{constructor(oe){}static withServerTransition(oe){return{ngModule:Ee,providers:[{provide:Ie.AFp,useValue:oe.appId},{provide:gt,useExisting:Ie.AFp},tt]}}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(Bn,12))},Ee.\u0275mod=Ie.oAB({type:Ee}),Ee.\u0275inj=Ie.cJS({providers:[...pi,...mn],imports:[H.ez,Ie.hGG]}),Ee})(),ft=(()=>{class Ee{constructor(oe){this._doc=oe}getTitle(){return this._doc.title}setTitle(oe){this._doc.title=oe||""}}return Ee.\u0275fac=function(oe){return new(oe||Ee)(Ie.LFG(H.K0))},Ee.\u0275prov=Ie.Yz7({token:Ee,factory:function(oe){let Oe=null;return Oe=oe?new oe:function Qr(){return new ft((0,Ie.LFG)(H.K0))}(),Oe},providedIn:"root"}),Ee})();typeof window<"u"&&window},4154:(zn,zt,Te)=>{"use strict";Te.d(zt,{Bz:()=>oo,lC:()=>Uo});var H=Te(8256),Ie=Te(2076),nt=Te(9646),c=Te(7579);class Fe extends c.x{constructor(S){super(),this._value=S}get value(){return this.getValue()}_subscribe(S){const T=super._subscribe(S);return!T.closed&&S.next(this._value),T}getValue(){const{hasError:S,thrownError:T,_value:k}=this;if(S)throw T;return this._throwIfClosed(),k}next(S){super.next(this._value=S)}}const kt=(0,Te(3888).d)(I=>function(){I(this),this.name="EmptyError",this.message="no elements in sequence"});var Ye=Te(9751),gt=Te(4742),yt=Te(4671),tt=Te(3268),st=Te(7669),un=Te(1810),Tt=Te(5403),xn=Te(9672);function hn(...I){const S=(0,st.yG)(I),T=(0,st.jO)(I),{args:k,keys:U}=(0,gt.D)(I);if(0===k.length)return(0,Ie.D)([],S);const Y=new Ye.y(function Cn(I,S,T=yt.y){return k=>{$t(S,()=>{const{length:U}=I,Y=new Array(U);let me=U,be=U;for(let h=0;h<U;h++)$t(S,()=>{const r=(0,Ie.D)(I[h],S);let l=!1;r.subscribe((0,Tt.x)(k,p=>{Y[h]=p,l||(l=!0,be--),be||k.next(T(Y.slice()))},()=>{--me||k.complete()}))},k)},k)}}(k,S,U?me=>(0,un.n)(U,me):yt.y));return T?Y.pipe((0,tt.Z)(T)):Y}function $t(I,S,T){I?(0,xn.f)(T,I,S):S()}var nr=Te(8189);function Qt(...I){return function rn(){return(0,nr.J)(1)}()((0,Ie.D)(I,(0,st.yG)(I)))}var Ht=Te(8421);function xt(I){return new Ye.y(S=>{(0,Ht.Xf)(I()).subscribe(S)})}var sr=Te(9635),At=Te(576);function Ct(I,S){const T=(0,At.m)(I)?I:()=>I,k=U=>U.error(T());return new Ye.y(S?U=>S.schedule(k,0,U):k)}var en=Te(515),Ze=Te(727),Ge=Te(4482);function ot(){return(0,Ge.e)((I,S)=>{let T=null;I._refCount++;const k=(0,Tt.x)(S,void 0,void 0,void 0,()=>{if(!I||I._refCount<=0||0<--I._refCount)return void(T=null);const U=I._connection,Y=T;T=null,U&&(!Y||U===Y)&&U.unsubscribe(),S.unsubscribe()});I.subscribe(k),k.closed||(T=I.connect())})}class We extends Ye.y{constructor(S,T){super(),this.source=S,this.subjectFactory=T,this._subject=null,this._refCount=0,this._connection=null,(0,Ge.A)(S)&&(this.lift=S.lift)}_subscribe(S){return this.getSubject().subscribe(S)}getSubject(){const S=this._subject;return(!S||S.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:S}=this;this._subject=this._connection=null,S?.unsubscribe()}connect(){let S=this._connection;if(!S){S=this._connection=new Ze.w0;const T=this.getSubject();S.add(this.source.subscribe((0,Tt.x)(T,void 0,()=>{this._teardown(),T.complete()},k=>{this._teardown(),T.error(k)},()=>this._teardown()))),S.closed&&(this._connection=null,S=Ze.w0.EMPTY)}return S}refCount(){return ot()(this)}}var Gt=Te(6895),dt=Te(4004);function wn(I,S){return(0,Ge.e)((T,k)=>{let U=null,Y=0,me=!1;const be=()=>me&&!U&&k.complete();T.subscribe((0,Tt.x)(k,h=>{U?.unsubscribe();let r=0;const l=Y++;(0,Ht.Xf)(I(h,l)).subscribe(U=(0,Tt.x)(k,p=>k.next(S?S(h,p,l,r++):p),()=>{U=null,be()}))},()=>{me=!0,be()}))})}function dn(I){return I<=0?()=>en.E:(0,Ge.e)((S,T)=>{let k=0;S.subscribe((0,Tt.x)(T,U=>{++k<=I&&(T.next(U),I<=k&&T.complete())}))})}var En=Te(9300),qn=Te(5577);function oi(I){return(0,Ge.e)((S,T)=>{let k=!1;S.subscribe((0,Tt.x)(T,U=>{k=!0,T.next(U)},()=>{k||T.next(I),T.complete()}))})}function pr(I=xi){return(0,Ge.e)((S,T)=>{let k=!1;S.subscribe((0,Tt.x)(T,U=>{k=!0,T.next(U)},()=>k?T.complete():T.error(I())))})}function xi(){return new kt}function Jr(I,S){const T=arguments.length>=2;return k=>k.pipe(I?(0,En.h)((U,Y)=>I(U,Y,k)):yt.y,dn(1),T?oi(S):pr(()=>new kt))}var yr=Te(4351),hr=Te(8505),Vn=Te(262);function Oo(I,S,T,k,U){return(Y,me)=>{let be=T,h=S,r=0;Y.subscribe((0,Tt.x)(me,l=>{const p=r++;h=be?I(h,l,p):(be=!0,l),k&&me.next(h)},U&&(()=>{be&&me.next(h),me.complete()})))}}function Jn(I,S){return(0,Ge.e)(Oo(I,S,arguments.length>=2,!0))}function $i(I){return I<=0?()=>en.E:(0,Ge.e)((S,T)=>{let k=[];S.subscribe((0,Tt.x)(T,U=>{k.push(U),I<k.length&&k.shift()},()=>{for(const U of k)T.next(U);T.complete()},void 0,()=>{k=null}))})}function Mr(I,S){const T=arguments.length>=2;return k=>k.pipe(I?(0,En.h)((U,Y)=>I(U,Y,k)):yt.y,$i(1),T?oi(S):pr(()=>new kt))}function Gi(I){return(0,Ge.e)((S,T)=>{try{S.subscribe(T)}finally{T.add(I)}})}var Bn=Te(1481);const mn="primary",pi=Symbol("RouteTitle");class fo{constructor(S){this.params=S||{}}has(S){return Object.prototype.hasOwnProperty.call(this.params,S)}get(S){if(this.has(S)){const T=this.params[S];return Array.isArray(T)?T[0]:T}return null}getAll(S){if(this.has(S)){const T=this.params[S];return Array.isArray(T)?T:[T]}return[]}get keys(){return Object.keys(this.params)}}function Oi(I){return new fo(I)}function io(I,S,T){const k=T.path.split("/");if(k.length>I.length||"full"===T.pathMatch&&(S.hasChildren()||k.length<I.length))return null;const U={};for(let Y=0;Y<k.length;Y++){const me=k[Y],be=I[Y];if(me.startsWith(":"))U[me.substring(1)]=be;else if(me!==be.path)return null}return{consumed:I.slice(0,k.length),posParams:U}}function Qr(I,S){const T=I?Object.keys(I):void 0,k=S?Object.keys(S):void 0;if(!T||!k||T.length!=k.length)return!1;let U;for(let Y=0;Y<T.length;Y++)if(U=T[Y],!ft(I[U],S[U]))return!1;return!0}function ft(I,S){if(Array.isArray(I)&&Array.isArray(S)){if(I.length!==S.length)return!1;const T=[...I].sort(),k=[...S].sort();return T.every((U,Y)=>k[Y]===U)}return I===S}function _e(I){return Array.prototype.concat.apply([],I)}function xe(I){return I.length>0?I[I.length-1]:null}function it(I,S){for(const T in I)I.hasOwnProperty(T)&&S(I[T],T)}function cn(I){return(0,H.CqO)(I)?I:(0,H.QGY)(I)?(0,Ie.D)(Promise.resolve(I)):(0,nt.of)(I)}const yn={exact:function gn(I,S,T){if(!G(I.segments,S.segments)||!kn(I.segments,S.segments,T)||I.numberOfChildren!==S.numberOfChildren)return!1;for(const k in S.children)if(!I.children[k]||!gn(I.children[k],S.children[k],T))return!1;return!0},subset:dr},Ur={exact:function ai(I,S){return Qr(I,S)},subset:function zr(I,S){return Object.keys(S).length<=Object.keys(I).length&&Object.keys(S).every(T=>ft(I[T],S[T]))},ignored:()=>!0};function mr(I,S,T){return yn[T.paths](I.root,S.root,T.matrixParams)&&Ur[T.queryParams](I.queryParams,S.queryParams)&&!("exact"===T.fragment&&I.fragment!==S.fragment)}function dr(I,S,T){return Wr(I,S,S.segments,T)}function Wr(I,S,T,k){if(I.segments.length>T.length){const U=I.segments.slice(0,T.length);return!(!G(U,T)||S.hasChildren()||!kn(U,T,k))}if(I.segments.length===T.length){if(!G(I.segments,T)||!kn(I.segments,T,k))return!1;for(const U in S.children)if(!I.children[U]||!dr(I.children[U],S.children[U],k))return!1;return!0}{const U=T.slice(0,I.segments.length),Y=T.slice(I.segments.length);return!!(G(I.segments,U)&&kn(I.segments,U,k)&&I.children[mn])&&Wr(I.children[mn],S,Y,k)}}function kn(I,S,T){return S.every((k,U)=>Ur[T](I[U].parameters,k.parameters))}class Ar{constructor(S,T,k){this.root=S,this.queryParams=T,this.fragment=k}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Oi(this.queryParams)),this._queryParamMap}toString(){return Pe.serialize(this)}}class bn{constructor(S,T){this.segments=S,this.children=T,this.parent=null,it(T,(k,U)=>k.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ue(this)}}class Fi{constructor(S,T){this.path=S,this.parameters=T}get parameterMap(){return this._parameterMap||(this._parameterMap=Oi(this.parameters)),this._parameterMap}toString(){return Oe(this)}}function G(I,S){return I.length===S.length&&I.every((T,k)=>T.path===S[k].path)}let he=(()=>{class I{}return I.\u0275fac=function(T){return new(T||I)},I.\u0275prov=H.Yz7({token:I,factory:function(){return new ge},providedIn:"root"}),I})();class ge{parse(S){const T=new mi(S);return new Ar(T.parseRootSegment(),T.parseQueryParams(),T.parseFragment())}serialize(S){const T=`/${Ne(S.root,!0)}`,k=function It(I){const S=Object.keys(I).map(T=>{const k=I[T];return Array.isArray(k)?k.map(U=>`${$e(T)}=${$e(U)}`).join("&"):`${$e(T)}=${$e(k)}`}).filter(T=>!!T);return S.length?`?${S.join("&")}`:""}(S.queryParams);return`${T}${k}${"string"==typeof S.fragment?`#${function pt(I){return encodeURI(I)}(S.fragment)}`:""}`}}const Pe=new ge;function Ue(I){return I.segments.map(S=>Oe(S)).join("/")}function Ne(I,S){if(!I.hasChildren())return Ue(I);if(S){const T=I.children[mn]?Ne(I.children[mn],!1):"",k=[];return it(I.children,(U,Y)=>{Y!==mn&&k.push(`${Y}:${Ne(U,!1)}`)}),k.length>0?`${T}(${k.join("//")})`:T}{const T=function q(I,S){let T=[];return it(I.children,(k,U)=>{U===mn&&(T=T.concat(S(k,U)))}),it(I.children,(k,U)=>{U!==mn&&(T=T.concat(S(k,U)))}),T}(I,(k,U)=>U===mn?[Ne(I.children[mn],!1)]:[`${U}:${Ne(k,!1)}`]);return 1===Object.keys(I.children).length&&null!=I.children[mn]?`${Ue(I)}/${T[0]}`:`${Ue(I)}/(${T.join("//")})`}}function Re(I){return encodeURIComponent(I).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function $e(I){return Re(I).replace(/%3B/gi,";")}function Ee(I){return Re(I).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function le(I){return decodeURIComponent(I)}function oe(I){return le(I.replace(/\+/g,"%20"))}function Oe(I){return`${Ee(I.path)}${function je(I){return Object.keys(I).map(S=>`;${Ee(S)}=${Ee(I[S])}`).join("")}(I.parameters)}`}const Ut=/^[^\/()?;=#]+/;function _n(I){const S=I.match(Ut);return S?S[0]:""}const wt=/^[^=?&#]+/,Zt=/^[^&#]+/;class mi{constructor(S){this.url=S,this.remaining=S}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new bn([],{}):new bn([],this.parseChildren())}parseQueryParams(){const S={};if(this.consumeOptional("?"))do{this.parseQueryParam(S)}while(this.consumeOptional("&"));return S}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const S=[];for(this.peekStartsWith("(")||S.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),S.push(this.parseSegment());let T={};this.peekStartsWith("/(")&&(this.capture("/"),T=this.parseParens(!0));let k={};return this.peekStartsWith("(")&&(k=this.parseParens(!1)),(S.length>0||Object.keys(T).length>0)&&(k[mn]=new bn(S,T)),k}parseSegment(){const S=_n(this.remaining);if(""===S&&this.peekStartsWith(";"))throw new H.vHH(4009,!1);return this.capture(S),new Fi(le(S),this.parseMatrixParams())}parseMatrixParams(){const S={};for(;this.consumeOptional(";");)this.parseParam(S);return S}parseParam(S){const T=_n(this.remaining);if(!T)return;this.capture(T);let k="";if(this.consumeOptional("=")){const U=_n(this.remaining);U&&(k=U,this.capture(k))}S[le(T)]=le(k)}parseQueryParam(S){const T=function tn(I){const S=I.match(wt);return S?S[0]:""}(this.remaining);if(!T)return;this.capture(T);let k="";if(this.consumeOptional("=")){const me=function Ke(I){const S=I.match(Zt);return S?S[0]:""}(this.remaining);me&&(k=me,this.capture(k))}const U=oe(T),Y=oe(k);if(S.hasOwnProperty(U)){let me=S[U];Array.isArray(me)||(me=[me],S[U]=me),me.push(Y)}else S[U]=Y}parseParens(S){const T={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const k=_n(this.remaining),U=this.remaining[k.length];if("/"!==U&&")"!==U&&";"!==U)throw new H.vHH(4010,!1);let Y;k.indexOf(":")>-1?(Y=k.slice(0,k.indexOf(":")),this.capture(Y),this.capture(":")):S&&(Y=mn);const me=this.parseChildren();T[Y]=1===Object.keys(me).length?me[mn]:new bn([],me),this.consumeOptional("//")}return T}peekStartsWith(S){return this.remaining.startsWith(S)}consumeOptional(S){return!!this.peekStartsWith(S)&&(this.remaining=this.remaining.substring(S.length),!0)}capture(S){if(!this.consumeOptional(S))throw new H.vHH(4011,!1)}}function $n(I){return I.segments.length>0?new bn([],{[mn]:I}):I}function Ti(I){const S={};for(const k of Object.keys(I.children)){const Y=Ti(I.children[k]);(Y.segments.length>0||Y.hasChildren())&&(S[k]=Y)}return function Br(I){if(1===I.numberOfChildren&&I.children[mn]){const S=I.children[mn];return new bn(I.segments.concat(S.segments),S.children)}return I}(new bn(I.segments,S))}function qr(I){return I instanceof Ar}function Fn(I,S,T,k,U){if(0===T.length)return li(S.root,S.root,S.root,k,U);const Y=function mo(I){if("string"==typeof I[0]&&1===I.length&&"/"===I[0])return new zi(!0,0,I);let S=0,T=!1;const k=I.reduce((U,Y,me)=>{if("object"==typeof Y&&null!=Y){if(Y.outlets){const be={};return it(Y.outlets,(h,r)=>{be[r]="string"==typeof h?h.split("/"):h}),[...U,{outlets:be}]}if(Y.segmentPath)return[...U,Y.segmentPath]}return"string"!=typeof Y?[...U,Y]:0===me?(Y.split("/").forEach((be,h)=>{0==h&&"."===be||(0==h&&""===be?T=!0:".."===be?S++:""!=be&&U.push(be))}),U):[...U,Y]},[]);return new zi(T,S,k)}(T);return Y.toRoot()?li(S.root,S.root,new bn([],{}),k,U):function me(h){const r=function jr(I,S,T,k){if(I.isAbsolute)return new To(S.root,!0,0);if(-1===k)return new To(T,T===S.root,0);return function Fa(I,S,T){let k=I,U=S,Y=T;for(;Y>U;){if(Y-=U,k=k.parent,!k)throw new H.vHH(4005,!1);U=k.segments.length}return new To(k,!1,U-Y)}(T,k+(Tn(I.commands[0])?0:1),I.numberOfDoubleDots)}(Y,S,I.snapshot?._urlSegment,h),l=r.processChildren?Bi(r.segmentGroup,r.index,Y.commands):Fo(r.segmentGroup,r.index,Y.commands);return li(S.root,r.segmentGroup,l,k,U)}(I.snapshot?._lastPathIndex)}function Tn(I){return"object"==typeof I&&null!=I&&!I.outlets&&!I.segmentPath}function Er(I){return"object"==typeof I&&null!=I&&I.outlets}function li(I,S,T,k,U){let me,Y={};k&&it(k,(h,r)=>{Y[r]=Array.isArray(h)?h.map(l=>`${l}`):`${h}`}),me=I===S?T:Dn(I,S,T);const be=$n(Ti(me));return new Ar(be,Y,U)}function Dn(I,S,T){const k={};return it(I.children,(U,Y)=>{k[Y]=U===S?T:Dn(U,S,T)}),new bn(I.segments,k)}class zi{constructor(S,T,k){if(this.isAbsolute=S,this.numberOfDoubleDots=T,this.commands=k,S&&k.length>0&&Tn(k[0]))throw new H.vHH(4003,!1);const U=k.find(Er);if(U&&U!==xe(k))throw new H.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class To{constructor(S,T,k){this.segmentGroup=S,this.processChildren=T,this.index=k}}function Fo(I,S,T){if(I||(I=new bn([],{})),0===I.segments.length&&I.hasChildren())return Bi(I,S,T);const k=function Ls(I,S,T){let k=0,U=S;const Y={match:!1,pathIndex:0,commandIndex:0};for(;U<I.segments.length;){if(k>=T.length)return Y;const me=I.segments[U],be=T[k];if(Er(be))break;const h=`${be}`,r=k<T.length-1?T[k+1]:null;if(U>0&&void 0===h)break;if(h&&r&&"object"==typeof r&&void 0===r.outlets){if(!Di(h,r,me))return Y;k+=2}else{if(!Di(h,{},me))return Y;k++}U++}return{match:!0,pathIndex:U,commandIndex:k}}(I,S,T),U=T.slice(k.commandIndex);if(k.match&&k.pathIndex<I.segments.length){const Y=new bn(I.segments.slice(0,k.pathIndex),{});return Y.children[mn]=new bn(I.segments.slice(k.pathIndex),I.children),Bi(Y,0,U)}return k.match&&0===U.length?new bn(I.segments,{}):k.match&&!I.hasChildren()?Hi(I,S,T):k.match?Bi(I,0,U):Hi(I,S,T)}function Bi(I,S,T){if(0===T.length)return new bn(I.segments,{});{const k=function Do(I){return Er(I[0])?I[0].outlets:{[mn]:I}}(T),U={};return it(k,(Y,me)=>{"string"==typeof Y&&(Y=[Y]),null!==Y&&(U[me]=Fo(I.children[me],S,Y))}),it(I.children,(Y,me)=>{void 0===k[me]&&(U[me]=Y)}),new bn(I.segments,U)}}function Hi(I,S,T){const k=I.segments.slice(0,S);let U=0;for(;U<T.length;){const Y=T[U];if(Er(Y)){const h=Tr(Y.outlets);return new bn(k,h)}if(0===U&&Tn(T[0])){k.push(new Fi(I.segments[S].path,vr(T[0]))),U++;continue}const me=Er(Y)?Y.outlets[mn]:`${Y}`,be=U<T.length-1?T[U+1]:null;me&&be&&Tn(be)?(k.push(new Fi(me,vr(be))),U+=2):(k.push(new Fi(me,{})),U++)}return new bn(k,{})}function Tr(I){const S={};return it(I,(T,k)=>{"string"==typeof T&&(T=[T]),null!==T&&(S[k]=Hi(new bn([],{}),0,T))}),S}function vr(I){const S={};return it(I,(T,k)=>S[k]=`${T}`),S}function Di(I,S,T){return I==T.path&&Qr(S,T.parameters)}class Xr{constructor(S,T){this.id=S,this.url=T}}class Ci extends Xr{constructor(S,T,k="imperative",U=null){super(S,T),this.type=0,this.navigationTrigger=k,this.restoredState=U}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class gr extends Xr{constructor(S,T,k){super(S,T),this.urlAfterRedirects=k,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Yo extends Xr{constructor(S,T,k,U){super(S,T),this.reason=k,this.code=U,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class gi extends Xr{constructor(S,T,k,U){super(S,T),this.error=k,this.target=U,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ei extends Xr{constructor(S,T,k,U){super(S,T),this.urlAfterRedirects=k,this.state=U,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class za extends Xr{constructor(S,T,k,U){super(S,T),this.urlAfterRedirects=k,this.state=U,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xl extends Xr{constructor(S,T,k,U,Y){super(S,T),this.urlAfterRedirects=k,this.state=U,this.shouldActivate=Y,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ia extends Xr{constructor(S,T,k,U){super(S,T),this.urlAfterRedirects=k,this.state=U,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ii extends Xr{constructor(S,T,k,U){super(S,T),this.urlAfterRedirects=k,this.state=U,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ba{constructor(S){this.route=S,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class tc{constructor(S){this.route=S,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Co{constructor(S){this.snapshot=S,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Na{constructor(S){this.snapshot=S,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bl{constructor(S){this.snapshot=S,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gu{constructor(S){this.snapshot=S,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wl{constructor(S,T,k){this.routerEvent=S,this.position=T,this.anchor=k,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class kc{constructor(S){this._root=S}get root(){return this._root.value}parent(S){const T=this.pathFromRoot(S);return T.length>1?T[T.length-2]:null}children(S){const T=El(S,this._root);return T?T.children.map(k=>k.value):[]}firstChild(S){const T=El(S,this._root);return T&&T.children.length>0?T.children[0].value:null}siblings(S){const T=Ko(S,this._root);return T.length<2?[]:T[T.length-2].children.map(U=>U.value).filter(U=>U!==S)}pathFromRoot(S){return Ko(S,this._root).map(T=>T.value)}}function El(I,S){if(I===S.value)return S;for(const T of S.children){const k=El(I,T);if(k)return k}return null}function Ko(I,S){if(I===S.value)return[S];for(const T of S.children){const k=Ko(I,T);if(k.length)return k.unshift(S),k}return[]}class _i{constructor(S,T){this.value=S,this.children=T}toString(){return`TreeNode(${this.value})`}}function ss(I){const S={};return I&&I.children.forEach(T=>S[T.value.outlet]=T),S}class zo extends kc{constructor(S,T){super(S),this.snapshot=T,Ua(this,S)}toString(){return this.snapshot.toString()}}function as(I,S){const T=function sa(I,S){const me=new ls([],{},{},"",{},mn,S,null,I.root,-1,{});return new aa("",new _i(me,[]))}(I,S),k=new Fe([new Fi("",{})]),U=new Fe({}),Y=new Fe({}),me=new Fe({}),be=new Fe(""),h=new Os(k,U,me,be,Y,mn,S,T.root);return h.snapshot=T.root,new zo(new _i(h,[]),T)}class Os{constructor(S,T,k,U,Y,me,be,h){this.url=S,this.params=T,this.queryParams=k,this.fragment=U,this.data=Y,this.outlet=me,this.component=be,this.title=this.data?.pipe((0,dt.U)(r=>r[pi]))??(0,nt.of)(void 0),this._futureSnapshot=h}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,dt.U)(S=>Oi(S)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,dt.U)(S=>Oi(S)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function _u(I,S="emptyOnly"){const T=I.pathFromRoot;let k=0;if("always"!==S)for(k=T.length-1;k>=1;){const U=T[k],Y=T[k-1];if(U.routeConfig&&""===U.routeConfig.path)k--;else{if(Y.component)break;k--}}return function Bo(I){return I.reduce((S,T)=>({params:{...S.params,...T.params},data:{...S.data,...T.data},resolve:{...T.data,...S.resolve,...T.routeConfig?.data,...T._resolvedData}}),{params:{},data:{},resolve:{}})}(T.slice(k))}class ls{constructor(S,T,k,U,Y,me,be,h,r,l,p,_){this.url=S,this.params=T,this.queryParams=k,this.fragment=U,this.data=Y,this.outlet=me,this.component=be,this.title=this.data?.[pi],this.routeConfig=h,this._urlSegment=r,this._lastPathIndex=l,this._correctedLastPathIndex=_??l,this._resolve=p}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Oi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Oi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(k=>k.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class aa extends kc{constructor(S,T){super(T),this.url=S,Ua(this,T)}toString(){return Tl(this._root)}}function Ua(I,S){S.value._routerState=I,S.children.forEach(T=>Ua(I,T))}function Tl(I){const S=I.children.length>0?` { ${I.children.map(Tl).join(", ")} } `:"";return`${I.value}${S}`}function nc(I){if(I.snapshot){const S=I.snapshot,T=I._futureSnapshot;I.snapshot=T,Qr(S.queryParams,T.queryParams)||I.queryParams.next(T.queryParams),S.fragment!==T.fragment&&I.fragment.next(T.fragment),Qr(S.params,T.params)||I.params.next(T.params),function Xo(I,S){if(I.length!==S.length)return!1;for(let T=0;T<I.length;++T)if(!Qr(I[T],S[T]))return!1;return!0}(S.url,T.url)||I.url.next(T.url),Qr(S.data,T.data)||I.data.next(T.data)}else I.snapshot=I._futureSnapshot,I.data.next(I._futureSnapshot.data)}function Ki(I,S){const T=Qr(I.params,S.params)&&function ue(I,S){return G(I,S)&&I.every((T,k)=>Qr(T.parameters,S[k].parameters))}(I.url,S.url);return T&&!(!I.parent!=!S.parent)&&(!I.parent||Ki(I.parent,S.parent))}function Fs(I,S,T){if(T&&I.shouldReuseRoute(S.value,T.value.snapshot)){const k=T.value;k._futureSnapshot=S.value;const U=function ja(I,S,T){return S.children.map(k=>{for(const U of T.children)if(I.shouldReuseRoute(k.value,U.value.snapshot))return Fs(I,k,U);return Fs(I,k)})}(I,S,T);return new _i(k,U)}{if(I.shouldAttach(S.value)){const Y=I.retrieve(S.value);if(null!==Y){const me=Y.route;return me.value._futureSnapshot=S.value,me.children=S.children.map(be=>Fs(I,be)),me}}const k=function Cl(I){return new Os(new Fe(I.url),new Fe(I.params),new Fe(I.queryParams),new Fe(I.fragment),new Fe(I.data),I.outlet,I.component,I)}(S.value),U=S.children.map(Y=>Fs(I,Y));return new _i(k,U)}}const yi="ngNavigationCancelingError";function cs(I,S){const{redirectTo:T,navigationBehaviorOptions:k}=qr(S)?{redirectTo:S,navigationBehaviorOptions:void 0}:S,U=us(!1,0,S);return U.url=T,U.navigationBehaviorOptions=k,U}function us(I,S,T){const k=new Error("NavigationCancelingError: "+(I||""));return k[yi]=!0,k.cancellationCode=S,T&&(k.url=T),k}function No(I){return zs(I)&&qr(I.url)}function zs(I){return I&&I[yi]}class rc{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Hn,this.attachRef=null}}let Hn=(()=>{class I{constructor(){this.contexts=new Map}onChildOutletCreated(T,k){const U=this.getOrCreateContext(T);U.outlet=k,this.contexts.set(T,U)}onChildOutletDestroyed(T){const k=this.getContext(T);k&&(k.outlet=null,k.attachRef=null)}onOutletDeactivated(){const T=this.contexts;return this.contexts=new Map,T}onOutletReAttached(T){this.contexts=T}getOrCreateContext(T){let k=this.getContext(T);return k||(k=new rc,this.contexts.set(T,k)),k}getContext(T){return this.contexts.get(T)||null}}return I.\u0275fac=function(T){return new(T||I)},I.\u0275prov=H.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})();const Bs=!1;let Uo=(()=>{class I{constructor(T,k,U,Y,me){this.parentContexts=T,this.location=k,this.changeDetector=Y,this.environmentInjector=me,this.activated=null,this._activatedRoute=null,this.activateEvents=new H.vpe,this.deactivateEvents=new H.vpe,this.attachEvents=new H.vpe,this.detachEvents=new H.vpe,this.name=U||mn,T.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const T=this.parentContexts.getContext(this.name);T&&T.route&&(T.attachRef?this.attach(T.attachRef,T.route):this.activateWith(T.route,T.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new H.vHH(4012,Bs);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new H.vHH(4012,Bs);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new H.vHH(4012,Bs);this.location.detach();const T=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(T.instance),T}attach(T,k){this.activated=T,this._activatedRoute=k,this.location.insert(T.hostView),this.attachEvents.emit(T.instance)}deactivate(){if(this.activated){const T=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(T)}}activateWith(T,k){if(this.isActivated)throw new H.vHH(4013,Bs);this._activatedRoute=T;const U=this.location,me=T._futureSnapshot.component,be=this.parentContexts.getOrCreateContext(this.name).children,h=new lr(T,be,U.injector);if(k&&function Zi(I){return!!I.resolveComponentFactory}(k)){const r=k.resolveComponentFactory(me);this.activated=U.createComponent(r,U.length,h)}else this.activated=U.createComponent(me,{index:U.length,injector:h,environmentInjector:k??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return I.\u0275fac=function(T){return new(T||I)(H.Y36(Hn),H.Y36(H.s_b),H.$8M("name"),H.Y36(H.sBO),H.Y36(H.lqb))},I.\u0275dir=H.lG2({type:I,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),I})();class lr{constructor(S,T,k){this.route=S,this.childContexts=T,this.parent=k}get(S,T){return S===Os?this.route:S===Hn?this.childContexts:this.parent.get(S,T)}}let la=(()=>{class I{}return I.\u0275fac=function(T){return new(T||I)},I.\u0275cmp=H.Xpm({type:I,selectors:[["ng-component"]],standalone:!0,features:[H.jDz],decls:1,vars:0,template:function(T,k){1&T&&H._UZ(0,"router-outlet")},dependencies:[Uo],encapsulation:2}),I})();function Ns(I,S){return I.providers&&!I._injector&&(I._injector=(0,H.MMx)(I.providers,S,`Route: ${I.path}`)),I._injector??S}function Pn(I){const S=I.children&&I.children.map(Pn),T=S?{...I,children:S}:{...I};return!T.component&&!T.loadComponent&&(S||T.loadChildren)&&T.outlet&&T.outlet!==mn&&(T.component=la),T}function Ji(I){return I.outlet||mn}function $a(I,S){const T=I.filter(k=>Ji(k)===S);return T.push(...I.filter(k=>Ji(k)!==S)),T}function Us(I){if(!I)return null;if(I.routeConfig?._injector)return I.routeConfig._injector;for(let S=I.parent;S;S=S.parent){const T=S.routeConfig;if(T?._loadedInjector)return T._loadedInjector;if(T?._injector)return T._injector}return null}class Sl{constructor(S,T,k,U){this.routeReuseStrategy=S,this.futureState=T,this.currState=k,this.forwardEvent=U}activate(S){const T=this.futureState._root,k=this.currState?this.currState._root:null;this.deactivateChildRoutes(T,k,S),nc(this.futureState.root),this.activateChildRoutes(T,k,S)}deactivateChildRoutes(S,T,k){const U=ss(T);S.children.forEach(Y=>{const me=Y.value.outlet;this.deactivateRoutes(Y,U[me],k),delete U[me]}),it(U,(Y,me)=>{this.deactivateRouteAndItsChildren(Y,k)})}deactivateRoutes(S,T,k){const U=S.value,Y=T?T.value:null;if(U===Y)if(U.component){const me=k.getContext(U.outlet);me&&this.deactivateChildRoutes(S,T,me.children)}else this.deactivateChildRoutes(S,T,k);else Y&&this.deactivateRouteAndItsChildren(T,k)}deactivateRouteAndItsChildren(S,T){S.value.component&&this.routeReuseStrategy.shouldDetach(S.value.snapshot)?this.detachAndStoreRouteSubtree(S,T):this.deactivateRouteAndOutlet(S,T)}detachAndStoreRouteSubtree(S,T){const k=T.getContext(S.value.outlet),U=k&&S.value.component?k.children:T,Y=ss(S);for(const me of Object.keys(Y))this.deactivateRouteAndItsChildren(Y[me],U);if(k&&k.outlet){const me=k.outlet.detach(),be=k.children.onOutletDeactivated();this.routeReuseStrategy.store(S.value.snapshot,{componentRef:me,route:S,contexts:be})}}deactivateRouteAndOutlet(S,T){const k=T.getContext(S.value.outlet),U=k&&S.value.component?k.children:T,Y=ss(S);for(const me of Object.keys(Y))this.deactivateRouteAndItsChildren(Y[me],U);k&&k.outlet&&(k.outlet.deactivate(),k.children.onOutletDeactivated(),k.attachRef=null,k.resolver=null,k.route=null)}activateChildRoutes(S,T,k){const U=ss(T);S.children.forEach(Y=>{this.activateRoutes(Y,U[Y.value.outlet],k),this.forwardEvent(new gu(Y.value.snapshot))}),S.children.length&&this.forwardEvent(new Na(S.value.snapshot))}activateRoutes(S,T,k){const U=S.value,Y=T?T.value:null;if(nc(U),U===Y)if(U.component){const me=k.getOrCreateContext(U.outlet);this.activateChildRoutes(S,T,me.children)}else this.activateChildRoutes(S,T,k);else if(U.component){const me=k.getOrCreateContext(U.outlet);if(this.routeReuseStrategy.shouldAttach(U.snapshot)){const be=this.routeReuseStrategy.retrieve(U.snapshot);this.routeReuseStrategy.store(U.snapshot,null),me.children.onOutletReAttached(be.contexts),me.attachRef=be.componentRef,me.route=be.route.value,me.outlet&&me.outlet.attach(be.componentRef,be.route.value),nc(be.route.value),this.activateChildRoutes(S,null,me.children)}else{const be=Us(U.snapshot),h=be?.get(H._Vd)??null;me.attachRef=null,me.route=U,me.resolver=h,me.injector=be,me.outlet&&me.outlet.activateWith(U,me.injector),this.activateChildRoutes(S,null,me.children)}}else this.activateChildRoutes(S,null,k)}}class Ga{constructor(S){this.path=S,this.route=this.path[this.path.length-1]}}class ha{constructor(S,T){this.component=S,this.route=T}}function ic(I,S,T){const k=I._root;return Es(k,S?S._root:null,T,[k.value])}function Gn(I,S){const T=Symbol(),k=S.get(I,T);return k===T?"function"!=typeof I||(0,H.Z0I)(I)?S.get(I):I:k}function Es(I,S,T,k,U={canDeactivateChecks:[],canActivateChecks:[]}){const Y=ss(S);return I.children.forEach(me=>{(function da(I,S,T,k,U={canDeactivateChecks:[],canActivateChecks:[]}){const Y=I.value,me=S?S.value:null,be=T?T.getContext(I.value.outlet):null;if(me&&Y.routeConfig===me.routeConfig){const h=function ti(I,S,T){if("function"==typeof T)return T(I,S);switch(T){case"pathParamsChange":return!G(I.url,S.url);case"pathParamsOrQueryParamsChange":return!G(I.url,S.url)||!Qr(I.queryParams,S.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ki(I,S)||!Qr(I.queryParams,S.queryParams);default:return!Ki(I,S)}}(me,Y,Y.routeConfig.runGuardsAndResolvers);h?U.canActivateChecks.push(new Ga(k)):(Y.data=me.data,Y._resolvedData=me._resolvedData),Es(I,S,Y.component?be?be.children:null:T,k,U),h&&be&&be.outlet&&be.outlet.isActivated&&U.canDeactivateChecks.push(new ha(be.outlet.component,me))}else me&&Si(S,be,U),U.canActivateChecks.push(new Ga(k)),Es(I,null,Y.component?be?be.children:null:T,k,U)})(me,Y[me.value.outlet],T,k.concat([me.value]),U),delete Y[me.value.outlet]}),it(Y,(me,be)=>Si(me,T.getContext(be),U)),U}function Si(I,S,T){const k=ss(I),U=I.value;it(k,(Y,me)=>{Si(Y,U.component?S?S.children.getContext(me):null:S,T)}),T.canDeactivateChecks.push(new ha(U.component&&S&&S.outlet&&S.outlet.isActivated?S.outlet.component:null,U))}function Wi(I){return"function"==typeof I}function Vo(I){return I instanceof kt||"EmptyError"===I?.name}const hs=Symbol("INITIAL_VALUE");function Io(){return wn(I=>hn(I.map(S=>S.pipe(dn(1),function Sr(...I){const S=(0,st.yG)(I);return(0,Ge.e)((T,k)=>{(S?Qt(I,T,S):Qt(I,T)).subscribe(k)})}(hs)))).pipe((0,dt.U)(S=>{for(const T of S)if(!0!==T){if(T===hs)return hs;if(!1===T||T instanceof Ar)return T}return!0}),(0,En.h)(S=>S!==hs),dn(1)))}function B(I){return(0,sr.z)((0,hr.b)(S=>{if(qr(S))throw cs(0,S)}),(0,dt.U)(S=>!0===S))}const Me={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function rt(I,S,T,k,U){const Y=Dt(I,S,T);return Y.matched?function Q(I,S,T,k){const U=S.canMatch;if(!U||0===U.length)return(0,nt.of)(!0);const Y=U.map(me=>{const be=Gn(me,I);return cn(function Fc(I){return I&&Wi(I.canMatch)}(be)?be.canMatch(S,T):I.runInContext(()=>be(S,T)))});return(0,nt.of)(Y).pipe(Io(),B())}(k=Ns(S,k),S,T).pipe((0,dt.U)(me=>!0===me?Y:{...Me})):(0,nt.of)(Y)}function Dt(I,S,T){if(""===S.path)return"full"===S.pathMatch&&(I.hasChildren()||T.length>0)?{...Me}:{matched:!0,consumedSegments:[],remainingSegments:T,parameters:{},positionalParamSegments:{}};const U=(S.matcher||io)(T,I,S);if(!U)return{...Me};const Y={};it(U.posParams,(be,h)=>{Y[h]=be.path});const me=U.consumed.length>0?{...Y,...U.consumed[U.consumed.length-1].parameters}:Y;return{matched:!0,consumedSegments:U.consumed,remainingSegments:T.slice(U.consumed.length),parameters:me,positionalParamSegments:U.posParams??{}}}function sn(I,S,T,k,U="corrected"){if(T.length>0&&function Dr(I,S,T){return T.some(k=>Nn(I,S,k)&&Ji(k)!==mn)}(I,T,k)){const me=new bn(S,function fr(I,S,T,k){const U={};U[mn]=k,k._sourceSegment=I,k._segmentIndexShift=S.length;for(const Y of T)if(""===Y.path&&Ji(Y)!==mn){const me=new bn([],{});me._sourceSegment=I,me._segmentIndexShift=S.length,U[Ji(Y)]=me}return U}(I,S,k,new bn(T,I.children)));return me._sourceSegment=I,me._segmentIndexShift=S.length,{segmentGroup:me,slicedSegments:[]}}if(0===T.length&&function rr(I,S,T){return T.some(k=>Nn(I,S,k))}(I,T,k)){const me=new bn(I.segments,function xr(I,S,T,k,U,Y){const me={};for(const be of k)if(Nn(I,T,be)&&!U[Ji(be)]){const h=new bn([],{});h._sourceSegment=I,h._segmentIndexShift="legacy"===Y?I.segments.length:S.length,me[Ji(be)]=h}return{...U,...me}}(I,S,T,k,I.children,U));return me._sourceSegment=I,me._segmentIndexShift=S.length,{segmentGroup:me,slicedSegments:T}}const Y=new bn(I.segments,I.children);return Y._sourceSegment=I,Y._segmentIndexShift=S.length,{segmentGroup:Y,slicedSegments:T}}function Nn(I,S,T){return(!(I.hasChildren()||S.length>0)||"full"!==T.pathMatch)&&""===T.path}function ir(I,S,T,k){return!!(Ji(I)===k||k!==mn&&Nn(S,T,I))&&("**"===I.path||Dt(S,I,T).matched)}function Yn(I,S,T){return 0===S.length&&!I.children[T]}const qi=!1;class bi{constructor(S){this.segmentGroup=S||null}}class Jo{constructor(S){this.urlTree=S}}function Qi(I){return Ct(new bi(I))}function or(I){return Ct(new Jo(I))}class Gs{constructor(S,T,k,U,Y){this.injector=S,this.configLoader=T,this.urlSerializer=k,this.urlTree=U,this.config=Y,this.allowRedirects=!0}apply(){const S=sn(this.urlTree.root,[],[],this.config).segmentGroup,T=new bn(S.segments,S.children);return this.expandSegmentGroup(this.injector,this.config,T,mn).pipe((0,dt.U)(Y=>this.createUrlTree(Ti(Y),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,Vn.K)(Y=>{if(Y instanceof Jo)return this.allowRedirects=!1,this.match(Y.urlTree);throw Y instanceof bi?this.noMatchError(Y):Y}))}match(S){return this.expandSegmentGroup(this.injector,this.config,S.root,mn).pipe((0,dt.U)(U=>this.createUrlTree(Ti(U),S.queryParams,S.fragment))).pipe((0,Vn.K)(U=>{throw U instanceof bi?this.noMatchError(U):U}))}noMatchError(S){return new H.vHH(4002,qi)}createUrlTree(S,T,k){const U=$n(S);return new Ar(U,T,k)}expandSegmentGroup(S,T,k,U){return 0===k.segments.length&&k.hasChildren()?this.expandChildren(S,T,k).pipe((0,dt.U)(Y=>new bn([],Y))):this.expandSegment(S,k,T,k.segments,U,!0)}expandChildren(S,T,k){const U=[];for(const Y of Object.keys(k.children))"primary"===Y?U.unshift(Y):U.push(Y);return(0,Ie.D)(U).pipe((0,yr.b)(Y=>{const me=k.children[Y],be=$a(T,Y);return this.expandSegmentGroup(S,be,me,Y).pipe((0,dt.U)(h=>({segment:h,outlet:Y})))}),Jn((Y,me)=>(Y[me.outlet]=me.segment,Y),{}),Mr())}expandSegment(S,T,k,U,Y,me){return(0,Ie.D)(k).pipe((0,yr.b)(be=>this.expandSegmentAgainstRoute(S,T,k,be,U,Y,me).pipe((0,Vn.K)(r=>{if(r instanceof bi)return(0,nt.of)(null);throw r}))),Jr(be=>!!be),(0,Vn.K)((be,h)=>{if(Vo(be))return Yn(T,U,Y)?(0,nt.of)(new bn([],{})):Qi(T);throw be}))}expandSegmentAgainstRoute(S,T,k,U,Y,me,be){return ir(U,T,Y,me)?void 0===U.redirectTo?this.matchSegmentAgainstRoute(S,T,U,Y,me):be&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(S,T,k,U,Y,me):Qi(T):Qi(T)}expandSegmentAgainstRouteUsingRedirect(S,T,k,U,Y,me){return"**"===U.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(S,k,U,me):this.expandRegularSegmentAgainstRouteUsingRedirect(S,T,k,U,Y,me)}expandWildCardWithParamsAgainstRouteUsingRedirect(S,T,k,U){const Y=this.applyRedirectCommands([],k.redirectTo,{});return k.redirectTo.startsWith("/")?or(Y):this.lineralizeSegments(k,Y).pipe((0,qn.z)(me=>{const be=new bn(me,{});return this.expandSegment(S,be,T,me,U,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(S,T,k,U,Y,me){const{matched:be,consumedSegments:h,remainingSegments:r,positionalParamSegments:l}=Dt(T,U,Y);if(!be)return Qi(T);const p=this.applyRedirectCommands(h,U.redirectTo,l);return U.redirectTo.startsWith("/")?or(p):this.lineralizeSegments(U,p).pipe((0,qn.z)(_=>this.expandSegment(S,T,k,_.concat(r),me,!1)))}matchSegmentAgainstRoute(S,T,k,U,Y){return"**"===k.path?(S=Ns(k,S),k.loadChildren?(k._loadedRoutes?(0,nt.of)({routes:k._loadedRoutes,injector:k._loadedInjector}):this.configLoader.loadChildren(S,k)).pipe((0,dt.U)(be=>(k._loadedRoutes=be.routes,k._loadedInjector=be.injector,new bn(U,{})))):(0,nt.of)(new bn(U,{}))):rt(T,k,U,S).pipe(wn(({matched:me,consumedSegments:be,remainingSegments:h})=>me?this.getChildConfig(S=k._injector??S,k,U).pipe((0,qn.z)(l=>{const p=l.injector??S,_=l.routes,{segmentGroup:v,slicedSegments:E}=sn(T,be,h,_),C=new bn(v.segments,v.children);if(0===E.length&&C.hasChildren())return this.expandChildren(p,_,C).pipe((0,dt.U)(Z=>new bn(be,Z)));if(0===_.length&&0===E.length)return(0,nt.of)(new bn(be,{}));const A=Ji(k)===Y;return this.expandSegment(p,C,_,E,A?mn:Y,!0).pipe((0,dt.U)(N=>new bn(be.concat(N.segments),N.children)))})):Qi(T)))}getChildConfig(S,T,k){return T.children?(0,nt.of)({routes:T.children,injector:S}):T.loadChildren?void 0!==T._loadedRoutes?(0,nt.of)({routes:T._loadedRoutes,injector:T._loadedInjector}):function W(I,S,T,k){const U=S.canLoad;if(void 0===U||0===U.length)return(0,nt.of)(!0);const Y=U.map(me=>{const be=Gn(me,I);return cn(function js(I){return I&&Wi(I.canLoad)}(be)?be.canLoad(S,T):I.runInContext(()=>be(S,T)))});return(0,nt.of)(Y).pipe(Io(),B())}(S,T,k).pipe((0,qn.z)(U=>U?this.configLoader.loadChildren(S,T).pipe((0,hr.b)(Y=>{T._loadedRoutes=Y.routes,T._loadedInjector=Y.injector})):function Vs(I){return Ct(us(qi,3))}())):(0,nt.of)({routes:[],injector:S})}lineralizeSegments(S,T){let k=[],U=T.root;for(;;){if(k=k.concat(U.segments),0===U.numberOfChildren)return(0,nt.of)(k);if(U.numberOfChildren>1||!U.children[mn])return Ct(new H.vHH(4e3,qi));U=U.children[mn]}}applyRedirectCommands(S,T,k){return this.applyRedirectCreateUrlTree(T,this.urlSerializer.parse(T),S,k)}applyRedirectCreateUrlTree(S,T,k,U){const Y=this.createSegmentGroup(S,T.root,k,U);return new Ar(Y,this.createQueryParams(T.queryParams,this.urlTree.queryParams),T.fragment)}createQueryParams(S,T){const k={};return it(S,(U,Y)=>{if("string"==typeof U&&U.startsWith(":")){const be=U.substring(1);k[Y]=T[be]}else k[Y]=U}),k}createSegmentGroup(S,T,k,U){const Y=this.createSegments(S,T.segments,k,U);let me={};return it(T.children,(be,h)=>{me[h]=this.createSegmentGroup(S,be,k,U)}),new bn(Y,me)}createSegments(S,T,k,U){return T.map(Y=>Y.path.startsWith(":")?this.findPosParam(S,Y,U):this.findOrReturn(Y,k))}findPosParam(S,T,k){const U=k[T.path.substring(1)];if(!U)throw new H.vHH(4001,qi);return U}findOrReturn(S,T){let k=0;for(const U of T){if(U.path===S.path)return T.splice(k),U;k++}return S}}class Uc{}class ac{constructor(S,T,k,U,Y,me,be,h){this.injector=S,this.rootComponentType=T,this.config=k,this.urlTree=U,this.url=Y,this.paramsInheritanceStrategy=me,this.relativeLinkResolution=be,this.urlSerializer=h}recognize(){const S=sn(this.urlTree.root,[],[],this.config.filter(T=>void 0===T.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,S,mn).pipe((0,dt.U)(T=>{if(null===T)return null;const k=new ls([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},mn,this.rootComponentType,null,this.urlTree.root,-1,{}),U=new _i(k,T),Y=new aa(this.url,U);return this.inheritParamsAndData(Y._root),Y}))}inheritParamsAndData(S){const T=S.value,k=_u(T,this.paramsInheritanceStrategy);T.params=Object.freeze(k.params),T.data=Object.freeze(k.data),S.children.forEach(U=>this.inheritParamsAndData(U))}processSegmentGroup(S,T,k,U){return 0===k.segments.length&&k.hasChildren()?this.processChildren(S,T,k):this.processSegment(S,T,k,k.segments,U)}processChildren(S,T,k){return(0,Ie.D)(Object.keys(k.children)).pipe((0,yr.b)(U=>{const Y=k.children[U],me=$a(T,U);return this.processSegmentGroup(S,me,Y,U)}),Jn((U,Y)=>U&&Y?(U.push(...Y),U):null),function Li(I,S=!1){return(0,Ge.e)((T,k)=>{let U=0;T.subscribe((0,Tt.x)(k,Y=>{const me=I(Y,U++);(me||S)&&k.next(Y),!me&&k.complete()}))})}(U=>null!==U),oi(null),Mr(),(0,dt.U)(U=>{if(null===U)return null;const Y=lc(U);return function Wa(I){I.sort((S,T)=>S.value.outlet===mn?-1:T.value.outlet===mn?1:S.value.outlet.localeCompare(T.value.outlet))}(Y),Y}))}processSegment(S,T,k,U,Y){return(0,Ie.D)(T).pipe((0,yr.b)(me=>this.processSegmentAgainstRoute(me._injector??S,me,k,U,Y)),Jr(me=>!!me),(0,Vn.K)(me=>{if(Vo(me))return Yn(k,U,Y)?(0,nt.of)([]):(0,nt.of)(null);throw me}))}processSegmentAgainstRoute(S,T,k,U,Y){if(T.redirectTo||!ir(T,k,U,Y))return(0,nt.of)(null);let me;if("**"===T.path){const be=U.length>0?xe(U).parameters:{},h=Xt(k)+U.length,r=new ls(U,be,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Al(T),Ji(T),T.component??T._loadedComponent??null,T,Xa(k),h,Pl(T),h);me=(0,nt.of)({snapshot:r,consumedSegments:[],remainingSegments:[]})}else me=rt(k,T,U,S).pipe((0,dt.U)(({matched:be,consumedSegments:h,remainingSegments:r,parameters:l})=>{if(!be)return null;const p=Xt(k)+h.length;return{snapshot:new ls(h,l,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Al(T),Ji(T),T.component??T._loadedComponent??null,T,Xa(k),p,Pl(T),p),consumedSegments:h,remainingSegments:r}}));return me.pipe(wn(be=>{if(null===be)return(0,nt.of)(null);const{snapshot:h,consumedSegments:r,remainingSegments:l}=be;S=T._injector??S;const p=T._loadedInjector??S,_=function pa(I){return I.children?I.children:I.loadChildren?I._loadedRoutes:[]}(T),{segmentGroup:v,slicedSegments:E}=sn(k,r,l,_.filter(A=>void 0===A.redirectTo),this.relativeLinkResolution);if(0===E.length&&v.hasChildren())return this.processChildren(p,_,v).pipe((0,dt.U)(A=>null===A?null:[new _i(h,A)]));if(0===_.length&&0===E.length)return(0,nt.of)([new _i(h,[])]);const C=Ji(T)===Y;return this.processSegment(p,_,v,E,C?mn:Y).pipe((0,dt.U)(A=>null===A?null:[new _i(h,A)]))}))}}function ma(I){const S=I.value.routeConfig;return S&&""===S.path&&void 0===S.redirectTo}function lc(I){const S=[],T=new Set;for(const k of I){if(!ma(k)){S.push(k);continue}const U=S.find(Y=>k.value.routeConfig===Y.value.routeConfig);void 0!==U?(U.children.push(...k.children),T.add(U)):S.push(k)}for(const k of T){const U=lc(k.children);S.push(new _i(k.value,U))}return S.filter(k=>!T.has(k))}function Xa(I){let S=I;for(;S._sourceSegment;)S=S._sourceSegment;return S}function Xt(I){let S=I,T=S._segmentIndexShift??0;for(;S._sourceSegment;)S=S._sourceSegment,T+=S._segmentIndexShift??0;return T-1}function Al(I){return I.data||{}}function Pl(I){return I.resolve||{}}function kl(I){return"string"==typeof I.title||null===I.title}function Zs(I){return wn(S=>{const T=I(S);return T?(0,Ie.D)(T).pipe((0,dt.U)(()=>S)):(0,nt.of)(S)})}let Cs=(()=>{class I{buildTitle(T){let k,U=T.root;for(;void 0!==U;)k=this.getResolvedTitleForRoute(U)??k,U=U.children.find(Y=>Y.outlet===mn);return k}getResolvedTitleForRoute(T){return T.data[pi]}}return I.\u0275fac=function(T){return new(T||I)},I.\u0275prov=H.Yz7({token:I,factory:function(){return(0,H.f3M)(jc)},providedIn:"root"}),I})(),jc=(()=>{class I extends Cs{constructor(T){super(),this.title=T}updateTitle(T){const k=this.buildTitle(T);void 0!==k&&this.title.setTitle(k)}}return I.\u0275fac=function(T){return new(T||I)(H.LFG(Bn.Dx))},I.\u0275prov=H.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})();class yu{}class Vc extends class Mo{shouldDetach(S){return!1}store(S,T){}shouldAttach(S){return!1}retrieve(S){return null}shouldReuseRoute(S,T){return S.routeConfig===T.routeConfig}}{}const ps=new H.OlP("",{providedIn:"root",factory:()=>({})}),Qo=new H.OlP("ROUTES");let ga=(()=>{class I{constructor(T,k){this.injector=T,this.compiler=k,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(T){if(this.componentLoaders.get(T))return this.componentLoaders.get(T);if(T._loadedComponent)return(0,nt.of)(T._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(T);const k=cn(T.loadComponent()).pipe((0,hr.b)(Y=>{this.onLoadEndListener&&this.onLoadEndListener(T),T._loadedComponent=Y}),Gi(()=>{this.componentLoaders.delete(T)})),U=new We(k,()=>new c.x).pipe(ot());return this.componentLoaders.set(T,U),U}loadChildren(T,k){if(this.childrenLoaders.get(k))return this.childrenLoaders.get(k);if(k._loadedRoutes)return(0,nt.of)({routes:k._loadedRoutes,injector:k._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(k);const Y=this.loadModuleFactoryOrRoutes(k.loadChildren).pipe((0,dt.U)(be=>{this.onLoadEndListener&&this.onLoadEndListener(k);let h,r,l=!1;Array.isArray(be)?r=be:(h=be.create(T).injector,r=_e(h.get(Qo,[],H.XFs.Self|H.XFs.Optional)));return{routes:r.map(Pn),injector:h}}),Gi(()=>{this.childrenLoaders.delete(k)})),me=new We(Y,()=>new c.x).pipe(ot());return this.childrenLoaders.set(k,me),me}loadModuleFactoryOrRoutes(T){return cn(T()).pipe((0,qn.z)(k=>k instanceof H.YKP||Array.isArray(k)?(0,nt.of)(k):(0,Ie.D)(this.compiler.compileModuleAsync(k))))}}return I.\u0275fac=function(T){return new(T||I)(H.LFG(H.zs3),H.LFG(H.Sil))},I.\u0275prov=H.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})();class vu{}class $c{shouldProcessUrl(S){return!0}extract(S){return S}merge(S,T){return S}}function Ll(I){throw I}function _a(I,S,T){return S.parse("/")}const uc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Ol={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function Fl(){const I=(0,H.f3M)(he),S=(0,H.f3M)(Hn),T=(0,H.f3M)(Gt.Ye),k=(0,H.f3M)(H.zs3),U=(0,H.f3M)(H.Sil),Y=(0,H.f3M)(Qo,{optional:!0})??[],me=(0,H.f3M)(ps,{optional:!0})??{},be=(0,H.f3M)(jc),h=(0,H.f3M)(Cs,{optional:!0}),r=(0,H.f3M)(vu,{optional:!0}),l=(0,H.f3M)(yu,{optional:!0}),p=new Pi(null,I,S,T,k,U,_e(Y));return r&&(p.urlHandlingStrategy=r),l&&(p.routeReuseStrategy=l),p.titleStrategy=h??be,function Ka(I,S){I.errorHandler&&(S.errorHandler=I.errorHandler),I.malformedUriErrorHandler&&(S.malformedUriErrorHandler=I.malformedUriErrorHandler),I.onSameUrlNavigation&&(S.onSameUrlNavigation=I.onSameUrlNavigation),I.paramsInheritanceStrategy&&(S.paramsInheritanceStrategy=I.paramsInheritanceStrategy),I.relativeLinkResolution&&(S.relativeLinkResolution=I.relativeLinkResolution),I.urlUpdateStrategy&&(S.urlUpdateStrategy=I.urlUpdateStrategy),I.canceledNavigationResolution&&(S.canceledNavigationResolution=I.canceledNavigationResolution)}(me,p),p}let Pi=(()=>{class I{constructor(T,k,U,Y,me,be,h){this.rootComponentType=T,this.urlSerializer=k,this.rootContexts=U,this.location=Y,this.config=h,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new c.x,this.errorHandler=Ll,this.malformedUriErrorHandler=_a,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>(0,nt.of)(void 0),this.urlHandlingStrategy=new $c,this.routeReuseStrategy=new Vc,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=me.get(ga),this.configLoader.onLoadEndListener=_=>this.triggerEvent(new tc(_)),this.configLoader.onLoadStartListener=_=>this.triggerEvent(new Ba(_)),this.ngModule=me.get(H.h0i),this.console=me.get(H.c2e);const p=me.get(H.R0b);this.isNgZoneEnabled=p instanceof H.R0b&&H.R0b.isInAngularZone(),this.resetConfig(h),this.currentUrlTree=function ar(){return new Ar(new bn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=as(this.currentUrlTree,this.rootComponentType),this.transitions=new Fe({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(T){const k=this.events;return T.pipe((0,En.h)(U=>0!==U.id),(0,dt.U)(U=>({...U,extractedUrl:this.urlHandlingStrategy.extract(U.rawUrl)})),wn(U=>{let Y=!1,me=!1;return(0,nt.of)(U).pipe((0,hr.b)(be=>{this.currentNavigation={id:be.id,initialUrl:be.rawUrl,extractedUrl:be.extractedUrl,trigger:be.source,extras:be.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),wn(be=>{const h=this.browserUrlTree.toString(),r=!this.navigated||be.extractedUrl.toString()!==h||h!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||r)&&this.urlHandlingStrategy.shouldProcessUrl(be.rawUrl))return ci(be.source)&&(this.browserUrlTree=be.extractedUrl),(0,nt.of)(be).pipe(wn(p=>{const _=this.transitions.getValue();return k.next(new Ci(p.id,this.serializeUrl(p.extractedUrl),p.source,p.restoredState)),_!==this.transitions.getValue()?en.E:Promise.resolve(p)}),function Nc(I,S,T,k){return wn(U=>function $s(I,S,T,k,U){return new Gs(I,S,T,k,U).apply()}(I,S,T,U.extractedUrl,k).pipe((0,dt.U)(Y=>({...U,urlAfterRedirects:Y}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),(0,hr.b)(p=>{this.currentNavigation={...this.currentNavigation,finalUrl:p.urlAfterRedirects},U.urlAfterRedirects=p.urlAfterRedirects}),function Hs(I,S,T,k,U,Y){return(0,qn.z)(me=>function fa(I,S,T,k,U,Y,me="emptyOnly",be="legacy"){return new ac(I,S,T,k,U,me,be,Y).recognize().pipe(wn(h=>null===h?function So(I){return new Ye.y(S=>S.error(I))}(new Uc):(0,nt.of)(h)))}(I,S,T,me.urlAfterRedirects,k.serialize(me.urlAfterRedirects),k,U,Y).pipe((0,dt.U)(be=>({...me,targetSnapshot:be}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),(0,hr.b)(p=>{if(U.targetSnapshot=p.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!p.extras.skipLocationChange){const v=this.urlHandlingStrategy.merge(p.urlAfterRedirects,p.rawUrl);this.setBrowserUrl(v,p)}this.browserUrlTree=p.urlAfterRedirects}const _=new ei(p.id,this.serializeUrl(p.extractedUrl),this.serializeUrl(p.urlAfterRedirects),p.targetSnapshot);k.next(_)}));if(r&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:_,extractedUrl:v,source:E,restoredState:C,extras:A}=be,z=new Ci(_,this.serializeUrl(v),E,C);k.next(z);const N=as(v,this.rootComponentType).snapshot;return U={...be,targetSnapshot:N,urlAfterRedirects:v,extras:{...A,skipLocationChange:!1,replaceUrl:!1}},(0,nt.of)(U)}return this.rawUrlTree=be.rawUrl,be.resolve(null),en.E}),(0,hr.b)(be=>{const h=new za(be.id,this.serializeUrl(be.extractedUrl),this.serializeUrl(be.urlAfterRedirects),be.targetSnapshot);this.triggerEvent(h)}),(0,dt.U)(be=>U={...be,guards:ic(be.targetSnapshot,be.currentSnapshot,this.rootContexts)}),function yo(I,S){return(0,qn.z)(T=>{const{targetSnapshot:k,currentSnapshot:U,guards:{canActivateChecks:Y,canDeactivateChecks:me}}=T;return 0===me.length&&0===Y.length?(0,nt.of)({...T,guardsResult:!0}):function zc(I,S,T,k){return(0,Ie.D)(I).pipe((0,qn.z)(U=>function F(I,S,T,k,U){const Y=S&&S.routeConfig?S.routeConfig.canDeactivate:null;if(!Y||0===Y.length)return(0,nt.of)(!0);const me=Y.map(be=>{const h=Us(S)??U,r=Gn(be,h);return cn(function Oc(I){return I&&Wi(I.canDeactivate)}(r)?r.canDeactivate(I,S,T,k):h.runInContext(()=>r(I,S,T,k))).pipe(Jr())});return(0,nt.of)(me).pipe(Io())}(U.component,U.route,T,S,k)),Jr(U=>!0!==U,!0))}(me,k,U,I).pipe((0,qn.z)(be=>be&&function _o(I){return"boolean"==typeof I}(be)?function Ha(I,S,T,k){return(0,Ie.D)(S).pipe((0,yr.b)(U=>Qt(function sc(I,S){return null!==I&&S&&S(new Co(I)),(0,nt.of)(!0)}(U.route.parent,k),function Bc(I,S){return null!==I&&S&&S(new bl(I)),(0,nt.of)(!0)}(U.route,k),function Ts(I,S,T){const k=S[S.length-1],Y=S.slice(0,S.length-1).reverse().map(me=>function St(I){const S=I.routeConfig?I.routeConfig.canActivateChild:null;return S&&0!==S.length?{node:I,guards:S}:null}(me)).filter(me=>null!==me).map(me=>xt(()=>{const be=me.guards.map(h=>{const r=Us(me.node)??T,l=Gn(h,r);return cn(function Lc(I){return I&&Wi(I.canActivateChild)}(l)?l.canActivateChild(k,I):r.runInContext(()=>l(k,I))).pipe(Jr())});return(0,nt.of)(be).pipe(Io())}));return(0,nt.of)(Y).pipe(Io())}(I,U.path,T),function Za(I,S,T){const k=S.routeConfig?S.routeConfig.canActivate:null;if(!k||0===k.length)return(0,nt.of)(!0);const U=k.map(Y=>xt(()=>{const me=Us(S)??T,be=Gn(Y,me);return cn(function Ml(I){return I&&Wi(I.canActivate)}(be)?be.canActivate(S,I):me.runInContext(()=>be(S,I))).pipe(Jr())}));return(0,nt.of)(U).pipe(Io())}(I,U.route,T))),Jr(U=>!0!==U,!0))}(k,Y,I,S):(0,nt.of)(be)),(0,dt.U)(be=>({...T,guardsResult:be})))})}(this.ngModule.injector,be=>this.triggerEvent(be)),(0,hr.b)(be=>{if(U.guardsResult=be.guardsResult,qr(be.guardsResult))throw cs(0,be.guardsResult);const h=new xl(be.id,this.serializeUrl(be.extractedUrl),this.serializeUrl(be.urlAfterRedirects),be.targetSnapshot,!!be.guardsResult);this.triggerEvent(h)}),(0,En.h)(be=>!!be.guardsResult||(this.restoreHistory(be),this.cancelNavigationTransition(be,"",3),!1)),Zs(be=>{if(be.guards.canActivateChecks.length)return(0,nt.of)(be).pipe((0,hr.b)(h=>{const r=new ia(h.id,this.serializeUrl(h.extractedUrl),this.serializeUrl(h.urlAfterRedirects),h.targetSnapshot);this.triggerEvent(r)}),wn(h=>{let r=!1;return(0,nt.of)(h).pipe(function Go(I,S){return(0,qn.z)(T=>{const{targetSnapshot:k,guards:{canActivateChecks:U}}=T;if(!U.length)return(0,nt.of)(T);let Y=0;return(0,Ie.D)(U).pipe((0,yr.b)(me=>function cc(I,S,T,k){const U=I.routeConfig,Y=I._resolve;return void 0!==U?.title&&!kl(U)&&(Y[pi]=U.title),function ds(I,S,T,k){const U=function Rl(I){return[...Object.keys(I),...Object.getOwnPropertySymbols(I)]}(I);if(0===U.length)return(0,nt.of)({});const Y={};return(0,Ie.D)(U).pipe((0,qn.z)(me=>function fs(I,S,T,k){const U=Us(S)??k,Y=Gn(I,U);return cn(Y.resolve?Y.resolve(S,T):U.runInContext(()=>Y(S,T)))}(I[me],S,T,k).pipe(Jr(),(0,hr.b)(be=>{Y[me]=be}))),$i(1),function si(I){return(0,dt.U)(()=>I)}(Y),(0,Vn.K)(me=>Vo(me)?en.E:Ct(me)))}(Y,I,S,k).pipe((0,dt.U)(me=>(I._resolvedData=me,I.data=_u(I,T).resolve,U&&kl(U)&&(I.data[pi]=U.title),null)))}(me.route,k,I,S)),(0,hr.b)(()=>Y++),$i(1),(0,qn.z)(me=>Y===U.length?(0,nt.of)(T):en.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),(0,hr.b)({next:()=>r=!0,complete:()=>{r||(this.restoreHistory(h),this.cancelNavigationTransition(h,"",2))}}))}),(0,hr.b)(h=>{const r=new Ii(h.id,this.serializeUrl(h.extractedUrl),this.serializeUrl(h.urlAfterRedirects),h.targetSnapshot);this.triggerEvent(r)}))}),Zs(be=>{const h=r=>{const l=[];r.routeConfig?.loadComponent&&!r.routeConfig._loadedComponent&&l.push(this.configLoader.loadComponent(r.routeConfig).pipe((0,hr.b)(p=>{r.component=p}),(0,dt.U)(()=>{})));for(const p of r.children)l.push(...h(p));return l};return hn(h(be.targetSnapshot.root)).pipe(oi(),dn(1))}),Zs(()=>this.afterPreactivation()),(0,dt.U)(be=>{const h=function Dl(I,S,T){const k=Fs(I,S._root,T?T._root:void 0);return new zo(k,S)}(this.routeReuseStrategy,be.targetSnapshot,be.currentRouterState);return U={...be,targetRouterState:h}}),(0,hr.b)(be=>{this.currentUrlTree=be.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(be.urlAfterRedirects,be.rawUrl),this.routerState=be.targetRouterState,"deferred"===this.urlUpdateStrategy&&(be.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,be),this.browserUrlTree=be.urlAfterRedirects)}),((I,S,T)=>(0,dt.U)(k=>(new Sl(S,k.targetRouterState,k.currentRouterState,T).activate(I),k)))(this.rootContexts,this.routeReuseStrategy,be=>this.triggerEvent(be)),(0,hr.b)({next(){Y=!0},complete(){Y=!0}}),Gi(()=>{Y||me||this.cancelNavigationTransition(U,"",1),this.currentNavigation?.id===U.id&&(this.currentNavigation=null)}),(0,Vn.K)(be=>{if(me=!0,zs(be)){No(be)||(this.navigated=!0,this.restoreHistory(U,!0));const h=new Yo(U.id,this.serializeUrl(U.extractedUrl),be.message,be.cancellationCode);if(k.next(h),No(be)){const r=this.urlHandlingStrategy.merge(be.url,this.rawUrlTree),l={skipLocationChange:U.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ci(U.source)};this.scheduleNavigation(r,"imperative",null,l,{resolve:U.resolve,reject:U.reject,promise:U.promise})}else U.resolve(!1)}else{this.restoreHistory(U,!0);const h=new gi(U.id,this.serializeUrl(U.extractedUrl),be,U.targetSnapshot??void 0);k.next(h);try{U.resolve(this.errorHandler(be))}catch(r){U.reject(r)}}return en.E}))}))}resetRootComponentType(T){this.rootComponentType=T,this.routerState.root.component=this.rootComponentType}setTransition(T){this.transitions.next({...this.transitions.value,...T})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(T=>{const k="popstate"===T.type?"popstate":"hashchange";"popstate"===k&&setTimeout(()=>{const U={replaceUrl:!0},Y=T.state?.navigationId?T.state:null;if(Y){const be={...Y};delete be.navigationId,delete be.\u0275routerPageId,0!==Object.keys(be).length&&(U.state=be)}const me=this.parseUrl(T.url);this.scheduleNavigation(me,k,Y,U)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(T){this.events.next(T)}resetConfig(T){this.config=T.map(Pn),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(T,k={}){const{relativeTo:U,queryParams:Y,fragment:me,queryParamsHandling:be,preserveFragment:h}=k,r=U||this.routerState.root,l=h?this.currentUrlTree.fragment:me;let p=null;switch(be){case"merge":p={...this.currentUrlTree.queryParams,...Y};break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=Y||null}return null!==p&&(p=this.removeEmptyProps(p)),Fn(r,this.currentUrlTree,T,p,l??null)}navigateByUrl(T,k={skipLocationChange:!1}){const U=qr(T)?T:this.parseUrl(T),Y=this.urlHandlingStrategy.merge(U,this.rawUrlTree);return this.scheduleNavigation(Y,"imperative",null,k)}navigate(T,k={skipLocationChange:!1}){return function hc(I){for(let S=0;S<I.length;S++){if(null==I[S])throw new H.vHH(4008,false)}}(T),this.navigateByUrl(this.createUrlTree(T,k),k)}serializeUrl(T){return this.urlSerializer.serialize(T)}parseUrl(T){let k;try{k=this.urlSerializer.parse(T)}catch(U){k=this.malformedUriErrorHandler(U,this.urlSerializer,T)}return k}isActive(T,k){let U;if(U=!0===k?{...uc}:!1===k?{...Ol}:k,qr(T))return mr(this.currentUrlTree,T,U);const Y=this.parseUrl(T);return mr(this.currentUrlTree,Y,U)}removeEmptyProps(T){return Object.keys(T).reduce((k,U)=>{const Y=T[U];return null!=Y&&(k[U]=Y),k},{})}processNavigations(){this.navigations.subscribe(T=>{this.navigated=!0,this.lastSuccessfulId=T.id,this.currentPageId=T.targetPageId,this.events.next(new gr(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),T.resolve(!0)},T=>{this.console.warn(`Unhandled Navigation Error: ${T}`)})}scheduleNavigation(T,k,U,Y,me){if(this.disposed)return Promise.resolve(!1);let be,h,r;me?(be=me.resolve,h=me.reject,r=me.promise):r=new Promise((_,v)=>{be=_,h=v});const l=++this.navigationId;let p;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(U=this.location.getState()),p=U&&U.\u0275routerPageId?U.\u0275routerPageId:Y.replaceUrl||Y.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):p=0,this.setTransition({id:l,targetPageId:p,source:k,restoredState:U,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:T,extras:Y,resolve:be,reject:h,promise:r,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),r.catch(_=>Promise.reject(_))}setBrowserUrl(T,k){const U=this.urlSerializer.serialize(T),Y={...k.extras.state,...this.generateNgRouterState(k.id,k.targetPageId)};this.location.isCurrentPathEqualTo(U)||k.extras.replaceUrl?this.location.replaceState(U,"",Y):this.location.go(U,"",Y)}restoreHistory(T,k=!1){if("computed"===this.canceledNavigationResolution){const U=this.currentPageId-T.targetPageId;"popstate"!==T.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===U?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===U&&(this.resetState(T),this.browserUrlTree=T.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(U)}else"replace"===this.canceledNavigationResolution&&(k&&this.resetState(T),this.resetUrlToCurrentUrlTree())}resetState(T){this.routerState=T.currentRouterState,this.currentUrlTree=T.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,T.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(T,k,U){const Y=new Yo(T.id,this.serializeUrl(T.extractedUrl),k,U);this.triggerEvent(Y),T.resolve(!1)}generateNgRouterState(T,k){return"computed"===this.canceledNavigationResolution?{navigationId:T,\u0275routerPageId:k}:{navigationId:T}}}return I.\u0275fac=function(T){H.$Z()},I.\u0275prov=H.Yz7({token:I,factory:function(){return Fl()},providedIn:"root"}),I})();function ci(I){return"imperative"!==I}class es{}let Yi=(()=>{class I{constructor(T,k,U,Y,me){this.router=T,this.injector=U,this.preloadingStrategy=Y,this.loader=me}setUpPreloading(){this.subscription=this.router.events.pipe((0,En.h)(T=>T instanceof gr),(0,yr.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(T,k){const U=[];for(const Y of k){Y.providers&&!Y._injector&&(Y._injector=(0,H.MMx)(Y.providers,T,`Route: ${Y.path}`));const me=Y._injector??T,be=Y._loadedInjector??me;Y.loadChildren&&!Y._loadedRoutes&&void 0===Y.canLoad||Y.loadComponent&&!Y._loadedComponent?U.push(this.preloadConfig(me,Y)):(Y.children||Y._loadedRoutes)&&U.push(this.processRoutes(be,Y.children??Y._loadedRoutes))}return(0,Ie.D)(U).pipe((0,nr.J)())}preloadConfig(T,k){return this.preloadingStrategy.preload(k,()=>{let U;U=k.loadChildren&&void 0===k.canLoad?this.loader.loadChildren(T,k):(0,nt.of)(null);const Y=U.pipe((0,qn.z)(me=>null===me?(0,nt.of)(void 0):(k._loadedRoutes=me.routes,k._loadedInjector=me.injector,this.processRoutes(me.injector??T,me.routes))));if(k.loadComponent&&!k._loadedComponent){const me=this.loader.loadComponent(k);return(0,Ie.D)([Y,me]).pipe((0,nr.J)())}return Y})}}return I.\u0275fac=function(T){return new(T||I)(H.LFG(Pi),H.LFG(H.Sil),H.LFG(H.lqb),H.LFG(es),H.LFG(ga))},I.\u0275prov=H.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"}),I})();const ts=new H.OlP("");let Yt=(()=>{class I{constructor(T,k,U={}){this.router=T,this.viewportScroller=k,this.options=U,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},U.scrollPositionRestoration=U.scrollPositionRestoration||"disabled",U.anchorScrolling=U.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(T=>{T instanceof Ci?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=T.navigationTrigger,this.restoredId=T.restoredState?T.restoredState.navigationId:0):T instanceof gr&&(this.lastId=T.id,this.scheduleScrollEvent(T,this.router.parseUrl(T.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(T=>{T instanceof wl&&(T.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(T.position):T.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(T.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(T,k){this.router.triggerEvent(new wl(T,"popstate"===this.lastSource?this.store[this.restoredId]:null,k))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return I.\u0275fac=function(T){H.$Z()},I.\u0275prov=H.Yz7({token:I,factory:I.\u0275fac}),I})();function gs(I,S){return{\u0275kind:I,\u0275providers:S}}function Rr(I){return[{provide:Qo,multi:!0,useValue:I}]}function bu(){const I=(0,H.f3M)(H.zs3);return S=>{const T=I.get(H.z2F);if(S!==T.components[0])return;const k=I.get(Pi),U=I.get(wu);1===I.get(Hc)&&k.initialNavigation(),I.get(Ws,null,H.XFs.Optional)?.setUpPreloading(),I.get(ts,null,H.XFs.Optional)?.init(),k.resetRootComponentType(T.componentTypes[0]),U.next(),U.complete()}}const wu=new H.OlP("",{factory:()=>new c.x}),Hc=new H.OlP("",{providedIn:"root",factory:()=>1});const Ws=new H.OlP("");function tl(I){return gs(0,[{provide:Ws,useExisting:Yi},{provide:es,useExisting:I}])}const qs=new H.OlP("ROUTER_FORROOT_GUARD"),Eu=[Gt.Ye,{provide:he,useClass:ge},{provide:Pi,useFactory:Fl},Hn,{provide:Os,useFactory:function el(I){return I.routerState.root},deps:[Pi]},ga];function qc(){return new H.PXZ("Router",Pi)}let oo=(()=>{class I{constructor(T){}static forRoot(T,k){return{ngModule:I,providers:[Eu,[],Rr(T),{provide:qs,useFactory:nl,deps:[[Pi,new H.FiY,new H.tp0]]},{provide:ps,useValue:k||{}},k?.useHash?{provide:Gt.S$,useClass:Gt.Do}:{provide:Gt.S$,useClass:Gt.b0},{provide:ts,useFactory:()=>{const I=(0,H.f3M)(Pi),S=(0,H.f3M)(Gt.EM),T=(0,H.f3M)(ps);return T.scrollOffset&&S.setOffset(T.scrollOffset),new Yt(I,S,T)}},k?.preloadingStrategy?tl(k.preloadingStrategy).\u0275providers:[],{provide:H.PXZ,multi:!0,useFactory:qc},k?.initialNavigation?Xc(k):[],[{provide:rl,useFactory:bu},{provide:H.tb,multi:!0,useExisting:rl}]]}}static forChild(T){return{ngModule:I,providers:[Rr(T)]}}}return I.\u0275fac=function(T){return new(T||I)(H.LFG(qs,8))},I.\u0275mod=H.oAB({type:I}),I.\u0275inj=H.cJS({imports:[la]}),I})();function nl(I){return"guarded"}function Xc(I){return["disabled"===I.initialNavigation?gs(3,[{provide:H.ip1,multi:!0,useFactory:()=>{const S=(0,H.f3M)(Pi);return()=>{S.setUpLocationChangeListener()}}},{provide:Hc,useValue:2}]).\u0275providers:[],"enabledBlocking"===I.initialNavigation?gs(2,[{provide:Hc,useValue:0},{provide:H.ip1,multi:!0,deps:[H.zs3],useFactory:S=>{const T=S.get(Gt.V_,Promise.resolve());let k=!1;return()=>T.then(()=>new Promise(Y=>{const me=S.get(Pi),be=S.get(wu);(function U(Y){S.get(Pi).events.pipe((0,En.h)(be=>be instanceof gr||be instanceof Yo||be instanceof gi),(0,dt.U)(be=>be instanceof gr||be instanceof Yo&&(0===be.code||1===be.code)&&null),(0,En.h)(be=>null!==be),dn(1)).subscribe(()=>{Y()})})(()=>{Y(!0),k=!0}),me.afterPreactivation=()=>(Y(!0),k||be.closed?(0,nt.of)(void 0):be),me.initialNavigation()}))}}]).\u0275providers:[]]}const rl=new H.OlP("")}},zn=>{zn(zn.s=2865)}]);